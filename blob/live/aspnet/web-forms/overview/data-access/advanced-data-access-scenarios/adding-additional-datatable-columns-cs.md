---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-cs
title: "添加其他数据表列 (C#) |Microsoft 文档"
author: rick-anderson
description: "使用 TableAdapter 向导时创建的类型化数据集，相应的数据表中的主数据库查询返回的列。 但存在..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/18/2007
ms.topic: article
ms.assetid: 615f3361-f21f-4338-8bc1-fce8ae071de9
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-cs
msc.type: authoredcontent
ms.openlocfilehash: 0b1fe8d2e376065aed8d94b1267910bd1f7e5bd0
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="adding-additional-datatable-columns-c"></a><span data-ttu-id="7f17f-104">添加其他数据表列 (C#)</span><span class="sxs-lookup"><span data-stu-id="7f17f-104">Adding Additional DataTable Columns (C#)</span></span>
====================
<span data-ttu-id="7f17f-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7f17f-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7f17f-106">[下载代码](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_CS.zip)或[下载 PDF](adding-additional-datatable-columns-cs/_static/datatutorial70cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="7f17f-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_CS.zip) or [Download PDF](adding-additional-datatable-columns-cs/_static/datatutorial70cs1.pdf)</span></span>

> <span data-ttu-id="7f17f-107">使用 TableAdapter 向导时创建的类型化数据集，相应的数据表中的主数据库查询返回的列。</span><span class="sxs-lookup"><span data-stu-id="7f17f-107">When using the TableAdapter Wizard to create a Typed DataSet, the corresponding DataTable contains the columns returned by the main database query.</span></span> <span data-ttu-id="7f17f-108">但有时当 DataTable 需要包含额外的列。</span><span class="sxs-lookup"><span data-stu-id="7f17f-108">But there are occasions when the DataTable needs to include additional columns.</span></span> <span data-ttu-id="7f17f-109">在本教程中我们了解为什么存储的过程时，建议使用我们需要其他数据表列。</span><span class="sxs-lookup"><span data-stu-id="7f17f-109">In this tutorial we learn why stored procedures are recommended when we need additional DataTable columns.</span></span>


## <a name="introduction"></a><span data-ttu-id="7f17f-110">介绍</span><span class="sxs-lookup"><span data-stu-id="7f17f-110">Introduction</span></span>

<span data-ttu-id="7f17f-111">当为类型化数据集添加 TableAdapter，相应的 DataTable 的架构由 TableAdapter s 主查询决定。</span><span class="sxs-lookup"><span data-stu-id="7f17f-111">When adding a TableAdapter to a Typed DataSet, the corresponding DataTable s schema is determined by the TableAdapter s main query.</span></span> <span data-ttu-id="7f17f-112">例如，如果主查询返回数据字段*A*， *B*，和*C*，DataTable 将具有三个名为的相应列*A*，*B*，和*C*。除了其主查询 TableAdapter 可以包括其他可能返回基于某些参数的数据子集的查询。</span><span class="sxs-lookup"><span data-stu-id="7f17f-112">For example, if the main query returns data fields *A*, *B*, and *C*, the DataTable will have three corresponding columns named *A*, *B*, and *C*. In addition to its main query, a TableAdapter can include additional queries that return, perhaps, a subset of the data based on some parameter.</span></span> <span data-ttu-id="7f17f-113">例如，于`ProductsTableAdapter`s 主查询，返回有关所有产品的信息，它还包含等方法`GetProductsByCategoryID(categoryID)`和`GetProductByProductID(productID)`，其返回基于提供的参数的特定产品信息。</span><span class="sxs-lookup"><span data-stu-id="7f17f-113">For instance, in addition to the `ProductsTableAdapter` s main query, which returns information about all products, it also contains methods like `GetProductsByCategoryID(categoryID)` and `GetProductByProductID(productID)`, which return specific product information based on a supplied parameter.</span></span>

<span data-ttu-id="7f17f-114">也在所有 TableAdapter 的方法返回相同或比主查询中指定的更少数据字段的工作将 DataTable 的架构反映 TableAdapter s 主查询的模型。</span><span class="sxs-lookup"><span data-stu-id="7f17f-114">The model of having the DataTable s schema reflect the TableAdapter s main query works well if all of the TableAdapter s methods return the same or fewer data fields than those specified in the main query.</span></span> <span data-ttu-id="7f17f-115">如果需要返回其他数据字段的 TableAdapter 方法，然后我们应 DataTable 的架构也相应扩展。</span><span class="sxs-lookup"><span data-stu-id="7f17f-115">If a TableAdapter method needs to return additional data fields, then we should expand the DataTable s schema accordingly.</span></span> <span data-ttu-id="7f17f-116">在[母版/详细介绍 Master 记录项目符号列表使用详细信息 DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md)我们添加了一种对方法的教程`CategoriesTableAdapter`返回`CategoryID`， `CategoryName`，和`Description`中定义的数据字段加号主查询`NumberOfProducts`，报告的每个类别关联的产品数目的其他数据字段。</span><span class="sxs-lookup"><span data-stu-id="7f17f-116">In the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial we added a method to the `CategoriesTableAdapter` that returned the `CategoryID`, `CategoryName`, and `Description` data fields defined in the main query plus `NumberOfProducts`, an additional data field that reported the number of products associated with each category.</span></span> <span data-ttu-id="7f17f-117">我们手动添加到新列`CategoriesDataTable`目的是捕获`NumberOfProducts`数据字段从这一新方法的值。</span><span class="sxs-lookup"><span data-stu-id="7f17f-117">We manually added a new column to the `CategoriesDataTable` in order to capture the `NumberOfProducts` data field value from this new method.</span></span>

<span data-ttu-id="7f17f-118">中所述[上载文件](../working-with-binary-files/uploading-files-cs.md)教程，但是必须格外小心使用 Tableadapter 使用临时 SQL 语句，并且让其数据字段不精确匹配主查询的方法。</span><span class="sxs-lookup"><span data-stu-id="7f17f-118">As discussed in the [Uploading Files](../working-with-binary-files/uploading-files-cs.md) tutorial, great care must be taken with TableAdapters that use ad-hoc SQL statements and have methods whose data fields do not precisely match the main query.</span></span> <span data-ttu-id="7f17f-119">如果重新运行 TableAdapter 配置向导，它将更新所有 TableAdapter 的方法，使其数据字段列表与匹配的主查询。</span><span class="sxs-lookup"><span data-stu-id="7f17f-119">If the TableAdapter Configuration wizard is re-run, it will update all of the TableAdapter s methods so that their data field list matches the main query.</span></span> <span data-ttu-id="7f17f-120">因此，任何的自定义的列列表的方法将还原到的主查询的列列表并不返回预期的数据。</span><span class="sxs-lookup"><span data-stu-id="7f17f-120">Consequently, any methods with customized column lists will revert to the main query s column list and not return the expected data.</span></span> <span data-ttu-id="7f17f-121">使用存储的过程时，就不会发生此问题。</span><span class="sxs-lookup"><span data-stu-id="7f17f-121">This issue does not arise when using stored procedures.</span></span>

<span data-ttu-id="7f17f-122">在本教程中我们将查看如何扩展 DataTable 的架构以包括其他列。</span><span class="sxs-lookup"><span data-stu-id="7f17f-122">In this tutorial we will look at how to extend a DataTable s schema to include additional columns.</span></span> <span data-ttu-id="7f17f-123">由于脆弱性 TableAdapter 使用临时 SQL 语句时，在本教程中我们将使用存储的过程。</span><span class="sxs-lookup"><span data-stu-id="7f17f-123">Due to the brittleness of the TableAdapter when using ad-hoc SQL statements, in this tutorial we will use stored procedures.</span></span> <span data-ttu-id="7f17f-124">请参阅[创建新的存储过程类型化数据集 s Tableadapter](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)和[使用现有存储过程类型化数据集 s Tableadapter](https://data-access/tutorials/using-existing-stored-procedures-for-the-typed-dataset-amp-rsquo-s-tableadapters-cs)教程有关详细信息配置 TableAdapter 以使用存储的过程。</span><span class="sxs-lookup"><span data-stu-id="7f17f-124">Refer to the [Creating New Stored Procedures for the Typed DataSet s TableAdapters](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) and [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](https://data-access/tutorials/using-existing-stored-procedures-for-the-typed-dataset-amp-rsquo-s-tableadapters-cs) tutorials for more information on configuring a TableAdapter to use stored procedures.</span></span>

## <a name="step-1-adding-apricequartilecolumn-to-theproductsdatatable"></a><span data-ttu-id="7f17f-125">步骤 1： 添加`PriceQuartile`列`ProductsDataTable`</span><span class="sxs-lookup"><span data-stu-id="7f17f-125">Step 1: Adding a`PriceQuartile`Column to the`ProductsDataTable`</span></span>

<span data-ttu-id="7f17f-126">在*创建新的存储过程类型化数据集 s Tableadapter*我们创建名为类型化数据集的教程`NorthwindWithSprocs`。</span><span class="sxs-lookup"><span data-stu-id="7f17f-126">In the *Creating New Stored Procedures for the Typed DataSet s TableAdapters* tutorial we created a Typed DataSet named `NorthwindWithSprocs`.</span></span> <span data-ttu-id="7f17f-127">此数据集当前包含两个数据表：`ProductsDataTable`和`EmployeesDataTable`。</span><span class="sxs-lookup"><span data-stu-id="7f17f-127">This DataSet currently contains two DataTables: `ProductsDataTable` and `EmployeesDataTable`.</span></span> <span data-ttu-id="7f17f-128">`ProductsTableAdapter`有以下三个方法：</span><span class="sxs-lookup"><span data-stu-id="7f17f-128">The `ProductsTableAdapter` has the following three methods:</span></span>

- <span data-ttu-id="7f17f-129">`GetProducts`-在主查询，返回中的所有记录`Products`表</span><span class="sxs-lookup"><span data-stu-id="7f17f-129">`GetProducts` - the main query, which returns all records from the `Products` table</span></span>
- <span data-ttu-id="7f17f-130">`GetProductsByCategoryID(categoryID)`-返回使用指定的所有产品*categoryID*。</span><span class="sxs-lookup"><span data-stu-id="7f17f-130">`GetProductsByCategoryID(categoryID)` - returns all products with the specified *categoryID*.</span></span>
- <span data-ttu-id="7f17f-131">`GetProductByProductID(productID)`-返回具有指定的特定产品*productID*。</span><span class="sxs-lookup"><span data-stu-id="7f17f-131">`GetProductByProductID(productID)` - returns the particular product with the specified *productID*.</span></span>

<span data-ttu-id="7f17f-132">主查询和两个附加方法将返回相同的数据字段，即所有中的列集`Products`表。</span><span class="sxs-lookup"><span data-stu-id="7f17f-132">The main query and the two additional methods all return the same set of data fields, namely all of the columns from the `Products` table.</span></span> <span data-ttu-id="7f17f-133">有无相关子查询或`JOIN`拉取来自的相关的数据的 s`Categories`或`Suppliers`表。</span><span class="sxs-lookup"><span data-stu-id="7f17f-133">There are no correlated subqueries or `JOIN` s pulling related data from the `Categories` or `Suppliers` tables.</span></span> <span data-ttu-id="7f17f-134">因此，`ProductsDataTable`对应的列中每个字段`Products`表。</span><span class="sxs-lookup"><span data-stu-id="7f17f-134">Therefore, the `ProductsDataTable` has a corresponding column for each field in the `Products` table.</span></span>

<span data-ttu-id="7f17f-135">对于本教程，让 s 将方法添加到`ProductsTableAdapter`名为`GetProductsWithPriceQuartile`，返回所有产品。</span><span class="sxs-lookup"><span data-stu-id="7f17f-135">For this tutorial, let s add a method to the `ProductsTableAdapter` named `GetProductsWithPriceQuartile` that returns all of the products.</span></span> <span data-ttu-id="7f17f-136">除了标准产品数据字段，`GetProductsWithPriceQuartile`还将包括`PriceQuartile`指示产品的价格处于下哪些四分位数的数据字段。</span><span class="sxs-lookup"><span data-stu-id="7f17f-136">In addition to the standard product data fields, `GetProductsWithPriceQuartile` will also include a `PriceQuartile` data field that indicates under which quartile the product s price falls.</span></span> <span data-ttu-id="7f17f-137">例如，其价格均为中成本最高的 25%这些产品将具有`PriceQuartile`值为 1，尽管其价格归入底部 25%的那些都将有的值为 4。</span><span class="sxs-lookup"><span data-stu-id="7f17f-137">For example, those products whose prices are in the most expensive 25% will have a `PriceQuartile` value of 1, while those whose prices fall in the bottom 25% will have a value of 4.</span></span> <span data-ttu-id="7f17f-138">我们担心如何创建存储的过程来返回此信息之前，但是，我们首先需要更新`ProductsDataTable`可包含的列来保存`PriceQuartile`结果时`GetProductsWithPriceQuartile`使用方法。</span><span class="sxs-lookup"><span data-stu-id="7f17f-138">Before we worry about creating the stored procedure to return this information, however, we first need to update the `ProductsDataTable` to include a column to hold the `PriceQuartile` results when the `GetProductsWithPriceQuartile` method is used.</span></span>

<span data-ttu-id="7f17f-139">打开`NorthwindWithSprocs`数据集，然后右键单击`ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="7f17f-139">Open the `NorthwindWithSprocs` DataSet and right-click on the `ProductsDataTable`.</span></span> <span data-ttu-id="7f17f-140">从上下文菜单中选择添加，然后挑选列。</span><span class="sxs-lookup"><span data-stu-id="7f17f-140">Choose Add from the context-menu and then pick Column.</span></span>


<span data-ttu-id="7f17f-141">[![将新列添加到 ProductsDataTable](adding-additional-datatable-columns-cs/_static/image2.png)](adding-additional-datatable-columns-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7f17f-141">[![Add a New Column to the ProductsDataTable](adding-additional-datatable-columns-cs/_static/image2.png)](adding-additional-datatable-columns-cs/_static/image1.png)</span></span>

<span data-ttu-id="7f17f-142">**图 1**： 添加到一个新列`ProductsDataTable`([单击以查看实际尺寸的图像](adding-additional-datatable-columns-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="7f17f-142">**Figure 1**: Add a New Column to the `ProductsDataTable` ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image3.png))</span></span>


<span data-ttu-id="7f17f-143">这会将新列添加到名为的类型的 Column1 DataTable `System.String`。</span><span class="sxs-lookup"><span data-stu-id="7f17f-143">This will add a new column to the DataTable named Column1 of type `System.String`.</span></span> <span data-ttu-id="7f17f-144">我们需要更新此列名的 PriceQuartile 和其类型设置为`System.Int32`因为它将用于保存介于 1 和 4 之间的数字。</span><span class="sxs-lookup"><span data-stu-id="7f17f-144">We need to update this column s name to PriceQuartile and its type to `System.Int32` since it will be used to hold a number between 1 and 4.</span></span> <span data-ttu-id="7f17f-145">选择中的新添加列`ProductsDataTable`并从属性窗口中，设置`Name`PriceQuartile 属性和`DataType`属性`System.Int32`。</span><span class="sxs-lookup"><span data-stu-id="7f17f-145">Select the newly-added column in the `ProductsDataTable` and, from the Properties window, set the `Name` property to PriceQuartile and the `DataType` property to `System.Int32`.</span></span>


<span data-ttu-id="7f17f-146">[![设置新的列的名称和数据类型属性](adding-additional-datatable-columns-cs/_static/image5.png)](adding-additional-datatable-columns-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="7f17f-146">[![Set the New Column s Name and DataType Properties](adding-additional-datatable-columns-cs/_static/image5.png)](adding-additional-datatable-columns-cs/_static/image4.png)</span></span>

<span data-ttu-id="7f17f-147">**图 2**： 设置新列 s`Name`和`DataType`属性 ([单击以查看实际尺寸的图像](adding-additional-datatable-columns-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="7f17f-147">**Figure 2**: Set the New Column s `Name` and `DataType` Properties ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image6.png))</span></span>


<span data-ttu-id="7f17f-148">如图 2 所示，有其他属性，可以设置，如是否列中的值必须是唯一的如果列是自动递增列，是否数据库`NULL`值允许，依次类推。</span><span class="sxs-lookup"><span data-stu-id="7f17f-148">As Figure 2 shows, there are additional properties that can be set, such as whether the values in the column must be unique, if the column is an auto-increment column, whether or not database `NULL` values are allowed, and so on.</span></span> <span data-ttu-id="7f17f-149">将保留这些值设置为各自的默认值。</span><span class="sxs-lookup"><span data-stu-id="7f17f-149">Leave these values set to their defaults.</span></span>

## <a name="step-2-creating-thegetproductswithpricequartilemethod"></a><span data-ttu-id="7f17f-150">步骤 2： 创建`GetProductsWithPriceQuartile`方法</span><span class="sxs-lookup"><span data-stu-id="7f17f-150">Step 2: Creating the`GetProductsWithPriceQuartile`Method</span></span>

<span data-ttu-id="7f17f-151">现在，`ProductsDataTable`已更新，包括`PriceQuartile`列中，我们已准备好创建`GetProductsWithPriceQuartile`方法。</span><span class="sxs-lookup"><span data-stu-id="7f17f-151">Now that the `ProductsDataTable` has been updated to include the `PriceQuartile` column, we are ready to create the `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="7f17f-152">启动的 TableAdapter 上右键单击并从上下文菜单中选择添加查询。</span><span class="sxs-lookup"><span data-stu-id="7f17f-152">Start by right-clicking on the TableAdapter and choosing Add Query from the context-menu.</span></span> <span data-ttu-id="7f17f-153">这将打开 TableAdapter 查询配置向导中，首先让我们是否我们要使用的临时 SQL 语句或新的或现有的存储的过程。</span><span class="sxs-lookup"><span data-stu-id="7f17f-153">This brings up the TableAdapter Query Configuration wizard, which first prompts us as to whether we want to use ad-hoc SQL statements or a new or existing stored procedure.</span></span> <span data-ttu-id="7f17f-154">由于我们不尚未有一个存储的过程返回价格四分位数数据，让我们来允许为我们创建此存储的过程的 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="7f17f-154">Since we don t yet have a stored procedure that returns the price quartile data, let s allow the TableAdapter to create this stored procedure for us.</span></span> <span data-ttu-id="7f17f-155">选择创建新存储的过程选项，然后单击下一步。</span><span class="sxs-lookup"><span data-stu-id="7f17f-155">Select the Create new stored procedure option and click Next.</span></span>


<span data-ttu-id="7f17f-156">[![指示 TableAdapter 向导以创建为我们的存储的过程](adding-additional-datatable-columns-cs/_static/image8.png)](adding-additional-datatable-columns-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="7f17f-156">[![Instruct the TableAdapter Wizard to Create the Stored Procedure For Us](adding-additional-datatable-columns-cs/_static/image8.png)](adding-additional-datatable-columns-cs/_static/image7.png)</span></span>

<span data-ttu-id="7f17f-157">**图 3**： 指示 TableAdapter 向导以创建存储过程为我们 ([单击以查看实际尺寸的图像](adding-additional-datatable-columns-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="7f17f-157">**Figure 3**: Instruct the TableAdapter Wizard to Create the Stored Procedure For Us ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image9.png))</span></span>


<span data-ttu-id="7f17f-158">在后续屏幕中，显示在图 4 中，向导将要求我们要添加查询的类型。</span><span class="sxs-lookup"><span data-stu-id="7f17f-158">In the subsequent screen, shown in Figure 4, the wizard asks us what type of query to add.</span></span> <span data-ttu-id="7f17f-159">由于`GetProductsWithPriceQuartile`方法将返回所有列和记录从`Products`表，请选中它返回行选项，然后单击下一步。</span><span class="sxs-lookup"><span data-stu-id="7f17f-159">Since the `GetProductsWithPriceQuartile` method will return all columns and records from the `Products` table, select the SELECT which returns rows option and click Next.</span></span>


<span data-ttu-id="7f17f-160">[![我们的查询将该返回多个行的 SELECT 语句](adding-additional-datatable-columns-cs/_static/image11.png)](adding-additional-datatable-columns-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="7f17f-160">[![Our Query will be a SELECT Statement that Returns Multiple Rows](adding-additional-datatable-columns-cs/_static/image11.png)](adding-additional-datatable-columns-cs/_static/image10.png)</span></span>

<span data-ttu-id="7f17f-161">**图 4**： 我们的查询将会`SELECT`语句该返回多个行 ([单击以查看实际尺寸的图像](adding-additional-datatable-columns-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="7f17f-161">**Figure 4**: Our Query will be a `SELECT` Statement that Returns Multiple Rows ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image12.png))</span></span>


<span data-ttu-id="7f17f-162">接下来我们将提示您输入`SELECT`查询。</span><span class="sxs-lookup"><span data-stu-id="7f17f-162">Next we are prompted for the `SELECT` query.</span></span> <span data-ttu-id="7f17f-163">在向导中输入以下查询：</span><span class="sxs-lookup"><span data-stu-id="7f17f-163">Enter the following query into the wizard:</span></span>


[!code-sql[Main](adding-additional-datatable-columns-cs/samples/sample1.sql)]

<span data-ttu-id="7f17f-164">上面的查询使用 SQL Server 2005 s 新[`NTILE`函数](https://msdn.microsoft.com/en-us/library/ms175126.aspx)若要将结果划分为四个组组由`UnitPrice`按降序排序的值。</span><span class="sxs-lookup"><span data-stu-id="7f17f-164">The above query uses SQL Server 2005 s new [`NTILE` function](https://msdn.microsoft.com/en-us/library/ms175126.aspx) to divide the results into four groups where the groups are determined by the `UnitPrice` values sorted in descending order.</span></span>

<span data-ttu-id="7f17f-165">遗憾的是，查询生成器不知道如何分析`OVER`关键字和分析上述查询时，将显示错误。</span><span class="sxs-lookup"><span data-stu-id="7f17f-165">Unfortunately, the Query Builder does not know how to parse the `OVER` keyword and will display an error when parsing the above query.</span></span> <span data-ttu-id="7f17f-166">因此，上面的查询在向导中的文本框中直接输入而无需使用查询生成器。</span><span class="sxs-lookup"><span data-stu-id="7f17f-166">Therefore, enter the above query directly in the textbox in the wizard without using the Query Builder.</span></span>

> [!NOTE]
> <span data-ttu-id="7f17f-167">有关详细信息 NTILE 和 SQL Server 2005 s 其他排名函数，请参阅[Microsoft SQL Server 2005 返回排名结果](http://www.4guysfromrolla.com/webtech/010406-1.shtml)和[排名函数部分](https://msdn.microsoft.com/en-us/library/ms189798.aspx)从[SQLServer 2005 联机丛书](https://msdn.microsoft.com/en-us/library/ms189798.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7f17f-167">For more information on NTILE and SQL Server 2005 s other ranking functions, see [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml) and the [Ranking Functions section](https://msdn.microsoft.com/en-us/library/ms189798.aspx) from the [SQL Server 2005 Books Online](https://msdn.microsoft.com/en-us/library/ms189798.aspx).</span></span>


<span data-ttu-id="7f17f-168">在输入后`SELECT`查询并单击下一步，则向导会询问我们提供它将创建的存储过程的名称。</span><span class="sxs-lookup"><span data-stu-id="7f17f-168">After entering the `SELECT` query and clicking Next, the wizard asks us to provide a name for the stored procedure it will create.</span></span> <span data-ttu-id="7f17f-169">命名新的存储的过程`Products_SelectWithPriceQuartile`单击下一步。</span><span class="sxs-lookup"><span data-stu-id="7f17f-169">Name the new stored procedure `Products_SelectWithPriceQuartile` and click Next.</span></span>


<span data-ttu-id="7f17f-170">[![存储的过程 Products_SelectWithPriceQuartile 名称](adding-additional-datatable-columns-cs/_static/image14.png)](adding-additional-datatable-columns-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="7f17f-170">[![Name the Stored Procedure Products_SelectWithPriceQuartile](adding-additional-datatable-columns-cs/_static/image14.png)](adding-additional-datatable-columns-cs/_static/image13.png)</span></span>

<span data-ttu-id="7f17f-171">**图 5**： 命名存储过程`Products_SelectWithPriceQuartile`([单击以查看实际尺寸的图像](adding-additional-datatable-columns-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="7f17f-171">**Figure 5**: Name the Stored Procedure `Products_SelectWithPriceQuartile` ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image15.png))</span></span>


<span data-ttu-id="7f17f-172">最后，我们会提示名称的 TableAdapter 方法。</span><span class="sxs-lookup"><span data-stu-id="7f17f-172">Lastly, we are prompted to name the TableAdapter methods.</span></span> <span data-ttu-id="7f17f-173">保留这两个填充 DataTable 并返回 DataTable 选中的复选框和名称方法`FillWithPriceQuartile`和`GetProductsWithPriceQuartile`。</span><span class="sxs-lookup"><span data-stu-id="7f17f-173">Leave both the Fill a DataTable and Return a DataTable checkboxes checked and name the methods `FillWithPriceQuartile` and `GetProductsWithPriceQuartile`.</span></span>


<span data-ttu-id="7f17f-174">[![名称的 TableAdapter s 方法，然后单击完成](adding-additional-datatable-columns-cs/_static/image17.png)](adding-additional-datatable-columns-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="7f17f-174">[![Name the TableAdapter s Methods and Click Finish](adding-additional-datatable-columns-cs/_static/image17.png)](adding-additional-datatable-columns-cs/_static/image16.png)</span></span>

<span data-ttu-id="7f17f-175">**图 6**： 名称，TableAdapter 的方法并单击完成 ([单击以查看实际尺寸的图像](adding-additional-datatable-columns-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="7f17f-175">**Figure 6**: Name the TableAdapter s Methods and Click Finish ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image18.png))</span></span>


<span data-ttu-id="7f17f-176">与`SELECT`指定查询和存储的过程和 TableAdapter 方法名为，单击完成以完成向导。</span><span class="sxs-lookup"><span data-stu-id="7f17f-176">With the `SELECT` query specified and the stored procedure and TableAdapter methods named, click Finish to complete the wizard.</span></span> <span data-ttu-id="7f17f-177">此时可能会收到警告还是说，该向导中的两个`OVER`不支持 SQL 构造或语句。</span><span class="sxs-lookup"><span data-stu-id="7f17f-177">At this point you may get a warning or two from the wizard saying that The `OVER` SQL construct or statement is not supported.</span></span> <span data-ttu-id="7f17f-178">可以忽略这些警告。</span><span class="sxs-lookup"><span data-stu-id="7f17f-178">These warnings can be ignored.</span></span>

<span data-ttu-id="7f17f-179">完成向导后，应包括 TableAdapter`FillWithPriceQuartile`和`GetProductsWithPriceQuartile`应包括名为的存储的过程的方法和数据库`Products_SelectWithPriceQuartile`。</span><span class="sxs-lookup"><span data-stu-id="7f17f-179">After completing the wizard, the TableAdapter should include the `FillWithPriceQuartile` and `GetProductsWithPriceQuartile` methods and the database should include a stored procedure named `Products_SelectWithPriceQuartile`.</span></span> <span data-ttu-id="7f17f-180">花一些时间来验证 TableAdapter，确实包含此新方法和存储的过程已正确添加到数据库。</span><span class="sxs-lookup"><span data-stu-id="7f17f-180">Take a moment to verify that the TableAdapter does indeed contain this new method and that the stored procedure has been correctly added to the database.</span></span> <span data-ttu-id="7f17f-181">当检查数据库中，如果你看不到存储的过程尝试右键单击的存储过程文件夹并选择刷新。</span><span class="sxs-lookup"><span data-stu-id="7f17f-181">When checking the database, if you do not see the stored procedure try right-clicking on the Stored Procedures folder and choosing Refresh.</span></span>


![验证已将新方法添加到 TableAdapter](adding-additional-datatable-columns-cs/_static/image19.png)

<span data-ttu-id="7f17f-183">**图 7**： 验证已将新方法添加到 TableAdapter</span><span class="sxs-lookup"><span data-stu-id="7f17f-183">**Figure 7**: Verify that a New Method Has Been Added to the TableAdapter</span></span>


<span data-ttu-id="7f17f-184">[![确保数据库包含 Products_SelectWithPriceQuartile 存储过程](adding-additional-datatable-columns-cs/_static/image21.png)](adding-additional-datatable-columns-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="7f17f-184">[![Ensure that the Database Contains the Products_SelectWithPriceQuartile Stored Procedure](adding-additional-datatable-columns-cs/_static/image21.png)](adding-additional-datatable-columns-cs/_static/image20.png)</span></span>

<span data-ttu-id="7f17f-185">**图 8**： 确保数据库包含`Products_SelectWithPriceQuartile`存储过程 ([单击以查看实际尺寸的图像](adding-additional-datatable-columns-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="7f17f-185">**Figure 8**: Ensure that the Database Contains the `Products_SelectWithPriceQuartile` Stored Procedure ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image22.png))</span></span>


> [!NOTE]
> <span data-ttu-id="7f17f-186">而不临时的 SQL 语句中使用存储的过程的好处之一是，重新运行 TableAdapter 配置向导将不会修改存储的过程列列表。</span><span class="sxs-lookup"><span data-stu-id="7f17f-186">One of the benefits of using stored procedures instead of ad-hoc SQL statements is that re-running the TableAdapter Configuration wizard will not modify the stored procedures column lists.</span></span> <span data-ttu-id="7f17f-187">此方法右键单击 TableAdapter，从上下文菜单以启动向导，选择配置选项，然后单击完成来完成此进行验证。</span><span class="sxs-lookup"><span data-stu-id="7f17f-187">Verify this by right-clicking on the TableAdapter, choosing the Configure option from the context-menu to start the wizard, and then clicking Finish to complete it.</span></span> <span data-ttu-id="7f17f-188">接下来，请转到该数据库并查看`Products_SelectWithPriceQuartile`存储过程。</span><span class="sxs-lookup"><span data-stu-id="7f17f-188">Next, go to the database and view the `Products_SelectWithPriceQuartile` stored procedure.</span></span> <span data-ttu-id="7f17f-189">请注意尚未修改其列列表。</span><span class="sxs-lookup"><span data-stu-id="7f17f-189">Note that its column list has not been modified.</span></span> <span data-ttu-id="7f17f-190">以前我们一直在使用临时 SQL 语句，重新运行 TableAdapter 配置向导将恢复此查询的列列表以匹配主查询列列表中，从而从使用的查询中删除 NTILE 语句`GetProductsWithPriceQuartile`方法。</span><span class="sxs-lookup"><span data-stu-id="7f17f-190">Had we been using ad-hoc SQL statements, re-running the TableAdapter Configuration wizard would have reverted this query s column list to match the main query column list, thereby removing the NTILE statement from the query used by the `GetProductsWithPriceQuartile` method.</span></span>


<span data-ttu-id="7f17f-191">当数据访问层 s`GetProductsWithPriceQuartile`调用方法、 TableAdapter 执行`Products_SelectWithPriceQuartile`存储过程，并将添加到行`ProductsDataTable`为每个返回的记录。</span><span class="sxs-lookup"><span data-stu-id="7f17f-191">When the Data Access Layer s `GetProductsWithPriceQuartile` method is invoked, the TableAdapter executes the `Products_SelectWithPriceQuartile` stored procedure and adds a row to the `ProductsDataTable` for each returned record.</span></span> <span data-ttu-id="7f17f-192">存储过程返回的数据字段映射到`ProductsDataTable`的列。</span><span class="sxs-lookup"><span data-stu-id="7f17f-192">The data fields returned by the stored procedure are mapped to the `ProductsDataTable` s columns.</span></span> <span data-ttu-id="7f17f-193">由于没有`PriceQuartile`数据字段从存储的过程中，返回其值分配给`ProductsDataTable`s`PriceQuartile`列。</span><span class="sxs-lookup"><span data-stu-id="7f17f-193">Since there is a `PriceQuartile` data field returned from the stored procedure, its value is assigned to the `ProductsDataTable` s `PriceQuartile` column.</span></span>

<span data-ttu-id="7f17f-194">对于其查询不会返回这些 TableAdapter 方法`PriceQuartile`数据字段，`PriceQuartile`列的值是由指定的值其`DefaultValue`属性。</span><span class="sxs-lookup"><span data-stu-id="7f17f-194">For those TableAdapter methods whose queries do not return a `PriceQuartile` data field, the `PriceQuartile` column s value is the value specified by its `DefaultValue` property.</span></span> <span data-ttu-id="7f17f-195">如图 2 所示，此值设置为`DBNull`，默认值。</span><span class="sxs-lookup"><span data-stu-id="7f17f-195">As Figure 2 shows, this value is set to `DBNull`, the default.</span></span> <span data-ttu-id="7f17f-196">如果您希望使用不同的默认值，只需设置`DefaultValue`属性相应地。</span><span class="sxs-lookup"><span data-stu-id="7f17f-196">If you would prefer a different default value, simply set the `DefaultValue` property accordingly.</span></span> <span data-ttu-id="7f17f-197">请确保`DefaultValue`值有效，并在给定列 s `DataType` (即，`System.Int32`为`PriceQuartile`列)。</span><span class="sxs-lookup"><span data-stu-id="7f17f-197">Just make sure that the `DefaultValue` value is valid given the column s `DataType` (i.e., `System.Int32` for the `PriceQuartile` column).</span></span>

<span data-ttu-id="7f17f-198">此时我们已向数据表添加一个额外的列执行所需的步骤。</span><span class="sxs-lookup"><span data-stu-id="7f17f-198">At this point we have performed the necessary steps for adding an additional column to a DataTable.</span></span> <span data-ttu-id="7f17f-199">若要验证此附加列按预期方式工作，让我们来创建 ASP.NET 页显示每个产品的名称、 价格和价格四分位数。</span><span class="sxs-lookup"><span data-stu-id="7f17f-199">To verify that this additional column works as expected, let s create an ASP.NET page that displays each product s name, price, and price quartile.</span></span> <span data-ttu-id="7f17f-200">我们在此之前，不过，我们首先需要更新业务逻辑层，若要包括到 DAL s 调用方法`GetProductsWithPriceQuartile`方法。</span><span class="sxs-lookup"><span data-stu-id="7f17f-200">Before we do that, though, we first need to update the Business Logic Layer to include a method that calls down to the DAL s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="7f17f-201">我们将在步骤 3 中，接下来，更新 BLL，然后在步骤 4 中创建 ASP.NET 页。</span><span class="sxs-lookup"><span data-stu-id="7f17f-201">We will update the BLL next, in Step 3, and then create the ASP.NET page in Step 4.</span></span>

## <a name="step-3-augmenting-the-business-logic-layer"></a><span data-ttu-id="7f17f-202">步骤 3： 补充业务逻辑层</span><span class="sxs-lookup"><span data-stu-id="7f17f-202">Step 3: Augmenting the Business Logic Layer</span></span>

<span data-ttu-id="7f17f-203">我们使用新之前`GetProductsWithPriceQuartile`方法与表示层中，我们首先应添加相应的方法为 BLL。</span><span class="sxs-lookup"><span data-stu-id="7f17f-203">Before we use the new `GetProductsWithPriceQuartile` method from the Presentation Layer, we should first add a corresponding method to the BLL.</span></span> <span data-ttu-id="7f17f-204">打开`ProductsBLLWithSprocs`类文件并添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="7f17f-204">Open the `ProductsBLLWithSprocs` class file and add the following code:</span></span>


[!code-csharp[Main](adding-additional-datatable-columns-cs/samples/sample2.cs)]

<span data-ttu-id="7f17f-205">与中的其他数据检索方法类似`ProductsBLLWithSprocs`、`GetProductsWithPriceQuartile`方法只需调用 DAL s 对应`GetProductsWithPriceQuartile`方法并返回其结果。</span><span class="sxs-lookup"><span data-stu-id="7f17f-205">Like the other data retrieval methods in `ProductsBLLWithSprocs`, the `GetProductsWithPriceQuartile` method simply calls the DAL s corresponding `GetProductsWithPriceQuartile` method and returns its results.</span></span>

## <a name="step-4-displaying-the-price-quartile-information-in-an-aspnet-web-page"></a><span data-ttu-id="7f17f-206">步骤 4： 在 ASP.NET 网页中显示的价格四分位数信息</span><span class="sxs-lookup"><span data-stu-id="7f17f-206">Step 4: Displaying the Price Quartile Information in an ASP.NET Web Page</span></span>

<span data-ttu-id="7f17f-207">加上 BLL 重新已准备好创建显示每个产品的价格四分位数的 ASP.NET 页完成我们。</span><span class="sxs-lookup"><span data-stu-id="7f17f-207">With the BLL addition complete we re ready to create an ASP.NET page that shows the price quartile for each product.</span></span> <span data-ttu-id="7f17f-208">打开`AddingColumns.aspx`页面`AdvancedDAL`文件夹，然后拖动一个 GridView 从工具箱中拖动到设计器中，设置其`ID`属性`Products`。</span><span class="sxs-lookup"><span data-stu-id="7f17f-208">Open the `AddingColumns.aspx` page in the `AdvancedDAL` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` property to `Products`.</span></span> <span data-ttu-id="7f17f-209">从 GridView s 智能标记，请将其绑定到名为新 ObjectDataSource `ProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="7f17f-209">From the GridView s smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="7f17f-210">配置对象数据源以使用`ProductsBLLWithSprocs`类的`GetProductsWithPriceQuartile`方法。</span><span class="sxs-lookup"><span data-stu-id="7f17f-210">Configure the ObjectDataSource to use the `ProductsBLLWithSprocs` class s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="7f17f-211">因为这将为只读的网格，在更新中，INSERT、 设置的下拉列表，并删除选项卡添加到 （无）。</span><span class="sxs-lookup"><span data-stu-id="7f17f-211">Since this will be a read-only grid, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="7f17f-212">[![配置对象数据源以使用 ProductsBLLWithSprocs 类](adding-additional-datatable-columns-cs/_static/image24.png)](adding-additional-datatable-columns-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="7f17f-212">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](adding-additional-datatable-columns-cs/_static/image24.png)](adding-additional-datatable-columns-cs/_static/image23.png)</span></span>

<span data-ttu-id="7f17f-213">**图 9**： 配置使用 ObjectDataSource`ProductsBLLWithSprocs`类 ([单击以查看实际尺寸的图像](adding-additional-datatable-columns-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="7f17f-213">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image25.png))</span></span>


<span data-ttu-id="7f17f-214">[![从 GetProductsWithPriceQuartile 方法中检索产品信息](adding-additional-datatable-columns-cs/_static/image27.png)](adding-additional-datatable-columns-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="7f17f-214">[![Retrieve Product Information from the GetProductsWithPriceQuartile Method](adding-additional-datatable-columns-cs/_static/image27.png)](adding-additional-datatable-columns-cs/_static/image26.png)</span></span>

<span data-ttu-id="7f17f-215">**图 10**： 中检索产品信息`GetProductsWithPriceQuartile`方法 ([单击以查看实际尺寸的图像](adding-additional-datatable-columns-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="7f17f-215">**Figure 10**: Retrieve Product Information from the `GetProductsWithPriceQuartile` Method ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image28.png))</span></span>


<span data-ttu-id="7f17f-216">完成配置数据源向导后，Visual Studio 将自动添加 BoundField 或 CheckBoxField 到 GridView 为每个方法返回的数据字段。</span><span class="sxs-lookup"><span data-stu-id="7f17f-216">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField or CheckBoxField to the GridView for each of the data fields returned by the method.</span></span> <span data-ttu-id="7f17f-217">这些数据字段之一是`PriceQuartile`，这是我们将添加到列`ProductsDataTable`在步骤 1 中。</span><span class="sxs-lookup"><span data-stu-id="7f17f-217">One of these data fields is `PriceQuartile`, which is the column we added to the `ProductsDataTable` in Step 1.</span></span>

<span data-ttu-id="7f17f-218">编辑删除的 GridView 的字段以外的所有`ProductName`， `UnitPrice`，和`PriceQuartile`BoundFields。</span><span class="sxs-lookup"><span data-stu-id="7f17f-218">Edit the GridView s fields, removing all but the `ProductName`, `UnitPrice`, and `PriceQuartile` BoundFields.</span></span> <span data-ttu-id="7f17f-219">配置`UnitPrice`BoundField 设置其值作为货币的格式，并让`UnitPrice`和`PriceQuartile`BoundFields 右和中心-对齐，分别。</span><span class="sxs-lookup"><span data-stu-id="7f17f-219">Configure the `UnitPrice` BoundField to format its value as a currency and have the `UnitPrice` and `PriceQuartile` BoundFields right- and center-aligned, respectively.</span></span> <span data-ttu-id="7f17f-220">最后，更新剩余 BoundFields`HeaderText`属性添加到产品、 价格和价格四分位数，分别。</span><span class="sxs-lookup"><span data-stu-id="7f17f-220">Finally, update the remaining BoundFields `HeaderText` properties to Product, Price, and Price Quartile, respectively.</span></span> <span data-ttu-id="7f17f-221">另外，请检查从 GridView s 智能标记启用排序复选框。</span><span class="sxs-lookup"><span data-stu-id="7f17f-221">Also, check the Enable Sorting checkbox from the GridView s smart tag.</span></span>

<span data-ttu-id="7f17f-222">这些修改后的 GridView 和 ObjectDataSource s 声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="7f17f-222">After these modifications, the GridView and ObjectDataSource s declarative markup should look like the following:</span></span>


[!code-aspx[Main](adding-additional-datatable-columns-cs/samples/sample3.aspx)]

<span data-ttu-id="7f17f-223">图 11 显示时通过浏览器访问此页。</span><span class="sxs-lookup"><span data-stu-id="7f17f-223">Figure 11 shows this page when visited through a browser.</span></span> <span data-ttu-id="7f17f-224">请注意，最初，产品按排序与每个分配适当的产品的降序其价格`PriceQuartile`值。</span><span class="sxs-lookup"><span data-stu-id="7f17f-224">Note that, initially, the products are ordered by their price in descending order with each product assigned an appropriate `PriceQuartile` value.</span></span> <span data-ttu-id="7f17f-225">这是当然的此数据可以进行分类按其他条件仍反映价格方面的产品的排名的价格四分位数列值 （请参阅图 12）。</span><span class="sxs-lookup"><span data-stu-id="7f17f-225">Of course this data can be sorted by other criteria with the Price Quartile column value still reflecting the product s ranking with respect to price (see Figure 12).</span></span>


<span data-ttu-id="7f17f-226">[![通过其价格订购的产品](adding-additional-datatable-columns-cs/_static/image30.png)](adding-additional-datatable-columns-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="7f17f-226">[![The Products are Ordered by their Prices](adding-additional-datatable-columns-cs/_static/image30.png)](adding-additional-datatable-columns-cs/_static/image29.png)</span></span>

<span data-ttu-id="7f17f-227">**图 11**： 按其价格排序的产品 ([单击以查看实际尺寸的图像](adding-additional-datatable-columns-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="7f17f-227">**Figure 11**: The Products are Ordered by their Prices ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image31.png))</span></span>


<span data-ttu-id="7f17f-228">[![产品按其名称进行排序](adding-additional-datatable-columns-cs/_static/image33.png)](adding-additional-datatable-columns-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="7f17f-228">[![The Products are Ordered by their Names](adding-additional-datatable-columns-cs/_static/image33.png)](adding-additional-datatable-columns-cs/_static/image32.png)</span></span>

<span data-ttu-id="7f17f-229">**图 12**： 按其名称进行排序的产品 ([单击以查看实际尺寸的图像](adding-additional-datatable-columns-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="7f17f-229">**Figure 12**: The Products are Ordered by their Names ([Click to view full-size image](adding-additional-datatable-columns-cs/_static/image34.png))</span></span>


> [!NOTE]
> <span data-ttu-id="7f17f-230">使用几行代码我们无法增加 GridView，以便它着色根据产品行其`PriceQuartile`值。</span><span class="sxs-lookup"><span data-stu-id="7f17f-230">With a few lines of code we could augment the GridView so that it colored the product rows based on their `PriceQuartile` value.</span></span> <span data-ttu-id="7f17f-231">我们可能颜色这些产品的第一个四分位数浅绿色，第二个四分位数浅黄色中的那些，等等。</span><span class="sxs-lookup"><span data-stu-id="7f17f-231">We might color those products in the first quartile a light green, those in the second quartile a light yellow, and so forth.</span></span> <span data-ttu-id="7f17f-232">我建议你花一些时间来添加此功能。</span><span class="sxs-lookup"><span data-stu-id="7f17f-232">I encourage you to take a moment to add this functionality.</span></span> <span data-ttu-id="7f17f-233">如果你需要在格式设置 GridView 刷新程序，请查阅[自定义格式设置基于时数据](../custom-formatting/custom-formatting-based-upon-data-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="7f17f-233">If you need a refresher on formatting a GridView, consult the [Custom Formatting Based Upon Data](../custom-formatting/custom-formatting-based-upon-data-cs.md) tutorial.</span></span>


## <a name="an-alternative-approach---creating-another-tableadapter"></a><span data-ttu-id="7f17f-234">一种方法-创建另一个 TableAdapter</span><span class="sxs-lookup"><span data-stu-id="7f17f-234">An Alternative Approach - Creating Another TableAdapter</span></span>

<span data-ttu-id="7f17f-235">如我们看到在本教程中，当主查询将方法添加到返回之外的数据字段的 TableAdapter 拼的不同而不同，我们可以添加 DataTable 对应的列。</span><span class="sxs-lookup"><span data-stu-id="7f17f-235">As we saw in this tutorial, when adding a method to a TableAdapter that returns data fields other than those spelled out by the main query, we can add corresponding columns to the DataTable.</span></span> <span data-ttu-id="7f17f-236">这种方法，但是，工作得只有少量的 TableAdapter 中返回不同的数据字段的方法和从主查询太多，这些备用数据字段不发生更改。</span><span class="sxs-lookup"><span data-stu-id="7f17f-236">Such an approach, however, works well only if there are a small number of methods in the TableAdapter that return different data fields and if those alternate data fields do not vary too much from the main query.</span></span>

<span data-ttu-id="7f17f-237">而不是将列添加到数据表中，可以改为将另一个 TableAdapter 添加到包含从第一个 TableAdapter 的方法的返回不同的数据字段的数据集。</span><span class="sxs-lookup"><span data-stu-id="7f17f-237">Rather than adding columns to the DataTable, you can instead add another TableAdapter to the DataSet that contains the methods from the first TableAdapter that return different data fields.</span></span> <span data-ttu-id="7f17f-238">对于本教程，而不是添加`PriceQuartile`列`ProductsDataTable`(其中仅使用由`GetProductsWithPriceQuartile`方法)，我们无法向名为数据集添加其他 TableAdapter`ProductsWithPriceQuartileTableAdapter`使用`Products_SelectWithPriceQuartile`存储为其主查询的过程。</span><span class="sxs-lookup"><span data-stu-id="7f17f-238">For this tutorial, rather than add the `PriceQuartile` column to the `ProductsDataTable` (where it is only used by the `GetProductsWithPriceQuartile` method), we could have added an additional TableAdapter to the DataSet named `ProductsWithPriceQuartileTableAdapter` that used the `Products_SelectWithPriceQuartile` stored procedure as its main query.</span></span> <span data-ttu-id="7f17f-239">获取产品信息价格四分位数，所需的 ASP.NET 页将使用`ProductsWithPriceQuartileTableAdapter`，而那些没有无法继续使用`ProductsTableAdapter`。</span><span class="sxs-lookup"><span data-stu-id="7f17f-239">ASP.NET pages that needed to get product information with the price quartile would use the `ProductsWithPriceQuartileTableAdapter`, while those that did not could continue to use the `ProductsTableAdapter`.</span></span>

<span data-ttu-id="7f17f-240">通过添加新的 TableAdapter，数据表保持 untarnished 镜像，并且其列精确由其 TableAdapter 的 s 方法返回的数据字段。</span><span class="sxs-lookup"><span data-stu-id="7f17f-240">By adding a new TableAdapter, the DataTables remain untarnished and their columns precisely mirror the data fields returned by their TableAdapter s methods.</span></span> <span data-ttu-id="7f17f-241">但是，其他 Tableadapter 会导致重复任务和功能。</span><span class="sxs-lookup"><span data-stu-id="7f17f-241">However, additional TableAdapters can introduce repetitive tasks and functionality.</span></span> <span data-ttu-id="7f17f-242">例如，如果这些 ASP.NET 页显示`PriceQuartile`列还需要提供插入、 更新和删除的支持，`ProductsWithPriceQuartileTableAdapter`将需要其`InsertCommand`， `UpdateCommand`，和`DeleteCommand`属性正确配置。</span><span class="sxs-lookup"><span data-stu-id="7f17f-242">For example, if those ASP.NET pages that displayed the `PriceQuartile` column also needed to provide insert, update, and delete support, the `ProductsWithPriceQuartileTableAdapter` would need to have its `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties properly configured.</span></span> <span data-ttu-id="7f17f-243">虽然这些属性将镜像`ProductsTableAdapter`s，此配置引入了一个额外步骤。</span><span class="sxs-lookup"><span data-stu-id="7f17f-243">While these properties would mirror the `ProductsTableAdapter` s, this configuration introduces an extra step.</span></span> <span data-ttu-id="7f17f-244">此外，有两种方法，若要更新，删除，或通过向数据库-添加产品现在`ProductsTableAdapter`和`ProductsWithPriceQuartileTableAdapter`类。</span><span class="sxs-lookup"><span data-stu-id="7f17f-244">Moreover, there are now two ways to update, delete, or add a product to the database - through the `ProductsTableAdapter` and `ProductsWithPriceQuartileTableAdapter` classes.</span></span>

<span data-ttu-id="7f17f-245">本教程中下载内容还包括`ProductsWithPriceQuartileTableAdapter`类`NorthwindWithSprocs`演示了此备用方法的数据集。</span><span class="sxs-lookup"><span data-stu-id="7f17f-245">The download for this tutorial includes a `ProductsWithPriceQuartileTableAdapter` class in the `NorthwindWithSprocs` DataSet that illustrates this alternative approach.</span></span>

## <a name="summary"></a><span data-ttu-id="7f17f-246">摘要</span><span class="sxs-lookup"><span data-stu-id="7f17f-246">Summary</span></span>

<span data-ttu-id="7f17f-247">在大多数情况下，所有 TableAdapter 中的方法将返回组相同的数据字段，但有特定的方法或两个可能需要时要返回的其他字段的时间。</span><span class="sxs-lookup"><span data-stu-id="7f17f-247">In most scenarios, all of the methods in a TableAdapter will return the same set of data fields, but there are times when a particular method or two may need to return an additional field.</span></span> <span data-ttu-id="7f17f-248">例如，在[母版/详细介绍 Master 记录项目符号列表使用详细信息 DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md)我们添加了一种对方法的教程`CategoriesTableAdapter`，除了返回的主查询的数据字段`NumberOfProducts`字段，报告的每个类别关联的产品数目。</span><span class="sxs-lookup"><span data-stu-id="7f17f-248">For example, in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial we added a method to the `CategoriesTableAdapter` that, in addition to the main query s data fields, returned a `NumberOfProducts` field that reported the number of products associated with each category.</span></span> <span data-ttu-id="7f17f-249">在本教程中我们查看添加中的方法`ProductsTableAdapter`返回`PriceQuartile`除了主查询的数据字段的字段。</span><span class="sxs-lookup"><span data-stu-id="7f17f-249">In this tutorial we looked at adding a method in the `ProductsTableAdapter` that returned a `PriceQuartile` field in addition to the main query s data fields.</span></span> <span data-ttu-id="7f17f-250">若要捕获更多数据字段由方法返回的 TableAdapter s 我们需要将对应的列添加到数据表。</span><span class="sxs-lookup"><span data-stu-id="7f17f-250">To capture additional data fields returned by the TableAdapter s methods we need to add corresponding columns to the DataTable.</span></span>

<span data-ttu-id="7f17f-251">如果你打算手动将列添加到 DataTable，建议 TableAdapter 使用存储的过程。</span><span class="sxs-lookup"><span data-stu-id="7f17f-251">If you plan on manually adding columns to the DataTable, it is recommended that the TableAdapter use stored procedures.</span></span> <span data-ttu-id="7f17f-252">如果 TableAdapter 使用临时 SQL 语句，任何时候 TableAdapter 配置向导将运行所有数据字段列表恢复到主查询返回的数据字段的方法。</span><span class="sxs-lookup"><span data-stu-id="7f17f-252">If the TableAdapter uses ad-hoc SQL statements, any time the TableAdapter Configuration wizard is run all of the methods data field lists revert to the data fields returned by the main query.</span></span> <span data-ttu-id="7f17f-253">此问题不会扩展到存储过程，这就是为什么建议并已在本教程中使用它们。</span><span class="sxs-lookup"><span data-stu-id="7f17f-253">This problem does not extend to stored procedures, which is why they are recommended and were used in this tutorial.</span></span>

<span data-ttu-id="7f17f-254">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="7f17f-254">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="7f17f-255">关于作者</span><span class="sxs-lookup"><span data-stu-id="7f17f-255">About the Author</span></span>

<span data-ttu-id="7f17f-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七个 ASP/ASP.NET 书籍和的创始人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年使用与 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="7f17f-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7f17f-257">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="7f17f-257">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7f17f-258">最新书籍是[ *Sam 教授自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="7f17f-258">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="7f17f-259">他可以达到在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或通过他的博客，其中可以找到在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="7f17f-259">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="7f17f-260">特别感谢</span><span class="sxs-lookup"><span data-stu-id="7f17f-260">Special Thanks To</span></span>

<span data-ttu-id="7f17f-261">本教程系列已由许多有用的审阅者评审。</span><span class="sxs-lookup"><span data-stu-id="7f17f-261">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7f17f-262">本教程中的前导审阅者已徐 Schmidt、 Jacky Goor、 伯纳黛特 Leigh 和希尔顿 Giesenow。</span><span class="sxs-lookup"><span data-stu-id="7f17f-262">Lead reviewers for this tutorial were Randy Schmidt, Jacky Goor, Bernadette Leigh, and Hilton Giesenow.</span></span> <span data-ttu-id="7f17f-263">对感兴趣查看我即将到来的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="7f17f-263">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7f17f-264">如果是这样，删除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7f17f-264">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="7f17f-265">[上一页](updating-the-tableadapter-to-use-joins-cs.md)
[下一页](working-with-computed-columns-cs.md)</span><span class="sxs-lookup"><span data-stu-id="7f17f-265">[Previous](updating-the-tableadapter-to-use-joins-cs.md)
[Next](working-with-computed-columns-cs.md)</span></span>
