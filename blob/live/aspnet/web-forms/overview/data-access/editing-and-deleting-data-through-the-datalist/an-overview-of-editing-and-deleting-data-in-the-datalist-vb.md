---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-vb
title: "编辑和删除 DataList (VB) 中的数据的概述 |Microsoft 文档"
author: rick-anderson
description: "DataList 缺少内置编辑和删除功能，而在本教程中我们将了解如何创建支持编辑和删除 o DataList..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/30/2006
ms.topic: article
ms.assetid: 9410a23c-9697-4f07-bd71-e62b0ceac655
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-vb
msc.type: authoredcontent
ms.openlocfilehash: 3f43001b1980452e95187096cf884778c2970eb5
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="an-overview-of-editing-and-deleting-data-in-the-datalist-vb"></a><span data-ttu-id="2a41b-103">编辑和删除 DataList (VB) 中的数据的概述</span><span class="sxs-lookup"><span data-stu-id="2a41b-103">An Overview of Editing and Deleting Data in the DataList (VB)</span></span>
====================
<span data-ttu-id="2a41b-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="2a41b-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="2a41b-105">[下载示例应用程序](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_36_VB.exe)或[下载 PDF](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/datatutorial36vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="2a41b-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_36_VB.exe) or [Download PDF](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/datatutorial36vb1.pdf)</span></span>

> <span data-ttu-id="2a41b-106">DataList 缺少内置编辑和删除功能，而在本教程中我们将了解如何创建支持编辑和删除其基础数据的 DataList。</span><span class="sxs-lookup"><span data-stu-id="2a41b-106">While the DataList lacks built-in editing and deleting capabilities, in this tutorial we'll see how to create a DataList that supports editing and deleting of its underlying data.</span></span>


## <a name="introduction"></a><span data-ttu-id="2a41b-107">介绍</span><span class="sxs-lookup"><span data-stu-id="2a41b-107">Introduction</span></span>

<span data-ttu-id="2a41b-108">在[概述的插入、 更新和删除数据](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)我们介绍了如何插入、 更新和删除数据使用应用程序体系结构时，对象数据源，以及 GridView、 说明，和 FormView 的教程控件。</span><span class="sxs-lookup"><span data-stu-id="2a41b-108">In the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial we looked at how to insert, update, and delete data using the application architecture, an ObjectDataSource, and the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="2a41b-109">使用对象数据源和这些三个数据 Web 控件，实现简单的数据修改接口已管理单元和涉及仅计时从智能标记的复选框。</span><span class="sxs-lookup"><span data-stu-id="2a41b-109">With the ObjectDataSource and these three data Web controls, implementing simple data modification interfaces was a snap and involved merely ticking a checkbox from a smart tag.</span></span> <span data-ttu-id="2a41b-110">需要编写任何代码。</span><span class="sxs-lookup"><span data-stu-id="2a41b-110">No code needed to be written.</span></span>

<span data-ttu-id="2a41b-111">遗憾的是，DataList 缺少内置编辑和删除 GridView 控件中的固有的功能。</span><span class="sxs-lookup"><span data-stu-id="2a41b-111">Unfortunately, the DataList lacks the built-in editing and deleting capabilities inherent in the GridView control.</span></span> <span data-ttu-id="2a41b-112">此缺少的功能是在某种由于 DataList 是从以前版本的 ASP.NET，relic，当声明性数据源控件和无需编码的数据修改页不可用。</span><span class="sxs-lookup"><span data-stu-id="2a41b-112">This missing functionality is due in part to the fact that the DataList is a relic from the previous version of ASP.NET, when declarative data source controls and code-free data modification pages were unavailable.</span></span> <span data-ttu-id="2a41b-113">虽然在 ASP.NET 2.0 DataList 不提供现成的相同数据修改功能作为 GridView，我们可以使用 ASP.NET 1.x 技术包括这样的功能。</span><span class="sxs-lookup"><span data-stu-id="2a41b-113">While the DataList in ASP.NET 2.0 does not offer the same out of the box data modification capabilities as the GridView, we can use ASP.NET 1.x techniques to include such functionality.</span></span> <span data-ttu-id="2a41b-114">此方法需要的代码，但 DataList 的位置，以帮助在此过程中我们将在本教程中看到的具有某些事件和属性。</span><span class="sxs-lookup"><span data-stu-id="2a41b-114">This approach requires a bit of code but, as we'll see in this tutorial, the DataList has some events and properties in place to aid in this process.</span></span>

<span data-ttu-id="2a41b-115">在本教程中我们将了解如何创建支持编辑和删除其基础数据的 DataList。</span><span class="sxs-lookup"><span data-stu-id="2a41b-115">In this tutorial we'll see how to create a DataList that supports editing and deleting of its underlying data.</span></span> <span data-ttu-id="2a41b-116">更高级的编辑和删除方案 （包括输入的字段验证），适当地处理从数据访问层或业务逻辑层和等等引发的异常，将检查将来的教程。</span><span class="sxs-lookup"><span data-stu-id="2a41b-116">Future tutorials will examine more advanced editing and deleting scenarios, including input field validation, gracefully handling exceptions raised from the Data Access or Business Logic Layers, and so on.</span></span>

> [!NOTE]
> <span data-ttu-id="2a41b-117">DataList，如中继器控件缺少外插入、 更新或删除的框功能。</span><span class="sxs-lookup"><span data-stu-id="2a41b-117">Like the DataList, the Repeater control lacks the out of the box functionality for inserting, updating, or deleting.</span></span> <span data-ttu-id="2a41b-118">虽然可以添加此类功能，但是 DataList 包括属性和简化添加此类功能的事件中转发器找不到。</span><span class="sxs-lookup"><span data-stu-id="2a41b-118">While such functionality can be added, the DataList includes properties and events not found in the Repeater that simplify adding such capabilities.</span></span> <span data-ttu-id="2a41b-119">因此，本教程将来的以及查看编辑和删除将焦点严格 DataList。</span><span class="sxs-lookup"><span data-stu-id="2a41b-119">Therefore, this tutorial and future ones that look at editing and deleting will focus strictly on the DataList.</span></span>


## <a name="step-1-creating-the-editing-and-deleting-tutorials-web-pages"></a><span data-ttu-id="2a41b-120">步骤 1： 创建编辑和删除教程网页</span><span class="sxs-lookup"><span data-stu-id="2a41b-120">Step 1: Creating the Editing and Deleting Tutorials Web Pages</span></span>

<span data-ttu-id="2a41b-121">我们开始浏览如何更新和删除数据从 DataList 之前，让我们来首先花一些时间，我们需要用于本教程和下一步的几个的网站项目中创建 ASP.NET 页。</span><span class="sxs-lookup"><span data-stu-id="2a41b-121">Before we start exploring how to update and delete data from a DataList, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next several ones.</span></span> <span data-ttu-id="2a41b-122">首先，通过添加一个名为的新文件夹`EditDeleteDataList`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-122">Start by adding a new folder named `EditDeleteDataList`.</span></span> <span data-ttu-id="2a41b-123">接下来，添加到该文件夹，并确保将每个包含网页相关联的以下 ASP.NET 页面`Site.master`母版页：</span><span class="sxs-lookup"><span data-stu-id="2a41b-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `Basics.aspx`
- `BatchUpdate.aspx`
- `ErrorHandling.aspx`
- `UIValidation.aspx`
- `CustomizedUI.aspx`
- `OptimisticConcurrency.aspx`
- `ConfirmationOnDelete.aspx`
- `UserLevelAccess.aspx`


![本教程中添加的 ASP.NET 页面](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image1.png)

<span data-ttu-id="2a41b-125">**图 1**： 本教程中添加的 ASP.NET 页面</span><span class="sxs-lookup"><span data-stu-id="2a41b-125">**Figure 1**: Add the ASP.NET Pages for the Tutorials</span></span>


<span data-ttu-id="2a41b-126">在其他文件夹中，如`Default.aspx`中`EditDeleteDataList`文件夹其部分中列出这些教程。</span><span class="sxs-lookup"><span data-stu-id="2a41b-126">Like in the other folders, `Default.aspx` in the `EditDeleteDataList` folder lists the tutorials in its section.</span></span> <span data-ttu-id="2a41b-127">回想一下，`SectionLevelTutorialListing.ascx`用户控件提供此功能。</span><span class="sxs-lookup"><span data-stu-id="2a41b-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="2a41b-128">因此，此用户将控件添加到`Default.aspx`通过从解决方案资源管理器拖到页面上的设计视图拖动。</span><span class="sxs-lookup"><span data-stu-id="2a41b-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>


<span data-ttu-id="2a41b-129">[![SectionLevelTutorialListing.ascx 用户控件添加到 Default.aspx](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image3.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="2a41b-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image3.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image2.png)</span></span>

<span data-ttu-id="2a41b-130">**图 2**： 添加`SectionLevelTutorialListing.ascx`用户控件`Default.aspx`([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="2a41b-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image4.png))</span></span>


<span data-ttu-id="2a41b-131">最后，将页添加到的条目为`Web.sitemap`文件。</span><span class="sxs-lookup"><span data-stu-id="2a41b-131">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="2a41b-132">具体而言，在主/详细信息报表后添加以下标记，使用 DataList 和转发器`<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="2a41b-132">Specifically, add the following markup after the Master/Detail Reports with the DataList and Repeater `<siteMapNode>`:</span></span>


[!code-xml[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample1.xml)]

<span data-ttu-id="2a41b-133">在更新后`Web.sitemap`，花些时间查看通过浏览器网站的教程。</span><span class="sxs-lookup"><span data-stu-id="2a41b-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="2a41b-134">在左侧菜单现在包括 DataList 编辑和删除教程项。</span><span class="sxs-lookup"><span data-stu-id="2a41b-134">The menu on the left now includes items for the DataList editing and deleting tutorials.</span></span>


![站点图现在包括 DataList 编辑和删除教程的条目](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image5.png)

<span data-ttu-id="2a41b-136">**图 3**： 站点图现在包括 DataList 编辑和删除教程的条目</span><span class="sxs-lookup"><span data-stu-id="2a41b-136">**Figure 3**: The Site Map Now Includes Entries for the DataList Editing and Deleting Tutorials</span></span>


## <a name="step-2-examining-techniques-for-updating-and-deleting-data"></a><span data-ttu-id="2a41b-137">第 2 步： 检查更新和删除数据的技术</span><span class="sxs-lookup"><span data-stu-id="2a41b-137">Step 2: Examining Techniques for Updating and Deleting Data</span></span>

<span data-ttu-id="2a41b-138">编辑和删除与 GridView 的数据是非常简单，因为这背后的 GridView 和 ObjectDataSource 协同工作。</span><span class="sxs-lookup"><span data-stu-id="2a41b-138">Editing and deleting data with the GridView is so easy because, underneath the covers, the GridView and ObjectDataSource work in concert.</span></span> <span data-ttu-id="2a41b-139">中所述[检查与插入、 更新和删除的事件相关联](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)教程中，单击行的更新按钮时，GridView 自动分配使用双向数据绑定到其字段`UpdateParameters`其对象数据源的集合，然后调用该 ObjectDataSource 的`Update()`方法。</span><span class="sxs-lookup"><span data-stu-id="2a41b-139">As discussed in the [Examining the Events Associated with Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md) tutorial, when a row s Update button is clicked, the GridView automatically assigns its fields that used two-way databinding to the `UpdateParameters` collection of its ObjectDataSource and then invokes that ObjectDataSource s `Update()` method.</span></span>

<span data-ttu-id="2a41b-140">遗憾的是，DataList 不提供任何此内置的功能。</span><span class="sxs-lookup"><span data-stu-id="2a41b-140">Sadly, the DataList does not provide any of this built-in functionality.</span></span> <span data-ttu-id="2a41b-141">我们有责任以确保用户 s 将值赋给 ObjectDataSource 的参数且其`Update()`调用方法。</span><span class="sxs-lookup"><span data-stu-id="2a41b-141">It is our responsibility to ensure that the user s values are assigned to the ObjectDataSource s parameters and that its `Update()` method is called.</span></span> <span data-ttu-id="2a41b-142">为了帮助我们在此任务，DataList 提供的以下属性和事件：</span><span class="sxs-lookup"><span data-stu-id="2a41b-142">To aid us in this endeavor, the DataList provides the following properties and events:</span></span>

- <span data-ttu-id="2a41b-143">**[ `DataKeyField`属性](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.basedatalist.datakeyfield.aspx)**当更新或删除时，我们需要能够唯一识别 DataList 中的每一项。</span><span class="sxs-lookup"><span data-stu-id="2a41b-143">**The [`DataKeyField` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.basedatalist.datakeyfield.aspx)** when updating or deleting, we need to be able to uniquely identify each item in the DataList.</span></span> <span data-ttu-id="2a41b-144">将此属性设置为显示的数据的主键字段。</span><span class="sxs-lookup"><span data-stu-id="2a41b-144">Set this property to the primary key field of the displayed data.</span></span> <span data-ttu-id="2a41b-145">这样将填充 DataList s [ `DataKeys`集合](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.basedatalist.datakeys.aspx)具有指定`DataKeyField`DataList 的每个项的值。</span><span class="sxs-lookup"><span data-stu-id="2a41b-145">Doing so will populate the DataList s [`DataKeys` collection](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.basedatalist.datakeys.aspx) with the specified `DataKeyField` value for each DataList item.</span></span>
- <span data-ttu-id="2a41b-146">**[ `EditCommand`事件](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.editcommand.aspx)**按钮、 LinkButton 或 ImageButton 时激发其`CommandName`属性设置为单击编辑。</span><span class="sxs-lookup"><span data-stu-id="2a41b-146">**The [`EditCommand` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.editcommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Edit is clicked.</span></span>
- <span data-ttu-id="2a41b-147">**[ `CancelCommand`事件](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.cancelcommand.aspx)**按钮、 LinkButton 或 ImageButton 时激发其`CommandName`属性设置为单击取消。</span><span class="sxs-lookup"><span data-stu-id="2a41b-147">**The [`CancelCommand` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.cancelcommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Cancel is clicked.</span></span>
- <span data-ttu-id="2a41b-148">**[ `UpdateCommand`事件](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.updatecommand.aspx)**按钮、 LinkButton 或 ImageButton 时激发其`CommandName`属性设置为在单击更新。</span><span class="sxs-lookup"><span data-stu-id="2a41b-148">**The [`UpdateCommand` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.updatecommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Update is clicked.</span></span>
- <span data-ttu-id="2a41b-149">**[ `DeleteCommand`事件](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.deletecommand.aspx)**按钮、 LinkButton 或 ImageButton 时激发其`CommandName`属性设置为单击删除。</span><span class="sxs-lookup"><span data-stu-id="2a41b-149">**The [`DeleteCommand` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.deletecommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Delete is clicked.</span></span>

<span data-ttu-id="2a41b-150">使用这些属性和事件，有四种方法可以用于更新和删除数据从 DataList:</span><span class="sxs-lookup"><span data-stu-id="2a41b-150">Using these properties and events, there are four approaches we can use to update and delete data from the DataList:</span></span>

1. <span data-ttu-id="2a41b-151">**使用 ASP.NET 1.x 技术**DataList ASP.NET 2.0 和 ObjectDataSources 之前存在并已能够更新和删除数据完全通过编程方式。</span><span class="sxs-lookup"><span data-stu-id="2a41b-151">**Using ASP.NET 1.x Techniques** the DataList existed prior to ASP.NET 2.0 and ObjectDataSources and was able to update and delete data entirely through programmatic means.</span></span> <span data-ttu-id="2a41b-152">此方法完全 ditches ObjectDataSource 和要求，我们将数据绑定到 DataList 直接从业务逻辑层，不管是在检索要显示的数据和更新或删除记录时。</span><span class="sxs-lookup"><span data-stu-id="2a41b-152">This technique ditches the ObjectDataSource altogether and requires that we bind the data to the DataList directly from the Business Logic Layer, both in retrieving the data to display and when updating or deleting a record.</span></span>
2. <span data-ttu-id="2a41b-153">**用于选择、 更新和删除的页上的单个 ObjectDataSource 控件**时 DataList 缺少 GridView s 固有编辑和删除功能，这里 s 无端我们可以 t 以添加，并自行。</span><span class="sxs-lookup"><span data-stu-id="2a41b-153">**Using a Single ObjectDataSource Control on the Page for Selecting, Updating, and Deleting** while the DataList lacks the GridView s inherent editing and deleting capabilities, there s no reason we can t add them in ourselves.</span></span> <span data-ttu-id="2a41b-154">使用此方法，我们在 GridView 示例中，就像使用对象数据源，但必须为 DataList s 创建事件处理程序`UpdateCommand`事件中： 我们在其中设置 ObjectDataSource 的参数和调用其`Update()`方法。</span><span class="sxs-lookup"><span data-stu-id="2a41b-154">With this approach, we use an ObjectDataSource just like in the GridView examples, but must create an event handler for the DataList s `UpdateCommand` event where we set the ObjectDataSource s parameters and call its `Update()` method.</span></span>
3. <span data-ttu-id="2a41b-155">**ObjectDataSource 控件用于选择，但更新和删除直接针对 BLL**使用选项 2 时，我们需要编写的代码中`UpdateCommand`事件，依次类推分配参数值。</span><span class="sxs-lookup"><span data-stu-id="2a41b-155">**Using an ObjectDataSource Control for Selecting, but Updating and Deleting Directly Against the BLL** when using option 2, we need to write a bit of code in the `UpdateCommand` event, assigning parameter values and so on.</span></span> <span data-ttu-id="2a41b-156">相反，我们可以停在与使用对象数据源进行选择，但进行更新和删除直接针对 BLL （例如，使用选项 1） 调用。</span><span class="sxs-lookup"><span data-stu-id="2a41b-156">Instead, we can stick with using the ObjectDataSource for selecting, but make the updating and deleting calls directly against the BLL (like with option 1).</span></span> <span data-ttu-id="2a41b-157">在我看来，通过直接接触 BLL 更新数据，就会导致更具可读性代码比分配 ObjectDataSource s`UpdateParameters`并调用其`Update()`方法。</span><span class="sxs-lookup"><span data-stu-id="2a41b-157">In my opinion, updating data by interfacing directly with the BLL leads to more readable code than assigning the ObjectDataSource s `UpdateParameters` and calling its `Update()` method.</span></span>
4. <span data-ttu-id="2a41b-158">**使用声明性方式通过多个 ObjectDataSources**以前所有的三种方法需要的代码。</span><span class="sxs-lookup"><span data-stu-id="2a41b-158">**Using Declarative Means through Multiple ObjectDataSources** the previous three approaches all require a bit of code.</span></span> <span data-ttu-id="2a41b-159">如果你 d 而继续使用如尽可能得多的声明性语法，最后一个选项是包括在页上的多个 ObjectDataSources。</span><span class="sxs-lookup"><span data-stu-id="2a41b-159">If you d rather keep using as much declarative syntax as possible, a final option is to include multiple ObjectDataSources on the page.</span></span> <span data-ttu-id="2a41b-160">第一个对象数据源从 BLL 中检索数据，并将其绑定到 DataList。</span><span class="sxs-lookup"><span data-stu-id="2a41b-160">The first ObjectDataSource retrieves the data from the BLL and binds it to the DataList.</span></span> <span data-ttu-id="2a41b-161">为了更新，添加，但直接在 DataList s 内添加另一个 ObjectDataSource `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-161">For updating, another ObjectDataSource is added, but added directly within the DataList s `EditItemTemplate`.</span></span> <span data-ttu-id="2a41b-162">若要包括删除支持，尚未另一个对象数据源需要在`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-162">To include deleting support, yet another ObjectDataSource would be needed in the `ItemTemplate`.</span></span> <span data-ttu-id="2a41b-163">使用此方法，这些嵌入 ObjectDataSource 的使用`ControlParameters`若要以声明方式将 ObjectDataSource 的参数绑定到用户输入控件 (而不是无需在 DataList s 以编程方式指定`UpdateCommand`事件处理程序)。</span><span class="sxs-lookup"><span data-stu-id="2a41b-163">With this approach, these embedded ObjectDataSource s use `ControlParameters` to declaratively bind the ObjectDataSource s parameters to the user input controls (rather than having to specify them programmatically in the DataList s `UpdateCommand` event handler).</span></span> <span data-ttu-id="2a41b-164">此方法仍要求的代码，我们需要调用嵌入的 ObjectDataSource s`Update()`或`Delete()`命令，但需要远远小于与其他三种方法。</span><span class="sxs-lookup"><span data-stu-id="2a41b-164">This approach still requires a bit of code we need to call the embedded ObjectDataSource s `Update()` or `Delete()` command but requires far less than with the other three approaches.</span></span> <span data-ttu-id="2a41b-165">此处的缺点是，多个 ObjectDataSources 执行混乱不堪页上，使整体可读性。</span><span class="sxs-lookup"><span data-stu-id="2a41b-165">The downside here is that the multiple ObjectDataSources do clutter up the page, detracting from the overall readability.</span></span>

<span data-ttu-id="2a41b-166">如果强制永远只有使用其中一种方法，我选择选项 1，因为它提供了最大的灵活性和因为 DataList 最初设计用于容纳此模式。</span><span class="sxs-lookup"><span data-stu-id="2a41b-166">If forced to only ever use one of these approaches, I d choose option 1 because it provides the most flexibility and because the DataList was originally designed to accommodate this pattern.</span></span> <span data-ttu-id="2a41b-167">DataList 已扩展到使用 ASP.NET 2.0 数据源控件，但它没有的所有扩展性点或官方 ASP.NET 2.0 数据 （GridView，说明如何和 FormView） 的 Web 控件的功能。</span><span class="sxs-lookup"><span data-stu-id="2a41b-167">While the DataList was extended to work with the ASP.NET 2.0 data source controls, it does not have all of the extensibility points or features of the official ASP.NET 2.0 data Web controls (the GridView, DetailsView, and FormView).</span></span> <span data-ttu-id="2a41b-168">选项 2 至 4 但是，也不值得，没有。</span><span class="sxs-lookup"><span data-stu-id="2a41b-168">Options 2 through 4 are not without merit, though.</span></span>

<span data-ttu-id="2a41b-169">这和将来编辑和删除教程将使用对象数据源用于检索数据可以显示并将调用定向到 BLL 更新和删除数据 （选项 3）。</span><span class="sxs-lookup"><span data-stu-id="2a41b-169">This and the future editing and deleting tutorials will use an ObjectDataSource for retrieving the data to display and direct calls to the BLL to update and delete data (option 3).</span></span>

## <a name="step-3-adding-the-datalist-and-configuring-its-objectdatasource"></a><span data-ttu-id="2a41b-170">步骤 3： 添加 DataList 和配置其 ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="2a41b-170">Step 3: Adding the DataList and Configuring its ObjectDataSource</span></span>

<span data-ttu-id="2a41b-171">在本教程中我们将创建 DataList 列出产品信息，并为每个产品，提供用户编辑名称和价格，并完全删除该产品的功能。</span><span class="sxs-lookup"><span data-stu-id="2a41b-171">In this tutorial we will create a DataList that lists product information and, for each product, provides the user the ability to edit the name and price and to delete the product altogether.</span></span> <span data-ttu-id="2a41b-172">具体而言，我们将检索的记录，以显示使用对象数据源，但执行更新和删除操作通过直接与 BLL 进行连接。</span><span class="sxs-lookup"><span data-stu-id="2a41b-172">In particular, we will retrieve the records to display using an ObjectDataSource, but perform the update and delete actions by interfacing directly with the BLL.</span></span> <span data-ttu-id="2a41b-173">我们担心实现 DataList 的编辑和删除功能之前，让我们来首先要获取页后，可以在只读的界面中显示的产品。</span><span class="sxs-lookup"><span data-stu-id="2a41b-173">Before we worry about implementing the editing and deleting capabilities to the DataList, let s first get the page to display the products in a read-only interface.</span></span> <span data-ttu-id="2a41b-174">因为我们已将检查这些步骤在上一个教程中，我将继续访问这些快速。</span><span class="sxs-lookup"><span data-stu-id="2a41b-174">Since we ve examined these steps in previous tutorials, I'll proceed through them quickly.</span></span>

<span data-ttu-id="2a41b-175">首先打开`Basics.aspx`页面`EditDeleteDataList`文件夹，然后从设计视图中，添加 DataList 到页。</span><span class="sxs-lookup"><span data-stu-id="2a41b-175">Start by opening the `Basics.aspx` page in the `EditDeleteDataList` folder and, from the Design view, add a DataList to the page.</span></span> <span data-ttu-id="2a41b-176">接下来，从 DataList s 智能标记，创建新对象数据源。</span><span class="sxs-lookup"><span data-stu-id="2a41b-176">Next, from the DataList s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="2a41b-177">由于我们正在使用产品数据，将其配置为使用`ProductsBLL`类。</span><span class="sxs-lookup"><span data-stu-id="2a41b-177">Since we are working with product data, configure it to use the `ProductsBLL` class.</span></span> <span data-ttu-id="2a41b-178">若要检索*所有*产品，选择`GetProducts()`中选择的选项卡上的方法。</span><span class="sxs-lookup"><span data-stu-id="2a41b-178">To retrieve *all* products, choose the `GetProducts()` method in the SELECT tab.</span></span>


<span data-ttu-id="2a41b-179">[![配置对象数据源以使用 ProductsBLL 类](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image7.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="2a41b-179">[![Configure the ObjectDataSource to Use the ProductsBLL Class](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image7.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image6.png)</span></span>

<span data-ttu-id="2a41b-180">**图 4**： 配置使用 ObjectDataSource`ProductsBLL`类 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="2a41b-180">**Figure 4**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image8.png))</span></span>


<span data-ttu-id="2a41b-181">[![返回使用 GetProducts() 方法的产品信息](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image10.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="2a41b-181">[![Return the Product Information Using the GetProducts() Method](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image10.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image9.png)</span></span>

<span data-ttu-id="2a41b-182">**图 5**： 返回产品信息使用`GetProducts()`方法 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="2a41b-182">**Figure 5**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image11.png))</span></span>


<span data-ttu-id="2a41b-183">DataList，如 GridView，不适用于插入新数据;因此，选择插入选项卡中的下拉列表从 (None) 选项。此外选择 （无） 为 UPDATE 和 DELETE 选项卡由于将通过 BLL 以编程方式执行更新和删除操作。</span><span class="sxs-lookup"><span data-stu-id="2a41b-183">The DataList, like the GridView, is not designed for inserting new data; therefore, select the (None) option from the drop-down list in the INSERT tab. Also choose (None) for the UPDATE and DELETE tabs since the updates and deletes will be performed programmatically through the BLL.</span></span>


<span data-ttu-id="2a41b-184">[![确认下拉列表中 ObjectDataSource 的插入、 更新和删除选项卡设置为 （无）](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image13.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="2a41b-184">[![Confirm that the Drop-Down Lists in the ObjectDataSource s INSERT, UPDATE, and DELETE Tabs are Set to (None)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image13.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image12.png)</span></span>

<span data-ttu-id="2a41b-185">**图 6**： 确认，ObjectDataSource 的插入、 更新和删除选项卡中的下拉列表设置为 （无） ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="2a41b-185">**Figure 6**: Confirm that the Drop-Down Lists in the ObjectDataSource s INSERT, UPDATE, and DELETE Tabs are Set to (None) ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image14.png))</span></span>


<span data-ttu-id="2a41b-186">在配置对象数据源后，单击完成返回到设计器。</span><span class="sxs-lookup"><span data-stu-id="2a41b-186">After configuring the ObjectDataSource, click Finish, returning to the Designer.</span></span> <span data-ttu-id="2a41b-187">正如我们看到在过去的示例中，当自动完成对象数据源配置，Visual Studio 的已创建`ItemTemplate`的下拉列表中，显示每个数据字段。</span><span class="sxs-lookup"><span data-stu-id="2a41b-187">As we ve seen in past examples, when completing the ObjectDataSource configuration, Visual Studio automatically creates an `ItemTemplate` for the DropDownList, displaying each of the data fields.</span></span> <span data-ttu-id="2a41b-188">将此替换`ItemTemplate`具有一个显示产品的名称和价格。</span><span class="sxs-lookup"><span data-stu-id="2a41b-188">Replace this `ItemTemplate` with one that displays only the product s name and price.</span></span> <span data-ttu-id="2a41b-189">此外，还要设置`RepeatColumns`属性设置为 2。</span><span class="sxs-lookup"><span data-stu-id="2a41b-189">Also, set the `RepeatColumns` property to 2.</span></span>

> [!NOTE]
> <span data-ttu-id="2a41b-190">中所述*概述的插入、 更新和删除数据*教程中，修改数据使用我们的体系结构需要我们删除 ObjectDataSource 时`OldValuesParameterFormatString`从 ObjectDataSource 的属性声明性的标记 (或其重置为其默认值， `{0}`)。</span><span class="sxs-lookup"><span data-stu-id="2a41b-190">As discussed in the *Overview of Inserting, Updating, and Deleting Data* tutorial, when modifying data using the ObjectDataSource our architecture requires that we remove the `OldValuesParameterFormatString` property from the ObjectDataSource s declarative markup (or reset it to its default value, `{0}`).</span></span> <span data-ttu-id="2a41b-191">在本教程中，但是，我们将使用 ObjectDataSource 仅用于检索数据。</span><span class="sxs-lookup"><span data-stu-id="2a41b-191">In this tutorial, however, we are using the ObjectDataSource only for retrieving data.</span></span> <span data-ttu-id="2a41b-192">因此，我们不需要修改 ObjectDataSource 的`OldValuesParameterFormatString`属性值 (尽管它不会降低，若要这样做)。</span><span class="sxs-lookup"><span data-stu-id="2a41b-192">Therefore, we do not need to modify the ObjectDataSource s `OldValuesParameterFormatString` property value (although it doesn t hurt to do so).</span></span>


<span data-ttu-id="2a41b-193">替换默认 DataList 后`ItemTemplate`用一个自定义在页面上的声明性标记应类似于以下：</span><span class="sxs-lookup"><span data-stu-id="2a41b-193">After replacing the default DataList `ItemTemplate` with a customized one, the declarative markup on your page should look similar to the following:</span></span>


[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample2.aspx)]

<span data-ttu-id="2a41b-194">花些时间查看我们通过浏览器的进度。</span><span class="sxs-lookup"><span data-stu-id="2a41b-194">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="2a41b-195">如图 7 所示，DataList 两个列中显示每个产品的产品名称和单位价格。</span><span class="sxs-lookup"><span data-stu-id="2a41b-195">As Figure 7 shows, the DataList displays the product name and unit price for each product in two columns.</span></span>


<span data-ttu-id="2a41b-196">[![在两个列 DataList 中显示的产品名称和价格](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image16.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="2a41b-196">[![The Products Names and Prices are Displayed in a Two-Column DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image16.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image15.png)</span></span>

<span data-ttu-id="2a41b-197">**图 7**: 产品名称和产品价格显示在两个列 DataList ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image17.png))</span><span class="sxs-lookup"><span data-stu-id="2a41b-197">**Figure 7**: The Products Names and Prices are Displayed in a Two-Column DataList ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image17.png))</span></span>


> [!NOTE]
> <span data-ttu-id="2a41b-198">DataList 具有多个更新和删除过程中，所需的属性和视图状态中存储这些值。</span><span class="sxs-lookup"><span data-stu-id="2a41b-198">The DataList has a number of properties that are required for the updating and deleting process, and these values are stored in view state.</span></span> <span data-ttu-id="2a41b-199">因此，当生成 DataList，该支持编辑或删除数据，很关键，启用 DataList 的视图状态。</span><span class="sxs-lookup"><span data-stu-id="2a41b-199">Therefore, when building a DataList that supports editing or deleting data, it is essential that the DataList s view state be enabled.</span></span>  
>   
>  <span data-ttu-id="2a41b-200">敏锐读取器可能还记得我们能够在创建可编辑 GridViews、 DetailsViews 和 FormViews 时禁用视图状态。</span><span class="sxs-lookup"><span data-stu-id="2a41b-200">The astute reader may recall that we were able to disable view state when creating editable GridViews, DetailsViews, and FormViews.</span></span> <span data-ttu-id="2a41b-201">这是因为 ASP.NET 2.0 Web 控件可以包含*控制状态*，后者在类似于视图状态，但被视为基本的回发保持状态。</span><span class="sxs-lookup"><span data-stu-id="2a41b-201">This is because ASP.NET 2.0 Web controls can include *control state*, which is state persisted across postbacks like view state, but deemed essential.</span></span>


<span data-ttu-id="2a41b-202">正在禁用视图中 GridView 状态只是未包含普通的状态信息，但维护 （其中包括用于编辑和删除所需的状态） 的控件状态。</span><span class="sxs-lookup"><span data-stu-id="2a41b-202">Disabling view state in the GridView merely omits trivial state information, but maintains the control state (which includes the state necessary for editing and deleting).</span></span> <span data-ttu-id="2a41b-203">DataList，具有在 ASP.NET 1.x 的时间范围内，已创建不使用控件状态，因此必须具有启用视图状态。</span><span class="sxs-lookup"><span data-stu-id="2a41b-203">The DataList, having been created in the ASP.NET 1.x timeframe, does not utilize control state and therefore must have view state enabled.</span></span> <span data-ttu-id="2a41b-204">请参阅[控件状态 vs。视图状态](https://msdn.microsoft.com/en-us/library/1whwt1k7.aspx)有关详细信息的控件状态和与视图状态的不同目的。</span><span class="sxs-lookup"><span data-stu-id="2a41b-204">See [Control State vs. View State](https://msdn.microsoft.com/en-us/library/1whwt1k7.aspx) for more information on the purpose of control state and how it differs from view state.</span></span>

## <a name="step-4-adding-an-editing-user-interface"></a><span data-ttu-id="2a41b-205">步骤 4： 添加用于编辑的用户界面</span><span class="sxs-lookup"><span data-stu-id="2a41b-205">Step 4: Adding an Editing User Interface</span></span>

<span data-ttu-id="2a41b-206">GridView 控件组成的字段 （BoundFields、 CheckBoxFields、 TemplateFields，等） 的集合。</span><span class="sxs-lookup"><span data-stu-id="2a41b-206">The GridView control is composed of a collection of fields (BoundFields, CheckBoxFields, TemplateFields, and so on).</span></span> <span data-ttu-id="2a41b-207">这些字段可以调整其呈现的标记，具体取决于其模式。</span><span class="sxs-lookup"><span data-stu-id="2a41b-207">These fields can adjust their rendered markup depending on their mode.</span></span> <span data-ttu-id="2a41b-208">例如，在只读模式下，BoundField 显示其数据字段值作为文本;当处于编辑模式呈现文本框中 Web 控件`Text`属性分配数据字段值。</span><span class="sxs-lookup"><span data-stu-id="2a41b-208">For example, when in read-only mode, a BoundField displays its data field value as text; when in edit mode, it renders a TextBox Web control whose `Text` property is assigned the data field value.</span></span>

<span data-ttu-id="2a41b-209">DataList，另一方面，呈现其使用模板的项。</span><span class="sxs-lookup"><span data-stu-id="2a41b-209">The DataList, on the other hand, renders its items using templates.</span></span> <span data-ttu-id="2a41b-210">只读项呈现使用`ItemTemplate`而处于编辑模式项呈现通过`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-210">Read-only items are rendered using the `ItemTemplate` whereas items in edit mode are rendered via the `EditItemTemplate`.</span></span> <span data-ttu-id="2a41b-211">此时，我们 DataList 只有`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-211">At this point, our DataList has only an `ItemTemplate`.</span></span> <span data-ttu-id="2a41b-212">若要支持项目级编辑功能，我们需要添加`EditItemTemplate`，其中包含要为可编辑的项显示的标记。</span><span class="sxs-lookup"><span data-stu-id="2a41b-212">To support item-level editing functionality we need to add an `EditItemTemplate` that contains the markup to be displayed for the editable item.</span></span> <span data-ttu-id="2a41b-213">对于本教程，我们将使用以进行编辑产品的名称和单价的文本框中 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="2a41b-213">For this tutorial, we'll use TextBox Web controls for editing the product s name and unit price.</span></span>

<span data-ttu-id="2a41b-214">`EditItemTemplate`可以 （通过选择编辑模板选项中 DataList s 智能标记） 以声明方式或通过设计器创建。</span><span class="sxs-lookup"><span data-stu-id="2a41b-214">The `EditItemTemplate` can be created either declaratively or through the Designer (by selecting the Edit Templates option from the DataList s smart tag).</span></span> <span data-ttu-id="2a41b-215">若要使用编辑模板选项，请首先单击智能标记中的编辑模板链接，然后选择`EditItemTemplate`从下拉列表的项。</span><span class="sxs-lookup"><span data-stu-id="2a41b-215">To use the Edit Templates option, first click the Edit Templates link in the smart tag and then select the `EditItemTemplate` item from the drop-down list.</span></span>


<span data-ttu-id="2a41b-216">[![选择以使用 DataList 的 EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image19.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="2a41b-216">[![Opt to Work with the DataList s EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image19.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image18.png)</span></span>

<span data-ttu-id="2a41b-217">**图 8**： 选择以使用 DataList s `EditItemTemplate` ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="2a41b-217">**Figure 8**: Opt to Work with the DataList s `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image20.png))</span></span>


<span data-ttu-id="2a41b-218">接下来，在产品名称中键入: 和价格： 然后将两个文本框控件拖动到工具箱从`EditItemTemplate`设计器上的接口。</span><span class="sxs-lookup"><span data-stu-id="2a41b-218">Next, type in Product name: and Price: and then drag two TextBox controls from the Toolbox into the `EditItemTemplate` interface on the Designer.</span></span> <span data-ttu-id="2a41b-219">设置文本框中`ID`属性设置为`ProductName`和`UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-219">Set the TextBoxes `ID` properties to `ProductName` and `UnitPrice`.</span></span>


<span data-ttu-id="2a41b-220">[![添加产品的名称和价格的文本框](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image22.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="2a41b-220">[![Add a TextBox for the Product s Name and Price](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image22.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image21.png)</span></span>

<span data-ttu-id="2a41b-221">**图 9**： 添加文本框的产品名称和价格 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image23.png))</span><span class="sxs-lookup"><span data-stu-id="2a41b-221">**Figure 9**: Add a TextBox for the Product s Name and Price ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image23.png))</span></span>


<span data-ttu-id="2a41b-222">我们需要将绑定到的相应产品数据字段值`Text`的两个文本框中的属性。</span><span class="sxs-lookup"><span data-stu-id="2a41b-222">We need to bind the corresponding product data field values to the `Text` properties of the two TextBoxes.</span></span> <span data-ttu-id="2a41b-223">从文本框中的智能标记，单击编辑数据绑定链接，然后将关联具有的适当的数据字段`Text`属性，如图 10 中所示。</span><span class="sxs-lookup"><span data-stu-id="2a41b-223">From the TextBoxes smart tags, click on the Edit DataBindings link and then associate the appropriate data field with the `Text` property, as shown in Figure 10.</span></span>

> [!NOTE]
> <span data-ttu-id="2a41b-224">在绑定时`UnitPrice`到文本框中 s 的价格数据字段`Text`字段中，您可能将其格式化为货币值 (`{0:C}`)，常规数 (`{0:N}`)，或将其保留为未格式化。</span><span class="sxs-lookup"><span data-stu-id="2a41b-224">When binding the `UnitPrice` data field to the price TextBox s `Text` field, you may format it as a currency value (`{0:C}`), a general number (`{0:N}`), or leave it unformatted.</span></span>


![将产品名称和单价数据字段绑定到文本框中的文本属性](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image24.png)

<span data-ttu-id="2a41b-226">**图 10**： 绑定`ProductName`和`UnitPrice`数据字段设置为`Text`的文本框中的属性</span><span class="sxs-lookup"><span data-stu-id="2a41b-226">**Figure 10**: Bind the `ProductName` and `UnitPrice` Data Fields to the `Text` Properties of the TextBoxes</span></span>


<span data-ttu-id="2a41b-227">请注意图 10 中的编辑数据绑定对话框的工作原理*不*包括编辑在 GridView 或说明，为 TemplateField 或 FormView 中的模板时显示的双向数据绑定复选框。</span><span class="sxs-lookup"><span data-stu-id="2a41b-227">Notice how the Edit DataBindings dialog box in Figure 10 does *not* include the Two-way databinding checkbox that is present when editing a TemplateField in the GridView or DetailsView, or a template in the FormView.</span></span> <span data-ttu-id="2a41b-228">允许文本框输入的 Web 控件，若要自动分配到相应的 ObjectDataSource s 中输入的值使用双向数据绑定功能`InsertParameters`或`UpdateParameters`插入或更新数据时。</span><span class="sxs-lookup"><span data-stu-id="2a41b-228">The two-way databinding feature allowed the value entered into the input Web control to be automatically assigned to the corresponding ObjectDataSource s `InsertParameters` or `UpdateParameters` when inserting or updating data.</span></span> <span data-ttu-id="2a41b-229">DataList 不支持双向数据绑定，因为我们将有更高版本上，在本教程中，了解用户使她更改和已准备好更新数据后，我们将需要以编程方式访问这些文本框中`Text`属性和传入到其值适当`UpdateProduct`中的方法`ProductsBLL`类。</span><span class="sxs-lookup"><span data-stu-id="2a41b-229">The DataList does not support two-way databinding as we'll see later on in this tutorial, after the user makes her changes and is ready to update the data, we will need to programmatically access these TextBoxes `Text` properties and pass in their values to the appropriate `UpdateProduct` method in the `ProductsBLL` class.</span></span>

<span data-ttu-id="2a41b-230">最后，我们需要添加更新和取消按钮`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-230">Finally, we need to add Update and Cancel buttons to the `EditItemTemplate`.</span></span> <span data-ttu-id="2a41b-231">正如我们看到在[母版/详细介绍 Master 记录项目符号列表使用详细信息 DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md)教程中，按钮、 LinkButton 或 ImageButton 时其`CommandName`属性设置中的转发器或 DataList，单击从转发器或 DataList 的`ItemCommand`引发事件。</span><span class="sxs-lookup"><span data-stu-id="2a41b-231">As we saw in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial, when a Button, LinkButton, or ImageButton whose `CommandName` property is set is clicked from within a Repeater or DataList, the Repeater or DataList s `ItemCommand` event is raised.</span></span> <span data-ttu-id="2a41b-232">有关 DataList，如果`CommandName`属性设置为某个值，则可能也引发事件的附加事件。</span><span class="sxs-lookup"><span data-stu-id="2a41b-232">For the DataList, if the `CommandName` property is set to a certain value, an additional event may be raised as well.</span></span> <span data-ttu-id="2a41b-233">这两个特殊`CommandName`内的其他属性值包括：</span><span class="sxs-lookup"><span data-stu-id="2a41b-233">The special `CommandName` property values include, among others:</span></span>

- <span data-ttu-id="2a41b-234">取消引发`CancelCommand`事件</span><span class="sxs-lookup"><span data-stu-id="2a41b-234">Cancel raises the `CancelCommand` event</span></span>
- <span data-ttu-id="2a41b-235">编辑引发`EditCommand`事件</span><span class="sxs-lookup"><span data-stu-id="2a41b-235">Edit raises the `EditCommand` event</span></span>
- <span data-ttu-id="2a41b-236">更新引发`UpdateCommand`事件</span><span class="sxs-lookup"><span data-stu-id="2a41b-236">Update raises the `UpdateCommand` event</span></span>

<span data-ttu-id="2a41b-237">请记住，会引发这些事件*除了*`ItemCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="2a41b-237">Keep in mind that these events are raised *in addition to* the `ItemCommand` event.</span></span>

<span data-ttu-id="2a41b-238">将添加到`EditItemTemplate`两个按钮 Web 控件、 一个其`CommandName`设置为更新和其他 s 设置为取消。</span><span class="sxs-lookup"><span data-stu-id="2a41b-238">Add to the `EditItemTemplate` two Button Web controls, one whose `CommandName` is set to Update and the other s set to Cancel.</span></span> <span data-ttu-id="2a41b-239">后添加这两个按钮 Web 控件设计器应看起来类似于以下：</span><span class="sxs-lookup"><span data-stu-id="2a41b-239">After adding these two Button Web controls the Designer should look similar to the following:</span></span>


<span data-ttu-id="2a41b-240">[![添加更新和取消按钮 EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image26.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="2a41b-240">[![Add Update and Cancel Buttons to the EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image26.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image25.png)</span></span>

<span data-ttu-id="2a41b-241">**图 11**： 添加更新和取消按钮添加到`EditItemTemplate`([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="2a41b-241">**Figure 11**: Add Update and Cancel Buttons to the `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image27.png))</span></span>


<span data-ttu-id="2a41b-242">与`EditItemTemplate`完成 DataList s 声明性标记应类似于以下：</span><span class="sxs-lookup"><span data-stu-id="2a41b-242">With the `EditItemTemplate` complete your DataList s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample3.aspx)]

## <a name="step-5-adding-the-plumbing-to-enter-edit-mode"></a><span data-ttu-id="2a41b-243">步骤 5： 添加联结进入编辑模式</span><span class="sxs-lookup"><span data-stu-id="2a41b-243">Step 5: Adding the Plumbing to Enter Edit Mode</span></span>

<span data-ttu-id="2a41b-244">此时我们 DataList 具有编辑界面通过定义其`EditItemTemplate`; 但是，此处 s 当前无法访问我们的页面的用户指示他想要编辑产品的信息。</span><span class="sxs-lookup"><span data-stu-id="2a41b-244">At this point our DataList has an editing interface defined via its `EditItemTemplate`; however, there s currently no way for a user visiting our page to indicate that he wants to edit a product s information.</span></span> <span data-ttu-id="2a41b-245">我们需要将一个编辑按钮添加到每个产品，单击时，呈现该 DataList 项处于编辑模式。</span><span class="sxs-lookup"><span data-stu-id="2a41b-245">We need to add an Edit button to each product that, when clicked, renders that DataList item in edit mode.</span></span> <span data-ttu-id="2a41b-246">首先，通过添加到一个编辑按钮`ItemTemplate`，通过设计器或以声明方式。</span><span class="sxs-lookup"><span data-stu-id="2a41b-246">Start by adding an Edit button to the `ItemTemplate`, either through the Designer or declaratively.</span></span> <span data-ttu-id="2a41b-247">请务必设置编辑按钮的`CommandName`编辑的属性。</span><span class="sxs-lookup"><span data-stu-id="2a41b-247">Be certain to set the Edit button s `CommandName` property to Edit .</span></span>

<span data-ttu-id="2a41b-248">已添加此编辑按钮后，需要一段时间来查看通过浏览器的页。</span><span class="sxs-lookup"><span data-stu-id="2a41b-248">After you have added this Edit button, take a moment to view the page through a browser.</span></span> <span data-ttu-id="2a41b-249">添加此元素后，每个产品列表应包含编辑按钮。</span><span class="sxs-lookup"><span data-stu-id="2a41b-249">With this addition, each product listing should include an Edit button.</span></span>


<span data-ttu-id="2a41b-250">[![添加更新和取消按钮 EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image29.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="2a41b-250">[![Add Update and Cancel Buttons to the EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image29.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image28.png)</span></span>

<span data-ttu-id="2a41b-251">**图 12**： 添加更新和取消按钮添加到`EditItemTemplate`([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="2a41b-251">**Figure 12**: Add Update and Cancel Buttons to the `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image30.png))</span></span>


<span data-ttu-id="2a41b-252">单击按钮会导致回发，但不*不*使产品列表置于编辑模式。</span><span class="sxs-lookup"><span data-stu-id="2a41b-252">Clicking the button causes a postback, but does *not* bring the product listing into edit mode.</span></span> <span data-ttu-id="2a41b-253">若要使产品可编辑，我们需要：</span><span class="sxs-lookup"><span data-stu-id="2a41b-253">To make the product editable, we need to:</span></span>

1. <span data-ttu-id="2a41b-254">设置 DataList s [ `EditItemIndex`属性](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)的索引`DataListItem`只需单击其编辑按钮。</span><span class="sxs-lookup"><span data-stu-id="2a41b-254">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of the `DataListItem` whose Edit button was just clicked.</span></span>
2. <span data-ttu-id="2a41b-255">重新绑定数据到 DataList。</span><span class="sxs-lookup"><span data-stu-id="2a41b-255">Rebind the data to the DataList.</span></span> <span data-ttu-id="2a41b-256">DataList 时都会重新生成时`DataListItem`其`ItemIndex`对应 DataList s`EditItemIndex`将呈现使用其`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-256">When the DataList is re-rendered, the `DataListItem` whose `ItemIndex` corresponds with the DataList s `EditItemIndex` will render using its `EditItemTemplate`.</span></span>

<span data-ttu-id="2a41b-257">由于 DataList s`EditCommand`单击编辑按钮时激发事件，创建`EditCommand`事件处理程序替换为以下代码：</span><span class="sxs-lookup"><span data-stu-id="2a41b-257">Since the DataList s `EditCommand` event is fired when the Edit button is clicked, create an `EditCommand` event handler with the following code:</span></span>


[!code-vb[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample4.vb)]

<span data-ttu-id="2a41b-258">`EditCommand`事件处理程序传递的类型对象中`DataListCommandEventArgs`作为其第二个输入参数，其中包括对引用`DataListItem`其编辑按钮被单击 (`e.Item`)。</span><span class="sxs-lookup"><span data-stu-id="2a41b-258">The `EditCommand` event handler is passed in an object of type `DataListCommandEventArgs` as its second input parameter, which includes a reference to the `DataListItem` whose Edit button was clicked (`e.Item`).</span></span> <span data-ttu-id="2a41b-259">事件处理程序首先设置 DataList s`EditItemIndex`到`ItemIndex`的可编辑`DataListItem`然后将数据转换为 DataList 重新绑定通过调用 DataList 的`DataBind()`方法。</span><span class="sxs-lookup"><span data-stu-id="2a41b-259">The event handler first sets the DataList s `EditItemIndex` to the `ItemIndex` of the editable `DataListItem` and then rebinds the data to the DataList by calling the DataList s `DataBind()` method.</span></span>

<span data-ttu-id="2a41b-260">在添加此事件处理程序之后, 重新访问浏览器中的页。</span><span class="sxs-lookup"><span data-stu-id="2a41b-260">After adding this event handler, revisit the page in a browser.</span></span> <span data-ttu-id="2a41b-261">现在单击编辑按钮使单击的产品可编辑 （请参阅图 13）。</span><span class="sxs-lookup"><span data-stu-id="2a41b-261">Clicking the Edit button now makes the clicked product editable (see Figure 13).</span></span>


<span data-ttu-id="2a41b-262">[![单击编辑按钮使可编辑产品](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image32.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="2a41b-262">[![Clicking the Edit Button Makes the Product Editable](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image32.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image31.png)</span></span>

<span data-ttu-id="2a41b-263">**图 13**： 单击编辑按钮使产品可编辑 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="2a41b-263">**Figure 13**: Clicking the Edit Button Makes the Product Editable ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image33.png))</span></span>


## <a name="step-6-saving-the-user-s-changes"></a><span data-ttu-id="2a41b-264">步骤 6： 保存用户的更改</span><span class="sxs-lookup"><span data-stu-id="2a41b-264">Step 6: Saving the User s Changes</span></span>

<span data-ttu-id="2a41b-265">单击编辑的产品 s 更新或取消按钮此时; 未执行任何操作若要添加此功能，我们需要创建的事件处理程序 DataList s`UpdateCommand`和`CancelCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="2a41b-265">Clicking the edited product s Update or Cancel buttons does nothing at this point; to add this functionality we need to create event handlers for the DataList s `UpdateCommand` and `CancelCommand` events.</span></span> <span data-ttu-id="2a41b-266">首先创建`CancelCommand`单击编辑的产品 s 取消按钮，且它担负使 DataList 恢复为其预编辑状态时将执行的事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="2a41b-266">Start by creating the `CancelCommand` event handler, which will execute when the edited product s Cancel button is clicked and it tasked with returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="2a41b-267">若要让 DataList 呈现其所有项中的只读模式，我们需要：</span><span class="sxs-lookup"><span data-stu-id="2a41b-267">To have the DataList render all of its items in the read-only mode, we need to:</span></span>

1. <span data-ttu-id="2a41b-268">设置 DataList s [ `EditItemIndex`属性](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)的不存在的索引`DataListItem`索引。</span><span class="sxs-lookup"><span data-stu-id="2a41b-268">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of a non-existent `DataListItem` index.</span></span> <span data-ttu-id="2a41b-269">`-1`由于是安全的选择，`DataListItem`索引开始`0`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-269">`-1` is a safe choice, since the `DataListItem` indexes start at `0`.</span></span>
2. <span data-ttu-id="2a41b-270">重新绑定数据到 DataList。</span><span class="sxs-lookup"><span data-stu-id="2a41b-270">Rebind the data to the DataList.</span></span> <span data-ttu-id="2a41b-271">由于否`DataListItem` `ItemIndex` es 对应于 DataList 的`EditItemIndex`，整个 DataList 将呈现在只读模式下。</span><span class="sxs-lookup"><span data-stu-id="2a41b-271">Since no `DataListItem` `ItemIndex` es correspond to the DataList s `EditItemIndex`, the entire DataList will be rendered in a read-only mode.</span></span>

<span data-ttu-id="2a41b-272">可以使用下面的事件处理程序代码完成这些步骤：</span><span class="sxs-lookup"><span data-stu-id="2a41b-272">These steps can be accomplished with the following event handler code:</span></span>


[!code-vb[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample5.vb)]

<span data-ttu-id="2a41b-273">添加此元素后，单击取消按钮返回 DataList 为其预编辑状态。</span><span class="sxs-lookup"><span data-stu-id="2a41b-273">With this addition, clicking the Cancel button returns the DataList to its pre-editing state.</span></span>

<span data-ttu-id="2a41b-274">我们需要完成最后一个事件处理程序是`UpdateCommand`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="2a41b-274">The last event handler we need to complete is the `UpdateCommand` event handler.</span></span> <span data-ttu-id="2a41b-275">此事件处理程序需要：</span><span class="sxs-lookup"><span data-stu-id="2a41b-275">This event handler needs to:</span></span>

1. <span data-ttu-id="2a41b-276">以编程方式访问的用户输入的产品名称和价格，以及编辑的产品的`ProductID`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-276">Programmatically access the user-entered product name and price as well as the edited product s `ProductID`.</span></span>
2. <span data-ttu-id="2a41b-277">启动更新过程，通过调用适当`UpdateProduct`重载中`ProductsBLL`类。</span><span class="sxs-lookup"><span data-stu-id="2a41b-277">Initiate the update process by calling the appropriate `UpdateProduct` overload in the `ProductsBLL` class.</span></span>
3. <span data-ttu-id="2a41b-278">设置 DataList s [ `EditItemIndex`属性](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)的不存在的索引`DataListItem`索引。</span><span class="sxs-lookup"><span data-stu-id="2a41b-278">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of a non-existent `DataListItem` index.</span></span> <span data-ttu-id="2a41b-279">`-1`由于是安全的选择，`DataListItem`索引开始`0`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-279">`-1` is a safe choice, since the `DataListItem` indexes start at `0`.</span></span>
4. <span data-ttu-id="2a41b-280">重新绑定数据到 DataList。</span><span class="sxs-lookup"><span data-stu-id="2a41b-280">Rebind the data to the DataList.</span></span> <span data-ttu-id="2a41b-281">由于否`DataListItem` `ItemIndex` es 对应于 DataList 的`EditItemIndex`，整个 DataList 将呈现在只读模式下。</span><span class="sxs-lookup"><span data-stu-id="2a41b-281">Since no `DataListItem` `ItemIndex` es correspond to the DataList s `EditItemIndex`, the entire DataList will be rendered in a read-only mode.</span></span>

<span data-ttu-id="2a41b-282">步骤 1 和 2 负责保存 s 更改; 的用户步骤 3 和 4 DataList 后返回到其预编辑状态更改已保存，并且在中执行的步骤相同`CancelCommand`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="2a41b-282">Steps 1 and 2 are responsible for saving the user s changes; steps 3 and 4 return the DataList to its pre-editing state after the changes have been saved and are identical to the steps performed in the `CancelCommand` event handler.</span></span>

<span data-ttu-id="2a41b-283">若要获取的更新的产品名称和价格，我们需要使用`FindControl`为以编程方式引用文本框中 Web 控件中的方法`EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-283">To get the updated product name and price, we need to use the `FindControl` method to programmatically reference the TextBox Web controls within the `EditItemTemplate`.</span></span> <span data-ttu-id="2a41b-284">我们还需要获取编辑的产品的`ProductID`值。</span><span class="sxs-lookup"><span data-stu-id="2a41b-284">We also need to get the edited product s `ProductID` value.</span></span> <span data-ttu-id="2a41b-285">Visual Studio 时我们最初绑定到 DataList ObjectDataSource，分配 DataList s`DataKeyField`到的主键值从数据源的属性 (`ProductID`)。</span><span class="sxs-lookup"><span data-stu-id="2a41b-285">When we initially bound the ObjectDataSource to the DataList, Visual Studio assigned the DataList s `DataKeyField` property to the primary key value from the data source (`ProductID`).</span></span> <span data-ttu-id="2a41b-286">此值可以然后从 DataList s 检索`DataKeys`集合。</span><span class="sxs-lookup"><span data-stu-id="2a41b-286">This value can then be retrieved from the DataList s `DataKeys` collection.</span></span> <span data-ttu-id="2a41b-287">花一些时间，请确保`DataKeyField`属性确实设置为`ProductID`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-287">Take a moment to ensure that the `DataKeyField` property is indeed set to `ProductID`.</span></span>

<span data-ttu-id="2a41b-288">下面的代码实现的四个步骤：</span><span class="sxs-lookup"><span data-stu-id="2a41b-288">The following code implements the four steps:</span></span>


[!code-vb[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample6.vb)]

<span data-ttu-id="2a41b-289">通过编辑产品 s 中读取的事件处理程序启动`ProductID`从`DataKeys`集合。</span><span class="sxs-lookup"><span data-stu-id="2a41b-289">The event handler starts by reading in the edited product s `ProductID` from the `DataKeys` collection.</span></span> <span data-ttu-id="2a41b-290">下一步中的两个文本框`EditItemTemplate`引用及其`Text`属性存储在本地变量，`productNameValue`和`unitPriceValue`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-290">Next, the two TextBoxes in the `EditItemTemplate` are referenced and their `Text` properties stored in local variables, `productNameValue` and `unitPriceValue`.</span></span> <span data-ttu-id="2a41b-291">我们使用`Decimal.Parse()`方法来读取值`UnitPrice`文本框中，因此，如果输入的值具有货币符号，它可仍将正确转换为`Decimal`值。</span><span class="sxs-lookup"><span data-stu-id="2a41b-291">We use the `Decimal.Parse()` method to read the value from the `UnitPrice` TextBox so that if the value entered has a currency symbol, it can still be correctly converted into a `Decimal` value.</span></span>

> [!NOTE]
> <span data-ttu-id="2a41b-292">从值`ProductName`和`UnitPrice`文本框中仅分配给的 productNameValue 和 unitPriceValue 变量，如果文本框中文本属性具有指定的值。</span><span class="sxs-lookup"><span data-stu-id="2a41b-292">The values from the `ProductName` and `UnitPrice` TextBoxes are only assigned to the productNameValue and unitPriceValue variables if the TextBoxes Text properties have a value specified.</span></span> <span data-ttu-id="2a41b-293">否则为值为`Nothing`用于变量，它具有与数据库中更新的数据的效果`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="2a41b-293">Otherwise, a value of `Nothing` is used for the variables, which has the effect of updating the data with a database `NULL` value.</span></span> <span data-ttu-id="2a41b-294">即我们的代码将转换为空字符串转换为数据库`NULL`值，这是 GridView、 说明，和 FormView 控件中的编辑界面的默认行为。</span><span class="sxs-lookup"><span data-stu-id="2a41b-294">That is, our code treats converts empty strings to database `NULL` values, which is the default behavior of the editing interface in the GridView, DetailsView, and FormView controls.</span></span>


<span data-ttu-id="2a41b-295">在读取值之后,`ProductsBLL`类 s`UpdateProduct`调用方法、 传入产品的名称，价格和`ProductID`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-295">After reading the values, the `ProductsBLL` class s `UpdateProduct` method is called, passing in the product s name, price, and `ProductID`.</span></span> <span data-ttu-id="2a41b-296">事件处理程序完成通过为预先编辑状态，使用完全相同的逻辑中返回 DataList`CancelCommand`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="2a41b-296">The event handler completes by returning the DataList to its pre-editing state using the exact same logic as in the `CancelCommand` event handler.</span></span>

<span data-ttu-id="2a41b-297">与`EditCommand`， `CancelCommand`，和`UpdateCommand`事件处理程序完成，访问者可以编辑名称和产品价格。</span><span class="sxs-lookup"><span data-stu-id="2a41b-297">With the `EditCommand`, `CancelCommand`, and `UpdateCommand` event handlers complete, a visitor can edit the name and price of a product.</span></span> <span data-ttu-id="2a41b-298">图 14-16 在操作中展示此编辑工作流。</span><span class="sxs-lookup"><span data-stu-id="2a41b-298">Figures 14-16 show this editing workflow in action.</span></span>


<span data-ttu-id="2a41b-299">[![第一个中访问的页面，所有产品时处于只读模式](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image35.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="2a41b-299">[![When First Visiting the Page, All Products are in Read-Only Mode](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image35.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image34.png)</span></span>

<span data-ttu-id="2a41b-300">**图 14**： 时第一次访问该页面，所有产品都处于只读模式 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="2a41b-300">**Figure 14**: When First Visiting the Page, All Products are in Read-Only Mode ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image36.png))</span></span>


<span data-ttu-id="2a41b-301">[![若要更新的产品名称的价格，请单击编辑按钮](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image38.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="2a41b-301">[![To Update a Product s Name or Price, Click the Edit Button](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image38.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image37.png)</span></span>

<span data-ttu-id="2a41b-302">**图 15**： 若要更新的产品名称或价格，单击编辑按钮 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="2a41b-302">**Figure 15**: To Update a Product s Name or Price, Click the Edit Button ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image39.png))</span></span>


<span data-ttu-id="2a41b-303">[![更改值之后，请单击更新返回到只读模式](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image41.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="2a41b-303">[![After Changing the Value, Click Update to Return to the Read-Only Mode](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image41.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image40.png)</span></span>

<span data-ttu-id="2a41b-304">**图 16**： 后更改的值，单击更新返回到只读模式 ([单击以查看实际尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="2a41b-304">**Figure 16**: After Changing the Value, Click Update to Return to the Read-Only Mode ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/_static/image42.png))</span></span>


## <a name="step-7-adding-delete-capabilities"></a><span data-ttu-id="2a41b-305">步骤 7： 添加删除功能</span><span class="sxs-lookup"><span data-stu-id="2a41b-305">Step 7: Adding Delete Capabilities</span></span>

<span data-ttu-id="2a41b-306">将删除功能添加到 DataList 的步骤是类似于添加编辑功能。</span><span class="sxs-lookup"><span data-stu-id="2a41b-306">The steps for adding delete capabilities to a DataList are similar to those for adding editing capabilities.</span></span> <span data-ttu-id="2a41b-307">简单地说，我们需要添加到删除按钮`ItemTemplate`，单击时：</span><span class="sxs-lookup"><span data-stu-id="2a41b-307">In short, we need to add a Delete button to the `ItemTemplate` that, when clicked:</span></span>

1. <span data-ttu-id="2a41b-308">相应的产品 s 中读取`ProductID`通过`DataKeys`集合。</span><span class="sxs-lookup"><span data-stu-id="2a41b-308">Reads in the corresponding product s `ProductID` via the `DataKeys` collection.</span></span>
2. <span data-ttu-id="2a41b-309">通过调用执行删除`ProductsBLL`类的`DeleteProduct`方法。</span><span class="sxs-lookup"><span data-stu-id="2a41b-309">Performs the delete by calling the `ProductsBLL` class s `DeleteProduct` method.</span></span>
3. <span data-ttu-id="2a41b-310">重新绑定次数 DataList 到的数据。</span><span class="sxs-lookup"><span data-stu-id="2a41b-310">Rebinds the data to the DataList.</span></span>

<span data-ttu-id="2a41b-311">让我们来通过添加到删除按钮来启动`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-311">Let s start by adding a Delete button to the `ItemTemplate`.</span></span>

<span data-ttu-id="2a41b-312">单击按钮时其`CommandName`为编辑，更新或取消引发 DataList s`ItemCommand`以及其他事件的事件 (例如，当使用编辑`EditCommand`事件也会产生)。</span><span class="sxs-lookup"><span data-stu-id="2a41b-312">When clicked, a Button whose `CommandName` is Edit, Update, or Cancel raises the DataList s `ItemCommand` event along with an additional event (for example, when using Edit the `EditCommand` event is raised as well).</span></span> <span data-ttu-id="2a41b-313">同样，任何按钮、 LinkButton 或 DataList 中的 ImageButton 其`CommandName`属性设置为删除原因`DeleteCommand`事件激发 (连同`ItemCommand`)。</span><span class="sxs-lookup"><span data-stu-id="2a41b-313">Similarly, any Button, LinkButton, or ImageButton in the DataList whose `CommandName` property is set to Delete causes the `DeleteCommand` event to fire (along with `ItemCommand`).</span></span>

<span data-ttu-id="2a41b-314">添加中的编辑按钮旁边的删除按钮`ItemTemplate`，设置其`CommandName`删除的属性。</span><span class="sxs-lookup"><span data-stu-id="2a41b-314">Add a Delete button next to the Edit button in the `ItemTemplate`, setting its `CommandName` property to Delete.</span></span> <span data-ttu-id="2a41b-315">在添加后，此按钮会控制你 DataList 的`ItemTemplate`声明性语法，应如下所示：</span><span class="sxs-lookup"><span data-stu-id="2a41b-315">After adding this Button control your DataList s `ItemTemplate` declarative syntax should look like:</span></span>


[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample7.aspx)]

<span data-ttu-id="2a41b-316">接下来，为 DataList s 创建事件处理程序`DeleteCommand`事件，使用下面的代码：</span><span class="sxs-lookup"><span data-stu-id="2a41b-316">Next, create an event handler for the DataList s `DeleteCommand` event, using the following code:</span></span>


[!code-vb[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-vb/samples/sample8.vb)]

<span data-ttu-id="2a41b-317">单击删除按钮会导致回发并激发 DataList 的`DeleteCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="2a41b-317">Clicking the Delete button causes a postback and fires the DataList s `DeleteCommand` event.</span></span> <span data-ttu-id="2a41b-318">事件处理程序中，单击产品 s`ProductID`值访问从`DataKeys`集合。</span><span class="sxs-lookup"><span data-stu-id="2a41b-318">In the event handler, the clicked product s `ProductID` value is accessed from the `DataKeys` collection.</span></span> <span data-ttu-id="2a41b-319">接下来，通过调用删除产品`ProductsBLL`类的`DeleteProduct`方法。</span><span class="sxs-lookup"><span data-stu-id="2a41b-319">Next, the product is deleted by calling the `ProductsBLL` class s `DeleteProduct` method.</span></span>

<span data-ttu-id="2a41b-320">删除该产品后它 s 重要我们重新绑定数据到 DataList (`DataList1.DataBind()`)，否则 DataList 将继续显示的产品，只需删除。</span><span class="sxs-lookup"><span data-stu-id="2a41b-320">After deleting the product, it s important that we rebind the data to the DataList (`DataList1.DataBind()`), otherwise the DataList will continue to show the product that was just deleted.</span></span>

## <a name="summary"></a><span data-ttu-id="2a41b-321">摘要</span><span class="sxs-lookup"><span data-stu-id="2a41b-321">Summary</span></span>

<span data-ttu-id="2a41b-322">DataList 缺少点，并单击编辑和删除享受的 GridView 的支持，而进行少量的代码的短它可以得到增强，包括这些功能。</span><span class="sxs-lookup"><span data-stu-id="2a41b-322">While the DataList lacks the point and click editing and deleting support enjoyed by the GridView, with a short bit of code it can be enhanced to include these features.</span></span> <span data-ttu-id="2a41b-323">在本教程中我们已了解如何创建的产品，无法删除，无法编辑其名称和价格的两列列表。</span><span class="sxs-lookup"><span data-stu-id="2a41b-323">In this tutorial we saw how to create a two-column listing of products that could be deleted and whose name and price could be edited.</span></span> <span data-ttu-id="2a41b-324">添加编辑和删除支持是一种包括在适当的 Web 控件`ItemTemplate`和`EditItemTemplate`、 创建相应的事件处理程序、 读取用户输入和主键值，和业务进行交互逻辑层。</span><span class="sxs-lookup"><span data-stu-id="2a41b-324">Adding editing and deleting support is a matter of including the appropriate Web controls in the `ItemTemplate` and `EditItemTemplate`, creating the corresponding event handlers, reading the user-entered and primary key values, and interfacing with the Business Logic Layer.</span></span>

<span data-ttu-id="2a41b-325">虽然我们已添加基本编辑和删除 DataList 的功能，但它缺少更高级的功能。</span><span class="sxs-lookup"><span data-stu-id="2a41b-325">While we have added basic editing and deleting capabilities to the DataList, it lacks more advanced features.</span></span> <span data-ttu-id="2a41b-326">例如，没有任何输入的字段验证-如果用户输入指价格为太占用大量资源，将引发异常的`Decimal.Parse`时尝试转换太昂贵到`Decimal`。</span><span class="sxs-lookup"><span data-stu-id="2a41b-326">For example, there is no input field validation - if a user enters a price of Too expensive, an exception will be thrown by `Decimal.Parse` when attempting to convert Too expensive into a `Decimal`.</span></span> <span data-ttu-id="2a41b-327">同样，如果更新的数据在业务逻辑或数据访问层中的问题用户将看到与标准错误屏幕。</span><span class="sxs-lookup"><span data-stu-id="2a41b-327">Similarly, if there is a problem in updating the data at the Business Logic or Data Access Layers the user will be presented with the standard error screen.</span></span> <span data-ttu-id="2a41b-328">而无需任何种类的删除按钮确认消息，是所有太可能意外删除产品。</span><span class="sxs-lookup"><span data-stu-id="2a41b-328">Without any sort of confirmation on the Delete button, accidentally deleting a product is all too likely.</span></span>

<span data-ttu-id="2a41b-329">在将来教程，我们将了解如何改善用户的编辑体验。</span><span class="sxs-lookup"><span data-stu-id="2a41b-329">In future tutorials we'll see how to improve the editing user experience.</span></span>

<span data-ttu-id="2a41b-330">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="2a41b-330">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="2a41b-331">关于作者</span><span class="sxs-lookup"><span data-stu-id="2a41b-331">About the Author</span></span>

<span data-ttu-id="2a41b-332">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七个 ASP/ASP.NET 书籍和的创始人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年使用与 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="2a41b-332">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="2a41b-333">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="2a41b-333">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="2a41b-334">最新书籍是[ *Sam 教授自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="2a41b-334">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="2a41b-335">他可以达到在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或通过他的博客，其中可以找到在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="2a41b-335">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="2a41b-336">特别感谢</span><span class="sxs-lookup"><span data-stu-id="2a41b-336">Special Thanks To</span></span>

<span data-ttu-id="2a41b-337">本教程系列已由许多有用的审阅者评审。</span><span class="sxs-lookup"><span data-stu-id="2a41b-337">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="2a41b-338">本教程中的前导审阅者已 Zack Jones、 Ken Pespisa 和徐 Schmidt。</span><span class="sxs-lookup"><span data-stu-id="2a41b-338">Lead reviewers for this tutorial were Zack Jones, Ken Pespisa, and Randy Schmidt.</span></span> <span data-ttu-id="2a41b-339">对感兴趣查看我即将到来的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="2a41b-339">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="2a41b-340">如果是这样，删除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="2a41b-340">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="2a41b-341">[上一页](customizing-the-datalist-s-editing-interface-cs.md)
[下一页](performing-batch-updates-vb.md)</span><span class="sxs-lookup"><span data-stu-id="2a41b-341">[Previous](customizing-the-datalist-s-editing-interface-cs.md)
[Next](performing-batch-updates-vb.md)</span></span>
