---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-6
title: "如何开始使用实体框架 4.0 数据库和 ASP.NET 4 Web 窗体-第 6 部分 |Microsoft 文档"
author: tdykstra
description: "Contoso 大学示例 web 应用程序演示如何创建 ASP.NET Web 窗体应用程序使用实体框架。 该示例应用程序..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 12/03/2010
ms.topic: article
ms.assetid: 994a5496-c648-4830-b03c-55bb43f325d2
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-6
msc.type: authoredcontent
ms.openlocfilehash: 164c2002a119420555d2c7065c5a79a5f433a725
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-6"></a><span data-ttu-id="d73d9-104">如何开始使用实体框架 4.0 数据库和 ASP.NET 4 Web 窗体-第 6 部分</span><span class="sxs-lookup"><span data-stu-id="d73d9-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 6</span></span>
====================
<span data-ttu-id="d73d9-105">通过[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="d73d9-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="d73d9-106">Contoso 大学示例 web 应用程序演示如何创建使用 Entity Framework 4.0 和 Visual Studio 2010 的 ASP.NET Web 窗体应用程序。</span><span class="sxs-lookup"><span data-stu-id="d73d9-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="d73d9-107">有关教程系列的信息，请参阅[序列中的第一个教程](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="d73d9-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>


## <a name="implementing-table-per-hierarchy-inheritance"></a><span data-ttu-id="d73d9-108">实现“每个层次结构一个表”继承</span><span class="sxs-lookup"><span data-stu-id="d73d9-108">Implementing Table-per-Hierarchy Inheritance</span></span>

<span data-ttu-id="d73d9-109">在以前的教程，你使用相关的数据处理，通过添加和删除关系并添加到现有实体的关系的新实体。</span><span class="sxs-lookup"><span data-stu-id="d73d9-109">In the previous tutorial you worked with related data by adding and deleting relationships and by adding a new entity that had a relationship to an existing entity.</span></span> <span data-ttu-id="d73d9-110">本教程将演示如何在数据模型中实现继承。</span><span class="sxs-lookup"><span data-stu-id="d73d9-110">This tutorial will show you how to implement inheritance in the data model.</span></span>

<span data-ttu-id="d73d9-111">在面向对象编程中，你可以使用继承以使其更轻松地使用相关的类。</span><span class="sxs-lookup"><span data-stu-id="d73d9-111">In object-oriented programming, you can use inheritance to make it easier to work with related classes.</span></span> <span data-ttu-id="d73d9-112">例如，你可以创建`Instructor`和`Student`派生自的类`Person`基类。</span><span class="sxs-lookup"><span data-stu-id="d73d9-112">For example, you could create `Instructor` and `Student` classes that derive from a `Person` base class.</span></span> <span data-ttu-id="d73d9-113">你可以在实体框架中创建相同类型的实体之间的继承结构。</span><span class="sxs-lookup"><span data-stu-id="d73d9-113">You can create the same kinds of inheritance structures among entities in the Entity Framework.</span></span>

<span data-ttu-id="d73d9-114">在本教程的此部分中，不会创建任何新的 web 页。</span><span class="sxs-lookup"><span data-stu-id="d73d9-114">In this part of the tutorial, you won't create any new web pages.</span></span> <span data-ttu-id="d73d9-115">相反，你将添加到数据模型中派生的实体和修改现有的页面，以使用新的实体。</span><span class="sxs-lookup"><span data-stu-id="d73d9-115">Instead, you'll add derived entities to the data model and modify existing pages to use the new entities.</span></span>

## <a name="table-per-hierarchy-versus-table-per-type-inheritance"></a><span data-ttu-id="d73d9-116">每个-层次结构一个表与每种类型一个表继承</span><span class="sxs-lookup"><span data-stu-id="d73d9-116">Table-per-Hierarchy versus Table-per-Type Inheritance</span></span>

<span data-ttu-id="d73d9-117">在一个表或多个表中，数据库可以存储有关相关的对象的信息。</span><span class="sxs-lookup"><span data-stu-id="d73d9-117">A database can store information about related objects in one table or in multiple tables.</span></span> <span data-ttu-id="d73d9-118">例如，在`School`数据库，`Person`表包含有关学生和教师单个表中的信息。</span><span class="sxs-lookup"><span data-stu-id="d73d9-118">For example, in the `School` database, the `Person` table includes information about both students and instructors in a single table.</span></span> <span data-ttu-id="d73d9-119">某些列仅适用于教师 (`HireDate`)，某些仅向学生 (`EnrollmentDate`)，而另一些同时向 (`LastName`， `FirstName`)。</span><span class="sxs-lookup"><span data-stu-id="d73d9-119">Some of the columns apply only to instructors (`HireDate`), some only to students (`EnrollmentDate`), and some to both (`LastName`, `FirstName`).</span></span>

<span data-ttu-id="d73d9-120">[![image11](the-entity-framework-and-aspnet-getting-started-part-6/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-120">[![image11](the-entity-framework-and-aspnet-getting-started-part-6/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image1.png)</span></span>

<span data-ttu-id="d73d9-121">你可以配置实体框架可以创建`Instructor`和`Student`继承的实体`Person`实体。</span><span class="sxs-lookup"><span data-stu-id="d73d9-121">You can configure the Entity Framework to create `Instructor` and `Student` entities that inherit from the `Person` entity.</span></span> <span data-ttu-id="d73d9-122">从单个数据库表生成的实体继承结构的此模式称为*表每个层次结构*(TPH) 继承。</span><span class="sxs-lookup"><span data-stu-id="d73d9-122">This pattern of generating an entity inheritance structure from a single database table is called *table-per-hierarchy* (TPH) inheritance.</span></span>

<span data-ttu-id="d73d9-123">对于课程，`School`数据库使用不同的模式。</span><span class="sxs-lookup"><span data-stu-id="d73d9-123">For courses, the `School` database uses a different pattern.</span></span> <span data-ttu-id="d73d9-124">联机课程和现场课程存储在单独的表，其中每个具有外键指向`Course`表。</span><span class="sxs-lookup"><span data-stu-id="d73d9-124">Online courses and onsite courses are stored in separate tables, each of which has a foreign key that points to the `Course` table.</span></span> <span data-ttu-id="d73d9-125">仅在存储信息普遍适用于这两种过程类型`Course`表。</span><span class="sxs-lookup"><span data-stu-id="d73d9-125">Information common to both course types is stored only in the `Course` table.</span></span>

<span data-ttu-id="d73d9-126">[![image12](the-entity-framework-and-aspnet-getting-started-part-6/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-126">[![image12](the-entity-framework-and-aspnet-getting-started-part-6/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image3.png)</span></span>

<span data-ttu-id="d73d9-127">你可以配置实体框架数据模型，以便`OnlineCourse`和`OnsiteCourse`实体继承自`Course`实体。</span><span class="sxs-lookup"><span data-stu-id="d73d9-127">You can configure the Entity Framework data model so that `OnlineCourse` and `OnsiteCourse` entities inherit from the `Course` entity.</span></span> <span data-ttu-id="d73d9-128">从具有引用返回到的表中存储数据普遍适用于所有类型，每个单独的表的每个类型的单独表中生成的实体继承结构的此模式称为*每种类型的表*(TPT) 继承。</span><span class="sxs-lookup"><span data-stu-id="d73d9-128">This pattern of generating an entity inheritance structure from separate tables for each type, with each separate table referring back to a table that stores data common to all types, is called *table per type* (TPT) inheritance.</span></span>

<span data-ttu-id="d73d9-129">TPH 继承模式通常因为 TPT 模式可能会导致复杂的联接查询在实体框架中比 TPT 继承模式提供更好的性能。</span><span class="sxs-lookup"><span data-stu-id="d73d9-129">TPH inheritance patterns generally deliver better performance in the Entity Framework than TPT inheritance patterns, because TPT patterns can result in complex join queries.</span></span> <span data-ttu-id="d73d9-130">本演练演示如何实现 TPH 继承。</span><span class="sxs-lookup"><span data-stu-id="d73d9-130">This walkthrough demonstrates how to implement TPH inheritance.</span></span> <span data-ttu-id="d73d9-131">将执行以下步骤来执行该操作：</span><span class="sxs-lookup"><span data-stu-id="d73d9-131">You'll do that by performing the following steps:</span></span>

- <span data-ttu-id="d73d9-132">创建`Instructor`和`Student`实体类型的派生自`Person`。</span><span class="sxs-lookup"><span data-stu-id="d73d9-132">Create `Instructor` and `Student` entity types that derive from `Person`.</span></span>
- <span data-ttu-id="d73d9-133">适用于从派生的实体的移动属性`Person`到派生的实体的实体。</span><span class="sxs-lookup"><span data-stu-id="d73d9-133">Move properties that pertain to the derived entities from the `Person` entity to the derived entities.</span></span>
- <span data-ttu-id="d73d9-134">在派生类型中设置属性的约束。</span><span class="sxs-lookup"><span data-stu-id="d73d9-134">Set constraints on properties in the derived types.</span></span>
- <span data-ttu-id="d73d9-135">请`Person`实体抽象实体。</span><span class="sxs-lookup"><span data-stu-id="d73d9-135">Make the `Person` entity an abstract entity.</span></span>
- <span data-ttu-id="d73d9-136">映射每个派生的实体访问`Person`具有一个条件以指定如何确定表是否`Person`行派生类型的表示。</span><span class="sxs-lookup"><span data-stu-id="d73d9-136">Map each derived entity to the `Person` table with a condition that specifies how to determine whether a `Person` row represents that derived type.</span></span>

## <a name="adding-instructor-and-student-entities"></a><span data-ttu-id="d73d9-137">添加教师和学生实体</span><span class="sxs-lookup"><span data-stu-id="d73d9-137">Adding Instructor and Student Entities</span></span>

<span data-ttu-id="d73d9-138">打开*SchoolModel.edmx*文件中，右击设计器中，选择中的未占用的区域**添加**，然后选择**实体***。*</span><span class="sxs-lookup"><span data-stu-id="d73d9-138">Open the *SchoolModel.edmx* file, right-click an unoccupied area in the designer, select **Add**, then select **Entity***.*</span></span>

<span data-ttu-id="d73d9-139">[![image01](the-entity-framework-and-aspnet-getting-started-part-6/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-139">[![image01](the-entity-framework-and-aspnet-getting-started-part-6/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image5.png)</span></span>

<span data-ttu-id="d73d9-140">在**添加实体**对话框中，命名实体`Instructor`并设置其**基类型**选项设为`Person`。</span><span class="sxs-lookup"><span data-stu-id="d73d9-140">In the **Add Entity** dialog box, name the entity `Instructor` and set its **Base type** option to `Person`.</span></span>

<span data-ttu-id="d73d9-141">[![image02](the-entity-framework-and-aspnet-getting-started-part-6/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-141">[![image02](the-entity-framework-and-aspnet-getting-started-part-6/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image7.png)</span></span>

<span data-ttu-id="d73d9-142">单击“确定”。</span><span class="sxs-lookup"><span data-stu-id="d73d9-142">Click **OK**.</span></span> <span data-ttu-id="d73d9-143">设计器创建`Instructor`派生自的实体`Person`实体。</span><span class="sxs-lookup"><span data-stu-id="d73d9-143">The designer creates an `Instructor` entity that derives from the `Person` entity.</span></span> <span data-ttu-id="d73d9-144">新的实体还没有任何属性。</span><span class="sxs-lookup"><span data-stu-id="d73d9-144">The new entity does not yet have any properties.</span></span>

<span data-ttu-id="d73d9-145">[![image03](the-entity-framework-and-aspnet-getting-started-part-6/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-145">[![image03](the-entity-framework-and-aspnet-getting-started-part-6/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image9.png)</span></span>

<span data-ttu-id="d73d9-146">重复此过程来创建`Student`又派生自的实体`Person`。</span><span class="sxs-lookup"><span data-stu-id="d73d9-146">Repeat the procedure to create a `Student` entity that also derives from `Person`.</span></span>

<span data-ttu-id="d73d9-147">只有教师有雇佣日期，因此你需要将该属性从移动`Person`实体到`Instructor`实体。</span><span class="sxs-lookup"><span data-stu-id="d73d9-147">Only instructors have hire dates, so you need to move that property from the `Person` entity to the `Instructor` entity.</span></span> <span data-ttu-id="d73d9-148">在`Person`实体，右键单击`HireDate`属性，然后单击**剪切**。</span><span class="sxs-lookup"><span data-stu-id="d73d9-148">In the `Person` entity, right-click the `HireDate` property and click **Cut**.</span></span> <span data-ttu-id="d73d9-149">然后右键单击**属性**中`Instructor`实体，然后单击**粘贴**。</span><span class="sxs-lookup"><span data-stu-id="d73d9-149">Then right-click **Properties** in the `Instructor` entity and click **Paste**.</span></span>

<span data-ttu-id="d73d9-150">[![image04](the-entity-framework-and-aspnet-getting-started-part-6/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-150">[![image04](the-entity-framework-and-aspnet-getting-started-part-6/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image11.png)</span></span>

<span data-ttu-id="d73d9-151">雇佣日期`Instructor`实体不能为 null。</span><span class="sxs-lookup"><span data-stu-id="d73d9-151">The hire date of an `Instructor` entity cannot be null.</span></span> <span data-ttu-id="d73d9-152">右键单击`HireDate`属性，单击**属性**，然后在**属性**窗口更改`Nullable`到`False`。</span><span class="sxs-lookup"><span data-stu-id="d73d9-152">Right-click the `HireDate` property, click **Properties**, and then in the **Properties** window change `Nullable` to `False`.</span></span>

<span data-ttu-id="d73d9-153">[![image05](the-entity-framework-and-aspnet-getting-started-part-6/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-153">[![image05](the-entity-framework-and-aspnet-getting-started-part-6/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image13.png)</span></span>

<span data-ttu-id="d73d9-154">重复此过程以移动`EnrollmentDate`属性从`Person`实体到`Student`实体。</span><span class="sxs-lookup"><span data-stu-id="d73d9-154">Repeat the procedure to move the `EnrollmentDate` property from the `Person` entity to the `Student` entity.</span></span> <span data-ttu-id="d73d9-155">请确保也设置`Nullable`到`False`为`EnrollmentDate`属性。</span><span class="sxs-lookup"><span data-stu-id="d73d9-155">Make sure that you also set `Nullable` to `False` for the `EnrollmentDate` property.</span></span>

<span data-ttu-id="d73d9-156">现在，`Person`实体包含所共有的属性`Instructor`和`Student`实体 （除了外导航属性，这些属性在不移动的），该实体可以仅用作基实体中的继承结构。</span><span class="sxs-lookup"><span data-stu-id="d73d9-156">Now that a `Person` entity has only the properties that are common to `Instructor` and `Student` entities (aside from navigation properties, which you're not moving), the entity can only be used as a base entity in the inheritance structure.</span></span> <span data-ttu-id="d73d9-157">因此，你需要确保将永远不会视为一个独立的实体。</span><span class="sxs-lookup"><span data-stu-id="d73d9-157">Therefore, you need to ensure that it's never treated as an independent entity.</span></span> <span data-ttu-id="d73d9-158">右键单击`Person`实体中，选择**属性**，然后在**属性**窗口更改的值**抽象**属性**True**。</span><span class="sxs-lookup"><span data-stu-id="d73d9-158">Right-click the `Person` entity, select **Properties**, and then in the **Properties** window change the value of the **Abstract** property to **True**.</span></span>

<span data-ttu-id="d73d9-159">[![image06](the-entity-framework-and-aspnet-getting-started-part-6/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-159">[![image06](the-entity-framework-and-aspnet-getting-started-part-6/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image15.png)</span></span>

## <a name="mapping-instructor-and-student-entities-to-the-person-table"></a><span data-ttu-id="d73d9-160">将教师和学生实体映射到 Person 表</span><span class="sxs-lookup"><span data-stu-id="d73d9-160">Mapping Instructor and Student Entities to the Person Table</span></span>

<span data-ttu-id="d73d9-161">现在你需要告诉实体框架如何区分`Instructor`和`Student`数据库中的实体。</span><span class="sxs-lookup"><span data-stu-id="d73d9-161">Now you need to tell the Entity Framework how to differentiate between `Instructor` and `Student` entities in the database.</span></span>

<span data-ttu-id="d73d9-162">右键单击`Instructor`实体，然后选择**表映射**。</span><span class="sxs-lookup"><span data-stu-id="d73d9-162">Right-click the `Instructor` entity and select **Table Mapping**.</span></span> <span data-ttu-id="d73d9-163">在**映射详细信息**窗口中，单击**添加表或视图**和选择**人员**。</span><span class="sxs-lookup"><span data-stu-id="d73d9-163">In the **Mapping Details** window, click **Add a Table or View** and select **Person**.</span></span>

<span data-ttu-id="d73d9-164">[![image07](the-entity-framework-and-aspnet-getting-started-part-6/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-164">[![image07](the-entity-framework-and-aspnet-getting-started-part-6/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image17.png)</span></span>

<span data-ttu-id="d73d9-165">单击**添加条件**，然后选择**HireDate**。</span><span class="sxs-lookup"><span data-stu-id="d73d9-165">Click **Add a Condition**, and then select **HireDate**.</span></span>

<span data-ttu-id="d73d9-166">[![image09](the-entity-framework-and-aspnet-getting-started-part-6/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-166">[![image09](the-entity-framework-and-aspnet-getting-started-part-6/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image19.png)</span></span>

<span data-ttu-id="d73d9-167">更改**运算符**到**是**和**值 / 属性**到**Not Null**。</span><span class="sxs-lookup"><span data-stu-id="d73d9-167">Change **Operator** to **Is** and **Value / Property** to **Not Null**.</span></span>

<span data-ttu-id="d73d9-168">[![image10](the-entity-framework-and-aspnet-getting-started-part-6/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-168">[![image10](the-entity-framework-and-aspnet-getting-started-part-6/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image21.png)</span></span>

<span data-ttu-id="d73d9-169">重复的过程`Students`实体，指定此实体映射到`Person`表时`EnrollmentDate`列不为 null。</span><span class="sxs-lookup"><span data-stu-id="d73d9-169">Repeat the procedure for the `Students` entity, specifying that this entity maps to the `Person` table when the `EnrollmentDate` column is not null.</span></span> <span data-ttu-id="d73d9-170">然后保存并关闭数据模型。</span><span class="sxs-lookup"><span data-stu-id="d73d9-170">Then save and close the data model.</span></span>

<span data-ttu-id="d73d9-171">生成项目以便创建为类的新实体，并使它们在设计器中可用。</span><span class="sxs-lookup"><span data-stu-id="d73d9-171">Build the project in order to create the new entities as classes and make them available in the designer.</span></span>

## <a name="using-the-instructor-and-student-entities"></a><span data-ttu-id="d73d9-172">使用教师和学生实体</span><span class="sxs-lookup"><span data-stu-id="d73d9-172">Using the Instructor and Student Entities</span></span>

<span data-ttu-id="d73d9-173">创建工作学生和教师数据，你将数据绑定到的网页时`Person`实体集，且上筛选`HireDate`或`EnrollmentDate`属性来限制返回的数据为学生或教师。</span><span class="sxs-lookup"><span data-stu-id="d73d9-173">When you created the web pages that work with student and instructor data, you databound them to the `Person` entity set, and you filtered on the `HireDate` or `EnrollmentDate` property to restrict the returned data to students or instructors.</span></span> <span data-ttu-id="d73d9-174">但是，现在当你将绑定到每个数据源控件`Person`实体集，你可以仅指定`Student`或`Instructor`应选择实体类型。</span><span class="sxs-lookup"><span data-stu-id="d73d9-174">However, now when you bind each data source control to the `Person` entity set, you can specify that only `Student` or `Instructor` entity types should be selected.</span></span> <span data-ttu-id="d73d9-175">因为实体框架知道如何区分学生和讲师`Person`实体集，你可以删除`Where`你手动输入要这样做的属性设置。</span><span class="sxs-lookup"><span data-stu-id="d73d9-175">Because the Entity Framework knows how to differentiate students and instructors in the `Person` entity set, you can remove the `Where` property settings you entered manually to do that.</span></span>

<span data-ttu-id="d73d9-176">在 Visual Studio 设计器中，你可以指定实体类型`EntityDataSource`控件应选择中**EntityTypeFilter**下拉列表框`Configure Data Source`向导，如下面的示例中所示。</span><span class="sxs-lookup"><span data-stu-id="d73d9-176">In the Visual Studio Designer, you can specify the entity type that an `EntityDataSource` control should select in the **EntityTypeFilter** drop-down box of the `Configure Data Source` wizard, as shown in the following example.</span></span>

<span data-ttu-id="d73d9-177">[![image13](the-entity-framework-and-aspnet-getting-started-part-6/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-177">[![image13](the-entity-framework-and-aspnet-getting-started-part-6/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image23.png)</span></span>

<span data-ttu-id="d73d9-178">然后在**属性**窗口，可移除`Where`子句不再需要如下面的示例中所示的值。</span><span class="sxs-lookup"><span data-stu-id="d73d9-178">And in the **Properties** window you can remove `Where` clause values that are no longer needed, as shown in the following example.</span></span>

<span data-ttu-id="d73d9-179">[![image14](the-entity-framework-and-aspnet-getting-started-part-6/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-179">[![image14](the-entity-framework-and-aspnet-getting-started-part-6/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image25.png)</span></span>

<span data-ttu-id="d73d9-180">但是，因为你已更改的标记`EntityDataSource`要使用的控件`ContextTypeName`属性，不能运行**配置数据源**向导上`EntityDataSource`你所创建的控件。</span><span class="sxs-lookup"><span data-stu-id="d73d9-180">However, because you've changed the markup for `EntityDataSource` controls to use the `ContextTypeName` attribute, you cannot run the **Configure Data Source** wizard on `EntityDataSource` controls that you've already created.</span></span> <span data-ttu-id="d73d9-181">因此，你将通过更改标记改为使所需的更改。</span><span class="sxs-lookup"><span data-stu-id="d73d9-181">Therefore, you'll make the required changes by changing markup instead.</span></span>

<span data-ttu-id="d73d9-182">打开*Students.aspx*页。</span><span class="sxs-lookup"><span data-stu-id="d73d9-182">Open the *Students.aspx* page.</span></span> <span data-ttu-id="d73d9-183">在`StudentsEntityDataSource`控件中，删除`Where`属性，并添加`EntityTypeFilter="Student"`属性。</span><span class="sxs-lookup"><span data-stu-id="d73d9-183">In the `StudentsEntityDataSource` control, remove the `Where` attribute and add an `EntityTypeFilter="Student"` attribute.</span></span> <span data-ttu-id="d73d9-184">标记现在将类似于下面的示例：</span><span class="sxs-lookup"><span data-stu-id="d73d9-184">The markup will now resemble the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample1.aspx)]

<span data-ttu-id="d73d9-185">设置`EntityTypeFilter`属性可确保`EntityDataSource`控件将自动选择仅指定的实体类型。</span><span class="sxs-lookup"><span data-stu-id="d73d9-185">Setting the `EntityTypeFilter` attribute ensures that the `EntityDataSource` control will select only the specified entity type.</span></span> <span data-ttu-id="d73d9-186">如果你想要同时检索`Student`和`Instructor`实体类型，则不要设置此属性。</span><span class="sxs-lookup"><span data-stu-id="d73d9-186">If you wanted to retrieve both `Student` and `Instructor` entity types, you would not set this attribute.</span></span> <span data-ttu-id="d73d9-187">(你可以检索多个实体类型具有一个选择`EntityDataSource`控制仅当你使用只读数据访问控件。</span><span class="sxs-lookup"><span data-stu-id="d73d9-187">(You have the option of retrieving multiple entity types with one `EntityDataSource` control only if you're using the control for read-only data access.</span></span> <span data-ttu-id="d73d9-188">如果你使用`EntityDataSource`控件插入、 更新或删除实体，并绑定到的实体集可以包含多个类型，如果你仅可以使用一种实体类型和你需要将此属性设置。)</span><span class="sxs-lookup"><span data-stu-id="d73d9-188">If you're using an `EntityDataSource` control to insert, update, or delete entities, and if the entity set it's bound to can contain multiple types, you can only work with one entity type, and you have to set this attribute.)</span></span>

<span data-ttu-id="d73d9-189">重复的过程`SearchEntityDataSource`控制，但删除仅的一部分`Where`选择的属性`Student`而不是完全删除此属性的实体。</span><span class="sxs-lookup"><span data-stu-id="d73d9-189">Repeat the procedure for the `SearchEntityDataSource` control, except remove only the part of the `Where` attribute that selects `Student` entities instead of removing the property altogether.</span></span> <span data-ttu-id="d73d9-190">控件的开始标记现在将类似于下面的示例：</span><span class="sxs-lookup"><span data-stu-id="d73d9-190">The opening tag of the control will now resemble the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample2.aspx)]

<span data-ttu-id="d73d9-191">运行页后，可以验证仍然工作像以前一样。</span><span class="sxs-lookup"><span data-stu-id="d73d9-191">Run the page to verify that it still works as it did before.</span></span>

<span data-ttu-id="d73d9-192">[![image15](the-entity-framework-and-aspnet-getting-started-part-6/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-192">[![image15](the-entity-framework-and-aspnet-getting-started-part-6/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image27.png)</span></span>

<span data-ttu-id="d73d9-193">更新你在早期的教程中，以便他们使用新创建的以下页面`Student`和`Instructor`实体而不是`Person`实体，然后运行它们以验证它们之前一样的正常工作：</span><span class="sxs-lookup"><span data-stu-id="d73d9-193">Update the following pages that you created in earlier tutorials so that they use the new `Student` and `Instructor` entities instead of `Person` entities, then run them to verify that they work as they did before:</span></span>

- <span data-ttu-id="d73d9-194">在*StudentsAdd.aspx*，添加`EntityTypeFilter="Student"`到`StudentsEntityDataSource`控件。</span><span class="sxs-lookup"><span data-stu-id="d73d9-194">In *StudentsAdd.aspx*, add `EntityTypeFilter="Student"` to the `StudentsEntityDataSource` control.</span></span> <span data-ttu-id="d73d9-195">标记现在将类似于下面的示例：</span><span class="sxs-lookup"><span data-stu-id="d73d9-195">The markup will now resemble the following example:</span></span> 

    [!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample3.aspx)]

    <span data-ttu-id="d73d9-196">[![image16](the-entity-framework-and-aspnet-getting-started-part-6/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-196">[![image16](the-entity-framework-and-aspnet-getting-started-part-6/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image29.png)</span></span>
- <span data-ttu-id="d73d9-197">在*About.aspx*，添加`EntityTypeFilter="Student"`到`StudentStatisticsEntityDataSource`控制和删除`Where="it.EnrollmentDate is not null"`。</span><span class="sxs-lookup"><span data-stu-id="d73d9-197">In *About.aspx*, add `EntityTypeFilter="Student"` to the `StudentStatisticsEntityDataSource` control and remove `Where="it.EnrollmentDate is not null"`.</span></span> <span data-ttu-id="d73d9-198">标记现在将类似于下面的示例：</span><span class="sxs-lookup"><span data-stu-id="d73d9-198">The markup will now resemble the following example:</span></span> 

    [!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample4.aspx)]

    <span data-ttu-id="d73d9-199">[![image17](the-entity-framework-and-aspnet-getting-started-part-6/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-199">[![image17](the-entity-framework-and-aspnet-getting-started-part-6/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image31.png)</span></span>
- <span data-ttu-id="d73d9-200">在*Instructors.aspx*和*InstructorsCourses.aspx*，添加`EntityTypeFilter="Instructor"`到`InstructorsEntityDataSource`控制和删除`Where="it.HireDate is not null"`。</span><span class="sxs-lookup"><span data-stu-id="d73d9-200">In *Instructors.aspx* and *InstructorsCourses.aspx*, add `EntityTypeFilter="Instructor"` to the `InstructorsEntityDataSource` control and remove `Where="it.HireDate is not null"`.</span></span> <span data-ttu-id="d73d9-201">中的标记*Instructors.aspx*现在类似于下面的示例：</span><span class="sxs-lookup"><span data-stu-id="d73d9-201">The markup in *Instructors.aspx* now resembles the following example:</span></span> 

    [!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample5.aspx)]

    <span data-ttu-id="d73d9-202">[![image18](the-entity-framework-and-aspnet-getting-started-part-6/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-202">[![image18](the-entity-framework-and-aspnet-getting-started-part-6/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image33.png)</span></span>

    <span data-ttu-id="d73d9-203">中的标记*InstructorsCourses.aspx*现在将类似于下面的示例：</span><span class="sxs-lookup"><span data-stu-id="d73d9-203">The markup in *InstructorsCourses.aspx* will now resemble the following example:</span></span>

    [!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-6/samples/sample6.aspx)]

    <span data-ttu-id="d73d9-204">[![image19](the-entity-framework-and-aspnet-getting-started-part-6/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="d73d9-204">[![image19](the-entity-framework-and-aspnet-getting-started-part-6/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-6/_static/image35.png)</span></span>

<span data-ttu-id="d73d9-205">由于这些更改，你改进了以下几种方式的 Contoso 大学应用程序的可维护性。</span><span class="sxs-lookup"><span data-stu-id="d73d9-205">As a result of these changes, you've improved the Contoso University application's maintainability in several ways.</span></span> <span data-ttu-id="d73d9-206">已移动的 UI 层之外的选择和验证逻辑 (*.aspx*标记) 及做出该数据访问层的必要组成部分。</span><span class="sxs-lookup"><span data-stu-id="d73d9-206">You've moved selection and validation logic out of the UI layer (*.aspx* markup) and made it an integral part of the data access layer.</span></span> <span data-ttu-id="d73d9-207">这可帮助将你的应用程序代码与您可能在将来对数据库架构或数据模型进行的更改隔离。</span><span class="sxs-lookup"><span data-stu-id="d73d9-207">This helps to isolate your application code from changes that you might make in the future to the database schema or the data model.</span></span> <span data-ttu-id="d73d9-208">例如，你可能决定学生可能受雇成为教师的帮助，并因此将获取雇佣日期。</span><span class="sxs-lookup"><span data-stu-id="d73d9-208">For example, you could decide that students might be hired as teachers' aids and therefore would get a hire date.</span></span> <span data-ttu-id="d73d9-209">然后可以添加一个新的属性，来从教师区分学生和更新数据模型。</span><span class="sxs-lookup"><span data-stu-id="d73d9-209">You could then add a new property to differentiate students from instructors and update the data model.</span></span> <span data-ttu-id="d73d9-210">Web 应用程序中的任何代码将不需要更改除非你想要显示学生版雇佣日期。</span><span class="sxs-lookup"><span data-stu-id="d73d9-210">No code in the web application would need to change except where you wanted to show a hire date for students.</span></span> <span data-ttu-id="d73d9-211">添加的另一个好处`Instructor`和`Student`实体，则是你的代码比它称为时可以更轻松地理解`Person`的实际学生对象的或教师。</span><span class="sxs-lookup"><span data-stu-id="d73d9-211">Another benefit of adding `Instructor` and `Student` entities is that your code is more readily understandable than when it referred to `Person` objects that were actually students or instructors.</span></span>

<span data-ttu-id="d73d9-212">现在，你已了解一种方法在实体框架中实施的继承模式。</span><span class="sxs-lookup"><span data-stu-id="d73d9-212">You've now seen one way to implement an inheritance pattern in the Entity Framework.</span></span> <span data-ttu-id="d73d9-213">在以下教程中，你将了解如何使用存储的过程以更好地控制实体框架中如何访问数据库。</span><span class="sxs-lookup"><span data-stu-id="d73d9-213">In the following tutorial, you'll learn how to use stored procedures in order to have more control over how the Entity Framework accesses the database.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="d73d9-214">[上一页](the-entity-framework-and-aspnet-getting-started-part-5.md)
[下一页](the-entity-framework-and-aspnet-getting-started-part-7.md)</span><span class="sxs-lookup"><span data-stu-id="d73d9-214">[Previous](the-entity-framework-and-aspnet-getting-started-part-5.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-7.md)</span></span>
