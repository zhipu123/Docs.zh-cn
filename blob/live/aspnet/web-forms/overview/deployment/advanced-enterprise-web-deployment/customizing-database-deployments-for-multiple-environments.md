---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
title: "自定义数据库部署为多个环境 |Microsoft 文档"
author: jrjlee
description: "本主题介绍如何部署过程的一部分定制到特定目标环境数据库的属性。 注意： 本主题假定 th..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/04/2012
ms.topic: article
ms.assetid: a172979a-1318-4318-a9c6-4f9560d26267
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
msc.type: authoredcontent
ms.openlocfilehash: 449c448d1be237f3f95a437bb2c0415bd8ed0d99
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="customizing-database-deployments-for-multiple-environments"></a><span data-ttu-id="ddd9f-104">多个环境的的自定义数据库部署</span><span class="sxs-lookup"><span data-stu-id="ddd9f-104">Customizing Database Deployments for Multiple Environments</span></span>
====================
<span data-ttu-id="ddd9f-105">通过[Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="ddd9f-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="ddd9f-106">下载 PDF</span><span class="sxs-lookup"><span data-stu-id="ddd9f-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="ddd9f-107">本主题介绍如何部署过程的一部分定制到特定目标环境数据库的属性。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-107">This topic describes how to tailor the properties of a database to specific target environments as part of the deployment process.</span></span>
> 
> > [!NOTE]
> > <span data-ttu-id="ddd9f-108">本主题假定你要部署使用 MSBuild.exe 和 VSDBCMD.exe 的 Visual Studio 2010 数据库项目。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-108">The topic assumes that you're deploying a Visual Studio 2010 database project using MSBuild.exe and VSDBCMD.exe.</span></span> <span data-ttu-id="ddd9f-109">为什么你可能选择这种方法的详细信息，请参阅[企业中的 Web 部署](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md)和[部署数据库项目](../web-deployment-in-the-enterprise/deploying-database-projects.md)。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-109">For more information on why you might choose this approach, see [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md) and [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span>
> 
> 
> <span data-ttu-id="ddd9f-110">在数据库项目部署到多个目标时，通常需要自定义每个目标环境的数据库部署属性。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-110">When you deploy a database project to multiple destinations, you'll often want to customize the database deployment properties for each target environment.</span></span> <span data-ttu-id="ddd9f-111">例如，在测试环境中你将通常重新创建数据库上每个部署，而在过渡环境或生产环境中将是大量更有可能进行增量更新，以保留数据。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-111">For example, in test environments you'd typically recreate the database on every deployment, whereas in staging or production environments you'd be a lot more likely to make incremental updates to preserve your data.</span></span>
> 
> <span data-ttu-id="ddd9f-112">在 Visual Studio 2010 数据库项目中，部署设置包含在一个部署配置 (.sqldeployment) 文件。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-112">In a Visual Studio 2010 database project, deployment settings are contained within a deployment configuration (.sqldeployment) file.</span></span> <span data-ttu-id="ddd9f-113">本主题将演示如何创建特定于环境的部署配置文件，指定你想要使用作为 VSDBCMD 参数。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-113">This topic will show you how to create environment-specific deployment configuration files and specify the one you want to use as a VSDBCMD parameter.</span></span>


<span data-ttu-id="ddd9f-114">本主题窗体的基于名为 Fabrikam，Inc.的虚构公司的企业部署要求的教程系列中的一部分本系列教程使用的示例解决方案 （&） #x 2014;[联系人管理器解决方案](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)& #x 2014; 来表示具有现实级别的复杂性，包括 ASP.NET MVC 3 应用程序，Windows 的 web 应用程序Communication Foundation (WCF) 服务和数据库项目。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-114">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="ddd9f-115">这些教程的核心的部署方法取决于中介绍的拆分项目文件方法[了解项目文件](../web-deployment-in-the-enterprise/understanding-the-project-file.md)，在其中生成过程控制由两个项目文件 （&） #x 2014; 一个包含生成适用于每种目标环境和一个包含特定于环境的生成和部署设置的说明。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-115">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="ddd9f-116">在生成期间，特定于环境的项目文件合并到环境无关的项目文件中以形成一组完整的生成说明。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-116">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="ddd9f-117">任务概述</span><span class="sxs-lookup"><span data-stu-id="ddd9f-117">Task Overview</span></span>

<span data-ttu-id="ddd9f-118">本主题假定：</span><span class="sxs-lookup"><span data-stu-id="ddd9f-118">This topic assumes that:</span></span>

- <span data-ttu-id="ddd9f-119">中所述使用解决方案部署的拆分项目文件方法[了解项目文件](../web-deployment-in-the-enterprise/understanding-the-project-file.md)。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-119">You use the split project file approach to solution deployment, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span>
- <span data-ttu-id="ddd9f-120">中所述从项目文件以部署数据库项目时，调用 VSDBCMD[了解该生成过程](../web-deployment-in-the-enterprise/understanding-the-build-process.md)。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-120">You call VSDBCMD from the project file to deploy your database project, as described in [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="ddd9f-121">若要创建支持改变目标环境之间的数据库部署属性的部署系统，你将需要：</span><span class="sxs-lookup"><span data-stu-id="ddd9f-121">To create a deployment system that supports varying the database deployment properties between target environments, you'll need to:</span></span>

- <span data-ttu-id="ddd9f-122">创建每个目标环境的部署配置 (.sqldeployment) 文件。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-122">Create a deployment configuration (.sqldeployment) file for each target environment.</span></span>
- <span data-ttu-id="ddd9f-123">创建用于部署配置文件指定为命令行开关的 VSDBCMD 命令。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-123">Create a VSDBCMD command that specifies the deployment configuration file as a command-line switch.</span></span>
- <span data-ttu-id="ddd9f-124">参数化 VSDBCMD 命令在 Microsoft Build Engine (MSBuild) 项目文件中，以便适合于目标环境的 VSDBCMD 选项。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-124">Parameterize the VSDBCMD command in a Microsoft Build Engine (MSBuild) project file, so that the VSDBCMD options are appropriate to the target environment.</span></span>

<span data-ttu-id="ddd9f-125">本主题将演示如何执行每个这些过程。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-125">This topic will show you how to perform each of these procedures.</span></span>

## <a name="creating-environment-specific-deployment-configuration-files"></a><span data-ttu-id="ddd9f-126">创建特定于环境的部署配置文件</span><span class="sxs-lookup"><span data-stu-id="ddd9f-126">Creating Environment-Specific Deployment Configuration Files</span></span>

<span data-ttu-id="ddd9f-127">默认情况下，数据库项目包含一个名为的单个部署配置文件*Database.sqldeployment*。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-127">By default, a database project contains a single deployment configuration file named *Database.sqldeployment*.</span></span> <span data-ttu-id="ddd9f-128">如果你在 Visual Studio 2010 中打开此文件，你可以看到向你提供的不同的部署选项：</span><span class="sxs-lookup"><span data-stu-id="ddd9f-128">If you open this file in Visual Studio 2010, you can see the different deployment options that are available to you:</span></span>

- <span data-ttu-id="ddd9f-129">**部署比较排序规则**。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-129">**Deployment comparison collation**.</span></span> <span data-ttu-id="ddd9f-130">这样就可以选择是否要使用你的项目的数据库排序规则 (*源*排序规则) 或你的目标服务器的数据库排序规则 (*目标*排序规则)。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-130">This lets you choose whether to use the database collation of your project (the *source* collation) or the database collation of your destination server (the *target* collation).</span></span> <span data-ttu-id="ddd9f-131">在大多数情况下，你将想要使用源的排序规则，当你将部署到一个开发或测试环境。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-131">In most cases, you'll want to use the source collation when you deploy to a development or test environment.</span></span> <span data-ttu-id="ddd9f-132">当你将部署到过渡或生产环境时，通常将想要保留不变以避免任何互操作性问题的目标排序规则。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-132">When you deploy to a staging or production environment, you'll usually want to leave the target collation unchanged to avoid any interoperability issues.</span></span>
- <span data-ttu-id="ddd9f-133">**部署数据库属性**。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-133">**Deploy database properties**.</span></span> <span data-ttu-id="ddd9f-134">这样就可以选择是否要应用的数据库属性中中, 定义*Database.sqlsettings*文件。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-134">This lets you choose whether to apply the database properties, as defined in the *Database.sqlsettings* file.</span></span> <span data-ttu-id="ddd9f-135">当您首次部署数据库时，你应该部署数据库属性。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-135">When you deploy a database for the first time, you should deploy the database properties.</span></span> <span data-ttu-id="ddd9f-136">如果你在更新现有数据库，属性应已就位，并且需要不应将它们重新部署。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-136">If you're updating an existing database, the properties should already be in place, and you shouldn't need to deploy them again.</span></span>
- <span data-ttu-id="ddd9f-137">**始终重新创建数据库**。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-137">**Always re-create database**.</span></span> <span data-ttu-id="ddd9f-138">这样，你选择是否要重新创建目标数据库，每次部署或您的架构进行增量更改，以使目标数据库的最新。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-138">This lets you choose whether to re-create the target database every time you deploy or make incremental changes to bring the target database up to date with your schema.</span></span> <span data-ttu-id="ddd9f-139">如果重新创建该数据库，你将丢失现有的数据库中的任何数据。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-139">If you re-create the database, you'll lose any data in the existing database.</span></span> <span data-ttu-id="ddd9f-140">在这种情况下，你应通常设置为**false**部署到过渡环境或生产环境。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-140">As such, you should usually set this to **false** for deployments to staging or production environments.</span></span>
- <span data-ttu-id="ddd9f-141">**如果可能发生数据丢失则阻止增量部署**。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-141">**Block incremental deployment if data loss might occur**.</span></span> <span data-ttu-id="ddd9f-142">这允许你选择部署是否应停止是否对数据库架构的更改会导致数据丢失。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-142">This lets you choose whether deployment should stop if a change to the database schema will cause the loss of data.</span></span> <span data-ttu-id="ddd9f-143">你通常将其设置为**true**以部署到生产环境中，以便为你提供机会介入和保护任何重要数据。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-143">You typically set this to **true** for a deployment to a production environment, to give you the opportunity to intervene and protect any important data.</span></span> <span data-ttu-id="ddd9f-144">如果设置了**始终重新创建数据库**到**false**，此设置将产生任何影响。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-144">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="ddd9f-145">**在单用户模式下执行部署**。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-145">**Execute deployment in single-user mode**.</span></span> <span data-ttu-id="ddd9f-146">这通常不开发或测试环境中的问题。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-146">This is not usually an issue in development or test environments.</span></span> <span data-ttu-id="ddd9f-147">但是，你应通常设置为**true**部署到过渡环境或生产环境。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-147">However, you should typically set this to **true** for deployments to staging or production environments.</span></span> <span data-ttu-id="ddd9f-148">这可以防止用户进行部署时，对数据库进行更改。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-148">This prevents users from making changes to the database while the deployment is underway.</span></span>
- <span data-ttu-id="ddd9f-149">**备份数据库之前部署**。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-149">**Back up database before deployment**.</span></span> <span data-ttu-id="ddd9f-150">你通常将其设置为**true**当你将部署到生产环境中，为防止数据丢失预防措施。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-150">You typically set this to **true** when you deploy to a production environment, as a precaution against data loss.</span></span> <span data-ttu-id="ddd9f-151">你可能还想要将其设置为**true**时你将部署到过渡环境，如果临时数据库中包含大量数据。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-151">You may also want to set it to **true** when you deploy to a staging environment, if your staging database contains a lot of data.</span></span>
- <span data-ttu-id="ddd9f-152">**生成的对象在目标数据库中但未在数据库项目中的 DROP 语句**。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-152">**Generate DROP statements for objects that are in the target database but that are not in the database project**.</span></span> <span data-ttu-id="ddd9f-153">在大多数情况下，这是对数据库进行增量更改的整数和最重要的部分。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-153">In most cases, this is an integral and essential part of making incremental changes to a database.</span></span> <span data-ttu-id="ddd9f-154">如果设置了**始终重新创建数据库**到**false**，此设置将产生任何影响。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-154">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="ddd9f-155">**不使用 ALTER ASSEMBLY 语句更新 CLR 类型**。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-155">**Do not use ALTER ASSEMBLY statements to update CLR types**.</span></span> <span data-ttu-id="ddd9f-156">此设置确定如何 SQL Server 应更新公共语言运行时 (CLR) 类型，程序集的较新版本。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-156">This setting determines how SQL Server should update common language runtime (CLR) types to newer assembly versions.</span></span> <span data-ttu-id="ddd9f-157">此属性应设置为**false**在大多数情况下。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-157">This should be set to **false** in most scenarios.</span></span>

<span data-ttu-id="ddd9f-158">此表显示不同的目标环境的典型的部署设置。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-158">This table shows typical deployment settings for different destination environments.</span></span> <span data-ttu-id="ddd9f-159">但是，你的设置可能不同，具体取决于你的确切需求。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-159">However, your settings may be different depending on your exact requirements.</span></span>

|  | <span data-ttu-id="ddd9f-160">开发人员/测试</span><span class="sxs-lookup"><span data-stu-id="ddd9f-160">Developer/Test</span></span> | <span data-ttu-id="ddd9f-161">过渡/集成</span><span class="sxs-lookup"><span data-stu-id="ddd9f-161">Staging/Integration</span></span> | <span data-ttu-id="ddd9f-162">生产</span><span class="sxs-lookup"><span data-stu-id="ddd9f-162">Production</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="ddd9f-163">**部署比较排序规则**</span><span class="sxs-lookup"><span data-stu-id="ddd9f-163">**Deployment comparison collation**</span></span> | <span data-ttu-id="ddd9f-164">源</span><span class="sxs-lookup"><span data-stu-id="ddd9f-164">Source</span></span> | <span data-ttu-id="ddd9f-165">目标</span><span class="sxs-lookup"><span data-stu-id="ddd9f-165">Target</span></span> | <span data-ttu-id="ddd9f-166">目标</span><span class="sxs-lookup"><span data-stu-id="ddd9f-166">Target</span></span> |
| <span data-ttu-id="ddd9f-167">**部署数据库属性**</span><span class="sxs-lookup"><span data-stu-id="ddd9f-167">**Deploy database properties**</span></span> | <span data-ttu-id="ddd9f-168">True</span><span class="sxs-lookup"><span data-stu-id="ddd9f-168">True</span></span> | <span data-ttu-id="ddd9f-169">仅在第一次</span><span class="sxs-lookup"><span data-stu-id="ddd9f-169">First time only</span></span> | <span data-ttu-id="ddd9f-170">仅在第一次</span><span class="sxs-lookup"><span data-stu-id="ddd9f-170">First time only</span></span> |
| <span data-ttu-id="ddd9f-171">**始终重新创建数据库**</span><span class="sxs-lookup"><span data-stu-id="ddd9f-171">**Always re-create database**</span></span> | <span data-ttu-id="ddd9f-172">True</span><span class="sxs-lookup"><span data-stu-id="ddd9f-172">True</span></span> | <span data-ttu-id="ddd9f-173">False</span><span class="sxs-lookup"><span data-stu-id="ddd9f-173">False</span></span> | <span data-ttu-id="ddd9f-174">False</span><span class="sxs-lookup"><span data-stu-id="ddd9f-174">False</span></span> |
| <span data-ttu-id="ddd9f-175">**如果可能发生数据丢失则，阻止增量部署**</span><span class="sxs-lookup"><span data-stu-id="ddd9f-175">**Block incremental deployment if data loss might occur**</span></span> | <span data-ttu-id="ddd9f-176">False</span><span class="sxs-lookup"><span data-stu-id="ddd9f-176">False</span></span> | <span data-ttu-id="ddd9f-177">可能</span><span class="sxs-lookup"><span data-stu-id="ddd9f-177">Maybe</span></span> | <span data-ttu-id="ddd9f-178">True</span><span class="sxs-lookup"><span data-stu-id="ddd9f-178">True</span></span> |
| <span data-ttu-id="ddd9f-179">**在单用户模式下执行部署脚本**</span><span class="sxs-lookup"><span data-stu-id="ddd9f-179">**Execute deployment script in single-user mode**</span></span> | <span data-ttu-id="ddd9f-180">False</span><span class="sxs-lookup"><span data-stu-id="ddd9f-180">False</span></span> | <span data-ttu-id="ddd9f-181">True</span><span class="sxs-lookup"><span data-stu-id="ddd9f-181">True</span></span> | <span data-ttu-id="ddd9f-182">True</span><span class="sxs-lookup"><span data-stu-id="ddd9f-182">True</span></span> |
| <span data-ttu-id="ddd9f-183">**部署前备份数据库**</span><span class="sxs-lookup"><span data-stu-id="ddd9f-183">**Back up database before deployment**</span></span> | <span data-ttu-id="ddd9f-184">False</span><span class="sxs-lookup"><span data-stu-id="ddd9f-184">False</span></span> | <span data-ttu-id="ddd9f-185">可能</span><span class="sxs-lookup"><span data-stu-id="ddd9f-185">Maybe</span></span> | <span data-ttu-id="ddd9f-186">True</span><span class="sxs-lookup"><span data-stu-id="ddd9f-186">True</span></span> |
| <span data-ttu-id="ddd9f-187">**生成 DROP 语句的目标数据库中的对象但不是在数据库项目**</span><span class="sxs-lookup"><span data-stu-id="ddd9f-187">**Generate DROP statements for objects that are in the target database but that are not in the database project**</span></span> | <span data-ttu-id="ddd9f-188">False</span><span class="sxs-lookup"><span data-stu-id="ddd9f-188">False</span></span> | <span data-ttu-id="ddd9f-189">True</span><span class="sxs-lookup"><span data-stu-id="ddd9f-189">True</span></span> | <span data-ttu-id="ddd9f-190">True</span><span class="sxs-lookup"><span data-stu-id="ddd9f-190">True</span></span> |
| <span data-ttu-id="ddd9f-191">**不使用 ALTER ASSEMBLY 语句更新 CLR 类型**</span><span class="sxs-lookup"><span data-stu-id="ddd9f-191">**Do not use ALTER ASSEMBLY statements to update CLR types**</span></span> | <span data-ttu-id="ddd9f-192">False</span><span class="sxs-lookup"><span data-stu-id="ddd9f-192">False</span></span> | <span data-ttu-id="ddd9f-193">False</span><span class="sxs-lookup"><span data-stu-id="ddd9f-193">False</span></span> | <span data-ttu-id="ddd9f-194">False</span><span class="sxs-lookup"><span data-stu-id="ddd9f-194">False</span></span> |
  

> [!NOTE]
> <span data-ttu-id="ddd9f-195">数据库部署属性和环境注意事项的详细信息，请参阅[数据库项目设置概述](https://msdn.microsoft.com/en-us/library/aa833291(v=VS.100).aspx)，[如何： 部署详细信息的配置属性](https://msdn.microsoft.com/en-us/library/dd172125.aspx)， [生成并将数据库部署到独立的开发环境中](https://msdn.microsoft.com/en-us/library/dd193409.aspx)，和[生成并将数据库部署到过渡或生产环境](https://msdn.microsoft.com/en-us/library/dd193413.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-195">For more information on database deployment properties and environment considerations, see [An Overview of Database Project Settings](https://msdn.microsoft.com/en-us/library/aa833291(v=VS.100).aspx), [How to: Configure Properties for Deployment Details](https://msdn.microsoft.com/en-us/library/dd172125.aspx), [Build and Deploy Database to an Isolated Development Environment](https://msdn.microsoft.com/en-us/library/dd193409.aspx), and [Build and Deploy Databases to a Staging or Production Environment](https://msdn.microsoft.com/en-us/library/dd193413.aspx).</span></span>


<span data-ttu-id="ddd9f-196">若要支持部署到多个目标数据库项目，应创建每个目标环境的部署配置的文件。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-196">To support the deployment of a database project to multiple destinations, you should create a deployment configuration file for each target environment.</span></span>

<span data-ttu-id="ddd9f-197">**若要创建特定于环境的配置文件**</span><span class="sxs-lookup"><span data-stu-id="ddd9f-197">**To create an environment-specific configuration file**</span></span>

1. <span data-ttu-id="ddd9f-198">在 Visual Studio 2010 中，在**解决方案资源管理器**窗口中，右键单击您的数据库项目，并依次**属性**。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-198">In Visual Studio 2010, in the **Solution Explorer** window, right-click your database project, and then click **Properties**.</span></span>
2. <span data-ttu-id="ddd9f-199">在数据库项目的属性页上，在**部署**选项卡上，在**部署配置文件**行中，单击**新建**。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-199">On the database project properties page, on the **Deploy** tab, in the **Deployment configuration file** row, click **New**.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image1.png)
3. <span data-ttu-id="ddd9f-200">在**新部署配置文件**对话框框中，为文件提供有意义的名称 (例如， **TestEnvironment.sqldeployment**)，然后单击**保存**。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-200">In the **New Deployment Configuration File** dialog box, give the file a meaningful name (for example, **TestEnvironment.sqldeployment**), and then click **Save**.</span></span>
4. <span data-ttu-id="ddd9f-201">上*[文件名]***.sqldeployment**页上，设置部署属性以匹配你的目标环境的要求，然后保存该文件。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-201">On the *[Filename]***.sqldeployment** page, set the deployment properties to match the requirements of your destination environment, and then save the file.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image2.png)
5. <span data-ttu-id="ddd9f-202">注意，新的文件会添加到您的数据库项目中的属性文件夹。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-202">Notice that the new file is added to the Properties folder in your database project.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image3.png)

## <a name="specifying-the-deployment-configuration-file-in-vsdbcmd"></a><span data-ttu-id="ddd9f-203">在 VSDBCMD 中指定的部署配置文件</span><span class="sxs-lookup"><span data-stu-id="ddd9f-203">Specifying the Deployment Configuration File in VSDBCMD</span></span>

<span data-ttu-id="ddd9f-204">当使用 Visual Studio 2010 中 （如调试和发布） 的解决方案配置时，你可以将部署配置文件关联的每个配置。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-204">When you use solution configurations (like Debug and Release) within Visual Studio 2010, you can associate a deployment configuration file with each configuration.</span></span> <span data-ttu-id="ddd9f-205">生成一个特定的配置时，生成过程将生成指向配置特定部署配置文件配置特定部署清单文件。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-205">When you build a particular configuration, the build process generates a configuration-specific deployment manifest file that points to the configuration-specific deployment configuration file.</span></span> <span data-ttu-id="ddd9f-206">但是，这些教程中所述的部署的主要目标之一是方法的使用户能够控制部署过程，而使用 Visual Studio 2010 和解决方案配置。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-206">However, one of the main aims of the approach to deployment described in these tutorials is to give people the ability to control the deployment process without using Visual Studio 2010 and solution configurations.</span></span> <span data-ttu-id="ddd9f-207">在此方法中，将解决方案配置无论是相同的目标部署环境。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-207">In this approach, the solution configuration is the same regardless of the target deployment environment.</span></span> <span data-ttu-id="ddd9f-208">若要定制您的数据库部署到特定目标环境，可以使用 VSDBCMD 命令行选项指定你的部署配置文件。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-208">To tailor your database deployment to a specific destination environment, you can use the VSDBCMD command-line options to specify your deployment configuration file.</span></span>

<span data-ttu-id="ddd9f-209">若要在你 VSDBCMD 中指定一个部署配置文件，使用**p: / DeploymentConfigurationFile**切换，并提供你的文件的完整路径。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-209">To specify a deployment configuration file in your VSDBCMD, use the **p:/DeploymentConfigurationFile** switch and provide the full path to your file.</span></span> <span data-ttu-id="ddd9f-210">这将覆盖部署清单标识的部署配置文件。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-210">This will override the deployment configuration file that the deployment manifest identifies.</span></span> <span data-ttu-id="ddd9f-211">例如，你可以使用此 VSDBCMD 命令部署**ContactManager**数据库添加到测试环境：</span><span class="sxs-lookup"><span data-stu-id="ddd9f-211">For example, you could use this VSDBCMD command to deploy the **ContactManager** database to a test environment:</span></span>


[!code-console[Main](customizing-database-deployments-for-multiple-environments/samples/sample1.cmd)]


> [!NOTE]
> <span data-ttu-id="ddd9f-212">请注意，生成过程可能会重命名.sqldeployment 文件时将文件复制到输出目录。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-212">Note that the build process may rename your .sqldeployment file when it copies the file to the output directory.</span></span>


<span data-ttu-id="ddd9f-213">如果在部署前或后部署 SQL 脚本中使用的 SQL 命令变量，可以使用类似的方法与部署关联的特定于环境的.sqlcmdvars 文件。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-213">If you use SQL command variables in your pre-deployment or post-deployment SQL scripts, you can use a similar approach to associate an environment-specific .sqlcmdvars file with your deployment.</span></span> <span data-ttu-id="ddd9f-214">在这种情况下，使用**p: / SqlCommandVariablesFile**开关来标识.sqlcmdvars 文件。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-214">In this case, you use the **p:/SqlCommandVariablesFile** switch to identify your .sqlcmdvars file.</span></span>

## <a name="running-the-vsdbcmd-command-from-an-msbuild-project-file"></a><span data-ttu-id="ddd9f-215">从 MSBuild 项目文件运行 VSDBCMD 命令</span><span class="sxs-lookup"><span data-stu-id="ddd9f-215">Running the VSDBCMD Command from an MSBuild Project File</span></span>

<span data-ttu-id="ddd9f-216">你可以通过调用 MSBuild 项目文件中的 VSDBCMD 命令**Exec** MSBuild 目标内的任务。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-216">You can invoke a VSDBCMD command from an MSBuild project file by using an **Exec** task within an MSBuild target.</span></span> <span data-ttu-id="ddd9f-217">在最简单的形式，它将如下所示：</span><span class="sxs-lookup"><span data-stu-id="ddd9f-217">In its simplest form, it would look like this:</span></span>


[!code-xml[Main](customizing-database-deployments-for-multiple-environments/samples/sample2.xml)]


- <span data-ttu-id="ddd9f-218">在实践中，若要使你的项目文件易于读取和重复使用，你需要创建用于存储的各种命令行参数的属性。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-218">In practice, to make your project files easy to read and reuse, you'll want to create properties to store the various command-line parameters.</span></span> <span data-ttu-id="ddd9f-219">这样会使用户能够提供特定于环境的项目文件中的属性值，或重写从 MSBuild 命令行的默认值更容易。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-219">This makes it easier for users to provide property values in an environment-specific project file or to override default values from the MSBuild command line.</span></span> <span data-ttu-id="ddd9f-220">如果你使用拆分项目文件方法中所述[了解项目文件](../web-deployment-in-the-enterprise/understanding-the-project-file.md)，应相应地划分你构建说明和两个文件之间的属性：</span><span class="sxs-lookup"><span data-stu-id="ddd9f-220">If you use the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), you should divide your build instructions and properties between the two files accordingly:</span></span>
- <span data-ttu-id="ddd9f-221">特定于环境的设置，例如部署配置文件名、 数据库连接字符串和目标数据库名称，应该在特定于环境的项目文件中。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-221">Environment-specific settings, like the deployment configuration filename, the database connection string, and the target database name, should go in the environment-specific project file.</span></span>
- <span data-ttu-id="ddd9f-222">运行 VSDBCMD 命令，以及任何通用的属性，例如 VSDBCMD 可执行文件的位置的 MSBuild 目标应放在通用项目文件中。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-222">The MSBuild target that runs the VSDBCMD command, together with any universal properties like the location of the VSDBCMD executable, should go in the universal project file.</span></span>

<span data-ttu-id="ddd9f-223">你还应确保生成数据库项目，然后调用 VSDBCMD 以便.deploymanifest 文件已创建，并可供使用。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-223">You should also ensure that you build the database project before you invoke VSDBCMD so that the .deploymanifest file is created and ready to use.</span></span> <span data-ttu-id="ddd9f-224">你可以看到这种方法主题中的完整示例[了解该生成过程](../web-deployment-in-the-enterprise/understanding-the-build-process.md)，这将指导你完成中的项目文件[联系人管理器示例解决方案](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-224">You can see a full example of this approach in the topic [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md), which walks you through the project files in the [Contact Manager sample solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md).</span></span>

## <a name="conclusion"></a><span data-ttu-id="ddd9f-225">结束语</span><span class="sxs-lookup"><span data-stu-id="ddd9f-225">Conclusion</span></span>

<span data-ttu-id="ddd9f-226">本主题介绍如何部署数据库项目使用 MSBuild 和 VSDBCMD 时定制到不同的目标环境的数据库属性。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-226">This topic described how you can tailor database properties to different destination environments when you deploy database projects using MSBuild and VSDBCMD.</span></span> <span data-ttu-id="ddd9f-227">当你需要将数据库项目部署为更大，企业级解决方案的一部分时，此方法非常有用。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-227">This approach is useful when you need to deploy database projects as part of larger, enterprise-scale solutions.</span></span> <span data-ttu-id="ddd9f-228">这些解决方案通常部署到多个目标，如沙盒开发或测试环境、 过渡或集成平台，和生产或实时环境。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-228">These solutions are often deployed to multiple destinations, like sandboxed development or test environments, staging or integration platforms, and production or live environments.</span></span> <span data-ttu-id="ddd9f-229">每个这些目标环境通常需要一组唯一的数据库部署属性。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-229">Each of these target environments typically requires a unique set of database deployment properties.</span></span>

## <a name="further-reading"></a><span data-ttu-id="ddd9f-230">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="ddd9f-230">Further Reading</span></span>

<span data-ttu-id="ddd9f-231">有关部署使用 VSDBCMD.exe 的数据库项目的详细信息，请参阅[部署数据库项目](../web-deployment-in-the-enterprise/deploying-database-projects.md)。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-231">For more information on deploying database projects using VSDBCMD.exe, see [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span> <span data-ttu-id="ddd9f-232">使用自定义 MSBuild 项目文件来控制部署过程的详细信息，请参阅[了解项目文件](../web-deployment-in-the-enterprise/understanding-the-project-file.md)和[了解该生成过程](../web-deployment-in-the-enterprise/understanding-the-build-process.md)。</span><span class="sxs-lookup"><span data-stu-id="ddd9f-232">For more information on using custom MSBuild project files to control the deployment process, see [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md) and [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="ddd9f-233">MSDN 上的这些文章提供有关数据库部署的更多常规指导：</span><span class="sxs-lookup"><span data-stu-id="ddd9f-233">These articles on MSDN provide more general guidance on database deployment:</span></span>

- <span data-ttu-id="ddd9f-234">[数据库项目设置的概述](https://msdn.microsoft.com/en-us/library/aa833291(v=VS.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="ddd9f-234">[An Overview of Database Project Settings](https://msdn.microsoft.com/en-us/library/aa833291(v=VS.100).aspx)</span></span>
- [<span data-ttu-id="ddd9f-235">如何： 配置的部署详细信息属性</span><span class="sxs-lookup"><span data-stu-id="ddd9f-235">How to: Configure Properties for Deployment Details</span></span>](https://msdn.microsoft.com/en-us/library/dd172125.aspx)
- [<span data-ttu-id="ddd9f-236">生成并部署到独立的开发环境中的数据库</span><span class="sxs-lookup"><span data-stu-id="ddd9f-236">Build and Deploy Databases to an Isolated Development Environment</span></span>](https://msdn.microsoft.com/en-us/library/dd193409.aspx)
- [<span data-ttu-id="ddd9f-237">生成并将数据库部署到过渡或生产环境</span><span class="sxs-lookup"><span data-stu-id="ddd9f-237">Build and Deploy Databases to a Staging or Production Environment</span></span>](https://msdn.microsoft.com/en-us/library/dd193413.aspx)

>[!div class="step-by-step"]
<span data-ttu-id="ddd9f-238">[上一页](performing-a-what-if-deployment.md)
[下一页](deploying-database-role-memberships-to-test-environments.md)</span><span class="sxs-lookup"><span data-stu-id="ddd9f-238">[Previous](performing-a-what-if-deployment.md)
[Next](deploying-database-role-memberships-to-test-environments.md)</span></span>
