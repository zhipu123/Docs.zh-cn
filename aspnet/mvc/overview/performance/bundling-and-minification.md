---
uid: mvc/overview/performance/bundling-and-minification
title: "绑定和缩减 |Microsoft 文档"
author: Rick-Anderson
description: "绑定和缩减是两种技术可以在 ASP.NET 4.5 中使用，来提高请求加载时间。 绑定和缩减提高 reducin 加载时间..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/23/2012
ms.topic: article
ms.assetid: 5894dc13-5d45-4dad-8096-136499120f1d
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/performance/bundling-and-minification
msc.type: authoredcontent
ms.openlocfilehash: e83be2446ef1e3ff1275d06d5b743fb5b9444a6a
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="bundling-and-minification"></a><span data-ttu-id="0f28d-104">绑定和缩减</span><span class="sxs-lookup"><span data-stu-id="0f28d-104">Bundling and Minification</span></span>
====================
<span data-ttu-id="0f28d-105">通过[Rick Anderson](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="0f28d-105">by [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

> <span data-ttu-id="0f28d-106">绑定和缩减是两种技术可以在 ASP.NET 4.5 中使用，来提高请求加载时间。</span><span class="sxs-lookup"><span data-stu-id="0f28d-106">Bundling and minification are two techniques you can use in ASP.NET 4.5 to improve request load time.</span></span> <span data-ttu-id="0f28d-107">绑定和缩减提高加载时通过减少到服务器的请求数和减少的大小的请求资产 （如 CSS 和 JavaScript。）</span><span class="sxs-lookup"><span data-stu-id="0f28d-107">Bundling and minification improves load time by reducing the number of requests to the server and reducing the size of requested assets (such as CSS and JavaScript.)</span></span>


<span data-ttu-id="0f28d-108">大部分当前主要浏览器都限制的数量[同时连接](http://www.browserscope.org/?category=network)每六个每个主机名。</span><span class="sxs-lookup"><span data-stu-id="0f28d-108">Most of the current major browsers limit the number of [simultaneous connections](http://www.browserscope.org/?category=network) per each hostname to six.</span></span> <span data-ttu-id="0f28d-109">这意味着，在处理六个请求，而在主机上的资产的其他请求将排队等候，由浏览器。</span><span class="sxs-lookup"><span data-stu-id="0f28d-109">That means that while six requests are being processed, additional requests for assets on a host will be queued by the browser.</span></span> <span data-ttu-id="0f28d-110">下图中，在 IE F12 开发人员工具网络选项卡显示所需的一个示例应用程序的关于视图资产的计时。</span><span class="sxs-lookup"><span data-stu-id="0f28d-110">In the image below, the IE F12 developer tools network tabs shows the timing for assets required by the About view of a sample application.</span></span>

![B/M](bundling-and-minification/_static/image1.png)

<span data-ttu-id="0f28d-112">灰色条显示该请求排队等待的六个连接限制上的浏览器的时间。</span><span class="sxs-lookup"><span data-stu-id="0f28d-112">The gray bars show the time the request is queued by the browser waiting on the six connection limit.</span></span> <span data-ttu-id="0f28d-113">黄色的条为至第一字节的请求时间，即发送请求和从服务器接收第一个响应所花费的时间。</span><span class="sxs-lookup"><span data-stu-id="0f28d-113">The yellow bar is the request time to first byte, that is, the time taken to send the request and receive the first response from the server.</span></span> <span data-ttu-id="0f28d-114">蓝色条显示从服务器收到的响应数据所花的时间。</span><span class="sxs-lookup"><span data-stu-id="0f28d-114">The blue bars show the time taken to receive the response data from the server.</span></span> <span data-ttu-id="0f28d-115">你可以双击资产中，以获取详细的计时信息。</span><span class="sxs-lookup"><span data-stu-id="0f28d-115">You can double-click on an asset to get detailed timing information.</span></span> <span data-ttu-id="0f28d-116">例如下, 图显示加载的计时详细信息*/Scripts/MyScripts/JavaScript6.js*文件。</span><span class="sxs-lookup"><span data-stu-id="0f28d-116">For example, the following image shows the timing details for loading the */Scripts/MyScripts/JavaScript6.js* file.</span></span>

![](bundling-and-minification/_static/image2.png)

<span data-ttu-id="0f28d-117">前面的图所示**启动**事件，其中给出了由于浏览器的请求已排入队列的时间限制同时连接数。</span><span class="sxs-lookup"><span data-stu-id="0f28d-117">The preceding image shows the **Start** event, which gives the time the request was queued because of the browser limit the number of simultaneous connections.</span></span> <span data-ttu-id="0f28d-118">在这种情况下，请求已排队等待 46 毫秒内等待另一个请求完成。</span><span class="sxs-lookup"><span data-stu-id="0f28d-118">In this case, the request was queued for 46 milliseconds waiting for another request to complete.</span></span>

## <a name="bundling"></a><span data-ttu-id="0f28d-119">绑定</span><span class="sxs-lookup"><span data-stu-id="0f28d-119">Bundling</span></span>

<span data-ttu-id="0f28d-120">绑定是可以轻松地合并或捆绑到单个文件的多个文件的 ASP.NET 4.5 中的新功能。</span><span class="sxs-lookup"><span data-stu-id="0f28d-120">Bundling is a new feature in ASP.NET 4.5 that makes it easy to combine or bundle multiple files into a single file.</span></span> <span data-ttu-id="0f28d-121">你可以创建 CSS、 JavaScript 和其他捆绑包。</span><span class="sxs-lookup"><span data-stu-id="0f28d-121">You can create CSS, JavaScript and other bundles.</span></span> <span data-ttu-id="0f28d-122">少选一些文件意味着少数几个 HTTP 请求，可以提高第一个页面加载性能。</span><span class="sxs-lookup"><span data-stu-id="0f28d-122">Fewer files means fewer HTTP requests and that can improve first page load performance.</span></span>

<span data-ttu-id="0f28d-123">下图显示的相同的计时视图的显示以前，但这一次绑定和缩减启用具有的关于视图。</span><span class="sxs-lookup"><span data-stu-id="0f28d-123">The following image shows the same timing view of the About view shown previously, but this time with bundling and minification enabled.</span></span>

![](bundling-and-minification/_static/image3.png)

## <a name="minification"></a><span data-ttu-id="0f28d-124">缩减</span><span class="sxs-lookup"><span data-stu-id="0f28d-124">Minification</span></span>

<span data-ttu-id="0f28d-125">缩减执行各种不同的代码优化脚本或 css，如删除不必要的空白区域和注释和缩短为一个字符的变量名。</span><span class="sxs-lookup"><span data-stu-id="0f28d-125">Minification performs a variety of different code optimizations to scripts or css, such as removing unnecessary white space and comments and shortening variable names to one character.</span></span> <span data-ttu-id="0f28d-126">请考虑下面的 JavaScript 函数。</span><span class="sxs-lookup"><span data-stu-id="0f28d-126">Consider the following JavaScript function.</span></span>

[!code-javascript[Main](bundling-and-minification/samples/sample1.js)]

<span data-ttu-id="0f28d-127">后缩减，该函数将都会减少到以下：</span><span class="sxs-lookup"><span data-stu-id="0f28d-127">After minification, the function is reduced to the following:</span></span>

[!code-javascript[Main](bundling-and-minification/samples/sample2.js)]

<span data-ttu-id="0f28d-128">除了删除注释和多余的空格，以下参数和变量名已重命名 （缩短），如下所示：</span><span class="sxs-lookup"><span data-stu-id="0f28d-128">In addition to removing the comments and unnecessary whitespace, the following parameters and variable names were renamed (shortened) as follows:</span></span>

| <span data-ttu-id="0f28d-129">**源语言**</span><span class="sxs-lookup"><span data-stu-id="0f28d-129">**Original**</span></span> | <span data-ttu-id="0f28d-130">**重命名**</span><span class="sxs-lookup"><span data-stu-id="0f28d-130">**Renamed**</span></span> |
| --- | --- |
| <span data-ttu-id="0f28d-131">imageTagAndImageID</span><span class="sxs-lookup"><span data-stu-id="0f28d-131">imageTagAndImageID</span></span> | n |
| <span data-ttu-id="0f28d-132">imageContext</span><span class="sxs-lookup"><span data-stu-id="0f28d-132">imageContext</span></span> | <span data-ttu-id="0f28d-133">T</span><span class="sxs-lookup"><span data-stu-id="0f28d-133">t</span></span> |
| <span data-ttu-id="0f28d-134">imageElement</span><span class="sxs-lookup"><span data-stu-id="0f28d-134">imageElement</span></span> | <span data-ttu-id="0f28d-135">i</span><span class="sxs-lookup"><span data-stu-id="0f28d-135">i</span></span> |

## <a name="impact-of-bundling-and-minification"></a><span data-ttu-id="0f28d-136">影响的绑定和缩减</span><span class="sxs-lookup"><span data-stu-id="0f28d-136">Impact of Bundling and Minification</span></span>

<span data-ttu-id="0f28d-137">下表显示单独列出所有资产，然后在示例程序中使用绑定和缩减 (B/M) 之间的几个重要区别。</span><span class="sxs-lookup"><span data-stu-id="0f28d-137">The following table shows several important differences between listing all the assets individually and using bundling and minification (B/M) in the sample program.</span></span>

|  | <span data-ttu-id="0f28d-138">**使用 B/M**</span><span class="sxs-lookup"><span data-stu-id="0f28d-138">**Using B/M**</span></span> | <span data-ttu-id="0f28d-139">**而无需 B/M**</span><span class="sxs-lookup"><span data-stu-id="0f28d-139">**Without B/M**</span></span> | <span data-ttu-id="0f28d-140">**更改**</span><span class="sxs-lookup"><span data-stu-id="0f28d-140">**Change**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="0f28d-141">**文件请求**</span><span class="sxs-lookup"><span data-stu-id="0f28d-141">**File Requests**</span></span> | <span data-ttu-id="0f28d-142">9</span><span class="sxs-lookup"><span data-stu-id="0f28d-142">9</span></span> | <span data-ttu-id="0f28d-143">34</span><span class="sxs-lookup"><span data-stu-id="0f28d-143">34</span></span> | <span data-ttu-id="0f28d-144">256%</span><span class="sxs-lookup"><span data-stu-id="0f28d-144">256%</span></span> |
| <span data-ttu-id="0f28d-145">**发送的 KB**</span><span class="sxs-lookup"><span data-stu-id="0f28d-145">**KB Sent**</span></span> | <span data-ttu-id="0f28d-146">3.26</span><span class="sxs-lookup"><span data-stu-id="0f28d-146">3.26</span></span> | <span data-ttu-id="0f28d-147">11.92</span><span class="sxs-lookup"><span data-stu-id="0f28d-147">11.92</span></span> | <span data-ttu-id="0f28d-148">266%</span><span class="sxs-lookup"><span data-stu-id="0f28d-148">266%</span></span> |
| <span data-ttu-id="0f28d-149">**收到的 KB**</span><span class="sxs-lookup"><span data-stu-id="0f28d-149">**KB Received**</span></span> | <span data-ttu-id="0f28d-150">388.51</span><span class="sxs-lookup"><span data-stu-id="0f28d-150">388.51</span></span> | <span data-ttu-id="0f28d-151">530</span><span class="sxs-lookup"><span data-stu-id="0f28d-151">530</span></span> | <span data-ttu-id="0f28d-152">36%</span><span class="sxs-lookup"><span data-stu-id="0f28d-152">36%</span></span> |
| <span data-ttu-id="0f28d-153">**加载时间**</span><span class="sxs-lookup"><span data-stu-id="0f28d-153">**Load Time**</span></span> | <span data-ttu-id="0f28d-154">510 MS</span><span class="sxs-lookup"><span data-stu-id="0f28d-154">510 MS</span></span> | <span data-ttu-id="0f28d-155">780 MS</span><span class="sxs-lookup"><span data-stu-id="0f28d-155">780 MS</span></span> | <span data-ttu-id="0f28d-156">53%</span><span class="sxs-lookup"><span data-stu-id="0f28d-156">53%</span></span> |

<span data-ttu-id="0f28d-157">发送的字节数必须是与绑定因为浏览器是与它们在请求应用的 HTTP 标头非常详细，大大减少。</span><span class="sxs-lookup"><span data-stu-id="0f28d-157">The bytes sent had a significant reduction with bundling as browsers are fairly verbose with the HTTP headers they apply on requests.</span></span> <span data-ttu-id="0f28d-158">接收的字节减少不是最大因为最大的文件 (*Scripts\jquery-ui-1.8.11.min.js*和*Scripts\jquery-1.7.1.min.js*) 已缩减。</span><span class="sxs-lookup"><span data-stu-id="0f28d-158">The received bytes reduction is not as large because the largest files (*Scripts\jquery-ui-1.8.11.min.js* and *Scripts\jquery-1.7.1.min.js*) are already minified.</span></span> <span data-ttu-id="0f28d-159">注意： 的使用的示例程序计时[Fiddler](http://www.fiddler2.com/fiddler2/)工具来模拟慢速网络。</span><span class="sxs-lookup"><span data-stu-id="0f28d-159">Note: The timings on the sample program used the [Fiddler](http://www.fiddler2.com/fiddler2/) tool to simulate a slow network.</span></span> <span data-ttu-id="0f28d-160">(从 Fiddler**规则**菜单上，选择**性能**然后**模拟调制解调器速度**。)</span><span class="sxs-lookup"><span data-stu-id="0f28d-160">(From the Fiddler **Rules** menu, select **Performance** then **Simulate Modem Speeds**.)</span></span>

## <a name="debugging-bundled-and-minified-javascript"></a><span data-ttu-id="0f28d-161">调试捆绑和缩减的 JavaScript</span><span class="sxs-lookup"><span data-stu-id="0f28d-161">Debugging Bundled and Minified JavaScript</span></span>

<span data-ttu-id="0f28d-162">很容易地调试你在开发环境中的 JavaScript (其中[编译元素](https://msdn.microsoft.com/en-us/library/s10awwz0.aspx)中*Web.config*文件设置为`debug="true"`) 因为 JavaScript 文件中未绑定或缩减。</span><span class="sxs-lookup"><span data-stu-id="0f28d-162">It's easy to debug your JavaScript in a development environment (where the [compilation Element](https://msdn.microsoft.com/en-us/library/s10awwz0.aspx) in the *Web.config* file is set to `debug="true"` ) because the JavaScript files are not bundled or minified.</span></span> <span data-ttu-id="0f28d-163">你还可以调试在其中捆绑和缩减的你 JavaScript 文件的发布版本。</span><span class="sxs-lookup"><span data-stu-id="0f28d-163">You can also debug a release build where your JavaScript files are bundled and minified.</span></span> <span data-ttu-id="0f28d-164">使用 IE F12 开发人员工具，调试使用以下方法缩减捆绑中包含的 JavaScript 函数：</span><span class="sxs-lookup"><span data-stu-id="0f28d-164">Using the IE F12 developer tools, you debug a JavaScript function included in a minified bundle using the following approach:</span></span>

1. <span data-ttu-id="0f28d-165">选择**脚本**选项卡上，然后选择**开始调试**按钮。</span><span class="sxs-lookup"><span data-stu-id="0f28d-165">Select the **Script** tab and then select the **Start debugging** button.</span></span>
2. <span data-ttu-id="0f28d-166">选择包含你想要使用的资产按钮调试 JavaScript 函数捆绑。</span><span class="sxs-lookup"><span data-stu-id="0f28d-166">Select the bundle containing the JavaScript function you want to debug using the assets button.</span></span>  
    ![](bundling-and-minification/_static/image4.png)
3. <span data-ttu-id="0f28d-167">通过选择设置格式缩减的 JavaScript**配置按钮** ![](bundling-and-minification/_static/image5.png)，然后选择**格式 JavaScript**。</span><span class="sxs-lookup"><span data-stu-id="0f28d-167">Format the minified JavaScript by selecting the **Configuration button** ![](bundling-and-minification/_static/image5.png), and then selecting **Format JavaScript**.</span></span>
4. <span data-ttu-id="0f28d-168">在**搜索脚本**t 输入框中，选择你想要调试的函数的名称。</span><span class="sxs-lookup"><span data-stu-id="0f28d-168">In the **Search Scrip** t input box, select the name of the function you want to debug.</span></span> <span data-ttu-id="0f28d-169">在下图中， **AddAltToImg**已进入**搜索脚本**t 输入的框。</span><span class="sxs-lookup"><span data-stu-id="0f28d-169">In the following image, **AddAltToImg** was entered in the **Search Scrip** t input box.</span></span>  
    ![](bundling-and-minification/_static/image6.png)

<span data-ttu-id="0f28d-170">有关使用 F12 开发人员工具进行调试的详细信息，请参阅 MSDN 文章[使用 F12 开发人员工具为调试 JavaScript 错误](https://msdn.microsoft.com/en-us/library/ie/gg699336(v=vs.85).aspx)。</span><span class="sxs-lookup"><span data-stu-id="0f28d-170">For more information on debugging with the F12 developer tools, see the MSDN article [Using the F12 Developer Tools to Debug JavaScript Errors](https://msdn.microsoft.com/en-us/library/ie/gg699336(v=vs.85).aspx).</span></span>

## <a name="controlling-bundling-and-minification"></a><span data-ttu-id="0f28d-171">控制绑定和缩减</span><span class="sxs-lookup"><span data-stu-id="0f28d-171">Controlling Bundling and Minification</span></span>

<span data-ttu-id="0f28d-172">启用或禁用通过设置中的调试属性的值绑定和缩减[编译元素](https://msdn.microsoft.com/en-us/library/s10awwz0.aspx)中*Web.config*文件。</span><span class="sxs-lookup"><span data-stu-id="0f28d-172">Bundling and minification is enabled or disabled by setting the value of the debug attribute in the [compilation Element](https://msdn.microsoft.com/en-us/library/s10awwz0.aspx)  in the *Web.config* file.</span></span> <span data-ttu-id="0f28d-173">在下面的 XML，`debug`设置为 true，绑定和缩减处于禁用状态。</span><span class="sxs-lookup"><span data-stu-id="0f28d-173">In the following XML, `debug` is set to true so bundling and minification is disabled.</span></span>

[!code-xml[Main](bundling-and-minification/samples/sample3.xml?highlight=2)]

<span data-ttu-id="0f28d-174">若要启用绑定和缩减，设置`debug`为"false"的值。</span><span class="sxs-lookup"><span data-stu-id="0f28d-174">To enable bundling and minification, set the `debug` value to "false".</span></span> <span data-ttu-id="0f28d-175">您可以重写*Web.config*设置，并`EnableOptimizations`属性`BundleTable`类。</span><span class="sxs-lookup"><span data-stu-id="0f28d-175">You can override the *Web.config* setting with the `EnableOptimizations` property on the `BundleTable` class.</span></span> <span data-ttu-id="0f28d-176">以下代码启用绑定和缩减，并将替代在任何设置*Web.config*文件。</span><span class="sxs-lookup"><span data-stu-id="0f28d-176">The following code enables bundling and minification and overrides any setting in the *Web.config* file.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample4.cs?highlight=7)]

> [!NOTE]
> <span data-ttu-id="0f28d-177">除非`EnableOptimizations`是`true`或中的调试属性[编译元素](https://msdn.microsoft.com/en-us/library/s10awwz0.aspx)中*Web.config*文件设置为`false`，不会捆绑在一起或缩减的文件。</span><span class="sxs-lookup"><span data-stu-id="0f28d-177">Unless `EnableOptimizations` is `true` or the debug attribute in the [compilation Element](https://msdn.microsoft.com/en-us/library/s10awwz0.aspx)  in the *Web.config* file is set to `false`, files will not be bundled or minified.</span></span> <span data-ttu-id="0f28d-178">此外，将不使用的文件的.min 版本，将选择的完整的调试版本。</span><span class="sxs-lookup"><span data-stu-id="0f28d-178">Additionally, the .min version of files will not be used, the full debug versions will be selected.</span></span> <span data-ttu-id="0f28d-179">`EnableOptimizations`重写中的调试属性[编译元素](https://msdn.microsoft.com/en-us/library/s10awwz0.aspx)中*Web.config*文件</span><span class="sxs-lookup"><span data-stu-id="0f28d-179">`EnableOptimizations` overrides the debug attribute in the [compilation Element](https://msdn.microsoft.com/en-us/library/s10awwz0.aspx)  in the *Web.config* file</span></span>


## <a name="using-bundling-and-minification-with-aspnet-web-forms-and-web-pages"></a><span data-ttu-id="0f28d-180">使用绑定和缩减与 ASP.NET Web 窗体和 Web 页</span><span class="sxs-lookup"><span data-stu-id="0f28d-180">Using Bundling and Minification with ASP.NET Web Forms and Web Pages</span></span>

- <span data-ttu-id="0f28d-181">有关 Web 页，请参阅博客文章[添加到网页站点的 Web 优化](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx)。</span><span class="sxs-lookup"><span data-stu-id="0f28d-181">For Web Pages, see the blog entry [Adding Web Optimization to a Web Pages Site](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx).</span></span>
- <span data-ttu-id="0f28d-182">Web 窗体，请参阅博客文章[添加绑定和缩减到 Web 窗体](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx)。</span><span class="sxs-lookup"><span data-stu-id="0f28d-182">For Web Forms, see the blog entry [Adding Bundling and Minification to Web Forms](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx).</span></span>

## <a name="using-bundling-and-minification-with-aspnet-mvc"></a><span data-ttu-id="0f28d-183">使用绑定和缩减使用 ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="0f28d-183">Using Bundling and Minification with ASP.NET MVC</span></span>

<span data-ttu-id="0f28d-184">在本部分中我们将创建 ASP.NET MVC 项目以检查捆绑和缩减。</span><span class="sxs-lookup"><span data-stu-id="0f28d-184">In this section we will create an ASP.NET MVC project to examine bundling and minification.</span></span> <span data-ttu-id="0f28d-185">首先，创建一个名为的新 ASP.NET MVC internet 项目**MvcBM**而无需更改任何默认值。</span><span class="sxs-lookup"><span data-stu-id="0f28d-185">First, create a new ASP.NET MVC internet project named **MvcBM** without changing any of the defaults.</span></span>

<span data-ttu-id="0f28d-186">打开*应用\_Start\BundleConfig.cs*文件并检查`RegisterBundles`方法用于创建、 注册和配置捆绑包。</span><span class="sxs-lookup"><span data-stu-id="0f28d-186">Open the *App\_Start\BundleConfig.cs* file and examine the `RegisterBundles` method which is used to create, register and configure bundles.</span></span> <span data-ttu-id="0f28d-187">下面的代码演示了一部分`RegisterBundles`方法。</span><span class="sxs-lookup"><span data-stu-id="0f28d-187">The following code shows a portion of the `RegisterBundles` method.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample5.cs)]

<span data-ttu-id="0f28d-188">前面的代码创建名为的新 JavaScript 捆绑*~/bundles/jquery* ，包括所有相应 (调试或缩减的但不是。*vsdoc*) 中的文件*脚本*匹配通配符字符串"~/Scripts/jquery-{version}.js"的文件夹。</span><span class="sxs-lookup"><span data-stu-id="0f28d-188">The  preceding code creates a new JavaScript bundle named *~/bundles/jquery* that includes all the appropriate (that is debug or minified but not .*vsdoc*) files in the *Scripts* folder that match the wild card string "~/Scripts/jquery-{version}.js".</span></span> <span data-ttu-id="0f28d-189">对于 ASP.NET MVC 4 中，这意味着使用调试配置，该文件*jquery 1.7.1.js*将添加到该绑定。</span><span class="sxs-lookup"><span data-stu-id="0f28d-189">For ASP.NET MVC 4, this means with a debug configuration, the file *jquery-1.7.1.js* will be added to the bundle.</span></span> <span data-ttu-id="0f28d-190">在版本配置中， *jquery 1.7.1.min.js*将添加。</span><span class="sxs-lookup"><span data-stu-id="0f28d-190">In a release configuration, *jquery-1.7.1.min.js* will be added.</span></span> <span data-ttu-id="0f28d-191">捆绑 framework 如遵循几个常见约定：</span><span class="sxs-lookup"><span data-stu-id="0f28d-191">The bundling framework follows several common conventions such as:</span></span>

- <span data-ttu-id="0f28d-192">当"FileX.min.js"和"FileX.js"存在，请选择".min"版本的文件。</span><span class="sxs-lookup"><span data-stu-id="0f28d-192">Selecting ".min" file for release when "FileX.min.js" and "FileX.js" exist.</span></span>
- <span data-ttu-id="0f28d-193">选择用于调试的非".min"版本。</span><span class="sxs-lookup"><span data-stu-id="0f28d-193">Selecting the non ".min" version for debug.</span></span>
- <span data-ttu-id="0f28d-194">忽略"-vsdoc"文件 （例如 jquery-1.7.1-vsdoc.js)，它仅由 IntelliSense。</span><span class="sxs-lookup"><span data-stu-id="0f28d-194">Ignoring "-vsdoc" files (such as jquery-1.7.1-vsdoc.js), which are used only by IntelliSense.</span></span>

<span data-ttu-id="0f28d-195">`{version}`通配符匹配上面所示用于自动创建相应版本的中的 jQuery jQuery 捆绑你*脚本*文件夹。</span><span class="sxs-lookup"><span data-stu-id="0f28d-195">The `{version}` wild card matching shown above is used to automatically create a jQuery bundle with the appropriate version of jQuery in your *Scripts* folder.</span></span> <span data-ttu-id="0f28d-196">在此示例中，使用通配符提供了以下好处：</span><span class="sxs-lookup"><span data-stu-id="0f28d-196">In this example, using a wild card provides the following benefits:</span></span>

- <span data-ttu-id="0f28d-197">可以使用 NuGet 来更新到较新的 jQuery 版本，而无需更改的前面的捆绑代码或 jQuery 引用视图页面中。</span><span class="sxs-lookup"><span data-stu-id="0f28d-197">Allows you to use NuGet to update to a newer jQuery version without changing the preceding bundling code or jQuery references in your view pages.</span></span>
- <span data-ttu-id="0f28d-198">自动选择调试配置的完整版本和版本的".min"版本生成。</span><span class="sxs-lookup"><span data-stu-id="0f28d-198">Automatically selects the full version for debug configurations and the ".min" version for release builds.</span></span>

## <a name="using-a-cdn"></a><span data-ttu-id="0f28d-199">使用 CDN</span><span class="sxs-lookup"><span data-stu-id="0f28d-199">Using a CDN</span></span>

 <span data-ttu-id="0f28d-200">以下代码替换 CDN jQuery 捆绑本地 jQuery 捆绑。</span><span class="sxs-lookup"><span data-stu-id="0f28d-200">The follow code replaces the local jQuery bundle with a CDN jQuery bundle.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample6.cs)]

<span data-ttu-id="0f28d-201">在上面的代码中，将 jQuery 请求从 CDN 这是在版本模式和 jQuery 的调试版本将获取本地在调试模式下时。</span><span class="sxs-lookup"><span data-stu-id="0f28d-201">In the code above, jQuery will be requested from the CDN while in release mode and the debug version of jQuery will be fetched locally in debug mode.</span></span> <span data-ttu-id="0f28d-202">在使用 CDN 时，你应在 CDN 请求失败的情况下具有回退机制。</span><span class="sxs-lookup"><span data-stu-id="0f28d-202">When using a CDN, you should have a fallback mechanism in case the CDN request fails.</span></span> <span data-ttu-id="0f28d-203">以下标记片段从添加请求 jQuery 应在 CDN 失败的布局文件显示脚本的末尾。</span><span class="sxs-lookup"><span data-stu-id="0f28d-203">The following markup fragment from the end of the layout file shows script added to request jQuery should the CDN fail.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample7.cshtml?highlight=5-13)]

## <a name="creating-a-bundle"></a><span data-ttu-id="0f28d-204">创建包</span><span class="sxs-lookup"><span data-stu-id="0f28d-204">Creating a Bundle</span></span>

<span data-ttu-id="0f28d-205">[捆绑](https://msdn.microsoft.com/en-us/library/system.web.optimization.bundle(v=VS.110).aspx)类`Include`方法采用数组的字符串，其中每个字符串是资源的虚拟路径。</span><span class="sxs-lookup"><span data-stu-id="0f28d-205">The [Bundle](https://msdn.microsoft.com/en-us/library/system.web.optimization.bundle(v=VS.110).aspx) class `Include` method takes an array of strings, where each string is a virtual path to resource.</span></span> <span data-ttu-id="0f28d-206">下面的代码中的 RegisterBundles 方法从*应用\_Start\BundleConfig.cs*文件说明了如何将多个文件添加到了捆绑包：</span><span class="sxs-lookup"><span data-stu-id="0f28d-206">The following code from the RegisterBundles method in the *App\_Start\BundleConfig.cs* file shows how multiple files are added to a bundle:</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample8.cs)]

<span data-ttu-id="0f28d-207">[捆绑](https://msdn.microsoft.com/en-us/library/system.web.optimization.bundle(v=VS.110).aspx)类`IncludeDirectory`方法可用于添加一个目录 （以及所有子目录 （可选）） 中与搜索模式匹配的所有文件。</span><span class="sxs-lookup"><span data-stu-id="0f28d-207">The [Bundle](https://msdn.microsoft.com/en-us/library/system.web.optimization.bundle(v=VS.110).aspx) class `IncludeDirectory` method is provided to add all the files in a directory (and optionally all subdirectories) which match a search pattern.</span></span> <span data-ttu-id="0f28d-208">[捆绑](https://msdn.microsoft.com/en-us/library/system.web.optimization.bundle(v=VS.110).aspx)类`IncludeDirectory`API 如下所示：</span><span class="sxs-lookup"><span data-stu-id="0f28d-208">The [Bundle](https://msdn.microsoft.com/en-us/library/system.web.optimization.bundle(v=VS.110).aspx) class `IncludeDirectory` API is shown below:</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample9.cs)]

<span data-ttu-id="0f28d-209">使用 Render 方法中，视图中引用捆绑包 ( `Styles.Render` css 和`Scripts.Render`javascript)。</span><span class="sxs-lookup"><span data-stu-id="0f28d-209">Bundles are referenced in views using the Render method, ( `Styles.Render` for CSS and `Scripts.Render` for JavaScript).</span></span> <span data-ttu-id="0f28d-210">从以下标记*views/shared\\_Layout.cshtml*文件演示如何在默认 ASP.NET internet 项目视图引用 CSS 和 JavaScript 的捆绑包。</span><span class="sxs-lookup"><span data-stu-id="0f28d-210">The following markup from the *Views\Shared\\_Layout.cshtml* file shows how the default ASP.NET internet project views reference CSS and JavaScript bundles.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample10.cshtml?highlight=5-6,11)]

<span data-ttu-id="0f28d-211">请注意呈现方法采用数组的字符串，因此你可以在某行代码中添加多个捆绑包。</span><span class="sxs-lookup"><span data-stu-id="0f28d-211">Notice the Render methods takes an array of strings, so you can add multiple bundles in one line of code.</span></span> <span data-ttu-id="0f28d-212">通常，你将想要使用创建必要 HTML 中以引用资产的呈现器方法。</span><span class="sxs-lookup"><span data-stu-id="0f28d-212">You will generally want to use the Render methods which create the necessary HTML to reference the asset.</span></span> <span data-ttu-id="0f28d-213">你可以使用`Url`方法以生成资产的 URL，而引用资产所需的标记。</span><span class="sxs-lookup"><span data-stu-id="0f28d-213">You can use the `Url` method to generate the URL to the asset without the markup needed to reference the asset.</span></span> <span data-ttu-id="0f28d-214">假设你想要使用新的 HTML5[异步](http://www.whatwg.org/specs/web-apps/current-work/#attr-script-async)属性。</span><span class="sxs-lookup"><span data-stu-id="0f28d-214">Suppose you wanted to use the new HTML5 [async](http://www.whatwg.org/specs/web-apps/current-work/#attr-script-async) attribute.</span></span> <span data-ttu-id="0f28d-215">下面的代码演示如何引用 modernizr 使用`Url`方法。</span><span class="sxs-lookup"><span data-stu-id="0f28d-215">The following code shows how to reference modernizr using the `Url` method.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample11.cshtml?highlight=11)]

## <a name="using-the--wildcard-character-to-select-files"></a><span data-ttu-id="0f28d-216">使用"\*"通配符，以选择文件</span><span class="sxs-lookup"><span data-stu-id="0f28d-216">Using the "\*" Wildcard Character to Select Files</span></span>

<span data-ttu-id="0f28d-217">中指定的虚拟路径`Include`方法并且搜索模式中`IncludeDirectory`方法可以接受一个"\*"作为前缀或后缀中最后一个路径段的通配符字符。</span><span class="sxs-lookup"><span data-stu-id="0f28d-217">The virtual path specified in the `Include` method and the search pattern in the `IncludeDirectory` method can accept one "\*" wildcard character as a prefix or suffix to in the last path segment.</span></span> <span data-ttu-id="0f28d-218">区分大小写的搜索字符串。</span><span class="sxs-lookup"><span data-stu-id="0f28d-218">The search string is case insensitive.</span></span> <span data-ttu-id="0f28d-219">`IncludeDirectory`方法具有的搜索子目录选项。</span><span class="sxs-lookup"><span data-stu-id="0f28d-219">The `IncludeDirectory` method has the option of searching subdirectories.</span></span>

<span data-ttu-id="0f28d-220">使用以下 JavaScript 文件，请考虑一个项目：</span><span class="sxs-lookup"><span data-stu-id="0f28d-220">Consider a project with the following JavaScript files:</span></span>

- <span data-ttu-id="0f28d-221">*Scripts\Common\AddAltToImg.js*</span><span class="sxs-lookup"><span data-stu-id="0f28d-221">*Scripts\Common\AddAltToImg.js*</span></span>
- <span data-ttu-id="0f28d-222">*Scripts\Common\ToggleDiv.js*</span><span class="sxs-lookup"><span data-stu-id="0f28d-222">*Scripts\Common\ToggleDiv.js*</span></span>
- <span data-ttu-id="0f28d-223">*Scripts\Common\ToggleImg.js*</span><span class="sxs-lookup"><span data-stu-id="0f28d-223">*Scripts\Common\ToggleImg.js*</span></span>
- <span data-ttu-id="0f28d-224">*Scripts\Common\Sub1\ToggleLinks.js*</span><span class="sxs-lookup"><span data-stu-id="0f28d-224">*Scripts\Common\Sub1\ToggleLinks.js*</span></span>

![dir imag](bundling-and-minification/_static/image7.png)

<span data-ttu-id="0f28d-226">下表显示添加到使用通配符，如下所示的捆绑的文件：</span><span class="sxs-lookup"><span data-stu-id="0f28d-226">The following table shows the files added to a bundle using the wildcard as shown:</span></span>

| <span data-ttu-id="0f28d-227">**Call**</span><span class="sxs-lookup"><span data-stu-id="0f28d-227">**Call**</span></span> | <span data-ttu-id="0f28d-228">**添加文件或引发异常**</span><span class="sxs-lookup"><span data-stu-id="0f28d-228">**Files Added or Exception Raised**</span></span> |
| --- | --- |
| <span data-ttu-id="0f28d-229">包括 ("~/Scripts/Common/\*.js")</span><span class="sxs-lookup"><span data-stu-id="0f28d-229">Include("~/Scripts/Common/\*.js")</span></span> | <span data-ttu-id="0f28d-230">*AddAltToImg.js，ToggleDiv.js，ToggleImg.js*</span><span class="sxs-lookup"><span data-stu-id="0f28d-230">*AddAltToImg.js, ToggleDiv.js, ToggleImg.js*</span></span> |
| <span data-ttu-id="0f28d-231">包括 ("~/Scripts/Common/T\*.js")</span><span class="sxs-lookup"><span data-stu-id="0f28d-231">Include("~/Scripts/Common/T\*.js")</span></span> | <span data-ttu-id="0f28d-232">无效模式异常。</span><span class="sxs-lookup"><span data-stu-id="0f28d-232">Invalid pattern exception.</span></span> <span data-ttu-id="0f28d-233">通配符字符只能在前缀或后缀上。</span><span class="sxs-lookup"><span data-stu-id="0f28d-233">The wildcard character is only allowed on the prefix or suffix.</span></span> |
| <span data-ttu-id="0f28d-234">包括 ("~/Scripts/Common/\*og。\*")</span><span class="sxs-lookup"><span data-stu-id="0f28d-234">Include("~/Scripts/Common/\*og.\*")</span></span> | <span data-ttu-id="0f28d-235">无效模式异常。</span><span class="sxs-lookup"><span data-stu-id="0f28d-235">Invalid pattern exception.</span></span> <span data-ttu-id="0f28d-236">允许只有一个通配符字符。</span><span class="sxs-lookup"><span data-stu-id="0f28d-236">Only one wildcard character is allowed.</span></span> |
| <span data-ttu-id="0f28d-237">"包括 ("~/Scripts/Common/T\*")</span><span class="sxs-lookup"><span data-stu-id="0f28d-237">"Include("~/Scripts/Common/T\*")</span></span> | <span data-ttu-id="0f28d-238">*ToggleDiv.js ToggleImg.js*</span><span class="sxs-lookup"><span data-stu-id="0f28d-238">*ToggleDiv.js, ToggleImg.js*</span></span> |
| <span data-ttu-id="0f28d-239">"包括 ("~/Scripts/Common/\*")</span><span class="sxs-lookup"><span data-stu-id="0f28d-239">"Include("~/Scripts/Common/\*")</span></span> | <span data-ttu-id="0f28d-240">无效模式异常。</span><span class="sxs-lookup"><span data-stu-id="0f28d-240">Invalid pattern exception.</span></span> <span data-ttu-id="0f28d-241">纯通配符段不是有效的。</span><span class="sxs-lookup"><span data-stu-id="0f28d-241">A pure wildcard segment is not valid.</span></span> |
| <span data-ttu-id="0f28d-242">IncludeDirectory ("~/Scripts/Common"，"T\*")</span><span class="sxs-lookup"><span data-stu-id="0f28d-242">IncludeDirectory("~/Scripts/Common", "T\*")</span></span> | <span data-ttu-id="0f28d-243">*ToggleDiv.js ToggleImg.js*</span><span class="sxs-lookup"><span data-stu-id="0f28d-243">*ToggleDiv.js, ToggleImg.js*</span></span> |
| <span data-ttu-id="0f28d-244">IncludeDirectory ("~/Scripts/Common"，"T\*"，则返回 true)</span><span class="sxs-lookup"><span data-stu-id="0f28d-244">IncludeDirectory("~/Scripts/Common", "T\*",true)</span></span> | <span data-ttu-id="0f28d-245">*ToggleDiv.js，ToggleImg.js，ToggleLinks.js*</span><span class="sxs-lookup"><span data-stu-id="0f28d-245">*ToggleDiv.js, ToggleImg.js, ToggleLinks.js*</span></span> |

<span data-ttu-id="0f28d-246">捆绑包中显式添加每个文件是通常首选通过通配符加载的下列原因造成的文件：</span><span class="sxs-lookup"><span data-stu-id="0f28d-246">Explicitly adding each file to a bundle is generally the preferred over wildcard loading of files for the following reasons:</span></span>

- <span data-ttu-id="0f28d-247">将脚本通配符默认情况下添加到在字母顺序排列，这通常不是你希望中加载它们。</span><span class="sxs-lookup"><span data-stu-id="0f28d-247">Adding scripts by wildcard defaults to loading them in alphabetical order, which is typically not what you want.</span></span> <span data-ttu-id="0f28d-248">经常需要添加特定 （非字母） 顺序 CSS 和 JavaScript 文件。</span><span class="sxs-lookup"><span data-stu-id="0f28d-248">CSS and JavaScript files frequently need to be added in a specific (non-alphabetic) order.</span></span> <span data-ttu-id="0f28d-249">你可以通过添加自定义来缓解此风险[IBundleOrderer](https://msdn.microsoft.com/en-us/library/system.web.optimization.ibundleorderer(VS.110).aspx)实现，但显式添加每个文件都不容易出错。</span><span class="sxs-lookup"><span data-stu-id="0f28d-249">You can mitigate this risk by adding a custom [IBundleOrderer](https://msdn.microsoft.com/en-us/library/system.web.optimization.ibundleorderer(VS.110).aspx) implementation, but explicitly adding each file is less error prone.</span></span> <span data-ttu-id="0f28d-250">例如，可以添加到将来的文件夹的新资产，这可能会要求你修改你[IBundleOrderer](https://msdn.microsoft.com/en-us/library/system.web.optimization.ibundleorderer(VS.110).aspx)实现。</span><span class="sxs-lookup"><span data-stu-id="0f28d-250">For example, you might add new assets to a folder in the future which might require you to modify your [IBundleOrderer](https://msdn.microsoft.com/en-us/library/system.web.optimization.ibundleorderer(VS.110).aspx) implementation.</span></span>
- <span data-ttu-id="0f28d-251">查看特定文件添加到目录中使用通配符加载可以包含在引用此绑定的所有视图。</span><span class="sxs-lookup"><span data-stu-id="0f28d-251">View specific files added to a directory using wild card loading can be included in all views referencing that bundle.</span></span> <span data-ttu-id="0f28d-252">如果查看特定脚本添加到捆绑包，您可能会在其他引用捆绑包的视图的 JavaScript 错误。</span><span class="sxs-lookup"><span data-stu-id="0f28d-252">If the view specific script is added to a bundle, you may get a JavaScript error on other views that reference the bundle.</span></span>
- <span data-ttu-id="0f28d-253">导入其他文件的 CSS 文件会产生两次加载导入文件。</span><span class="sxs-lookup"><span data-stu-id="0f28d-253">CSS files that import other files result in the imported files loaded twice.</span></span> <span data-ttu-id="0f28d-254">例如，下面的代码与大多数两次加载 jQuery UI 主题 CSS 文件创建包。</span><span class="sxs-lookup"><span data-stu-id="0f28d-254">For example, the following code creates a bundle with most of the jQuery UI theme CSS files loaded twice.</span></span> 

    [!code-csharp[Main](bundling-and-minification/samples/sample12.cs)]

 <span data-ttu-id="0f28d-255">通配符选择器"\*.css"的文件夹中，每个 CSS 文件中将包括*Content\themes\base\jquery.ui.all.css*文件。</span><span class="sxs-lookup"><span data-stu-id="0f28d-255">The wild card selector "\*.css" brings in each CSS file in the folder, including the *Content\themes\base\jquery.ui.all.css* file.</span></span> <span data-ttu-id="0f28d-256">*Jquery.ui.all.css*文件导入其他 CSS 文件。</span><span class="sxs-lookup"><span data-stu-id="0f28d-256">The *jquery.ui.all.css* file imports other CSS files.</span></span>

## <a name="bundle-caching"></a><span data-ttu-id="0f28d-257">捆绑缓存</span><span class="sxs-lookup"><span data-stu-id="0f28d-257">Bundle Caching</span></span>

<span data-ttu-id="0f28d-258">捆绑包设置创建包时从 HTTP 过期标头一年。</span><span class="sxs-lookup"><span data-stu-id="0f28d-258">Bundles set the HTTP Expires Header one year from when the bundle is created.</span></span> <span data-ttu-id="0f28d-259">如果你导航到以前查看过的页面，Fiddler 显示 IE 不会进行捆绑包，条件请求，即有的捆绑包的 IE 没有 HTTP GET 请求以及来自服务器的任何 HTTP 304 响应。</span><span class="sxs-lookup"><span data-stu-id="0f28d-259">If you navigate to a previously viewed page, Fiddler shows IE does not make a conditional request for the bundle, that is, there are no HTTP GET requests from IE for the bundles and no HTTP 304 responses from the server.</span></span> <span data-ttu-id="0f28d-260">你可以强制 IE 以便每个捆绑包的条件请求 （导致每个捆绑包的 HTTP 304 响应） F5 键。</span><span class="sxs-lookup"><span data-stu-id="0f28d-260">You can force IE to make a conditional request for each bundle with the F5 key (resulting in a HTTP 304 response for each bundle).</span></span> <span data-ttu-id="0f28d-261">你可以通过使用强制完全刷新 ^ F5 （导致每个捆绑包的 HTTP 200 响应）。</span><span class="sxs-lookup"><span data-stu-id="0f28d-261">You can force a full refresh by using ^F5 (resulting in a HTTP 200 response for each bundle.)</span></span>

<span data-ttu-id="0f28d-262">下图显示**Caching** Fiddler 响应窗格的选项卡：</span><span class="sxs-lookup"><span data-stu-id="0f28d-262">The following image shows the **Caching** tab of the Fiddler response pane:</span></span>

![fiddler 缓存图像](bundling-and-minification/_static/image8.png)

<span data-ttu-id="0f28d-264">请求</span><span class="sxs-lookup"><span data-stu-id="0f28d-264">The request</span></span>   
`http://localhost/MvcBM_time/bundles/AllMyScripts?v=r0sLDicvP58AIXN_mc3QdyVvVj5euZNzdsa2N1PKvb81`  
 <span data-ttu-id="0f28d-265">是捆绑包**AllMyScripts**和包含查询字符串对**v = r0sLDicvP58AIXN\_mc3QdyVvVj5euZNzdsa2N1PKvb81**。</span><span class="sxs-lookup"><span data-stu-id="0f28d-265">is for the bundle **AllMyScripts** and contains a query string pair **v=r0sLDicvP58AIXN\_mc3QdyVvVj5euZNzdsa2N1PKvb81**.</span></span> <span data-ttu-id="0f28d-266">查询字符串**v**令牌，它是用于缓存的唯一标识符的值。</span><span class="sxs-lookup"><span data-stu-id="0f28d-266">The query string **v** has a value token that is a unique identifier used for caching.</span></span> <span data-ttu-id="0f28d-267">ASP.NET 应用程序，只要捆绑包不会更改，将请求**AllMyScripts**捆绑在一起使用此令牌。</span><span class="sxs-lookup"><span data-stu-id="0f28d-267">As long as the bundle doesn't change, the ASP.NET application will request the **AllMyScripts** bundle using this token.</span></span> <span data-ttu-id="0f28d-268">如果捆绑中的任何文件发生更改，ASP.NET 优化框架将生成一个新的令牌，捆绑包的浏览器请求将获取最新的捆绑包，从而保证。</span><span class="sxs-lookup"><span data-stu-id="0f28d-268">If any file in the bundle changes, the ASP.NET optimization framework will generate a new token, guaranteeing that browser requests for the bundle will get the latest bundle.</span></span>

<span data-ttu-id="0f28d-269">如果你运行 IE9 F12 开发人员工具，并导航到先前加载页时，即错误地显示为每个捆绑包和返回 HTTP 304 服务器所做的条件性 GET 请求。</span><span class="sxs-lookup"><span data-stu-id="0f28d-269">If you run the IE9 F12 developer tools and navigate to a previously loaded page, IE incorrectly shows conditional GET requests made to each bundle and the server returning HTTP 304.</span></span> <span data-ttu-id="0f28d-270">你可以阅读 IE9 具有确定是否在博客文章中进行了一个条件的请求的问题的原因[使用 Cdn 和提高网站性能的 Expires](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)。</span><span class="sxs-lookup"><span data-stu-id="0f28d-270">You can read why IE9 has problems determining if a conditional request was made in the blog entry [Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span>

## <a name="less-coffeescript-scss-sass-bundling"></a><span data-ttu-id="0f28d-271">更少，CoffeeScript、 SCSS，Sass 绑定。</span><span class="sxs-lookup"><span data-stu-id="0f28d-271">LESS, CoffeeScript, SCSS, Sass Bundling.</span></span>

<span data-ttu-id="0f28d-272">绑定和缩减 framework 提供一种机制，如处理中间语言[SCSS](http://sass-lang.com/)， [Sass](http://sass-lang.com/)，[较少](http://www.dotlesscss.org/)或[Coffeescript](http://coffeescript.org/)，并将如缩减的转换应用到生成的捆绑包。</span><span class="sxs-lookup"><span data-stu-id="0f28d-272">The bundling and minification framework provides a mechanism to process intermediate languages such as [SCSS](http://sass-lang.com/), [Sass](http://sass-lang.com/), [LESS](http://www.dotlesscss.org/) or [Coffeescript](http://coffeescript.org/), and apply transforms such as minification to the resulting bundle.</span></span> <span data-ttu-id="0f28d-273">例如，若要添加[.less](http://www.dotlesscss.org/)到 MVC 4 项目的文件：</span><span class="sxs-lookup"><span data-stu-id="0f28d-273">For example, to add [.less](http://www.dotlesscss.org/) files to your MVC 4 project:</span></span>

1. <span data-ttu-id="0f28d-274">创建你较少的内容的文件夹。</span><span class="sxs-lookup"><span data-stu-id="0f28d-274">Create a folder for your LESS content.</span></span> <span data-ttu-id="0f28d-275">下面的示例使用*Content\MyLess*文件夹。</span><span class="sxs-lookup"><span data-stu-id="0f28d-275">The following example uses the *Content\MyLess* folder.</span></span>
2. <span data-ttu-id="0f28d-276">添加[.less](http://www.dotlesscss.org/) NuGet 包**无点**到你的项目。</span><span class="sxs-lookup"><span data-stu-id="0f28d-276">Add the [.less](http://www.dotlesscss.org/) NuGet package **dotless** to your project.</span></span>  
    <span data-ttu-id="0f28d-277">![NuGet 无点安装](bundling-and-minification/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="0f28d-277">![NuGet dotless install](bundling-and-minification/_static/image9.png)</span></span>
3. <span data-ttu-id="0f28d-278">添加一个类，实现[IBundleTransform](https://msdn.microsoft.com/en-us/library/system.web.optimization.ibundletransform(VS.110).aspx)接口。</span><span class="sxs-lookup"><span data-stu-id="0f28d-278">Add a class that implements the [IBundleTransform](https://msdn.microsoft.com/en-us/library/system.web.optimization.ibundletransform(VS.110).aspx) interface.</span></span> <span data-ttu-id="0f28d-279">用于.less 转换到你的项目中添加以下代码。</span><span class="sxs-lookup"><span data-stu-id="0f28d-279">For the .less transform, add the following code to your project.</span></span>

    [!code-csharp[Main](bundling-and-minification/samples/sample13.cs)]
4. <span data-ttu-id="0f28d-280">创建具有更少文件的捆绑包`LessTransform`和[CssMinify](https://msdn.microsoft.com/en-us/library/system.web.optimization.cssminify(VS.110).aspx)转换。</span><span class="sxs-lookup"><span data-stu-id="0f28d-280">Create a bundle of LESS files with the `LessTransform` and the [CssMinify](https://msdn.microsoft.com/en-us/library/system.web.optimization.cssminify(VS.110).aspx) transform.</span></span> <span data-ttu-id="0f28d-281">以下代码添加到`RegisterBundles`中的方法*应用\_Start\BundleConfig.cs*文件。</span><span class="sxs-lookup"><span data-stu-id="0f28d-281">Add the following code to the `RegisterBundles` method in the *App\_Start\BundleConfig.cs* file.</span></span>

    [!code-csharp[Main](bundling-and-minification/samples/sample14.cs)]
5. <span data-ttu-id="0f28d-282">将以下代码添加到任何视图，即在引用较少捆绑包。</span><span class="sxs-lookup"><span data-stu-id="0f28d-282">Add the following code to any views which references the LESS bundle.</span></span>

    [!code-cshtml[Main](bundling-and-minification/samples/sample15.cshtml)]

## <a name="bundle-considerations"></a><span data-ttu-id="0f28d-283">捆绑注意事项</span><span class="sxs-lookup"><span data-stu-id="0f28d-283">Bundle Considerations</span></span>

<span data-ttu-id="0f28d-284">较好的做法，在创建包时应遵循是作为前缀的捆绑包名称包含"捆绑"。</span><span class="sxs-lookup"><span data-stu-id="0f28d-284">A good convention to follow when creating bundles is to include "bundle" as a prefix in the bundle name.</span></span> <span data-ttu-id="0f28d-285">这将防止可能发生的[路由冲突](https://forums.asp.net/post/5012037.aspx)。</span><span class="sxs-lookup"><span data-stu-id="0f28d-285">This will prevent a possible [routing conflict](https://forums.asp.net/post/5012037.aspx).</span></span>

<span data-ttu-id="0f28d-286">后更新捆绑中的一个文件，为捆绑查询字符串参数生成新的令牌，并必须客户端请求包含捆绑包的页在下一步时下载完整的捆绑包。</span><span class="sxs-lookup"><span data-stu-id="0f28d-286">Once you update one file in a bundle, a new token is generated for the bundle query string parameter and the full bundle must be downloaded the next time a client requests a page containing the bundle.</span></span> <span data-ttu-id="0f28d-287">在其中将单独列出每个资产的传统标记中，会下载已更改的文件。</span><span class="sxs-lookup"><span data-stu-id="0f28d-287">In traditional markup where each asset is listed individually, only the changed file would be downloaded.</span></span> <span data-ttu-id="0f28d-288">批的情况下，经常发生变化的资产可能不是很好的候选。</span><span class="sxs-lookup"><span data-stu-id="0f28d-288">Assets that change frequently may not be good candidates for bundling.</span></span>

<span data-ttu-id="0f28d-289">绑定和缩减主要提高第一个页面请求加载时间。</span><span class="sxs-lookup"><span data-stu-id="0f28d-289">Bundling and minification primarily improve the first page request load time.</span></span> <span data-ttu-id="0f28d-290">一旦已请求了网页，浏览器缓存的资产 （JavaScript、 CSS 和图像） 因此绑定和缩减在请求同一页面时，不会提供任何性能提升，或在同一站点请求相同的资产。</span><span class="sxs-lookup"><span data-stu-id="0f28d-290">Once a webpage has been requested, the browser caches the assets (JavaScript, CSS and images) so bundling and minification won't provide any performance boost when requesting the same page, or pages on the same site requesting the same assets.</span></span> <span data-ttu-id="0f28d-291">如果未设置过期标头在你的资产上正常和不使用绑定和缩减、 浏览器新鲜度试探方法会将标记为资产陈旧在几天后和浏览器将需要为每个资产的验证请求。</span><span class="sxs-lookup"><span data-stu-id="0f28d-291">If you don't set the expires header correctly on your assets, and you don't use bundling and minification, the browsers freshness heuristics will mark the assets stale after a few days and the browser will require a validation request for each asset.</span></span> <span data-ttu-id="0f28d-292">在这种情况下，绑定和缩减后首次页请求提供性能提升。</span><span class="sxs-lookup"><span data-stu-id="0f28d-292">In this case, bundling and minification provide a performance increase after the first page request.</span></span> <span data-ttu-id="0f28d-293">有关详细信息，请参阅博客[使用 Cdn 和提高网站性能的 Expires](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)。</span><span class="sxs-lookup"><span data-stu-id="0f28d-293">For details, see the blog [Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span>

<span data-ttu-id="0f28d-294">每个主机名每六个同时连接的浏览器限制可以通过使用减轻[CDN](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)。</span><span class="sxs-lookup"><span data-stu-id="0f28d-294">The browser limitation of six simultaneous connections per each hostname can be mitigated by using a [CDN](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span> <span data-ttu-id="0f28d-295">CDN 将有不同的主机名与你的托管站点，因为从 CDN 的资产请求将不计入你的托管环境的六个并发连接限制。</span><span class="sxs-lookup"><span data-stu-id="0f28d-295">Because the CDN will have a different hostname than your hosting site, asset requests from the CDN will not count against the six simultaneous connections limit to your hosting environment.</span></span> <span data-ttu-id="0f28d-296">常见包缓存和缓存优点的边缘，还可以提供 CDN。</span><span class="sxs-lookup"><span data-stu-id="0f28d-296">A CDN can also provide common package caching and edge caching advantages.</span></span>

<span data-ttu-id="0f28d-297">捆绑包应进行分区需要它们的页。</span><span class="sxs-lookup"><span data-stu-id="0f28d-297">Bundles should be partitioned by pages that need them.</span></span> <span data-ttu-id="0f28d-298">例如，默认的 internet 应用程序的 ASP.NET MVC 模板创建 jQuery 验证捆绑分开 jQuery。</span><span class="sxs-lookup"><span data-stu-id="0f28d-298">For example, the default ASP.NET MVC template for an internet application creates a jQuery Validation bundle separate from jQuery.</span></span> <span data-ttu-id="0f28d-299">创建的默认视图不产生任何影响，并不发布值，因为它们不包括验证捆绑。</span><span class="sxs-lookup"><span data-stu-id="0f28d-299">Because the default views created have no input and do not post values, they don't include the validation bundle.</span></span>

<span data-ttu-id="0f28d-300">`System.Web.Optimization`在 System.Web.Optimization.DLL 中实现命名空间。</span><span class="sxs-lookup"><span data-stu-id="0f28d-300">The `System.Web.Optimization` namespace is implemented in System.Web.Optimization.DLL.</span></span> <span data-ttu-id="0f28d-301">它利用 WebGrease 库 (WebGrease.dll) 对于缩减功能，这反过来使用 Antlr3.Runtime.dll。</span><span class="sxs-lookup"><span data-stu-id="0f28d-301">It leverages the WebGrease library (WebGrease.dll) for minification capabilities, which in turn uses Antlr3.Runtime.dll.</span></span>

<span data-ttu-id="0f28d-302">*我使用 Twitter 进行快速的文章和共享链接。我 Twitter 句柄是*:[@RickAndMSFT](http://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="0f28d-302">*I use Twitter to make quick posts and share links. My Twitter handle is*: [@RickAndMSFT](http://twitter.com/RickAndMSFT)</span></span>

## <a name="additional-resources"></a><span data-ttu-id="0f28d-303">其他资源</span><span class="sxs-lookup"><span data-stu-id="0f28d-303">Additional Resources</span></span>

- <span data-ttu-id="0f28d-304">视频：[绑定和优化](https://channel9.msdn.com/Events/aspConf/aspConf/Bundling-and-Optimizing)通过[Howard Dierking](https://twitter.com/#!/howard_dierking)</span><span class="sxs-lookup"><span data-stu-id="0f28d-304">Video:[Bundling and Optimizing](https://channel9.msdn.com/Events/aspConf/aspConf/Bundling-and-Optimizing) by [Howard Dierking](https://twitter.com/#!/howard_dierking)</span></span>
- <span data-ttu-id="0f28d-305">[将添加到的网页的 Web 优化](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx)。</span><span class="sxs-lookup"><span data-stu-id="0f28d-305">[Adding Web Optimization to a Web Pages Site](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx).</span></span>
- <span data-ttu-id="0f28d-306">[添加绑定和缩减到 Web 窗体](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx)。</span><span class="sxs-lookup"><span data-stu-id="0f28d-306">[Adding Bundling and Minification to Web Forms](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx).</span></span>
- <span data-ttu-id="0f28d-307">[性能影响的绑定和缩减在 Web 浏览](https://blogs.msdn.com/b/henrikn/archive/2012/06/17/performance-implications-of-bundling-and-minification-on-http.aspx)通过[Henrik F Nielsen](http://en.wikipedia.org/wiki/Henrik_Frystyk_Nielsen)[@frystyk](https://twitter.com/frystyk)</span><span class="sxs-lookup"><span data-stu-id="0f28d-307">[Performance Implications of Bundling and Minification on Web Browsing](https://blogs.msdn.com/b/henrikn/archive/2012/06/17/performance-implications-of-bundling-and-minification-on-http.aspx) by [Henrik F Nielsen](http://en.wikipedia.org/wiki/Henrik_Frystyk_Nielsen) [@frystyk](https://twitter.com/frystyk)</span></span>
- <span data-ttu-id="0f28d-308">[使用 Cdn 和过期以提高网站性能](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)由 Rick Anderson[@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="0f28d-308">[Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx) by Rick Anderson [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)</span></span>
- [<span data-ttu-id="0f28d-309">最大程度减少 RTT （往返时间）</span><span class="sxs-lookup"><span data-stu-id="0f28d-309">Minimize RTT (round-trip times)</span></span>](https://developers.google.com/speed/docs/best-practices/rtt)

## <a name="contributors"></a><span data-ttu-id="0f28d-310">参与者</span><span class="sxs-lookup"><span data-stu-id="0f28d-310">Contributors</span></span>

- <span data-ttu-id="0f28d-311">Hao 永远</span><span class="sxs-lookup"><span data-stu-id="0f28d-311">Hao Kung</span></span>
- [<span data-ttu-id="0f28d-312">Howard Dierking</span><span class="sxs-lookup"><span data-stu-id="0f28d-312">Howard Dierking</span></span>](https://twitter.com/#!/howard_dierking)
- <span data-ttu-id="0f28d-313">Diana LaRose</span><span class="sxs-lookup"><span data-stu-id="0f28d-313">Diana LaRose</span></span>
