---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-vb
title: "检查事件与插入、 更新和删除 (VB) |Microsoft 文档"
author: rick-anderson
description: "在本教程中我们将检查使用发生之前、 之中以及之后插入的事件，更新或删除操作的 Web 控件的 ASP.NET 数据。 W..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/17/2006
ms.topic: article
ms.assetid: c9bd10a7-eff8-4d8c-bec9-963c2aef2d6e
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-vb
msc.type: authoredcontent
ms.openlocfilehash: 5daa9d1fe63e4ad8ec8c667f84de00fadd77fefa
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="examining-the-events-associated-with-inserting-updating-and-deleting-vb"></a><span data-ttu-id="cc8ec-104">检查与插入、 更新和删除 (VB) 关联的事件</span><span class="sxs-lookup"><span data-stu-id="cc8ec-104">Examining the Events Associated with Inserting, Updating, and Deleting (VB)</span></span>
====================
<span data-ttu-id="cc8ec-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="cc8ec-106">[下载示例应用程序](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_17_VB.exe)或[下载 PDF](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/datatutorial17vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-106">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_17_VB.exe) or [Download PDF](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/datatutorial17vb1.pdf)</span></span>

> <span data-ttu-id="cc8ec-107">在本教程中我们将检查使用发生之前、 之中以及之后插入的事件，更新或删除操作的 Web 控件的 ASP.NET 数据。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-107">In this tutorial we'll examine using the events that occur before, during, and after an insert, update, or delete operation of an ASP.NET data Web control.</span></span> <span data-ttu-id="cc8ec-108">我们将了解如何自定义编辑界面只更新产品字段的子集。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-108">We'll also see how to customize the editing interface to only update a subset of the product fields.</span></span>


## <a name="introduction"></a><span data-ttu-id="cc8ec-109">介绍</span><span class="sxs-lookup"><span data-stu-id="cc8ec-109">Introduction</span></span>

<span data-ttu-id="cc8ec-110">在使用内置插入、 编辑或删除功能的 GridView，说明如何或 FormView 控件时，各种步骤经过最终用户完成添加新记录或更新或删除现有记录的过程。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-110">When using the built-in inserting, editing, or deleting features of the GridView, DetailsView, or FormView controls, a variety of steps transpire when the end user completes the process of adding a new record or updating or deleting an existing record.</span></span> <span data-ttu-id="cc8ec-111">如我们所述[以前一教程](an-overview-of-inserting-updating-and-deleting-data-vb.md)，当在编辑按钮替换为更新和取消按钮并在文本框中 BoundFields 打开 GridView 中编辑行时。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-111">As we discussed in the [previous tutorial](an-overview-of-inserting-updating-and-deleting-data-vb.md), when a row is edited in the GridView the Edit button is replaced by Update and Cancel buttons and the BoundFields turn into TextBoxes.</span></span> <span data-ttu-id="cc8ec-112">最终用户更新的数据，并单击更新后，在回发时执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="cc8ec-112">After the end user updates the data and clicks Update, the following steps are performed on postback:</span></span>

1. <span data-ttu-id="cc8ec-113">GridView 填充其 ObjectDataSource`UpdateParameters`与已编辑的记录的唯一标识字段的记录 (通过`DataKeyNames`属性) 以及用户输入的值</span><span class="sxs-lookup"><span data-stu-id="cc8ec-113">The GridView populates its ObjectDataSource's `UpdateParameters` with the edited record's unique identifying field(s) (via the `DataKeyNames` property) along with the values entered by the user</span></span>
2. <span data-ttu-id="cc8ec-114">GridView 调用其 ObjectDataSource`Update()`方法，反过来调用基础对象中的相应方法 (`ProductsDAL.UpdateProduct`，我们以前一教程中)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-114">The GridView invokes its ObjectDataSource's `Update()` method, which in turn invokes the appropriate method in the underlying object (`ProductsDAL.UpdateProduct`, in our previous tutorial)</span></span>
3. <span data-ttu-id="cc8ec-115">基础数据，现在包含已更新的更改，是重新绑定到 GridView</span><span class="sxs-lookup"><span data-stu-id="cc8ec-115">The underlying data, which now includes the updated changes, is rebound to the GridView</span></span>

<span data-ttu-id="cc8ec-116">在这一序列的步骤，过程的数目的事件激发，使我们能够创建事件处理程序来添加自定义逻辑在需要时。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-116">During this sequence of steps, a number of events fire, enabling us to create event handlers to add custom logic where needed.</span></span> <span data-ttu-id="cc8ec-117">例如，在步骤 1，GridView 之前`RowUpdating`事件激发。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-117">For example, prior to Step 1, the GridView's `RowUpdating` event fires.</span></span> <span data-ttu-id="cc8ec-118">如果没有某些验证错误，我们此时，可以取消更新请求。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-118">We can, at this point, cancel the update request if there is some validation error.</span></span> <span data-ttu-id="cc8ec-119">当`Update()`调用方法时，ObjectDataSource`Updating`事件激发，提供机会添加或自定义的任一值`UpdateParameters`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-119">When the `Update()` method is invoked, the ObjectDataSource's `Updating` event fires, providing an opportunity to add or customize the values of any of the `UpdateParameters`.</span></span> <span data-ttu-id="cc8ec-120">对象的方法的基本 ObjectDataSource 后已完成执行，ObjectDataSource`Updated`引发事件。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-120">After the ObjectDataSource's underlying object's method has completed executing, the ObjectDataSource's `Updated` event is raised.</span></span> <span data-ttu-id="cc8ec-121">事件处理程序`Updated`事件可以查看有关更新操作，例如多少行受到影响，以及是否发生了异常详细信息。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-121">An event handler for the `Updated` event can inspect the details about the update operation, such as how many rows were affected and whether or not an exception occurred.</span></span> <span data-ttu-id="cc8ec-122">最后，在步骤 2，GridView 后`RowUpdated`事件激发; 检查执行只需更新操作的其他信息的事件处理程序会此事件。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-122">Finally, after Step 2, the GridView's `RowUpdated` event fires; an event handler for this event can examine additional information about the update operation just performed.</span></span>

<span data-ttu-id="cc8ec-123">图 1 所示更新 GridView 时这一系列的事件和步骤。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-123">Figure 1 depicts this series of events and steps when updating a GridView.</span></span> <span data-ttu-id="cc8ec-124">图 1 中的事件模式不是唯一的 GridView 使用更新的。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-124">The event pattern in Figure 1 is not unique to updating with a GridView.</span></span> <span data-ttu-id="cc8ec-125">插入、 更新或删除数据从 GridView，说明如何或 FormView precipitates 相同的数据的 Web 控件和对象数据源的复制前和后级别事件序列。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-125">Inserting, updating, or deleting data from the GridView, DetailsView, or FormView precipitates the same sequence of pre- and post-level events for both the data Web control and the ObjectDataSource.</span></span>


<span data-ttu-id="cc8ec-126">[![A 系列的预和后期事件激发时在 GridView 中更新数据](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image2.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-126">[![A Series of Pre- and Post-Events Fire When Updating Data in a GridView](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image2.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image1.png)</span></span>

<span data-ttu-id="cc8ec-127">**图 1**: A 系列的复制前和后事件激发时更新中的数据 GridView ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-127">**Figure 1**: A Series of Pre- and Post-Events Fire When Updating Data in a GridView ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image3.png))</span></span>


<span data-ttu-id="cc8ec-128">在本教程中我们将检查使用这些事件来扩展内置的插入、 更新和删除功能的 ASP.NET 数据 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-128">In this tutorial we'll examine using these events to extend the built-in inserting, updating, and deleting capabilities of the ASP.NET data Web controls.</span></span> <span data-ttu-id="cc8ec-129">我们将了解如何自定义编辑界面只更新产品字段的子集。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-129">We'll also see how to customize the editing interface to only update a subset of the product fields.</span></span>

## <a name="step-1-updating-a-productsproductnameandunitpricefields"></a><span data-ttu-id="cc8ec-130">步骤 1： 更新产品的`ProductName`和`UnitPrice`字段</span><span class="sxs-lookup"><span data-stu-id="cc8ec-130">Step 1: Updating a Product's`ProductName`and`UnitPrice`Fields</span></span>

<span data-ttu-id="cc8ec-131">在从以前的教程，编辑接口*所有*产品不是只读的具有要包含的字段。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-131">In the editing interfaces from the previous tutorial *all* product fields that were not read-only had to be included.</span></span> <span data-ttu-id="cc8ec-132">如果要 GridView-从中删除字段说`QuantityPerUnit`-当更新数据 Web 控件的数据不会设置 ObjectDataSource `QuantityPerUnit` `UpdateParameters`值。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-132">If we were to remove a field from the GridView - say `QuantityPerUnit` - when updating the data the data Web control would not set the ObjectDataSource's `QuantityPerUnit` `UpdateParameters` value.</span></span> <span data-ttu-id="cc8ec-133">中的一个值然后传递 ObjectDataSource`Nothing`到`UpdateProduct`业务逻辑层 (BLL) 方法，更改编辑的数据库记录`QuantityPerUnit`列`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-133">The ObjectDataSource would then pass in a value of `Nothing` into the `UpdateProduct` Business Logic Layer (BLL) method, which would change the edited database record's `QuantityPerUnit` column to a `NULL` value.</span></span> <span data-ttu-id="cc8ec-134">同样，如果必填字段，如`ProductName`，删除在编辑界面上，更新将失败并"*列 ProductName 不允许使用 null*"异常。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-134">Similarly, if a required field, such as `ProductName`, is removed from the editing interface, the update will fail with a "*Column 'ProductName' does not allow nulls*" exception.</span></span> <span data-ttu-id="cc8ec-135">此行为的原因是因为配置 ObjectDataSource 调用`ProductsBLL`类的`UpdateProduct`方法，应为每个产品字段输入的参数。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-135">The reason for this behavior was because the ObjectDataSource was configured to call the `ProductsBLL` class's `UpdateProduct` method, which expected an input parameter for each of the product fields.</span></span> <span data-ttu-id="cc8ec-136">因此，ObjectDataSource 的`UpdateParameters`集合包含一个参数，为每个方法的输入参数。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-136">Therefore, the ObjectDataSource's `UpdateParameters` collection contained a parameter for each of the method's input parameters.</span></span>

<span data-ttu-id="cc8ec-137">如果我们想要提供数据 Web 控件，最终用户可以仅更新字段的子集，则我们需要以编程方式设置缺失`UpdateParameters`ObjectDataSource 的中值`Updating`事件处理程序或创建和调用 BLL 方法需要字段的一个子集。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-137">If we want to provide a data Web control that allows the end user to only update a subset of fields, then we need to either programmatically set the missing `UpdateParameters` values in the ObjectDataSource's `Updating` event handler or create and call a BLL method that expects only a subset of the fields.</span></span> <span data-ttu-id="cc8ec-138">让我们了解此后一种方法。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-138">Let's explore this latter approach.</span></span>

<span data-ttu-id="cc8ec-139">具体而言，让我们创建显示的页面仅`ProductName`和`UnitPrice`中可编辑的 GridView 的字段。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-139">Specifically, let's create a page that displays just the `ProductName` and `UnitPrice` fields in an editable GridView.</span></span> <span data-ttu-id="cc8ec-140">此 GridView 编辑界面将只允许要更新两个显示的字段的用户`ProductName`和`UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-140">This GridView's editing interface will only allow the user to update the two displayed fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="cc8ec-141">由于此编辑接口仅提供产品的字段的子集，我们需要创建使用现有 BLL ObjectDataSource`UpdateProduct`方法和具有缺少产品字段值设置以编程方式在其`Updating`事件处理程序，或者我们需要创建一个新的 BLL 方法需要仅在 GridView 中定义的字段的子集。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-141">Since this editing interface only provides a subset of a product's fields, we either need to create an ObjectDataSource that uses the existing BLL's `UpdateProduct` method and has the missing product field values set programmatically in its `Updating` event handler, or we need to create a new BLL method that expects only the subset of fields defined in the GridView.</span></span> <span data-ttu-id="cc8ec-142">对于本教程，让我们使用后一个选项，创建的重载`UpdateProduct`方法，只需三个输入参数采用的一个： `productName`， `unitPrice`，和`productID`:</span><span class="sxs-lookup"><span data-stu-id="cc8ec-142">For this tutorial, let's use the latter option and create an overload of the `UpdateProduct` method, one that takes in just three input parameters: `productName`, `unitPrice`, and `productID`:</span></span>


[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample1.vb)]

<span data-ttu-id="cc8ec-143">如原始`UpdateProduct`方法，此重载会启动通过检查具有指定数据库中是否存在产品`ProductID`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-143">Like the original `UpdateProduct` method, this overload starts by checking to see if there is a product in the database with the specified `ProductID`.</span></span> <span data-ttu-id="cc8ec-144">如果不是，它返回`False`，即指示该更新的产品信息的请求失败。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-144">If not, it returns `False`, indicating that the request to update the product information failed.</span></span> <span data-ttu-id="cc8ec-145">否则它会更新现有产品记录的`ProductName`和`UnitPrice`相应字段，并通过调用 TableAdpater 的提交更新`Update()`方法，同时传入`ProductsRow`实例。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-145">Otherwise it updates the existing product record's `ProductName` and `UnitPrice` fields accordingly and commits the update by calling the TableAdpater's `Update()` method, passing in the `ProductsRow` instance.</span></span>

<span data-ttu-id="cc8ec-146">添加到此元素我们`ProductsBLL`类，我们已准备好创建简化的 GridView 接口。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-146">With this addition to our `ProductsBLL` class, we're ready to create the simplified GridView interface.</span></span> <span data-ttu-id="cc8ec-147">打开`DataModificationEvents.aspx`中`EditInsertDelete`文件夹和向页面添加一个 GridView。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-147">Open the `DataModificationEvents.aspx` in the `EditInsertDelete` folder and add a GridView to the page.</span></span> <span data-ttu-id="cc8ec-148">创建新对象数据源并将其配置为使用`ProductsBLL`类，该类具有其`Select()`方法映射到`GetProducts`及其`Update()`方法映射到`UpdateProduct`重载只使用在`productName`， `unitPrice`，和`productID`输入参数。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-148">Create a new ObjectDataSource and configure it to use the `ProductsBLL` class with its `Select()` method mapping to `GetProducts` and its `Update()` method mapping to the `UpdateProduct` overload that takes in only the `productName`, `unitPrice`, and `productID` input parameters.</span></span> <span data-ttu-id="cc8ec-149">图 2 显示了创建数据源向导，映射 ObjectDataSource 时`Update()`方法`ProductsBLL`类的新`UpdateProduct`方法重载。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-149">Figure 2 shows the Create Data Source wizard when mapping the ObjectDataSource's `Update()` method to the `ProductsBLL` class's new `UpdateProduct` method overload.</span></span>


<span data-ttu-id="cc8ec-150">[![将对象数据源的 update （） 方法映射到新的 UpdateProduct 重载](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image5.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-150">[![Map the ObjectDataSource's Update() Method to the New UpdateProduct Overload](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image5.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image4.png)</span></span>

<span data-ttu-id="cc8ec-151">**图 2**： 映射 ObjectDataSource`Update()`方法新建`UpdateProduct`重载 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-151">**Figure 2**: Map the ObjectDataSource's `Update()` Method to the New `UpdateProduct` Overload ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image6.png))</span></span>


<span data-ttu-id="cc8ec-152">由于我们的示例最初只需要编辑数据，但不是能插入或删除记录的功能，花一些时间，则显式指示 ObjectDataSource`Insert()`和`Delete()`方法不应映射到任何`ProductsBLL`通过转到插入和删除选项卡并从下拉列表中选择 （无） 的类的方法。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-152">Since our example will initially just need the ability to edit data, but not to insert or delete records, take a moment to explicitly indicate that the ObjectDataSource's `Insert()` and `Delete()` methods shouldn't be mapped to any of the `ProductsBLL` class's methods by going to the INSERT and DELETE tabs and choosing (None) from the drop-down list.</span></span>


<span data-ttu-id="cc8ec-153">[![从的插入和删除选项卡的下拉列表中选择 （无）](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image8.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-153">[![Choose (None) From the Drop-Down List for the INSERT and DELETE Tabs](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image8.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image7.png)</span></span>

<span data-ttu-id="cc8ec-154">**图 3**： 选择 （无） 从下拉列表中对插入和删除选项卡 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-154">**Figure 3**: Choose (None) From the Drop-Down List for the INSERT and DELETE Tabs ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image9.png))</span></span>


<span data-ttu-id="cc8ec-155">完成此向导后检查从 GridView 的智能标记启用编辑复选框。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-155">After completing this wizard check the Enable Editing checkbox from the GridView's smart tag.</span></span>

<span data-ttu-id="cc8ec-156">创建数据源向导和绑定到 GridView 完成时，Visual Studio 创建了两个控件的声明性语法。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-156">With the completion of the Create Data Source wizard and binding that to the GridView, Visual Studio has created the declarative syntax for both controls.</span></span> <span data-ttu-id="cc8ec-157">请转到源视图以检查对象数据源的声明性标记，其如下所示：</span><span class="sxs-lookup"><span data-stu-id="cc8ec-157">Go to the Source view to inspect the ObjectDataSource's declarative markup, which is shown below:</span></span>


[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample2.aspx)]

<span data-ttu-id="cc8ec-158">因为不不存在的对象数据源的任何映射`Insert()`和`Delete()`方法，有没有`InsertParameters`或`DeleteParameters`部分。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-158">Since there are no mappings for the ObjectDataSource's `Insert()` and `Delete()` methods, there are no `InsertParameters` or `DeleteParameters` sections.</span></span> <span data-ttu-id="cc8ec-159">此外，由于`Update()`方法映射到`UpdateProduct`仅接受三个输入的参数的方法重载`UpdateParameters`部分具有只使用三`Parameter`实例。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-159">Furthermore, since the `Update()` method is mapped to the `UpdateProduct` method overload that only accepts three input parameters, the `UpdateParameters` section has just three `Parameter` instances.</span></span>

<span data-ttu-id="cc8ec-160">请注意，ObjectDataSource`OldValuesParameterFormatString`属性设置为`original_{0}`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-160">Note that the ObjectDataSource's `OldValuesParameterFormatString` property is set to `original_{0}`.</span></span> <span data-ttu-id="cc8ec-161">使用配置数据源向导时，此属性将由 Visual Studio 自动进行设置。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-161">This property is set automatically by Visual Studio when using the Configure Data Source wizard.</span></span> <span data-ttu-id="cc8ec-162">但是，由于我们 BLL 方法不需要原始`ProductID`要中传递，从 ObjectDataSource 的声明性语法中完全删除此属性分配值。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-162">However, since our BLL methods don't expect the original `ProductID` value to be passed in, remove this property assignment altogether from the ObjectDataSource's declarative syntax.</span></span>

> [!NOTE]
> <span data-ttu-id="cc8ec-163">如果你只需清除`OldValuesParameterFormatString`于在设计视图中，该属性的属性窗口的属性值将仍然存在于声明性语法，但将设置为一个空字符串。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-163">If you simply clear out the `OldValuesParameterFormatString` property value from the Properties window in the Design view, the property will still exist in the declarative syntax, but will be set to an empty string.</span></span> <span data-ttu-id="cc8ec-164">删除属性完全声明性语法，或从属性窗口中，将值设置为默认情况下， `{0}`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-164">Either remove the property altogether from the declarative syntax or, from the Properties window, set the value to the default, `{0}`.</span></span>


<span data-ttu-id="cc8ec-165">虽然 ObjectDataSource 只有`UpdateParameters`有关产品的名称、 价格和 ID，Visual Studio 添加了 BoundField 或 CheckBoxField GridView 中用于每个产品的字段。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-165">While the ObjectDataSource only has `UpdateParameters` for the product's name, price, and ID, Visual Studio has added a BoundField or CheckBoxField in the GridView for each of the product's fields.</span></span>


<span data-ttu-id="cc8ec-166">[![GridView 对于每个产品的字段包含 BoundField 或 CheckBoxField](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image11.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-166">[![The GridView Contains a BoundField or CheckBoxField for Each of the Product's Fields](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image11.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image10.png)</span></span>

<span data-ttu-id="cc8ec-167">**图 4**: GridView 对于每个产品的字段包含 BoundField 或 CheckBoxField ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-167">**Figure 4**: The GridView Contains a BoundField or CheckBoxField for Each of the Product's Fields ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image12.png))</span></span>


<span data-ttu-id="cc8ec-168">当最终用户编辑产品，并单击其更新按钮时，GridView 枚举这些字段不是只读的。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-168">When the end user edits a product and clicks its Update button, the GridView enumerates those fields that were not read-only.</span></span> <span data-ttu-id="cc8ec-169">然后将相应的参数的值设置 ObjectDataSource`UpdateParameters`为用户输入的值的集合。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-169">It then sets the value of the corresponding parameter in the ObjectDataSource's `UpdateParameters` collection to the value entered by the user.</span></span> <span data-ttu-id="cc8ec-170">如果没有相应的参数，GridView 将添加到集合的一个。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-170">If there is not a corresponding parameter, the GridView adds one to the collection.</span></span> <span data-ttu-id="cc8ec-171">因此，如果我们 GridView 包含 BoundFields 和 CheckBoxFields 所有产品的字段，ObjectDataSource 将结束调用`UpdateProduct`重载采用在所有这些参数的情况下，ObjectDataSource声明性标记指定 （请参见图 5） 的仅三个输入的参数。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-171">Therefore, if our GridView contains BoundFields and CheckBoxFields for all of the product's fields, the ObjectDataSource will end up invoking the `UpdateProduct` overload that takes in all of these parameters, despite the fact that the ObjectDataSource's declarative markup specifies only three input parameters (see Figure 5).</span></span> <span data-ttu-id="cc8ec-172">同样，如果没有非只读的某种组合产品字段中都不对应的输入参数 GridView`UpdateProduct`超负荷运转，当尝试进行更新时，将引发异常。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-172">Similarly, if there is some combination of non-read-only product fields in the GridView that doesn't correspond to the input parameters for a `UpdateProduct` overload, an exception will be raised when attempting to update.</span></span>


<span data-ttu-id="cc8ec-173">[![GridView 将将参数添加到对象数据源的 UpdateParameters 集合](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image14.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-173">[![The GridView Will Add Parameters to the ObjectDataSource's UpdateParameters Collection](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image14.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image13.png)</span></span>

<span data-ttu-id="cc8ec-174">**图 5**: GridView 将添加参数以 ObjectDataSource`UpdateParameters`集合 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-174">**Figure 5**: The GridView Will Add Parameters to the ObjectDataSource's `UpdateParameters` Collection ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image15.png))</span></span>


<span data-ttu-id="cc8ec-175">若要确保 ObjectDataSource 调用`UpdateProduct`中只是该产品的名称、 价格和 ID，采用重载我们需要使其可编辑字段限制 GridView 仅`ProductName`和`UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-175">To ensure that the ObjectDataSource invokes the `UpdateProduct` overload that takes in just the product's name, price, and ID, we need to restrict the GridView to having editable fields for just the `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="cc8ec-176">这可以通过删除其他 BoundFields 和 CheckBoxFields，通过设置这些其他字段的`ReadOnly`属性`True`，或通过两个的某种组合。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-176">This can be accomplished by removing the other BoundFields and CheckBoxFields, by setting those other fields' `ReadOnly` property to `True`, or by some combination of the two.</span></span> <span data-ttu-id="cc8ec-177">对于本教程让我们只需删除之外的所有 GridView 字段`ProductName`和`UnitPrice`BoundFields，此后 GridView 的声明性标记将如下所示：</span><span class="sxs-lookup"><span data-stu-id="cc8ec-177">For this tutorial let's simply remove all GridView fields except the `ProductName` and `UnitPrice` BoundFields, after which the GridView's declarative markup will look like:</span></span>


[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample3.aspx)]

<span data-ttu-id="cc8ec-178">即使`UpdateProduct`重载需要三个输入的参数，我们在我们 GridView 中只能有两个 BoundFields。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-178">Even though the `UpdateProduct` overload expects three input parameters, we only have two BoundFields in our GridView.</span></span> <span data-ttu-id="cc8ec-179">这是因为`productID`输入的参数是主键值，在传递的值`DataKeyNames`编辑过的行的属性。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-179">This is because the `productID` input parameter is a primary key value and passed in through the value of the `DataKeyNames` property for the edited row.</span></span>

<span data-ttu-id="cc8ec-180">我们 GridView，连同`UpdateProduct`重载，允许用户而不丢失任何其他产品字段的编辑仅的名称和产品价格。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-180">Our GridView, along with the `UpdateProduct` overload, allows a user to edit just the name and price of a product without losing any of the other product fields.</span></span>


<span data-ttu-id="cc8ec-181">[![接口允许编辑只是该产品的名称和价格](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image17.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-181">[![The Interface Allows Editing Just the Product's Name and Price](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image17.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image16.png)</span></span>

<span data-ttu-id="cc8ec-182">**图 6**： 编辑只是该产品的名称和价格接口允许 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-182">**Figure 6**: The Interface Allows Editing Just the Product's Name and Price ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image18.png))</span></span>


> [!NOTE]
> <span data-ttu-id="cc8ec-183">如前面的教程中所述，是极其重要的 GridView 的视图状态是启用 （默认行为）。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-183">As discussed in the previous tutorial, it is vitally important that the GridView s view state be enabled (the default behavior).</span></span> <span data-ttu-id="cc8ec-184">如果设置 GridView s`EnableViewState`属性`false`，运行出现无意中删除或编辑记录的并发用户的风险。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-184">If you set the GridView s `EnableViewState` property to `false`, you run the risk of having concurrent users unintentionally deleting or editing records.</span></span> <span data-ttu-id="cc8ec-185">请参阅[警告： 禁用并发问题与 ASP.NET 2.0 GridViews/说明/FormViews 该支持编辑和/或删除和其视图状态](http://scottonwriting.net/sowblog/posts/10054.aspx)有关详细信息。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-185">See [WARNING: Concurrency Issue with ASP.NET 2.0 GridViews/DetailsView/FormViews that Support Editing and/or Deleting and Whose View State is Disabled](http://scottonwriting.net/sowblog/posts/10054.aspx) for more information.</span></span>


## <a name="improving-theunitpriceformatting"></a><span data-ttu-id="cc8ec-186">提高`UnitPrice`格式设置</span><span class="sxs-lookup"><span data-stu-id="cc8ec-186">Improving the`UnitPrice`Formatting</span></span>

<span data-ttu-id="cc8ec-187">尽管图 6 工作原理中, 所示的 GridView 示例`UnitPrice`字段的格式不根本，导致缺少任何货币价格显示符号和具有四个小数位。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-187">While the GridView example shown in Figure 6 works, the `UnitPrice` field is not formatted at all, resulting in a price display that lacks any currency symbols and has four decimal places.</span></span> <span data-ttu-id="cc8ec-188">若要应用一种货币格式不可编辑的行，只需设置`UnitPrice`BoundField 的`DataFormatString`属性`{0:c}`及其`HtmlEncode`属性`False`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-188">To apply a currency formatting for the non-editable rows, simply set the `UnitPrice` BoundField's `DataFormatString` property to `{0:c}` and its `HtmlEncode` property to `False`.</span></span>


<span data-ttu-id="cc8ec-189">[![相应地设置单价的数据和 HtmlEncode 属性](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image20.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-189">[![Set the UnitPrice's DataFormatString and HtmlEncode Properties Accordingly](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image20.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image19.png)</span></span>

<span data-ttu-id="cc8ec-190">**图 7**： 设置`UnitPrice`的`DataFormatString`和`HtmlEncode`相应属性 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-190">**Figure 7**: Set the `UnitPrice`'s `DataFormatString` and `HtmlEncode` Properties Accordingly ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image21.png))</span></span>


<span data-ttu-id="cc8ec-191">进行此更改后，不可编辑的行设置价格的格式为货币;编辑过的行，但是，仍会显示的货币符号而无需有四个小数位数的值。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-191">With this change, the non-editable rows format the price as a currency; the edited row, however, still displays the value without the currency symbol and with four decimal places.</span></span>


<span data-ttu-id="cc8ec-192">[![非可编辑的行是现进行格式设置为货币值](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image23.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-192">[![The Non-Editable Rows are Now Formatted as Currency Values](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image23.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image22.png)</span></span>

<span data-ttu-id="cc8ec-193">**图 8**: 非可编辑的行是现在格式化为货币值 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-193">**Figure 8**: The Non-Editable Rows are Now Formatted as Currency Values ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image24.png))</span></span>


<span data-ttu-id="cc8ec-194">中指定的格式设置说明`DataFormatString`属性可以通过设置 BoundField 应用于编辑接口`ApplyFormatInEditMode`属性`True`(默认值是`False`)。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-194">The formatting instructions specified in the `DataFormatString` property can be applied to the editing interface by setting the BoundField's `ApplyFormatInEditMode` property to `True` (the default is `False`).</span></span> <span data-ttu-id="cc8ec-195">花些时间将此属性设置为`True`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-195">Take a moment to set this property to `True`.</span></span>


<span data-ttu-id="cc8ec-196">[![UnitPrice BoundField ApplyFormatInEditMode 属性设置为 True](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image26.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-196">[![Set the UnitPrice BoundField's ApplyFormatInEditMode property to True](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image26.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image25.png)</span></span>

<span data-ttu-id="cc8ec-197">**图 9**： 设置`UnitPrice`BoundField 的`ApplyFormatInEditMode`属性`True`([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-197">**Figure 9**: Set the `UnitPrice` BoundField's `ApplyFormatInEditMode` property to `True` ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image27.png))</span></span>


<span data-ttu-id="cc8ec-198">进行此更改后，值`UnitPrice`显示在编辑行也设置为货币的格式。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-198">With this change, the value of the `UnitPrice` displayed in the edited row is also formatted as a currency.</span></span>


<span data-ttu-id="cc8ec-199">[![编辑行的单价值是现在格式的作为一种货币](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image29.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-199">[![The Edited Row's UnitPrice Value is Now Formatted as a Currency](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image29.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image28.png)</span></span>

<span data-ttu-id="cc8ec-200">**图 10**: 编辑行`UnitPrice`值现在格式化为货币 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-200">**Figure 10**: The Edited Row's `UnitPrice` Value is Now Formatted as a Currency ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image30.png))</span></span>


<span data-ttu-id="cc8ec-201">但是，在文本框中的货币符号与更新产品，如 $19.00 引发`FormatException`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-201">However, updating a product with the currency symbol in the textbox such as $19.00 throws a `FormatException`.</span></span> <span data-ttu-id="cc8ec-202">当尝试将用户提供的值分配给对象数据源的 GridView`UpdateParameters`集合无法转换`UnitPrice`到字符串"$19.00"`Decimal`为参数要求 （请参阅图 11）。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-202">When the GridView attempts to assign the user-supplied values to the ObjectDataSource's `UpdateParameters` collection it is unable to convert the `UnitPrice` string "$19.00" into the `Decimal` required by the parameter (see Figure 11).</span></span> <span data-ttu-id="cc8ec-203">若要纠正此我们可以为 GridView 创建事件处理程序`RowUpdating`事件，并将其分析用户提供`UnitPrice`作为货币格式`Decimal`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-203">To remedy this we can create an event handler for the GridView's `RowUpdating` event and have it parse the user-supplied `UnitPrice` as a currency-formatted `Decimal`.</span></span>

<span data-ttu-id="cc8ec-204">GridView`RowUpdating`接受作为其第二个参数类型的对象的事件[GridViewUpdateEventArgs](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridviewupdateeventargs(VS.80).aspx)，其中包括`NewValues`作为包含的用户提供的值可供其属性之一的字典分配给 ObjectDataSource`UpdateParameters`集合。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-204">The GridView's `RowUpdating` event accepts as its second parameter an object of type [GridViewUpdateEventArgs](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridviewupdateeventargs(VS.80).aspx), which includes a `NewValues` dictionary as one of its properties that holds the user-supplied values ready to be assigned to the ObjectDataSource's `UpdateParameters` collection.</span></span> <span data-ttu-id="cc8ec-205">我们可以覆盖现有`UnitPrice`中的值`NewValues`十进制值集合分析用以下行中的代码使用货币格式`RowUpdating`事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="cc8ec-205">We can overwrite the existing `UnitPrice` value in the `NewValues` collection with a decimal value parsed using the currency format with the following lines of code in the `RowUpdating` event handler:</span></span>


[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample4.vb)]

<span data-ttu-id="cc8ec-206">如果用户已提供`UnitPrice`值 （如"$19.00") 与计算出的十进制值会覆盖了此值[Decimal.Parse](https://msdn.microsoft.com/en-us/library/system.decimal.parse(VS.80).aspx)，分析作为一种货币值。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-206">If the user has supplied a `UnitPrice` value (such as "$19.00"), this value is overwritten with the decimal value computed by [Decimal.Parse](https://msdn.microsoft.com/en-us/library/system.decimal.parse(VS.80).aspx), parsing the value as a currency.</span></span> <span data-ttu-id="cc8ec-207">这将正确分析小数点发生任何货币符号、 逗号、 小数点、 和等等，并使用[NumberStyles 枚举](https://msdn.microsoft.com/en-US/library/system.globalization.numberstyles(VS.80).aspx)中[System.Globalization](https://msdn.microsoft.com/en-US/library/abeh092z(VS.80).aspx)命名空间。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-207">This will correctly parse the decimal in the event of any currency symbols, commas, decimal points, and so on, and uses the [NumberStyles enumeration](https://msdn.microsoft.com/en-US/library/system.globalization.numberstyles(VS.80).aspx) in the [System.Globalization](https://msdn.microsoft.com/en-US/library/abeh092z(VS.80).aspx) namespace.</span></span>

<span data-ttu-id="cc8ec-208">图 11 显示这两个问题引起的中的用户提供的货币符号`UnitPrice`，以及如何 GridView`RowUpdating`事件处理程序可以利用为了正确分析这类输入。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-208">Figure 11 shows both the problem caused by currency symbols in the user-supplied `UnitPrice`, along with how the GridView's `RowUpdating` event handler can be utilized to correctly parse such input.</span></span>


<span data-ttu-id="cc8ec-209">[![编辑行的单价值是现在格式的作为一种货币](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image32.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-209">[![The Edited Row's UnitPrice Value is Now Formatted as a Currency](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image32.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image31.png)</span></span>

<span data-ttu-id="cc8ec-210">**图 11**: 编辑行`UnitPrice`值现在格式化为货币 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-210">**Figure 11**: The Edited Row's `UnitPrice` Value is Now Formatted as a Currency ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image33.png))</span></span>


## <a name="step-2-prohibitingnull-unitprices"></a><span data-ttu-id="cc8ec-211">步骤 2： 禁止`NULL UnitPrices`</span><span class="sxs-lookup"><span data-stu-id="cc8ec-211">Step 2: Prohibiting`NULL UnitPrices`</span></span>

<span data-ttu-id="cc8ec-212">尽管数据库配置为允许`NULL`中值`Products`表的`UnitPrice`列中，我们可能想要阻止用户访问此特定页，指定从`NULL``UnitPrice`值。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-212">While the database is configured to allow `NULL` values in the `Products` table's `UnitPrice` column, we may want to prevent users visiting this particular page from specifying a `NULL` `UnitPrice` value.</span></span> <span data-ttu-id="cc8ec-213">也就是说，如果用户无法输入`UnitPrice`时编辑产品行的值，而不是将结果保存到数据库我们想要显示一条消息，通知用户，通过此页上，编辑的任何产品必须具有指定的价格。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-213">That is, if a user fails to enter a `UnitPrice` value when editing a product row, rather than save the results to the database we want to display a message informing the user that, through this page, any edited products must have a price specified.</span></span>

<span data-ttu-id="cc8ec-214">`GridViewUpdateEventArgs`对象传递到的 GridView`RowUpdating`事件处理程序包含`Cancel`属性，如果设置为`True`，终止更新程序。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-214">The `GridViewUpdateEventArgs` object passed into the GridView's `RowUpdating` event handler contains a `Cancel` property that, if set to `True`, terminates the updating process.</span></span> <span data-ttu-id="cc8ec-215">让我们扩展`RowUpdating`事件处理程序来设置`e.Cancel`到`True`并显示一条消息说明原因，如果`UnitPrice`中的值`NewValues`集合包含的值`Nothing`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-215">Let's extend the `RowUpdating` event handler to set `e.Cancel` to `True` and display a message explaining why if the `UnitPrice` value in the `NewValues` collection has a value of `Nothing`.</span></span>

<span data-ttu-id="cc8ec-216">通过将标签 Web 控件添加到名为的页启动`MustProvideUnitPriceMessage`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-216">Start by adding a Label Web control to the page named `MustProvideUnitPriceMessage`.</span></span> <span data-ttu-id="cc8ec-217">如果用户无法指定，将会显示此标签控件`UnitPrice`值更新产品时。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-217">This Label control will be displayed if the user fails to specify a `UnitPrice` value when updating a product.</span></span> <span data-ttu-id="cc8ec-218">设置标签的`Text`属性设置为"你必须提供价格的产品。"</span><span class="sxs-lookup"><span data-stu-id="cc8ec-218">Set the Label's `Text` property to "You must provide a price for the product."</span></span> <span data-ttu-id="cc8ec-219">我还创建了新 CSS 类中的`Styles.css`名为`Warning`替换为以下定义：</span><span class="sxs-lookup"><span data-stu-id="cc8ec-219">I've also created a new CSS class in `Styles.css` named `Warning` with the following definition:</span></span>


[!code-css[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample5.css)]

<span data-ttu-id="cc8ec-220">最后，设置标签的`CssClass`属性`Warning`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-220">Finally, set the Label's `CssClass` property to `Warning`.</span></span> <span data-ttu-id="cc8ec-221">此时设计器应显示以红色、 粗体、 斜体显示的警告消息、 特大型字体大小超出 GridView，如图 12 中所示。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-221">At this point the Designer should show the warning message in a red, bold, italic, extra large font size above the GridView, as shown in Figure 12.</span></span>


<span data-ttu-id="cc8ec-222">[![上面 GridView 中添加标签](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image35.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-222">[![A Label Has Been Added Above the GridView](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image35.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image34.png)</span></span>

<span data-ttu-id="cc8ec-223">**图 12**: 标签具有已添加上面 GridView ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-223">**Figure 12**: A Label Has Been Added Above the GridView ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image36.png))</span></span>


<span data-ttu-id="cc8ec-224">默认情况下，此标签应被隐藏，因此设置其`Visible`属性`False`中`Page_Load`事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="cc8ec-224">By default, this Label should be hidden, so set its `Visible` property to `False` in the `Page_Load` event handler:</span></span>


[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample6.vb)]

<span data-ttu-id="cc8ec-225">如果用户尝试将产品更新而无需指定`UnitPrice`，我们想要取消更新并显示警告标签。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-225">If the user attempts to update a product without specifying the `UnitPrice`, we want to cancel the update and display the warning label.</span></span> <span data-ttu-id="cc8ec-226">增加 GridView`RowUpdating`事件处理程序，如下所示：</span><span class="sxs-lookup"><span data-stu-id="cc8ec-226">Augment the GridView's `RowUpdating` event handler as follows:</span></span>


[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample7.vb)]

<span data-ttu-id="cc8ec-227">如果用户尝试保存产品而无需指定价格，更新会取消并会显示很有帮助的消息。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-227">If a user attempts to save a product without specifying a price, the update is cancelled and a helpful message is displayed.</span></span> <span data-ttu-id="cc8ec-228">而在数据库 （和业务逻辑） 允许`NULL` `UnitPrice` s，此特定的 ASP.NET 页却没有。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-228">While the database (and business logic) allows for `NULL` `UnitPrice` s, this particular ASP.NET page does not.</span></span>


<span data-ttu-id="cc8ec-229">[![用户不能离开单价保留为空白](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image38.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-229">[![A User Cannot Leave UnitPrice Blank](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image38.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image37.png)</span></span>

<span data-ttu-id="cc8ec-230">**图 13**: 用户不能离开`UnitPrice`空白 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-230">**Figure 13**: A User Cannot Leave `UnitPrice` Blank ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image39.png))</span></span>


<span data-ttu-id="cc8ec-231">到目前为止，我们已了解如何使用 GridView`RowUpdating`事件以编程方式更改分配给对象数据源的参数值`UpdateParameters`集合以及如何取消更新处理完全。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-231">So far we have seen how to use the GridView's `RowUpdating` event to programmatically alter the parameter values assigned to the ObjectDataSource's `UpdateParameters` collection as well as how to cancel the updating process altogether.</span></span> <span data-ttu-id="cc8ec-232">这些概念会延续到说明和 FormView 控件和也适用于插入和删除。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-232">These concepts carry over to the DetailsView and FormView controls and also apply to inserting and deleting.</span></span>

<span data-ttu-id="cc8ec-233">也可以在对象数据源级别事件处理程序通过执行这些任务其`Inserting`， `Updating`，和`Deleting`事件。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-233">These tasks can also be done at the ObjectDataSource level through event handlers for its `Inserting`, `Updating`, and `Deleting` events.</span></span> <span data-ttu-id="cc8ec-234">这些事件激发之前调用的基础对象的关联的方法，并提供上一次机会机会来修改输入的参数集合，或者取消迫切地操作。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-234">These events fire before the associated method of the underlying object is invoked and provide a last-chance opportunity to modify the input parameters collection or cancel the operation outright.</span></span> <span data-ttu-id="cc8ec-235">这三个事件的事件处理程序传递的类型对象[ObjectDataSourceMethodEventArgs](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs(VS.80).aspx)具有两个相关属性：</span><span class="sxs-lookup"><span data-stu-id="cc8ec-235">The event handlers for these three events are passed an object of type [ObjectDataSourceMethodEventArgs](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs(VS.80).aspx) that has two properties of interest:</span></span>

- <span data-ttu-id="cc8ec-236">[取消](https://msdn.microsoft.com/en-US/library/system.componentmodel.canceleventargs.cancel(VS.80).aspx)，后者，如果设置为`True`，取消正在执行的操作</span><span class="sxs-lookup"><span data-stu-id="cc8ec-236">[Cancel](https://msdn.microsoft.com/en-US/library/system.componentmodel.canceleventargs.cancel(VS.80).aspx), which, if set to `True`, cancels the operation being performed</span></span>
- <span data-ttu-id="cc8ec-237">[输入参数](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs.inputparameters(VS.80).aspx)，这是集合的`InsertParameters`， `UpdateParameters`，或`DeleteParameters`，具体取决于事件处理程序是否为`Inserting`， `Updating`，或`Deleting`事件</span><span class="sxs-lookup"><span data-stu-id="cc8ec-237">[InputParameters](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs.inputparameters(VS.80).aspx), which is the collection of `InsertParameters`, `UpdateParameters`, or `DeleteParameters`, depending on whether the event handler is for the `Inserting`, `Updating`, or `Deleting` event</span></span>

<span data-ttu-id="cc8ec-238">为了说明使用对象数据源级别的参数值，让我们在我们的页面，用户可添加新的产品中包含说明如何。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-238">To illustrate working with the parameter values at the ObjectDataSource level, let's include a DetailsView in our page that allows the users to add a new product.</span></span> <span data-ttu-id="cc8ec-239">此说明如何将用于提供用于将新产品快速添加到数据库的接口。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-239">This DetailsView will be used to provide an interface for quickly adding a new product to the database.</span></span> <span data-ttu-id="cc8ec-240">若要在添加新的产品，让我们允许用户只需输入的值时保持一致的用户界面`ProductName`和`UnitPrice`字段。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-240">To keep a consistent user interface when adding a new product let's allow the user to only enter values for the `ProductName` and `UnitPrice` fields.</span></span> <span data-ttu-id="cc8ec-241">默认情况下，在说明的插入接口中不提供这些值将设置为`NULL`数据库值。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-241">By default, those values that aren't supplied in the DetailsView's inserting interface will be set to a `NULL` database value.</span></span> <span data-ttu-id="cc8ec-242">但是，我们可以使用对象数据源的`Inserting`以插入不同的默认值，正如我们很快将看到的事件。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-242">However, we can use the ObjectDataSource's `Inserting` event to inject different default values, as we'll see shortly.</span></span>

## <a name="step-3-providing-an-interface-to-add-new-products"></a><span data-ttu-id="cc8ec-243">步骤 3： 提供一个接口，以便添加新产品</span><span class="sxs-lookup"><span data-stu-id="cc8ec-243">Step 3: Providing an Interface to Add New Products</span></span>

<span data-ttu-id="cc8ec-244">将说明如何从工具箱中拖动到设计器上面 GridView，拖动清除其`Height`和`Width`属性，并绑定到 ObjectDataSource 页已存在。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-244">Drag a DetailsView from the Toolbox onto the Designer above the GridView, clear out its `Height` and `Width` properties, and bind it to the ObjectDataSource already present on the page.</span></span> <span data-ttu-id="cc8ec-245">这将为每个产品的字段添加 BoundField 或 CheckBoxField。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-245">This will add a BoundField or CheckBoxField for each of the product's fields.</span></span> <span data-ttu-id="cc8ec-246">由于我们想要使用此说明如何添加新的产品，我们需要检查从智能标记; 启用插入选项但是，没有此类选项因为 ObjectDataSource`Insert()`方法未映射到中的方法`ProductsBLL`类 （回想一下，我们设置此映射到 （无） 时配置数据源，请参见图 3）。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-246">Since we want to use this DetailsView to add new products, we need to check the Enable Inserting option from the smart tag; however, there's no such option because the ObjectDataSource's `Insert()` method is not mapped to a method in the `ProductsBLL` class (recall that we set this mapping to (None) when configuring the data source see Figure 3).</span></span>

<span data-ttu-id="cc8ec-247">若要配置对象数据源，请从其智能标记，启动该向导中选择的配置数据源链接。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-247">To configure the ObjectDataSource, select the Configure Data Source link from its smart tag, launching the wizard.</span></span> <span data-ttu-id="cc8ec-248">第一个屏幕可让你可以更改基础对象数据源绑定到; 的对象保留`ProductsBLL`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-248">The first screen allows you to change the underlying object the ObjectDataSource is bound to; leave it set to `ProductsBLL`.</span></span> <span data-ttu-id="cc8ec-249">下一个屏幕中列出的映射与从 ObjectDataSource 的方法的基础对象。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-249">The next screen lists the mappings from the ObjectDataSource's methods to the underlying object's.</span></span> <span data-ttu-id="cc8ec-250">即使显式指出`Insert()`和`Delete()`方法不应映射到任何方法，如果你转到插入和删除选项卡将会看到映射是否存在。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-250">Even though we explicitly indicated that the `Insert()` and `Delete()` methods should not be mapped to any methods, if you go to the INSERT and DELETE tabs you'll see that a mapping is there.</span></span> <span data-ttu-id="cc8ec-251">这是因为`ProductsBLL`的`AddProduct`和`DeleteProduct`方法使用`DataObjectMethodAttribute`特性以指示它们是默认方法`Insert()`和`Delete()`分别。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-251">This is because the `ProductsBLL`'s `AddProduct` and `DeleteProduct` methods use the `DataObjectMethodAttribute` attribute to indicate that they are the default methods for `Insert()` and `Delete()`, respectively.</span></span> <span data-ttu-id="cc8ec-252">因此，ObjectDataSource 向导会选择这些每次你运行向导，除非显式指定的一些其他值。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-252">Hence, the ObjectDataSource wizard selects these each time you run the wizard unless there's some other value explicitly specified.</span></span>

<span data-ttu-id="cc8ec-253">保留`Insert()`方法指向`AddProduct`方法，但重新设置为 （无） 删除选项卡的下拉列表。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-253">Leave the `Insert()` method pointing to the `AddProduct` method, but again set the DELETE tab's drop-down list to (None).</span></span>


<span data-ttu-id="cc8ec-254">[![将插入选项卡的下拉列表设置为 AddProduct 方法](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image41.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-254">[![Set the INSERT Tab's Drop-Down List to the AddProduct Method](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image41.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image40.png)</span></span>

<span data-ttu-id="cc8ec-255">**图 14**： 将插入选项卡的下拉列表设置为`AddProduct`方法 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-255">**Figure 14**: Set the INSERT Tab's Drop-Down List to the `AddProduct` Method ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image42.png))</span></span>


<span data-ttu-id="cc8ec-256">[![设置为 （无） 删除选项卡的下拉列表](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image44.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-256">[![Set the DELETE Tab's Drop-Down List to (None)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image44.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image43.png)</span></span>

<span data-ttu-id="cc8ec-257">**图 15**： 设置为 (None) 的删除选项卡的下拉列表 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-257">**Figure 15**: Set the DELETE Tab's Drop-Down List to (None) ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image45.png))</span></span>


<span data-ttu-id="cc8ec-258">进行这些更改后，ObjectDataSource 的声明性语法，将会展开以包括`InsertParameters`集合，如下所示：</span><span class="sxs-lookup"><span data-stu-id="cc8ec-258">After making these changes, the ObjectDataSource's declarative syntax will be expanded to include an `InsertParameters` collection, as shown below:</span></span>


[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample8.aspx)]

<span data-ttu-id="cc8ec-259">重新运行该向导添加回`OldValuesParameterFormatString`属性。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-259">Rerunning the wizard added back the `OldValuesParameterFormatString` property.</span></span> <span data-ttu-id="cc8ec-260">花一些时间来清除此属性，将其设置为默认值 (`{0}`) 或将其删除的声明性语法一起删除。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-260">Take a moment to clear this property by setting it to the default value (`{0}`) or removing it altogether from the declarative syntax.</span></span>

<span data-ttu-id="cc8ec-261">使用对象数据源提供插入功能，说明如何的智能标记现在将包括启用插入的复选框。返回到设计器，并选中此选项。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-261">With the ObjectDataSource providing inserting capabilities, the DetailsView's smart tag will now include the Enable Inserting checkbox; return to the Designer and check this option.</span></span> <span data-ttu-id="cc8ec-262">接下来，削减说明，以便它仅有两个 BoundFields-`ProductName`和`UnitPrice`-和 CommandField。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-262">Next, pare down the DetailsView so that it only has two BoundFields - `ProductName` and `UnitPrice` - and the CommandField.</span></span> <span data-ttu-id="cc8ec-263">在此点说明的声明性语法，应如下所示：</span><span class="sxs-lookup"><span data-stu-id="cc8ec-263">At this point the DetailsView's declarative syntax should look like:</span></span>


[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample9.aspx)]

<span data-ttu-id="cc8ec-264">图 16 显示此页，此时查看通过浏览器时。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-264">Figure 16 shows this page when viewed through a browser at this point.</span></span> <span data-ttu-id="cc8ec-265">如你所见，说明如何列出的名称和 （牛奶） 的第一个产品价格。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-265">As you can see, the DetailsView lists the name and price of the first product (Chai).</span></span> <span data-ttu-id="cc8ec-266">但是，我们希望是插入接口，提供用户快速将新产品添加到数据库的一种方法。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-266">What we want, however, is an inserting interface that provides a means for the user to quickly add a new product to the database.</span></span>


<span data-ttu-id="cc8ec-267">[![说明如何为当前呈现在只读模式下](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image47.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-267">[![The DetailsView is Currently Rendered in Read-Only Mode](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image47.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image46.png)</span></span>

<span data-ttu-id="cc8ec-268">**图 16**: 说明如何为当前呈现在只读模式下 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image48.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-268">**Figure 16**: The DetailsView is Currently Rendered in Read-Only Mode ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image48.png))</span></span>


<span data-ttu-id="cc8ec-269">为了显示说明如何在插入模式下我们需要将设置`DefaultMode`属性`Inserting`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-269">In order to show the DetailsView in its inserting mode we need to set the `DefaultMode` property to `Inserting`.</span></span> <span data-ttu-id="cc8ec-270">此呈现在插入模式下时首次访问说明，并阻止插入一条新记录后对其存在。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-270">This renders the DetailsView in insert mode when first visited and keeps it there after inserting a new record.</span></span> <span data-ttu-id="cc8ec-271">如图 17 所示，此类说明提供快速接口添加新记录。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-271">As Figure 17 shows, such a DetailsView provides a quick interface for adding a new record.</span></span>


<span data-ttu-id="cc8ec-272">[![说明如何提供一个接口，以便将新产品快速添加](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image50.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-272">[![The DetailsView Provides an Interface for Quickly Adding a New Product](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image50.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image49.png)</span></span>

<span data-ttu-id="cc8ec-273">**图 17**: 说明如何提供一个接口以便将快速添加新的产品 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-273">**Figure 17**: The DetailsView Provides an Interface for Quickly Adding a New Product ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image51.png))</span></span>


<span data-ttu-id="cc8ec-274">当用户输入的产品名称和价格 （如"Acme Water"和 1.99，如下所示图 17），并单击插入时，回发时，才会和插入工作流开始，新产品记录添加到数据库中结束。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-274">When the user enters a product name and price (such as "Acme Water" and 1.99, as in Figure 17) and clicks Insert, a postback ensues and the inserting workflow commences, culminating in a new product record being added to the database.</span></span> <span data-ttu-id="cc8ec-275">说明如何维护其插入接口和 GridView 自动重新绑定到其数据源以便包含新的产品，如图 18 中所示。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-275">The DetailsView maintains its inserting interface and the GridView is automatically rebound to its data source in order to include the new product, as shown in Figure 18.</span></span>


![产品](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image52.png)

<span data-ttu-id="cc8ec-277">**图 18**： 产品"Acme Water"已添加到数据库</span><span class="sxs-lookup"><span data-stu-id="cc8ec-277">**Figure 18**: The Product "Acme Water" Has Been Added to the Database</span></span>


<span data-ttu-id="cc8ec-278">虽然图 18 中的 GridView 不显示它，说明如何接口从缺少产品字段`CategoryID`， `SupplierID`， `QuantityPerUnit`，依次类推分配`NULL`数据库值。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-278">While the GridView in Figure 18 doesn't show it, the product fields lacking from the DetailsView interface `CategoryID`, `SupplierID`, `QuantityPerUnit`, and so on are assigned `NULL` database values.</span></span> <span data-ttu-id="cc8ec-279">你可以看到此通过执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="cc8ec-279">You can see this by performing the following steps:</span></span>

1. <span data-ttu-id="cc8ec-280">转到 Visual Studio 中的服务器资源管理器</span><span class="sxs-lookup"><span data-stu-id="cc8ec-280">Go to the Server Explorer in Visual Studio</span></span>
2. <span data-ttu-id="cc8ec-281">展开`NORTHWND.MDF`数据库节点</span><span class="sxs-lookup"><span data-stu-id="cc8ec-281">Expanding the `NORTHWND.MDF` database node</span></span>
3. <span data-ttu-id="cc8ec-282">右键单击`Products`数据库表节点</span><span class="sxs-lookup"><span data-stu-id="cc8ec-282">Right-click on the `Products` database table node</span></span>
4. <span data-ttu-id="cc8ec-283">选择显示表数据</span><span class="sxs-lookup"><span data-stu-id="cc8ec-283">Select Show Table Data</span></span>

<span data-ttu-id="cc8ec-284">此命令将列出所有中的记录`Products`表。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-284">This will list all of the records in the `Products` table.</span></span> <span data-ttu-id="cc8ec-285">如图 19 所示，我们新产品的列的所有以外`ProductID`， `ProductName`，和`UnitPrice`具有`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-285">As Figure 19 shows, all of our new product's columns other than `ProductID`, `ProductName`, and `UnitPrice` have `NULL` values.</span></span>


<span data-ttu-id="cc8ec-286">[![说明如何在未提供产品字段是分配 NULL 值](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image54.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image53.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-286">[![The Product Fields Not Provided in the DetailsView are Assigned NULL Values](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image54.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image53.png)</span></span>

<span data-ttu-id="cc8ec-287">**图 19**: 产品字段中未提供说明如何分配`NULL`值 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image55.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-287">**Figure 19**: The Product Fields Not Provided in the DetailsView are Assigned `NULL` Values ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image55.png))</span></span>


<span data-ttu-id="cc8ec-288">我们可能想要提供默认值以外`NULL`的一个或多个列值，或者因为`NULL`不是最佳的默认选项或因为本身的数据库列不允许`NULL`s。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-288">We may want to provide a default value other than `NULL` for one or more of these column values, either because `NULL` isn't the best default option or because the database column itself doesn't allow `NULL` s.</span></span> <span data-ttu-id="cc8ec-289">若要实现此目的我们可以以编程方式设置的说明的参数的值`InputParameters`集合。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-289">To accomplish this we can programmatically set the values of the parameters of the DetailsView's `InputParameters` collection.</span></span> <span data-ttu-id="cc8ec-290">此分配可能会出于或者在事件处理程序说明如何的`ItemInserting`事件或 ObjectDataSource`Inserting`事件。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-290">This assignment can be done either in the event handler for the DetailsView's `ItemInserting` event or the ObjectDataSource's `Inserting` event.</span></span> <span data-ttu-id="cc8ec-291">由于我们已介绍在使用预和后级别事件的数据 Web 控制级别，让我们研究一下这一次使用对象数据源的事件。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-291">Since we've already looked at using the pre- and post-level events at the data Web control level, let's explore using the ObjectDataSource's events this time.</span></span>

## <a name="step-4-assigning-values-to-thecategoryidandsupplieridparameters"></a><span data-ttu-id="cc8ec-292">步骤 4： 将值赋给`CategoryID`和`SupplierID`参数</span><span class="sxs-lookup"><span data-stu-id="cc8ec-292">Step 4: Assigning Values to the`CategoryID`and`SupplierID`Parameters</span></span>

<span data-ttu-id="cc8ec-293">对于本教程让我们想象，对于我们的应用程序中添加新产品通过此接口时它应分配`CategoryID`和`SupplierID`值为 1。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-293">For this tutorial let's imagine that for our application when adding a new product through this interface it should be assigned a `CategoryID` and `SupplierID` value of 1.</span></span> <span data-ttu-id="cc8ec-294">如前所述，ObjectDataSource 有一对预和后级别事件触发数据修改过程。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-294">As mentioned earlier, the ObjectDataSource has a pair of pre- and post-level events that fire during the data modification process.</span></span> <span data-ttu-id="cc8ec-295">当其`Insert()`调用方法，ObjectDataSource 首先引发其`Inserting`事件，然后调用的方法，其`Insert()`方法映射到，并最后引发`Inserted`事件。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-295">When its `Insert()` method is invoked, the ObjectDataSource first raises its `Inserting` event, then calls the method that its `Insert()` method has been mapped to, and finally raises the `Inserted` event.</span></span> <span data-ttu-id="cc8ec-296">`Inserting`事件处理程序为我们提供了一个最后一次机会调整的输入的参数，或者取消迫切地操作。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-296">The `Inserting` event handler affords us one last opportunity to tweak the input parameters or cancel the operation outright.</span></span>

> [!NOTE]
> <span data-ttu-id="cc8ec-297">在实际应用程序中你可能想让用户指定的类别和供应商，或将它们根据某些标准选取此值或业务逻辑 （而不是隐式选择 ID 为 1）。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-297">In a real-world application you would likely want to either let the user specify the category and supplier or would pick this value for them based on some criteria or business logic (rather than blindly selecting an ID of 1).</span></span> <span data-ttu-id="cc8ec-298">无论如何，该示例说明如何以编程方式设置从 ObjectDataSource 预级别事件的输入参数的值。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-298">Regardless, the example illustrates how to programmatically set the value of an input parameter from the ObjectDataSource's pre-level event.</span></span>


<span data-ttu-id="cc8ec-299">花一些时间创建对象数据源的事件处理程序`Inserting`事件。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-299">Take a moment to create an event handler for the ObjectDataSource's `Inserting` event.</span></span> <span data-ttu-id="cc8ec-300">请注意，事件处理程序的第二个输入的参数是类型的对象`ObjectDataSourceMethodEventArgs`，它具有要对参数集合的访问的属性 (`InputParameters`) 和要取消操作的属性 (`Cancel`)。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-300">Notice that the event handler's second input parameter is an object of type `ObjectDataSourceMethodEventArgs`, which has a property to access the parameters collection (`InputParameters`) and a property to cancel the operation (`Cancel`).</span></span>


[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample10.vb)]

<span data-ttu-id="cc8ec-301">此时，`InputParameters`属性包含 ObjectDataSource`InsertParameters`与说明如何从所赋的值的集合。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-301">At this point, the `InputParameters` property contains the ObjectDataSource's `InsertParameters` collection with the values assigned from the DetailsView.</span></span> <span data-ttu-id="cc8ec-302">若要更改的其中一个参数的值，只需使用： `e.InputParameters("paramName") = value`。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-302">To change the value of one of these parameters, simply use: `e.InputParameters("paramName") = value`.</span></span> <span data-ttu-id="cc8ec-303">因此，若要设置`CategoryID`和`SupplierID`为 1 的值，调整`Inserting`事件处理程序如下所示：</span><span class="sxs-lookup"><span data-stu-id="cc8ec-303">Therefore, to set the `CategoryID` and `SupplierID` to values of 1, adjust the `Inserting` event handler to look like the following:</span></span>


[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample11.vb)]

<span data-ttu-id="cc8ec-304">此时间添加新产品 （如 acme 开发 Soda) 时`CategoryID`和`SupplierID`新产品的列将设置为 1 （请参阅图 20）。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-304">This time when adding a new product (such as Acme Soda), the `CategoryID` and `SupplierID` columns of the new product are set to 1 (see Figure 20).</span></span>


<span data-ttu-id="cc8ec-305">[![新的产品现在具有其 CategoryID 和供应商 Id 值设置为 1](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image57.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image56.png)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-305">[![New Products Now Have Their CategoryID and SupplierID Values Set to 1](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image57.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image56.png)</span></span>

<span data-ttu-id="cc8ec-306">**图 20**： 新产品现在拥有他们`CategoryID`和`SupplierID`值设置为 1 ([单击以查看实际尺寸的图像](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image58.png))</span><span class="sxs-lookup"><span data-stu-id="cc8ec-306">**Figure 20**: New Products Now Have Their `CategoryID` and `SupplierID` Values Set to 1 ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image58.png))</span></span>


## <a name="summary"></a><span data-ttu-id="cc8ec-307">摘要</span><span class="sxs-lookup"><span data-stu-id="cc8ec-307">Summary</span></span>

<span data-ttu-id="cc8ec-308">在编辑、 插入和删除过程，过程数据 Web 控件和 ObjectDataSource 继续完成复制前和后级别的事件数。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-308">During the editing, inserting, and deleting process, both the data Web control and the ObjectDataSource proceed through a number of pre- and post-level events.</span></span> <span data-ttu-id="cc8ec-309">在本教程中我们将检查预级别的事件，并已了解如何使用这些自定义输入的参数或取消数据修改操作完全同时从数据 Web 控件和对象数据源的事件。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-309">In this tutorial we examined the pre-level events and saw how to use these to customize the input parameters or cancel the data modification operation altogether both from the data Web control and ObjectDataSource's events.</span></span> <span data-ttu-id="cc8ec-310">在下一教程中我们将查看创建和使用针对后级别事件的事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-310">In the next tutorial we'll look at creating and using event handlers for the post-level events.</span></span>

<span data-ttu-id="cc8ec-311">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="cc8ec-311">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="cc8ec-312">关于作者</span><span class="sxs-lookup"><span data-stu-id="cc8ec-312">About the Author</span></span>

<span data-ttu-id="cc8ec-313">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七个 ASP/ASP.NET 书籍和的创始人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年使用与 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-313">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="cc8ec-314">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-314">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="cc8ec-315">最新书籍是[ *Sam 教授自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-315">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="cc8ec-316">他可以达到在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或通过他的博客，其中可以找到在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-316">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="cc8ec-317">特别感谢</span><span class="sxs-lookup"><span data-stu-id="cc8ec-317">Special Thanks To</span></span>

<span data-ttu-id="cc8ec-318">本教程系列已由许多有用的审阅者评审。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-318">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="cc8ec-319">本教程中的前导审阅者已 Jackie Goor 和沈 Shulok。</span><span class="sxs-lookup"><span data-stu-id="cc8ec-319">Lead reviewers for this tutorial were Jackie Goor and Liz Shulok.</span></span> <span data-ttu-id="cc8ec-320">对感兴趣查看我即将到来的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="cc8ec-320">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="cc8ec-321">如果是这样，删除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-321">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="cc8ec-322">[上一页](an-overview-of-inserting-updating-and-deleting-data-vb.md)
[下一页](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)</span><span class="sxs-lookup"><span data-stu-id="cc8ec-322">[Previous](an-overview-of-inserting-updating-and-deleting-data-vb.md)
[Next](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)</span></span>
