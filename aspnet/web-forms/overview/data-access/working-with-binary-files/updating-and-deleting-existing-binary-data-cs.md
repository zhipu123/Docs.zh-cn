---
uid: web-forms/overview/data-access/working-with-binary-files/updating-and-deleting-existing-binary-data-cs
title: "更新和删除现有的二进制数据 (C#) |Microsoft 文档"
author: rick-anderson
description: "前面的教程中我们已了解如何 GridView 控件可以方便地编辑和删除文本数据。 在本教程中我们看到如何 GridView 控件还建立..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/27/2007
ms.topic: article
ms.assetid: 35798f21-1606-434b-83f8-30166906ef49
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/updating-and-deleting-existing-binary-data-cs
msc.type: authoredcontent
ms.openlocfilehash: 55128faa3752a43902c17525dde3543a4a8c3997
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="updating-and-deleting-existing-binary-data-c"></a><span data-ttu-id="6082b-104">更新和删除现有的二进制数据 (C#)</span><span class="sxs-lookup"><span data-stu-id="6082b-104">Updating and Deleting Existing Binary Data (C#)</span></span>
====================
<span data-ttu-id="6082b-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="6082b-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="6082b-106">[下载示例应用程序](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_57_CS.exe)或[下载 PDF](updating-and-deleting-existing-binary-data-cs/_static/datatutorial57cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="6082b-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_57_CS.exe) or [Download PDF](updating-and-deleting-existing-binary-data-cs/_static/datatutorial57cs1.pdf)</span></span>

> <span data-ttu-id="6082b-107">前面的教程中我们已了解如何 GridView 控件可以方便地编辑和删除文本数据。</span><span class="sxs-lookup"><span data-stu-id="6082b-107">In earlier tutorials we saw how the GridView control makes it simple to edit and delete text data.</span></span> <span data-ttu-id="6082b-108">在本教程中我们将了解如何 GridView 控件还使它能够编辑和删除二进制数据，该二进制数据是保存到数据库中还是存储在文件系统。</span><span class="sxs-lookup"><span data-stu-id="6082b-108">In this tutorial we see how the GridView control also makes it possible to edit and delete binary data, whether that binary data is saved in the database or stored in the file system.</span></span>


## <a name="introduction"></a><span data-ttu-id="6082b-109">介绍</span><span class="sxs-lookup"><span data-stu-id="6082b-109">Introduction</span></span>

<span data-ttu-id="6082b-110">在过去三个教程我们已添加的处理二进制数据的功能相当多的位。</span><span class="sxs-lookup"><span data-stu-id="6082b-110">Over the past three tutorials we ve added quite a bit of functionality for working with binary data.</span></span> <span data-ttu-id="6082b-111">我们已开始将通过添加`BrochurePath`列`Categories`表并相应地更新体系结构。</span><span class="sxs-lookup"><span data-stu-id="6082b-111">We started by adding a `BrochurePath` column to the `Categories` table and updated the architecture accordingly.</span></span> <span data-ttu-id="6082b-112">我们还将添加数据访问层和业务逻辑层的方法，以便处理与类别表 s 现有`Picture`列，其中包含的图像文件的二进制内容 s。</span><span class="sxs-lookup"><span data-stu-id="6082b-112">We also added Data Access Layer and Business Logic Layer methods to work with the Categories table s existing `Picture` column, which holds the binary content s of an image file.</span></span> <span data-ttu-id="6082b-113">我们已构建的 web 页面以提供一个 GridView 中的二进制数据小册子中，下载链接具有类别的图中所示`<img>`元素并将其添加说明如何以允许用户添加新类别并上载其小册子和图片的数据。</span><span class="sxs-lookup"><span data-stu-id="6082b-113">We have built web pages to present the binary data in a GridView a download link for the brochure, with the category s picture shown in an `<img>` element and have added a DetailsView to allow users to add a new category and upload its brochure and picture data.</span></span>

<span data-ttu-id="6082b-114">所有这些剩下实现是能够编辑和删除现有类别，我们将完成在本教程中使用的 GridView s 内置编辑和删除功能。</span><span class="sxs-lookup"><span data-stu-id="6082b-114">All that remains to be implemented is the ability to edit and delete existing categories, which we'll accomplish in this tutorial using the GridView s built-in editing and deleting features.</span></span> <span data-ttu-id="6082b-115">当编辑某个类别时，用户将能够根据需要上载新图片或继续使用现有的类别。</span><span class="sxs-lookup"><span data-stu-id="6082b-115">When editing a category, the user will be able to optionally upload a new picture or have the category continue to use the existing one.</span></span> <span data-ttu-id="6082b-116">为小册子中，它们可以选择使用现有小册子中，上载新小册子中，或以指示类别不再具有小册子与之关联。</span><span class="sxs-lookup"><span data-stu-id="6082b-116">For the brochure, they can either choose to use the existing brochure, to upload a new brochure, or to indicate that the category no longer has a brochure associated with it.</span></span> <span data-ttu-id="6082b-117">让我们来开始 ！</span><span class="sxs-lookup"><span data-stu-id="6082b-117">Let s get started!</span></span>

## <a name="step-1-updating-the-data-access-layer"></a><span data-ttu-id="6082b-118">步骤 1： 更新的数据访问层</span><span class="sxs-lookup"><span data-stu-id="6082b-118">Step 1: Updating the Data Access Layer</span></span>

<span data-ttu-id="6082b-119">DAL 具有自动生成`Insert`， `Update`，和`Delete`方法，但这些方法基于生成`CategoriesTableAdapter`s 主查询，这不包括`Picture`列。</span><span class="sxs-lookup"><span data-stu-id="6082b-119">The DAL has auto-generated `Insert`, `Update`, and `Delete` methods, but these methods were generated based on the `CategoriesTableAdapter` s main query, which does not include the `Picture` column.</span></span> <span data-ttu-id="6082b-120">因此，`Insert`和`Update`方法不包括用于指定类别的图片的二进制数据的参数。</span><span class="sxs-lookup"><span data-stu-id="6082b-120">Therefore, the `Insert` and `Update` methods do not include parameters for specifying the binary data for the category s picture.</span></span> <span data-ttu-id="6082b-121">像我们[前面教程](including-a-file-upload-option-when-adding-a-new-record-cs.md)，我们需要创建一个新的 TableAdapter 方法用于更新`Categories`表指定二进制数据时。</span><span class="sxs-lookup"><span data-stu-id="6082b-121">Like we did in the [preceding tutorial](including-a-file-upload-option-when-adding-a-new-record-cs.md), we need to create a new TableAdapter method for updating the `Categories` table when specifying binary data.</span></span>

<span data-ttu-id="6082b-122">打开该类型化数据集，然后从设计器中，右键单击`CategoriesTableAdapter`s 标头，然后选择添加查询从上下文菜单到 launche TableAdapter 查询配置向导。</span><span class="sxs-lookup"><span data-stu-id="6082b-122">Open the Typed DataSet and, from the Designer, right-click on the `CategoriesTableAdapter` s header and choose Add Query from the context menu to launche the TableAdapter Query Configuration Wizard.</span></span> <span data-ttu-id="6082b-123">通过要求我们 TableAdapter 查询访问数据库的方式来启动此向导。</span><span class="sxs-lookup"><span data-stu-id="6082b-123">This wizard starts by asking us how the TableAdapter query should access the database.</span></span> <span data-ttu-id="6082b-124">选择使用 SQL 语句，然后单击下一步。</span><span class="sxs-lookup"><span data-stu-id="6082b-124">Choose Use SQL statements and click Next.</span></span> <span data-ttu-id="6082b-125">下一步将提示输入查询的类型生成。</span><span class="sxs-lookup"><span data-stu-id="6082b-125">The next step prompts for the type of query to be generated.</span></span> <span data-ttu-id="6082b-126">由于我们重新创建一个查询来添加到新的记录`Categories`表，选择更新，然后单击下一步。</span><span class="sxs-lookup"><span data-stu-id="6082b-126">Since we re creating a query to add a new record to the `Categories` table, choose UPDATE and click Next.</span></span>


<span data-ttu-id="6082b-127">[![选择更新选项](updating-and-deleting-existing-binary-data-cs/_static/image1.gif)](updating-and-deleting-existing-binary-data-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-127">[![Select the UPDATE Option](updating-and-deleting-existing-binary-data-cs/_static/image1.gif)](updating-and-deleting-existing-binary-data-cs/_static/image1.png)</span></span>

<span data-ttu-id="6082b-128">**图 1**： 选择更新选项 ([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-128">**Figure 1**: Select the UPDATE Option ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image2.png))</span></span>


<span data-ttu-id="6082b-129">现在，我们需要指定`UPDATE`SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="6082b-129">We now need to specify the `UPDATE` SQL statement.</span></span> <span data-ttu-id="6082b-130">向导会自动建议使用`UPDATE`语句对应于 TableAdapter s 主查询 (更新的一个`CategoryName`， `Description`，和`BrochurePath`值)。</span><span class="sxs-lookup"><span data-stu-id="6082b-130">The wizard automatically suggests an `UPDATE` statement corresponding to the TableAdapter s main query (one that updates the `CategoryName`, `Description`, and `BrochurePath` values).</span></span> <span data-ttu-id="6082b-131">将该语句更改以便`Picture`列是包含沿`@Picture`参数，如下所示：</span><span class="sxs-lookup"><span data-stu-id="6082b-131">Change the statement so that the `Picture` column is included along with a `@Picture` parameter, like so:</span></span>


[!code-sql[Main](updating-and-deleting-existing-binary-data-cs/samples/sample1.sql)]

<span data-ttu-id="6082b-132">在向导的最后一个屏幕可让我们将新的 TableAdapter 方法。</span><span class="sxs-lookup"><span data-stu-id="6082b-132">The final screen of the wizard asks us to name the new TableAdapter method.</span></span> <span data-ttu-id="6082b-133">输入`UpdateWithPicture`并单击完成。</span><span class="sxs-lookup"><span data-stu-id="6082b-133">Enter `UpdateWithPicture` and click Finish.</span></span>


<span data-ttu-id="6082b-134">[![新的 TableAdapter 方法 UpdateWithPicture 名称](updating-and-deleting-existing-binary-data-cs/_static/image2.gif)](updating-and-deleting-existing-binary-data-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-134">[![Name the New TableAdapter Method UpdateWithPicture](updating-and-deleting-existing-binary-data-cs/_static/image2.gif)](updating-and-deleting-existing-binary-data-cs/_static/image3.png)</span></span>

<span data-ttu-id="6082b-135">**图 2**： 将新的 TableAdapter 方法`UpdateWithPicture`([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-135">**Figure 2**: Name the New TableAdapter Method `UpdateWithPicture` ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image4.png))</span></span>


## <a name="step-2-adding-the-business-logic-layer-methods"></a><span data-ttu-id="6082b-136">步骤 2： 添加业务逻辑层方法</span><span class="sxs-lookup"><span data-stu-id="6082b-136">Step 2: Adding the Business Logic Layer Methods</span></span>

<span data-ttu-id="6082b-137">除了更新 DAL，我们需要更新 BLL 包括更新和删除某一类别的方法。</span><span class="sxs-lookup"><span data-stu-id="6082b-137">In addition to updating the DAL, we need to update the BLL to include methods for updating and deleting a category.</span></span> <span data-ttu-id="6082b-138">这些是将与表示层调用的方法。</span><span class="sxs-lookup"><span data-stu-id="6082b-138">These are the methods that will be invoked from the Presentation Layer.</span></span>

<span data-ttu-id="6082b-139">对于删除类别，我们可以使用`CategoriesTableAdapter`自动生成的 s`Delete`方法。</span><span class="sxs-lookup"><span data-stu-id="6082b-139">For deleting a category, we can use the `CategoriesTableAdapter` s auto-generated `Delete` method.</span></span> <span data-ttu-id="6082b-140">添加以下方法`CategoriesBLL`类：</span><span class="sxs-lookup"><span data-stu-id="6082b-140">Add the following method to the `CategoriesBLL` class:</span></span>


[!code-csharp[Main](updating-and-deleting-existing-binary-data-cs/samples/sample2.cs)]

<span data-ttu-id="6082b-141">对于本教程，让 s 创建两种方法来更新类别的一个要求二进制图片数据并调用`UpdateWithPicture`方法我们刚添加到`CategoriesTableAdapter`接受的另一个只需`CategoryName`， `Description`，和`BrochurePath`值，并使用`CategoriesTableAdapter`类自动生成的 s`Update`语句。</span><span class="sxs-lookup"><span data-stu-id="6082b-141">For this tutorial, let s create two methods for updating a category - one that expects the binary picture data and invokes the `UpdateWithPicture` method we just added to the `CategoriesTableAdapter` and another that accepts just the `CategoryName`, `Description`, and `BrochurePath` values and uses `CategoriesTableAdapter` class s auto-generated `Update` statement.</span></span> <span data-ttu-id="6082b-142">使用两种方法背后的基本原理是，在某些情况下，用户可能想要更新的类别的图片以及其其他字段，在该情况下，用户将需要上载新图片。</span><span class="sxs-lookup"><span data-stu-id="6082b-142">The rationale behind using two methods is that in some circumstances, a user might want to update the category s picture along with its other fields, in which case the user will have to upload the new picture.</span></span> <span data-ttu-id="6082b-143">上载的图片 s 二进制数据然后可在`UPDATE`语句。</span><span class="sxs-lookup"><span data-stu-id="6082b-143">The uploaded picture s binary data can then be used in the `UPDATE` statement.</span></span> <span data-ttu-id="6082b-144">在其他情况下，用户可能仅关注中更新，例如，名称和说明。</span><span class="sxs-lookup"><span data-stu-id="6082b-144">In other cases, the user might only be interested in updating, say, the name and description.</span></span> <span data-ttu-id="6082b-145">但是，如果`UPDATE`语句要求的二进制数据`Picture`列，然后我们 d 需要提供该信息以及。</span><span class="sxs-lookup"><span data-stu-id="6082b-145">But if the `UPDATE` statement expects the binary data for the `Picture` column as well, then we d need to provide that information as well.</span></span> <span data-ttu-id="6082b-146">这需要额外经历一次到数据库来取回图片数据正在编辑的记录。</span><span class="sxs-lookup"><span data-stu-id="6082b-146">This would require an extra trip to the database to bring back the picture data for the record being edited.</span></span> <span data-ttu-id="6082b-147">因此，我们想要两个`UPDATE`方法。</span><span class="sxs-lookup"><span data-stu-id="6082b-147">Therefore, we want two `UPDATE` methods.</span></span> <span data-ttu-id="6082b-148">业务逻辑层将确定使用哪一个基于图片数据以更新类别时提供。</span><span class="sxs-lookup"><span data-stu-id="6082b-148">The Business Logic Layer will determine which one to use based on whether picture data is provided when updating the category.</span></span>

<span data-ttu-id="6082b-149">若要为此，将添加以下两种方法`CategoriesBLL`类，这两名为`UpdateCategory`。</span><span class="sxs-lookup"><span data-stu-id="6082b-149">To facilitate this, add two methods to the `CategoriesBLL` class, both named `UpdateCategory`.</span></span> <span data-ttu-id="6082b-150">第一个应接受三个`string`s，`byte`数组，和`int`作为其输入参数; 第二个，只需三个`string`s 和`int`。</span><span class="sxs-lookup"><span data-stu-id="6082b-150">The first one should accept three `string` s, a `byte` array, and an `int` as its input parameters; the second, just three `string` s and an `int`.</span></span> <span data-ttu-id="6082b-151">`string`输入的参数只用于类别的名称、 说明和小册子文件路径，`byte`数组为类别的图的二进制内容和`int`标识`CategoryID`要更新的记录。</span><span class="sxs-lookup"><span data-stu-id="6082b-151">The `string` input parameters are for the category s name, description, and brochure file path, the `byte` array is for the binary contents of the category s picture, and the `int` identifies the `CategoryID` of the record to update.</span></span> <span data-ttu-id="6082b-152">请注意，第一个重载时，将调用第二个如果传入的`byte`数组是`null`:</span><span class="sxs-lookup"><span data-stu-id="6082b-152">Notice that the first overload invokes the second if the passed-in `byte` array is `null`:</span></span>


[!code-csharp[Main](updating-and-deleting-existing-binary-data-cs/samples/sample3.cs)]

## <a name="step-3-copying-over-the-insert-and-view-functionality"></a><span data-ttu-id="6082b-153">步骤 3： 将某个复制 Insert 和视图功能</span><span class="sxs-lookup"><span data-stu-id="6082b-153">Step 3: Copying Over the Insert and View Functionality</span></span>

<span data-ttu-id="6082b-154">在[前面教程](including-a-file-upload-option-when-adding-a-new-record-cs.md)我们创建一个名为页`UploadInDetailsView.aspx`，列出一个 GridView 中的所有类别，提供说明如何向系统添加新类别。</span><span class="sxs-lookup"><span data-stu-id="6082b-154">In the [preceding tutorial](including-a-file-upload-option-when-adding-a-new-record-cs.md) we created a page named `UploadInDetailsView.aspx` that listed all categories in a GridView and provided a DetailsView to add new categories to the system.</span></span> <span data-ttu-id="6082b-155">在本教程中我们将扩展以包括编辑和删除支持 GridView。</span><span class="sxs-lookup"><span data-stu-id="6082b-155">In this tutorial we will extend the GridView to include editing and deleting support.</span></span> <span data-ttu-id="6082b-156">而不是继续使用`UploadInDetailsView.aspx`，让 s 改为将放在此教程的更改`UpdatingAndDeleting.aspx`来自同一文件夹中，页`~/BinaryData`。</span><span class="sxs-lookup"><span data-stu-id="6082b-156">Rather than continuing to work from `UploadInDetailsView.aspx`, let s instead place this tutorial s changes in the `UpdatingAndDeleting.aspx` page from the same folder, `~/BinaryData`.</span></span> <span data-ttu-id="6082b-157">复制并粘贴声明性的标记，然后从代码`UploadInDetailsView.aspx`到`UpdatingAndDeleting.aspx`。</span><span class="sxs-lookup"><span data-stu-id="6082b-157">Copy and paste the declarative markup and code from `UploadInDetailsView.aspx` to `UpdatingAndDeleting.aspx`.</span></span>

<span data-ttu-id="6082b-158">首先打开`UploadInDetailsView.aspx`页。</span><span class="sxs-lookup"><span data-stu-id="6082b-158">Start by opening the `UploadInDetailsView.aspx` page.</span></span> <span data-ttu-id="6082b-159">将所有中的声明性语法复制`<asp:Content>`元素，如图 3 中所示。</span><span class="sxs-lookup"><span data-stu-id="6082b-159">Copy all of the declarative syntax within the `<asp:Content>` element, as shown in Figure 3.</span></span> <span data-ttu-id="6082b-160">接下来，打开`UpdatingAndDeleting.aspx`和粘贴在此标记其`<asp:Content>`元素。</span><span class="sxs-lookup"><span data-stu-id="6082b-160">Next, open `UpdatingAndDeleting.aspx` and paste this markup within its `<asp:Content>` element.</span></span> <span data-ttu-id="6082b-161">同样，复制中的代码`UploadInDetailsView.aspx`页上 s 代码隐藏类`UpdatingAndDeleting.aspx`。</span><span class="sxs-lookup"><span data-stu-id="6082b-161">Similarly, copy the code from the `UploadInDetailsView.aspx` page s code-behind class to `UpdatingAndDeleting.aspx`.</span></span>


<span data-ttu-id="6082b-162">[![从 UploadInDetailsView.aspx 复制的声明性的标记](updating-and-deleting-existing-binary-data-cs/_static/image3.gif)](updating-and-deleting-existing-binary-data-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-162">[![Copy the Declarative Markup from UploadInDetailsView.aspx](updating-and-deleting-existing-binary-data-cs/_static/image3.gif)](updating-and-deleting-existing-binary-data-cs/_static/image5.png)</span></span>

<span data-ttu-id="6082b-163">**图 3**： 复制中的声明性标记`UploadInDetailsView.aspx`([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-163">**Figure 3**: Copy the Declarative Markup from `UploadInDetailsView.aspx` ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image6.png))</span></span>


<span data-ttu-id="6082b-164">复制后通过声明性的标记和代码，请访问`UpdatingAndDeleting.aspx`。</span><span class="sxs-lookup"><span data-stu-id="6082b-164">After copying over the declarative markup and code, visit `UpdatingAndDeleting.aspx`.</span></span> <span data-ttu-id="6082b-165">你应看到相同输出，并且具有相同的用户体验与`UploadInDetailsView.aspx`来自前面的教程页。</span><span class="sxs-lookup"><span data-stu-id="6082b-165">You should see the same output and have the same user experience as with `UploadInDetailsView.aspx` page from the previous tutorial.</span></span>

## <a name="step-4-adding-deleting-support-to-the-objectdatasource-and-gridview"></a><span data-ttu-id="6082b-166">步骤 4： 添加删除支持添加到的对象数据源和 GridView</span><span class="sxs-lookup"><span data-stu-id="6082b-166">Step 4: Adding Deleting Support to the ObjectDataSource and GridView</span></span>

<span data-ttu-id="6082b-167">中所述我们回[概述的插入、 更新和删除数据](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)教程中，GridView 提供内置的删除功能，并且可以在一个复选框的刻度线启用这些功能，如果网格 s 基础数据源支持删除。</span><span class="sxs-lookup"><span data-stu-id="6082b-167">As we discussed back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial, the GridView provides built-in deleting capabilities and these capabilities can be enabled at the tick of a checkbox if the grid s underlying data source supports deleting.</span></span> <span data-ttu-id="6082b-168">当前 ObjectDataSource GridView 绑定到 (`CategoriesDataSource`) 不支持删除。</span><span class="sxs-lookup"><span data-stu-id="6082b-168">Currently the ObjectDataSource the GridView is bound to (`CategoriesDataSource`) does not support deleting.</span></span>

<span data-ttu-id="6082b-169">若要解决此问题，请单击从 ObjectDataSource s 智能标记的配置数据源选项，以启动向导。</span><span class="sxs-lookup"><span data-stu-id="6082b-169">To remedy this, click on the Configure Data Source option from the ObjectDataSource s smart tag to launch the wizard.</span></span> <span data-ttu-id="6082b-170">第一个屏幕显示 ObjectDataSource 配置为使用`CategoriesBLL`类。</span><span class="sxs-lookup"><span data-stu-id="6082b-170">The first screen shows that the ObjectDataSource is configured to work with the `CategoriesBLL` class.</span></span> <span data-ttu-id="6082b-171">点击下一步。</span><span class="sxs-lookup"><span data-stu-id="6082b-171">Hit Next.</span></span> <span data-ttu-id="6082b-172">目前，仅 ObjectDataSource s`InsertMethod`和`SelectMethod`指定属性。</span><span class="sxs-lookup"><span data-stu-id="6082b-172">Currently, only the ObjectDataSource s `InsertMethod` and `SelectMethod` properties are specified.</span></span> <span data-ttu-id="6082b-173">但是，向导自动填充使用更新和删除选项卡中的下拉列表`UpdateCategory`和`DeleteCategory`方法，分别。</span><span class="sxs-lookup"><span data-stu-id="6082b-173">However, the wizard auto-populated the drop-down lists in the UPDATE and DELETE tabs with the `UpdateCategory` and `DeleteCategory` methods, respectively.</span></span> <span data-ttu-id="6082b-174">这是因为在`CategoriesBLL`我们标记使用这些方法的类`DataObjectMethodAttribute`与更新和删除的默认方法。</span><span class="sxs-lookup"><span data-stu-id="6082b-174">This is because in the `CategoriesBLL` class we marked these methods using the `DataObjectMethodAttribute` as the default methods for updating and deleting.</span></span>

<span data-ttu-id="6082b-175">现在，设置为 （无） 的更新选项卡的下拉列表，但将删除选项卡的下拉列表设置为保持为`DeleteCategory`。</span><span class="sxs-lookup"><span data-stu-id="6082b-175">For now, set the UPDATE tab s drop-down list to (None), but leave the DELETE tab s drop-down list set to `DeleteCategory`.</span></span> <span data-ttu-id="6082b-176">我们会返回到步骤 6 以添加更新的支持在此向导。</span><span class="sxs-lookup"><span data-stu-id="6082b-176">We'll return to this wizard in Step 6 to add updating support.</span></span>


<span data-ttu-id="6082b-177">[![配置对象数据源以使用 DeleteCategory 方法](updating-and-deleting-existing-binary-data-cs/_static/image4.gif)](updating-and-deleting-existing-binary-data-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-177">[![Configure the ObjectDataSource to Use the DeleteCategory Method](updating-and-deleting-existing-binary-data-cs/_static/image4.gif)](updating-and-deleting-existing-binary-data-cs/_static/image7.png)</span></span>

<span data-ttu-id="6082b-178">**图 4**： 配置使用 ObjectDataSource`DeleteCategory`方法 ([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-178">**Figure 4**: Configure the ObjectDataSource to Use the `DeleteCategory` Method ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image8.png))</span></span>


> [!NOTE]
> <span data-ttu-id="6082b-179">完成向导之后，Visual Studio 可能会要求是否你要刷新字段和密钥，这将重新生成数据 Web 控制字段。</span><span class="sxs-lookup"><span data-stu-id="6082b-179">Upon completing the wizard, Visual Studio may ask if you want to Refresh Fields and Keys, which will regenerate the data Web controls fields.</span></span> <span data-ttu-id="6082b-180">因为选择是将覆盖您所做的任何字段自定义，请选择否，。</span><span class="sxs-lookup"><span data-stu-id="6082b-180">Choose No, because choosing Yes will overwrite any field customizations you may have made.</span></span>


<span data-ttu-id="6082b-181">ObjectDataSource 现在将包括的值其`DeleteMethod`属性以及`DeleteParameter`。</span><span class="sxs-lookup"><span data-stu-id="6082b-181">The ObjectDataSource will now include a value for its `DeleteMethod` property as well as a `DeleteParameter`.</span></span> <span data-ttu-id="6082b-182">回想一下，当使用向导指定的方法，Visual Studio 将设置 ObjectDataSource s`OldValuesParameterFormatString`属性`original_{0}`，这会导致出现问题更新和删除方法调用。</span><span class="sxs-lookup"><span data-stu-id="6082b-182">Recall that when using the wizard to specify the methods, Visual Studio sets the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}`, which causes problems with the update and delete method invocations.</span></span> <span data-ttu-id="6082b-183">因此，完全清除此属性，或将它重置为默认情况下， `{0}`。</span><span class="sxs-lookup"><span data-stu-id="6082b-183">Therefore, either clear out this property altogether or reset it to the default, `{0}`.</span></span> <span data-ttu-id="6082b-184">如果您需要刷新你在此 ObjectDataSource 属性上的内存，请参阅[概述的插入、 更新和删除数据](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="6082b-184">If you need to refresh your memory on this ObjectDataSource property, see the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial.</span></span>

<span data-ttu-id="6082b-185">完成该向导并修复后`OldValuesParameterFormatString`，ObjectDataSource s 声明性标记应类似如下所示：</span><span class="sxs-lookup"><span data-stu-id="6082b-185">After completing the wizard and fixing the `OldValuesParameterFormatString`, the ObjectDataSource s declarative markup should look similar like the following:</span></span>


[!code-aspx[Main](updating-and-deleting-existing-binary-data-cs/samples/sample4.aspx)]

<span data-ttu-id="6082b-186">在配置对象数据源之后, 删除通过将功能添加到 GridView 检查从 GridView s 智能标记启用删除复选框。</span><span class="sxs-lookup"><span data-stu-id="6082b-186">After configuring the ObjectDataSource, add deleting capabilities to the GridView by checking the Enable Deleting checkbox from the GridView s smart tag.</span></span> <span data-ttu-id="6082b-187">这会将 CommandField 添加到 GridView 其`ShowDeleteButton`属性设置为`true`。</span><span class="sxs-lookup"><span data-stu-id="6082b-187">This will add a CommandField to the GridView whose `ShowDeleteButton` property is set to `true`.</span></span>


<span data-ttu-id="6082b-188">[![为在 GridView 中删除启用支持](updating-and-deleting-existing-binary-data-cs/_static/image5.gif)](updating-and-deleting-existing-binary-data-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-188">[![Enable Support for Deleting in the GridView](updating-and-deleting-existing-binary-data-cs/_static/image5.gif)](updating-and-deleting-existing-binary-data-cs/_static/image9.png)</span></span>

<span data-ttu-id="6082b-189">**图 5**： 启用对 GridView 中删除的支持 ([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-189">**Figure 5**: Enable Support for Deleting in the GridView ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image10.png))</span></span>


<span data-ttu-id="6082b-190">花些时间测试的删除功能。</span><span class="sxs-lookup"><span data-stu-id="6082b-190">Take a moment to test out the delete functionality.</span></span> <span data-ttu-id="6082b-191">没有间的外键`Products`表 s`CategoryID`和`Categories`表的`CategoryID`，因此如果你尝试删除的任何前八个类别，你将收到外键约束冲突异常。</span><span class="sxs-lookup"><span data-stu-id="6082b-191">There is a foreign key between the `Products` table s `CategoryID` and the `Categories` table s `CategoryID`, so you will get a foreign key constraint violation exception if you attempt to delete any of the first eight categories.</span></span> <span data-ttu-id="6082b-192">若要测试出此功能，请添加一个新类别，提供小册子和图片。</span><span class="sxs-lookup"><span data-stu-id="6082b-192">To test this functionality out, add a new category, providing both a brochure and picture.</span></span> <span data-ttu-id="6082b-193">图 6 所示我测试类别包括一个名为的测试小册子文件`Test.pdf`和测试图片。</span><span class="sxs-lookup"><span data-stu-id="6082b-193">My test category, shown in Figure 6, includes a test brochure file named `Test.pdf` and a test picture.</span></span> <span data-ttu-id="6082b-194">图 7 显示 GridView 后添加测试类别。</span><span class="sxs-lookup"><span data-stu-id="6082b-194">Figure 7 shows the GridView after the test category has been added.</span></span>


<span data-ttu-id="6082b-195">[![添加具有小册子和图像的测试类别](updating-and-deleting-existing-binary-data-cs/_static/image6.gif)](updating-and-deleting-existing-binary-data-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-195">[![Add a Test Category with a Brochure and Image](updating-and-deleting-existing-binary-data-cs/_static/image6.gif)](updating-and-deleting-existing-binary-data-cs/_static/image11.png)</span></span>

<span data-ttu-id="6082b-196">**图 6**： 添加具有小册子和图像的测试类别 ([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-196">**Figure 6**: Add a Test Category with a Brochure and Image ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image12.png))</span></span>


<span data-ttu-id="6082b-197">[![插入后测试类别，它将显示在 GridView](updating-and-deleting-existing-binary-data-cs/_static/image7.gif)](updating-and-deleting-existing-binary-data-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-197">[![After Inserting the Test Category, it is Displayed in the GridView](updating-and-deleting-existing-binary-data-cs/_static/image7.gif)](updating-and-deleting-existing-binary-data-cs/_static/image13.png)</span></span>

<span data-ttu-id="6082b-198">**图 7**： 插入后测试类别，它将显示在 GridView ([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-198">**Figure 7**: After Inserting the Test Category, it is Displayed in the GridView ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image14.png))</span></span>


<span data-ttu-id="6082b-199">在 Visual Studio 中，刷新解决方案资源管理器。</span><span class="sxs-lookup"><span data-stu-id="6082b-199">In Visual Studio, refresh the Solution Explorer.</span></span> <span data-ttu-id="6082b-200">你现在应该看到的新文件中`~/Brochures`文件夹， `Test.pdf` （请参阅图 8）。</span><span class="sxs-lookup"><span data-stu-id="6082b-200">You should now see a new file in the `~/Brochures` folder, `Test.pdf` (see Figure 8).</span></span>

<span data-ttu-id="6082b-201">接下来，单击删除链接在测试类别行中，导致页后，可以回发和`CategoriesBLL`类的`DeleteCategory`方法激发。</span><span class="sxs-lookup"><span data-stu-id="6082b-201">Next, click the Delete link in the Test Category row, causing the page to postback and the `CategoriesBLL` class s `DeleteCategory` method to fire.</span></span> <span data-ttu-id="6082b-202">这将调用 DAL s`Delete`方法，使相应`DELETE`语句发送到数据库。</span><span class="sxs-lookup"><span data-stu-id="6082b-202">This will invoke the DAL s `Delete` method, causing the appropriate `DELETE` statement to be sent to the database.</span></span> <span data-ttu-id="6082b-203">然后，重新将数据绑定到 GridView 和标记发送回客户端使用测试类别不再存在。</span><span class="sxs-lookup"><span data-stu-id="6082b-203">The data is then rebound to the GridView and the markup is sent back to the client with the Test Category no longer present.</span></span>

<span data-ttu-id="6082b-204">而删除工作流已成功删除中的测试类别记录`Categories`表，而未从 web 服务器的文件系统中删除其小册子文件。</span><span class="sxs-lookup"><span data-stu-id="6082b-204">While the delete workflow successfully removed the Test Category record from the `Categories` table, it did not remove its brochure file from the web server s file system.</span></span> <span data-ttu-id="6082b-205">刷新解决方案资源管理器，你将看到，`Test.pdf`仍位于`~/Brochures`文件夹。</span><span class="sxs-lookup"><span data-stu-id="6082b-205">Refresh the Solution Explorer and you will see that `Test.pdf` is still sitting in the `~/Brochures` folder.</span></span>


![Test.pdf 文件未删除从 Web 服务器的文件系统](updating-and-deleting-existing-binary-data-cs/_static/image8.gif)

<span data-ttu-id="6082b-207">**图 8**:`Test.pdf`不从 Web 服务器的文件系统中删除文件</span><span class="sxs-lookup"><span data-stu-id="6082b-207">**Figure 8**: The `Test.pdf` File Was Not Deleted from the Web Server s File System</span></span>


## <a name="step-5-removing-the-deleted-category-s-brochure-file"></a><span data-ttu-id="6082b-208">步骤 5： 删除已删除的类别的小册子文件</span><span class="sxs-lookup"><span data-stu-id="6082b-208">Step 5: Removing the Deleted Category s Brochure File</span></span>

<span data-ttu-id="6082b-209">存储到数据库外部的二进制数据的缺点之一是，必须采取额外步骤来清理这些文件，删除关联的数据库记录时。</span><span class="sxs-lookup"><span data-stu-id="6082b-209">One of the downsides of storing binary data external to the database is that extra steps must be taken to clean up these files when the associated database record is deleted.</span></span> <span data-ttu-id="6082b-210">GridView 和 ObjectDataSource 提供激发之前和之后已执行 delete 命令的事件。</span><span class="sxs-lookup"><span data-stu-id="6082b-210">The GridView and ObjectDataSource provide events that fire both before and after the delete command has been performed.</span></span> <span data-ttu-id="6082b-211">我们实际上需要创建前和操作后事件的事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6082b-211">We actually need to create event handlers for both the pre- and post-action events.</span></span> <span data-ttu-id="6082b-212">之前`Categories`删除记录，我们需要确定其 PDF 文件的路径，但我们不想删除 PDF 类别中删除某些异常并且不删除类别之前。</span><span class="sxs-lookup"><span data-stu-id="6082b-212">Before the `Categories` record is deleted we need to determine its PDF file s path, but we don t want to delete the PDF before the category is deleted in case there is some exception and the category is not deleted.</span></span>

<span data-ttu-id="6082b-213">GridView s [ `RowDeleting`事件](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx)激发已调用 ObjectDataSource s delete 命令之前，而其[`RowDeleted`事件](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowdeleted.aspx)之后激发。</span><span class="sxs-lookup"><span data-stu-id="6082b-213">The GridView s [`RowDeleting` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx) fires before the ObjectDataSource s delete command has been invoked, while its [`RowDeleted` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowdeleted.aspx) fires after.</span></span> <span data-ttu-id="6082b-214">创建事件处理程序使用下面的代码这两个事件：</span><span class="sxs-lookup"><span data-stu-id="6082b-214">Create event handlers for these two events using the following code:</span></span>


[!code-csharp[Main](updating-and-deleting-existing-binary-data-cs/samples/sample5.cs)]

<span data-ttu-id="6082b-215">在`RowDeleting`事件处理程序，`CategoryID`的行在从 GridView s 抓取正在删除`DataKeys`集合，这可通过此事件处理程序中访问`e.Keys`集合。</span><span class="sxs-lookup"><span data-stu-id="6082b-215">In the `RowDeleting` event handler, the `CategoryID` of the row being deleted is grabbed from the GridView s `DataKeys` collection, which can be accessed in this event handler through the `e.Keys` collection.</span></span> <span data-ttu-id="6082b-216">接下来，`CategoriesBLL`类的`GetCategoryByCategoryID(categoryID)`调用以返回有关要删除的记录的信息。</span><span class="sxs-lookup"><span data-stu-id="6082b-216">Next, the `CategoriesBLL` class s `GetCategoryByCategoryID(categoryID)` is invoked to return information about the record being deleted.</span></span> <span data-ttu-id="6082b-217">如果返回`CategoriesDataRow`对象具有非`NULL``BrochurePath`值则存储在该页面变量`deletedCategorysPdfPath`，以便可以在删除该文件`RowDeleted`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6082b-217">If the returned `CategoriesDataRow` object has a non-`NULL``BrochurePath` value then it is stored in the page variable `deletedCategorysPdfPath` so that the file can be deleted in the `RowDeleted` event handler.</span></span>

> [!NOTE]
> <span data-ttu-id="6082b-218">而不是检索`BrochurePath`详细信息`Categories`记录中被删除`RowDeleting`事件处理程序中，我们无法或者添加`BrochurePath`到 GridView 的`DataKeyNames`属性和访问记录的值通过`e.Keys`集合。</span><span class="sxs-lookup"><span data-stu-id="6082b-218">Rather than retrieving the `BrochurePath` details for the `Categories` record being deleted in the `RowDeleting` event handler, we could have alternatively added the `BrochurePath` to the GridView s `DataKeyNames` property and accessed the record s value through the `e.Keys` collection.</span></span> <span data-ttu-id="6082b-219">这样将略有增加 GridView 的视图状态大小，但会减少所需的代码量并将行程保存到数据库。</span><span class="sxs-lookup"><span data-stu-id="6082b-219">Doing so would slightly increase the GridView s view state size, but would reduce the amount of code needed and save a trip to the database.</span></span>


<span data-ttu-id="6082b-220">已调用 s 基础 delete 命令，ObjectDataSource GridView s 后`RowDeleted`事件处理程序将触发。</span><span class="sxs-lookup"><span data-stu-id="6082b-220">After the ObjectDataSource s underlying delete command has been invoked, the GridView s `RowDeleted` event handler fires.</span></span> <span data-ttu-id="6082b-221">如果不没有中删除数据的任何异常，并且没有值`deletedCategorysPdfPath`，然后从文件系统中删除 PDF。</span><span class="sxs-lookup"><span data-stu-id="6082b-221">If there were no exceptions in deleting the data and there is a value for `deletedCategorysPdfPath`, then the PDF is deleted from the file system.</span></span> <span data-ttu-id="6082b-222">请注意，则不需要此额外代码以清理其图片与关联的类别 s 二进制数据。</span><span class="sxs-lookup"><span data-stu-id="6082b-222">Note that this extra code is not needed to clean up the category s binary data associated with its picture.</span></span> <span data-ttu-id="6082b-223">该 s 因为直接在数据库中存储的图片数据，因此删除`Categories`行也会删除该类别的图片数据。</span><span class="sxs-lookup"><span data-stu-id="6082b-223">That s because the picture data is stored directly in the database, so deleting the `Categories` row also deletes that category s picture data.</span></span>

<span data-ttu-id="6082b-224">添加两个事件处理程序后, 再次运行此测试用例。</span><span class="sxs-lookup"><span data-stu-id="6082b-224">After adding the two event handlers, run this test case again.</span></span> <span data-ttu-id="6082b-225">当删除类别时，也将删除其关联的 PDF。</span><span class="sxs-lookup"><span data-stu-id="6082b-225">When deleting the category, its associated PDF is also deleted.</span></span>

<span data-ttu-id="6082b-226">更新现有的关联记录 s 二进制数据提供了一些有趣的难题。</span><span class="sxs-lookup"><span data-stu-id="6082b-226">Updating an existing record s associated binary data provides some interesting challenges.</span></span> <span data-ttu-id="6082b-227">本教程的其余部分深入介绍了将更新功能添加到的手册和图片。</span><span class="sxs-lookup"><span data-stu-id="6082b-227">The remainder of this tutorial delves into adding update capabilities to the brochure and picture.</span></span> <span data-ttu-id="6082b-228">步骤 6 探讨了用于在步骤 7 考察更新图更新小册子信息技术。</span><span class="sxs-lookup"><span data-stu-id="6082b-228">Step 6 explores techniques for updating the brochure information while Step 7 looks at updating the picture.</span></span>

## <a name="step-6-updating-a-category-s-brochure"></a><span data-ttu-id="6082b-229">步骤 6： 更新类别的手册</span><span class="sxs-lookup"><span data-stu-id="6082b-229">Step 6: Updating a Category s Brochure</span></span>

<span data-ttu-id="6082b-230">中所述[概述的插入、 更新和删除数据](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)教程中，GridView 提供其基础数据源是否可以通过一个复选框的刻度线的内置行级编辑支持适当地配置。</span><span class="sxs-lookup"><span data-stu-id="6082b-230">As discussed in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial, the GridView offers built-in row-level editing support that can be implemented by the tick of a checkbox if its underlying data source is appropriately configured.</span></span> <span data-ttu-id="6082b-231">目前， `CategoriesDataSource` ObjectDataSource 尚未配置以包括更新支持，因此让 s 添加中。</span><span class="sxs-lookup"><span data-stu-id="6082b-231">Currently, the `CategoriesDataSource` ObjectDataSource is not yet configured to include updating support, so let s add that in.</span></span>

<span data-ttu-id="6082b-232">单击从 ObjectDataSource 的向导的配置数据源链接，转到第二个步骤。</span><span class="sxs-lookup"><span data-stu-id="6082b-232">Click the Configure Data Source link from the ObjectDataSource s wizard and proceed to the second step.</span></span> <span data-ttu-id="6082b-233">由于`DataObjectMethodAttribute`中使用`CategoriesBLL`，更新下拉列表应自动用填充`UpdateCategory`接受四个输入参数的重载 (所有列，但`Picture`)。</span><span class="sxs-lookup"><span data-stu-id="6082b-233">Because of the `DataObjectMethodAttribute` used in `CategoriesBLL`, the UPDATE drop-down list should automatically be populated with the `UpdateCategory` overload that accepts four input parameters (for all columns but `Picture`).</span></span> <span data-ttu-id="6082b-234">更改此步骤，以便它使用五个参数的重载。</span><span class="sxs-lookup"><span data-stu-id="6082b-234">Change this so that it uses the overload with five parameters.</span></span>


<span data-ttu-id="6082b-235">[![配置对象数据源以使用包含一个参数为图片 UpdateCategory 方法](updating-and-deleting-existing-binary-data-cs/_static/image9.gif)](updating-and-deleting-existing-binary-data-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-235">[![Configure the ObjectDataSource to Use the UpdateCategory Method that Includes a Parameter for Picture](updating-and-deleting-existing-binary-data-cs/_static/image9.gif)](updating-and-deleting-existing-binary-data-cs/_static/image15.png)</span></span>

<span data-ttu-id="6082b-236">**图 9**： 配置使用 ObjectDataSource`UpdateCategory`包括的参数的方法`Picture`([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-236">**Figure 9**: Configure the ObjectDataSource to Use the `UpdateCategory` Method that Includes a Parameter for `Picture` ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image16.png))</span></span>


<span data-ttu-id="6082b-237">ObjectDataSource 现在将包括的值其`UpdateMethod`属性以及对应`UpdateParameter`s。</span><span class="sxs-lookup"><span data-stu-id="6082b-237">The ObjectDataSource will now include a value for its `UpdateMethod` property as well as corresponding `UpdateParameter` s.</span></span> <span data-ttu-id="6082b-238">Visual Studio 在步骤 4 中所述，设置 ObjectDataSource s`OldValuesParameterFormatString`属性`original_{0}`时使用配置数据源向导。</span><span class="sxs-lookup"><span data-stu-id="6082b-238">As noted in Step 4, Visual Studio sets the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}` when using the Configure Data Source wizard.</span></span> <span data-ttu-id="6082b-239">这将导致问题的更新和删除方法调用。</span><span class="sxs-lookup"><span data-stu-id="6082b-239">This will cause problems with the update and delete method invocations.</span></span> <span data-ttu-id="6082b-240">因此，完全清除此属性，或将它重置为默认情况下， `{0}`。</span><span class="sxs-lookup"><span data-stu-id="6082b-240">Therefore, either clear out this property altogether or reset it to the default, `{0}`.</span></span>

<span data-ttu-id="6082b-241">完成该向导并修复后`OldValuesParameterFormatString`，ObjectDataSource s 声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="6082b-241">After completing the wizard and fixing the `OldValuesParameterFormatString`, the ObjectDataSource s declarative markup should look like the following:</span></span>


[!code-aspx[Main](updating-and-deleting-existing-binary-data-cs/samples/sample6.aspx)]

<span data-ttu-id="6082b-242">若要打开 s 内置编辑功能的 GridView，选中从 GridView s 智能标记启用编辑选项。</span><span class="sxs-lookup"><span data-stu-id="6082b-242">To turn on the GridView s built-in editing features, check the Enable Editing option from the GridView s smart tag.</span></span> <span data-ttu-id="6082b-243">这便会设置 CommandField s`ShowEditButton`属性`true`，这会导致其他部分的编辑按钮 （和正在编辑的行的更新和取消按钮）。</span><span class="sxs-lookup"><span data-stu-id="6082b-243">This will set the CommandField s `ShowEditButton` property to `true`, resulting in the addition of an Edit button (and Update and Cancel buttons for the row being edited).</span></span>


<span data-ttu-id="6082b-244">[![配置为支持编辑 GridView](updating-and-deleting-existing-binary-data-cs/_static/image10.gif)](updating-and-deleting-existing-binary-data-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-244">[![Configure the GridView to Support Editing](updating-and-deleting-existing-binary-data-cs/_static/image10.gif)](updating-and-deleting-existing-binary-data-cs/_static/image17.png)</span></span>

<span data-ttu-id="6082b-245">**图 10**： 配置为支持编辑 GridView ([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-245">**Figure 10**: Configure the GridView to Support Editing ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image18.png))</span></span>


<span data-ttu-id="6082b-246">访问通过浏览器页面，单击一个行的编辑按钮。</span><span class="sxs-lookup"><span data-stu-id="6082b-246">Visit the page through a browser and click one of the row s Edit buttons.</span></span> <span data-ttu-id="6082b-247">`CategoryName`和`Description`BoundFields 呈现为文本框。</span><span class="sxs-lookup"><span data-stu-id="6082b-247">The `CategoryName` and `Description` BoundFields are rendered as textboxes.</span></span> <span data-ttu-id="6082b-248">`BrochurePath` TemplateField 缺少`EditItemTemplate`，因此它将继续显示其`ItemTemplate`小册子中的链接。</span><span class="sxs-lookup"><span data-stu-id="6082b-248">The `BrochurePath` TemplateField lacks an `EditItemTemplate`, so it continues to show its `ItemTemplate` a link to the brochure.</span></span> <span data-ttu-id="6082b-249">`Picture` ImageField 呈现文本框中为其`Text`属性被赋值 ImageField s`DataImageUrlField`值，在这种情况下`CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="6082b-249">The `Picture` ImageField renders as a TextBox whose `Text` property is assigned the value of the ImageField s `DataImageUrlField` value, in this case `CategoryID`.</span></span>


<span data-ttu-id="6082b-250">[![GridView 为 BrochurePath 缺少编辑接口](updating-and-deleting-existing-binary-data-cs/_static/image11.gif)](updating-and-deleting-existing-binary-data-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-250">[![The GridView Lacks an Editing Interface for BrochurePath](updating-and-deleting-existing-binary-data-cs/_static/image11.gif)](updating-and-deleting-existing-binary-data-cs/_static/image19.png)</span></span>

<span data-ttu-id="6082b-251">**图 11**: GridView 缺少用于的编辑接口`BrochurePath`([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-251">**Figure 11**: The GridView Lacks an Editing Interface for `BrochurePath` ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image20.png))</span></span>


## <a name="customizing-thebrochurepaths-editing-interface"></a><span data-ttu-id="6082b-252">自定义`BrochurePath`s 编辑接口</span><span class="sxs-lookup"><span data-stu-id="6082b-252">Customizing the`BrochurePath`s Editing Interface</span></span>

<span data-ttu-id="6082b-253">我们需要创建的编辑接口`BrochurePath`TemplateField，允许用户或者直接：</span><span class="sxs-lookup"><span data-stu-id="6082b-253">We need to create an editing interface for the `BrochurePath` TemplateField, one that allows the user to either:</span></span>

- <span data-ttu-id="6082b-254">将类别的小册子中作为-，</span><span class="sxs-lookup"><span data-stu-id="6082b-254">Leave the category s brochure as-is,</span></span>
- <span data-ttu-id="6082b-255">通过上载新小册子中，更新类别的手册或</span><span class="sxs-lookup"><span data-stu-id="6082b-255">Update the category s brochure by uploading a new brochure, or</span></span>
- <span data-ttu-id="6082b-256">（在类别不再具有关联的小册子的情况下） 完全移除类别的手册。</span><span class="sxs-lookup"><span data-stu-id="6082b-256">Remove the category s brochure altogether (in the case that the category no longer has an associated brochure).</span></span>

<span data-ttu-id="6082b-257">我们还需要更新`Picture`ImageField s 编辑接口，但我们将获取与此步骤 7 中。</span><span class="sxs-lookup"><span data-stu-id="6082b-257">We also need to update the `Picture` ImageField s editing interface, but we'll get to this in Step 7.</span></span>

<span data-ttu-id="6082b-258">从 GridView s 智能标记中，单击编辑模板链接，然后选择`BrochurePath`TemplateField 的`EditItemTemplate`从下拉列表。</span><span class="sxs-lookup"><span data-stu-id="6082b-258">From the GridView s smart tag, click on the Edit Templates link and select the `BrochurePath` TemplateField s `EditItemTemplate` from the drop-down list.</span></span> <span data-ttu-id="6082b-259">说明如何 Web 控件添加到此模板中，设置其`ID`属性`BrochureOptions`及其`AutoPostBack`属性`true`。</span><span class="sxs-lookup"><span data-stu-id="6082b-259">Add a RadioButtonList Web control to this template, setting its `ID` property to `BrochureOptions` and its `AutoPostBack` property to `true`.</span></span> <span data-ttu-id="6082b-260">从属性窗口中，单击省略号以`Items`属性，它会弹出`ListItem`集合编辑器。</span><span class="sxs-lookup"><span data-stu-id="6082b-260">From the Properties window, click on the ellipses in the `Items` property, which will bring up the `ListItem` Collection Editor.</span></span> <span data-ttu-id="6082b-261">添加的以下三个选项`Value`的 1、 2 和 3，分别：</span><span class="sxs-lookup"><span data-stu-id="6082b-261">Add the following three options with `Value` s 1, 2 and 3, respectively:</span></span>

- <span data-ttu-id="6082b-262">使用当前手册</span><span class="sxs-lookup"><span data-stu-id="6082b-262">Use current brochure</span></span>
- <span data-ttu-id="6082b-263">删除当前手册</span><span class="sxs-lookup"><span data-stu-id="6082b-263">Remove current brochure</span></span>
- <span data-ttu-id="6082b-264">上载新的手册</span><span class="sxs-lookup"><span data-stu-id="6082b-264">Upload new brochure</span></span>

<span data-ttu-id="6082b-265">设置第一个`ListItem`s`Selected`属性`true`。</span><span class="sxs-lookup"><span data-stu-id="6082b-265">Set the first `ListItem` s `Selected` property to `true`.</span></span>


![说明如何向中添加三个 ListItems](updating-and-deleting-existing-binary-data-cs/_static/image12.gif)

<span data-ttu-id="6082b-267">**图 12**： 添加三个`ListItem`到说明如何</span><span class="sxs-lookup"><span data-stu-id="6082b-267">**Figure 12**: Add Three `ListItem` s to the RadioButtonList</span></span>


<span data-ttu-id="6082b-268">下面说明如何，添加一个名为的 FileUpload 控件`BrochureUpload`。</span><span class="sxs-lookup"><span data-stu-id="6082b-268">Beneath the RadioButtonList, add a FileUpload control named `BrochureUpload`.</span></span> <span data-ttu-id="6082b-269">设置其`Visible`属性`false`。</span><span class="sxs-lookup"><span data-stu-id="6082b-269">Set its `Visible` property to `false`.</span></span>


<span data-ttu-id="6082b-270">[![将说明如何和 FileUpload 控件添加到 EditItemTemplate](updating-and-deleting-existing-binary-data-cs/_static/image13.gif)](updating-and-deleting-existing-binary-data-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-270">[![Add a RadioButtonList and FileUpload Control to the EditItemTemplate](updating-and-deleting-existing-binary-data-cs/_static/image13.gif)](updating-and-deleting-existing-binary-data-cs/_static/image21.png)</span></span>

<span data-ttu-id="6082b-271">**图 13**： 添加说明如何与 FileUpload 控制`EditItemTemplate`([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-271">**Figure 13**: Add a RadioButtonList and FileUpload Control to the `EditItemTemplate` ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image22.png))</span></span>


<span data-ttu-id="6082b-272">此说明如何提供用户的三个选项。</span><span class="sxs-lookup"><span data-stu-id="6082b-272">This RadioButtonList provides the three options for the user.</span></span> <span data-ttu-id="6082b-273">思路是仅当选择最后一个选项，上载新小册子中，将显示 FileUpload 控件。</span><span class="sxs-lookup"><span data-stu-id="6082b-273">The idea is that the FileUpload control will be displayed only if the last option, Upload new brochure, is selected.</span></span> <span data-ttu-id="6082b-274">若要实现此目的，创建的事件处理程序说明如何的`SelectedIndexChanged`事件并添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="6082b-274">To accomplish this, create an event handler for the RadioButtonList s `SelectedIndexChanged` event and add the following code:</span></span>


[!code-csharp[Main](updating-and-deleting-existing-binary-data-cs/samples/sample7.cs)]

<span data-ttu-id="6082b-275">由于如何和 FileUpload 控件是在模板中，我们必须编写的代码以编程方式访问这些控件。</span><span class="sxs-lookup"><span data-stu-id="6082b-275">Since the RadioButtonList and FileUpload controls are within a template, we have to write a bit of code to programmatically access these controls.</span></span> <span data-ttu-id="6082b-276">`SelectedIndexChanged`事件处理程序传递的引用中说明如何`sender`输入的参数。</span><span class="sxs-lookup"><span data-stu-id="6082b-276">The `SelectedIndexChanged` event handler is passed a reference of the RadioButtonList in the `sender` input parameter.</span></span> <span data-ttu-id="6082b-277">若要获取 FileUpload 控件，我们需要先获取说明如何的父控件并使用`FindControl("controlID")`从那里的方法。</span><span class="sxs-lookup"><span data-stu-id="6082b-277">To get the FileUpload control, we need to get the RadioButtonList s parent control and use the `FindControl("controlID")` method from there.</span></span> <span data-ttu-id="6082b-278">一旦我们有了说明如何和 FileUpload 控件的引用，FileUpload 控制 s`Visible`属性设置为`true`才说明如何 s`SelectedValue`等于 3，这是`Value`上载新手册`ListItem`.</span><span class="sxs-lookup"><span data-stu-id="6082b-278">Once we have a reference to both the RadioButtonList and FileUpload controls, the FileUpload control s `Visible` property is set to `true` only if the RadioButtonList s `SelectedValue` equals 3, which is the `Value` for the Upload new brochure `ListItem`.</span></span>

<span data-ttu-id="6082b-279">与此代码中的位置，需要花费一段时间来测试编辑界面。</span><span class="sxs-lookup"><span data-stu-id="6082b-279">With this code in place, take a moment to test out the editing interface.</span></span> <span data-ttu-id="6082b-280">单击编辑按钮的行。</span><span class="sxs-lookup"><span data-stu-id="6082b-280">Click on the Edit button for a row.</span></span> <span data-ttu-id="6082b-281">最初，应选择使用当前小册子选项。</span><span class="sxs-lookup"><span data-stu-id="6082b-281">Initially, the Use current brochure option should be selected.</span></span> <span data-ttu-id="6082b-282">更改所选的索引会导致回发。</span><span class="sxs-lookup"><span data-stu-id="6082b-282">Changing the selected index causes a postback.</span></span> <span data-ttu-id="6082b-283">如果选择第三个选项，则显示 FileUpload 控件，否则其处于隐藏状态。</span><span class="sxs-lookup"><span data-stu-id="6082b-283">If the third option is selected, the FileUpload control is displayed, otherwise it is hidden.</span></span> <span data-ttu-id="6082b-284">图 14 首先单击编辑按钮; 时显示的编辑接口图 15 演示接口之后选择上载新小册子选项。</span><span class="sxs-lookup"><span data-stu-id="6082b-284">Figure 14 shows the editing interface when the Edit button is first clicked; Figure 15 shows the interface after the Upload new brochure option is selected.</span></span>


<span data-ttu-id="6082b-285">[![最初，使用当前小册子中选择选项](updating-and-deleting-existing-binary-data-cs/_static/image14.gif)](updating-and-deleting-existing-binary-data-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-285">[![Initially, the Use current brochure Option is Selected](updating-and-deleting-existing-binary-data-cs/_static/image14.gif)](updating-and-deleting-existing-binary-data-cs/_static/image23.png)</span></span>

<span data-ttu-id="6082b-286">**图 14**： 最初，使用当前小册子选项 ([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-286">**Figure 14**: Initially, the Use current brochure Option is Selected ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image24.png))</span></span>


<span data-ttu-id="6082b-287">[![选择上载新小册子中此选项可以显示 FileUpload 控件](updating-and-deleting-existing-binary-data-cs/_static/image15.gif)](updating-and-deleting-existing-binary-data-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-287">[![Choosing the Upload new brochure Option Displays the FileUpload Control](updating-and-deleting-existing-binary-data-cs/_static/image15.gif)](updating-and-deleting-existing-binary-data-cs/_static/image25.png)</span></span>

<span data-ttu-id="6082b-288">**图 15**： 选择上载新小册子中此选项可以显示 FileUpload 控件 ([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-288">**Figure 15**: Choosing the Upload new brochure Option Displays the FileUpload Control ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image26.png))</span></span>


## <a name="saving-the-brochure-file-and-updating-thebrochurepathcolumn"></a><span data-ttu-id="6082b-289">保存小册子中文件和更新`BrochurePath`列</span><span class="sxs-lookup"><span data-stu-id="6082b-289">Saving the Brochure File and Updating the`BrochurePath`Column</span></span>

<span data-ttu-id="6082b-290">单击 GridView s 更新按钮后，其`RowUpdating`事件激发。</span><span class="sxs-lookup"><span data-stu-id="6082b-290">When the GridView s Update button is clicked, its `RowUpdating` event fires.</span></span> <span data-ttu-id="6082b-291">调用 s 更新命令 ObjectDataSource，然后选择 GridView 的`RowUpdated`事件激发。</span><span class="sxs-lookup"><span data-stu-id="6082b-291">The ObjectDataSource s update command is invoked and then the GridView s `RowUpdated` event fires.</span></span> <span data-ttu-id="6082b-292">像借助删除工作流，我们需要为这两种事件创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6082b-292">Like with the deleting workflow, we need to create event handlers for both of these events.</span></span> <span data-ttu-id="6082b-293">在`RowUpdating`事件处理程序，我们需要确定要执行的操作基于`SelectedValue`的`BrochureOptions`说明如何：</span><span class="sxs-lookup"><span data-stu-id="6082b-293">In the `RowUpdating` event handler, we need to determine what action to take based on the `SelectedValue` of the `BrochureOptions` RadioButtonList:</span></span>

- <span data-ttu-id="6082b-294">如果`SelectedValue`为 1，我们想要继续使用相同`BrochurePath`设置。</span><span class="sxs-lookup"><span data-stu-id="6082b-294">If the `SelectedValue` is 1, we want to keep using the same `BrochurePath` setting.</span></span> <span data-ttu-id="6082b-295">因此，我们需要将设置 ObjectDataSource s`brochurePath`到现有的参数`BrochurePath`正在更新的记录的值。</span><span class="sxs-lookup"><span data-stu-id="6082b-295">Therefore, we need to set the ObjectDataSource s `brochurePath` parameter to the existing `BrochurePath` value of the record being updated.</span></span> <span data-ttu-id="6082b-296">ObjectDataSource s`brochurePath`参数可以设置使用`e.NewValues["brochurePath"] = value`。</span><span class="sxs-lookup"><span data-stu-id="6082b-296">The ObjectDataSource s `brochurePath` parameter can be set using `e.NewValues["brochurePath"] = value`.</span></span>
- <span data-ttu-id="6082b-297">如果`SelectedValue`为 2，则我们想要设置记录 s`BrochurePath`值赋给`NULL`。</span><span class="sxs-lookup"><span data-stu-id="6082b-297">If the `SelectedValue` is 2, then we want to set the record s `BrochurePath` value to `NULL`.</span></span> <span data-ttu-id="6082b-298">这可以通过设置 ObjectDataSource s`brochurePath`参数`Nothing`，这将导致数据库`NULL`中正在使用`UPDATE`语句。</span><span class="sxs-lookup"><span data-stu-id="6082b-298">This can be accomplished by setting the ObjectDataSource s `brochurePath` parameter to `Nothing`, which results in a database `NULL` being used in the `UPDATE` statement.</span></span> <span data-ttu-id="6082b-299">如果没有正在删除现有小册子文件，我们需要删除现有文件。</span><span class="sxs-lookup"><span data-stu-id="6082b-299">If there is an existing brochure file that is being removed, we need to delete the existing file.</span></span> <span data-ttu-id="6082b-300">但是，我们只想要执行此操作，如果更新完成而不会引发异常。</span><span class="sxs-lookup"><span data-stu-id="6082b-300">However, we only want to do this if the update completes without raising an exception.</span></span>
- <span data-ttu-id="6082b-301">如果`SelectedValue`为 3，则我们想要确保用户已上载 PDF 文件，然后将其保存到文件系统并更新记录的`BrochurePath`列的值。</span><span class="sxs-lookup"><span data-stu-id="6082b-301">If the `SelectedValue` is 3, then we want to ensure that the user has uploaded a PDF file and then save it to the file system and update the record s `BrochurePath` column value.</span></span> <span data-ttu-id="6082b-302">此外，如果没有将被替换的现有小册子文件，我们需要删除以前的文件。</span><span class="sxs-lookup"><span data-stu-id="6082b-302">Moreover, if there is an existing brochure file that is being replaced, we need to delete the previous file.</span></span> <span data-ttu-id="6082b-303">但是，我们只想要执行此操作，如果更新完成而不会引发异常。</span><span class="sxs-lookup"><span data-stu-id="6082b-303">However, we only want to do this if the update completes without raising an exception.</span></span>

<span data-ttu-id="6082b-304">当完成所需的步骤说明如何 s`SelectedValue`是 3 几乎是相同的所使用的说明如何的`ItemInserting`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6082b-304">The steps needed to be completed when the RadioButtonList s `SelectedValue` is 3 are virtually identical to those used by the DetailsView s `ItemInserting` event handler.</span></span> <span data-ttu-id="6082b-305">此事件处理程序执行时从我们添加中的说明如何控件添加新类别记录[以前一教程](including-a-file-upload-option-when-adding-a-new-record-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="6082b-305">This event handler is executed when a new category record is added from the DetailsView control we added in the [previous tutorial](including-a-file-upload-option-when-adding-a-new-record-cs.md).</span></span> <span data-ttu-id="6082b-306">因此，它 behooves 我们可以重构出到单独的方法，此功能。</span><span class="sxs-lookup"><span data-stu-id="6082b-306">Therefore, it behooves us to refactor this functionality out into separate methods.</span></span> <span data-ttu-id="6082b-307">具体而言，我移出的常见功能为两个方法：</span><span class="sxs-lookup"><span data-stu-id="6082b-307">Specifically, I moved out the common functionality into two methods:</span></span>

- <span data-ttu-id="6082b-308">`ProcessBrochureUpload(FileUpload, out bool)`FileUpload 控件实例和一个输出布尔值，指定是否应继续删除或编辑操作或如果不应将其取消由于某个验证错误，则接受作为输入。</span><span class="sxs-lookup"><span data-stu-id="6082b-308">`ProcessBrochureUpload(FileUpload, out bool)` accepts as input a FileUpload control instance and an output Boolean value that specifies whether the delete or edit operation should proceed or if it should be cancelled due to some validation error.</span></span> <span data-ttu-id="6082b-309">此方法返回的已保存文件的路径或`null`如果没有文件已保存。</span><span class="sxs-lookup"><span data-stu-id="6082b-309">This method returns the path to the saved file or `null` if no file was saved.</span></span>
- <span data-ttu-id="6082b-310">`DeleteRememberedBrochurePath`删除指定的页面变量中的路径的文件`deletedCategorysPdfPath`如果`deletedCategorysPdfPath`不`null`。</span><span class="sxs-lookup"><span data-stu-id="6082b-310">`DeleteRememberedBrochurePath` deletes the file specified by the path in the page variable `deletedCategorysPdfPath` if `deletedCategorysPdfPath` is not `null`.</span></span>

<span data-ttu-id="6082b-311">遵循这两种方法的代码。</span><span class="sxs-lookup"><span data-stu-id="6082b-311">The code for these two methods follows.</span></span> <span data-ttu-id="6082b-312">请注意之间的相似性`ProcessBrochureUpload`和说明如何的`ItemInserting`从前面的教程的事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6082b-312">Note the similarity between `ProcessBrochureUpload` and the DetailsView s `ItemInserting` event handler from the previous tutorial.</span></span> <span data-ttu-id="6082b-313">在本教程中，我已更新说明的事件处理程序以使用这些新方法。</span><span class="sxs-lookup"><span data-stu-id="6082b-313">In this tutorial I have updated the DetailsView s event handlers to use these new methods.</span></span> <span data-ttu-id="6082b-314">下载与本教程，若要查看对说明的事件处理程序的修改关联的代码。</span><span class="sxs-lookup"><span data-stu-id="6082b-314">Download the code associated with this tutorial to see the modifications to the DetailsView s event handlers.</span></span>


[!code-csharp[Main](updating-and-deleting-existing-binary-data-cs/samples/sample8.cs)]

<span data-ttu-id="6082b-315">GridView s`RowUpdating`和`RowUpdated`事件处理程序使用`ProcessBrochureUpload`和`DeleteRememberedBrochurePath`方法，如以下代码所示：</span><span class="sxs-lookup"><span data-stu-id="6082b-315">The GridView s `RowUpdating` and `RowUpdated` event handlers use the `ProcessBrochureUpload` and `DeleteRememberedBrochurePath` methods, as the following code shows:</span></span>


[!code-csharp[Main](updating-and-deleting-existing-binary-data-cs/samples/sample9.cs)]

<span data-ttu-id="6082b-316">请注意如何`RowUpdating`事件处理程序使用一系列条件语句来执行相应的操作基于`BrochureOptions`说明如何的`SelectedValue`属性值。</span><span class="sxs-lookup"><span data-stu-id="6082b-316">Note how the `RowUpdating` event handler uses a series of conditional statements to perform the appropriate action based on the `BrochureOptions` RadioButtonList s `SelectedValue` property value.</span></span>

<span data-ttu-id="6082b-317">使用此代码中的位置，你可以编辑某一类别，并将其使用其当前小册子，请使用没有小册子中，或上载一个新。</span><span class="sxs-lookup"><span data-stu-id="6082b-317">With this code in place, you can edit a category and have it use its current brochure, use no brochure, or upload a new one.</span></span> <span data-ttu-id="6082b-318">请继续并对其进行测试。在中设置断点`RowUpdating`和`RowUpdated`事件处理程序以获取工作流的意义。</span><span class="sxs-lookup"><span data-stu-id="6082b-318">Go ahead and try it out. Set breakpoints in the `RowUpdating` and `RowUpdated` event handlers to get a sense of the workflow.</span></span>

## <a name="step-7-uploading-a-new-picture"></a><span data-ttu-id="6082b-319">步骤 7： 上载新图片</span><span class="sxs-lookup"><span data-stu-id="6082b-319">Step 7: Uploading a New Picture</span></span>

<span data-ttu-id="6082b-320">`Picture` ImageField s 编辑接口呈现为文本框中，使用从值填充其`DataImageUrlField`属性。</span><span class="sxs-lookup"><span data-stu-id="6082b-320">The `Picture` ImageField s editing interface renders as a textbox populated with the value from its `DataImageUrlField` property.</span></span> <span data-ttu-id="6082b-321">在编辑工作流，GridView 将参数传递给参数 s 同名 ObjectDataSource ImageField 的值`DataImageUrlField`属性和参数 s 值编辑界面中，在文本框中输入的值。</span><span class="sxs-lookup"><span data-stu-id="6082b-321">During the editing workflow, the GridView passes a parameter to the ObjectDataSource with the parameter s name the value of the ImageField s `DataImageUrlField` property and the parameter s value the value entered into the textbox in the editing interface.</span></span> <span data-ttu-id="6082b-322">映像保存为文件系统上的文件时，此行为是适合和`DataImageUrlField`包含图像的完整 URL。</span><span class="sxs-lookup"><span data-stu-id="6082b-322">This behavior is suitable when the image is saved as a file on the file system and the `DataImageUrlField` contains the full URL of the image.</span></span> <span data-ttu-id="6082b-323">与此类情况下，编辑界面显示图像的 URL 在文本框中，用户可以更改和保存回数据库。</span><span class="sxs-lookup"><span data-stu-id="6082b-323">With such circumstances, the editing interface displays the image s URL in the textbox, which the user can change and have saved back to the database.</span></span> <span data-ttu-id="6082b-324">授予，此默认接口不允许用户上载一个新的映像，但它确实允许它们将图像的 URL 与当前值更改为另一个。</span><span class="sxs-lookup"><span data-stu-id="6082b-324">Granted, this default interface doesn t allow the user to upload a new image, but it does let them change the URL of the image from the current value to another.</span></span> <span data-ttu-id="6082b-325">对于本教程，但是，编辑接口 ImageField 的默认不满足需要因为`Picture`直接在数据库中存储二进制数据和`DataImageUrlField`属性包含仅`CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="6082b-325">For this tutorial, however, the ImageField s default editing interface does not suffice because the `Picture` binary data is being stored directly in the database and the `DataImageUrlField` property holds just the `CategoryID`.</span></span>

<span data-ttu-id="6082b-326">若要更好地了解时会发生什么情况在我们的教程用户编辑具有 ImageField 的行，请考虑下面的示例： 用户编辑某一行而该行`CategoryID`10，导致`Picture`ImageField 以将呈现为文本框中，值为 10。</span><span class="sxs-lookup"><span data-stu-id="6082b-326">To better understand what happens in our tutorial when a user edits a row with an ImageField, consider the following example: a user edits a row with `CategoryID` 10, causing the `Picture` ImageField to render as a textbox with the value 10.</span></span> <span data-ttu-id="6082b-327">假设用户在此文本框中的值更改为 50，并单击更新按钮。</span><span class="sxs-lookup"><span data-stu-id="6082b-327">Imagine that the user changes the value in this textbox to 50 and clicks the Update button.</span></span> <span data-ttu-id="6082b-328">产生的回发和 GridView 最初创建一个名为参数`CategoryID`值 50。</span><span class="sxs-lookup"><span data-stu-id="6082b-328">A postback occurs and the GridView initially creates a parameter named `CategoryID` with the value 50.</span></span> <span data-ttu-id="6082b-329">但是，GridView 发送此参数之前 (和`CategoryName`和`Description`参数)，它会从值内添加`DataKeys`集合。</span><span class="sxs-lookup"><span data-stu-id="6082b-329">However, before the GridView sends this parameter (and the `CategoryName` and `Description` parameters), it adds in the values from the `DataKeys` collection.</span></span> <span data-ttu-id="6082b-330">因此，它将覆盖`CategoryID`参数与当前行 s 基础`CategoryID`值 10。</span><span class="sxs-lookup"><span data-stu-id="6082b-330">Therefore, it overwrites the `CategoryID` parameter with the current row s underlying `CategoryID` value, 10.</span></span> <span data-ttu-id="6082b-331">简单地说，编辑接口 ImageField s 没有任何影响编辑工作流出于本教程因为 ImageField 的名称`DataImageUrlField`属性和网格的`DataKey`值都相同。</span><span class="sxs-lookup"><span data-stu-id="6082b-331">In short, the ImageField s editing interface has no affect on the editing workflow for this tutorial because names of the ImageField s `DataImageUrlField` property and the grid s `DataKey` value are one in the same.</span></span>

<span data-ttu-id="6082b-332">尽管 ImageField 使得变得更容易地显示基于数据库数据的映像，我们不想提供编辑界面中的文本框。</span><span class="sxs-lookup"><span data-stu-id="6082b-332">While the ImageField makes it easy to display an image based on database data, we don t want to provide a textbox in the editing interface.</span></span> <span data-ttu-id="6082b-333">相反，我们想要提供最终用户可用于更改类别的图片 FileUpload 控件。</span><span class="sxs-lookup"><span data-stu-id="6082b-333">Rather, we want to offer a FileUpload control that the end user can use to change the category s picture.</span></span> <span data-ttu-id="6082b-334">与不同`BrochurePath`值，这些教程我们已决定需要每个类别，必须具有图片。</span><span class="sxs-lookup"><span data-stu-id="6082b-334">Unlike the `BrochurePath` value, for these tutorials we ve decided to require that each category must have a picture.</span></span> <span data-ttu-id="6082b-335">因此，我们不需要让用户指示是否有任何关联的图片用户可能将.vhd 文件的新图片或保留当前图片作为-是。</span><span class="sxs-lookup"><span data-stu-id="6082b-335">Therefore, we don t need to let the user indicate that there is no associated picture the user may either upload a new picture or leave the current picture as-is.</span></span>

<span data-ttu-id="6082b-336">若要自定义 ImageField s 编辑界面，我们需要将其转换转换为 TemplateField。</span><span class="sxs-lookup"><span data-stu-id="6082b-336">To customize the ImageField s editing interface, we need to convert it into a TemplateField.</span></span> <span data-ttu-id="6082b-337">从 GridView s 智能标记，单击编辑列链接、 选择 ImageField，和 TemplateField 链接到单击转换此字段。</span><span class="sxs-lookup"><span data-stu-id="6082b-337">From the GridView s smart tag, click on the Edit Columns link, select the ImageField, and click the Convert this field into a TemplateField link.</span></span>


![将 ImageField 转换转换为 TemplateField](updating-and-deleting-existing-binary-data-cs/_static/image16.gif)

<span data-ttu-id="6082b-339">**图 16**: ImageField 转换为 TemplateField</span><span class="sxs-lookup"><span data-stu-id="6082b-339">**Figure 16**: Convert the ImageField Into a TemplateField</span></span>


<span data-ttu-id="6082b-340">将 ImageField 转换为以这种方式为 TemplateField 生成两个模板与 TemplateField。</span><span class="sxs-lookup"><span data-stu-id="6082b-340">Converting the ImageField into a TemplateField in this manner generates a TemplateField with two templates.</span></span> <span data-ttu-id="6082b-341">如下面的声明性语法所示，`ItemTemplate`包含映像 Web 控件`ImageUrl`属性分配使用数据绑定语法基于 ImageField s`DataImageUrlField`和`DataImageUrlFormatString`属性。</span><span class="sxs-lookup"><span data-stu-id="6082b-341">As the following declarative syntax shows, the `ItemTemplate` contains an Image Web control whose `ImageUrl` property is assigned using databinding syntax based on the ImageField s `DataImageUrlField` and `DataImageUrlFormatString` properties.</span></span> <span data-ttu-id="6082b-342">`EditItemTemplate`包含一个文本框其`Text`属性绑定到指定的值`DataImageUrlField`属性。</span><span class="sxs-lookup"><span data-stu-id="6082b-342">The `EditItemTemplate` contains a TextBox whose `Text` property is bound to the value specified by the `DataImageUrlField` property.</span></span>


[!code-aspx[Main](updating-and-deleting-existing-binary-data-cs/samples/sample10.aspx)]

<span data-ttu-id="6082b-343">我们需要更新`EditItemTemplate`若要使用 FileUpload 控件。</span><span class="sxs-lookup"><span data-stu-id="6082b-343">We need to update the `EditItemTemplate` to use a FileUpload control.</span></span> <span data-ttu-id="6082b-344">从 GridView s 智能标记单击编辑模板链接，然后选择`Picture`TemplateField 的`EditItemTemplate`从下拉列表。</span><span class="sxs-lookup"><span data-stu-id="6082b-344">From the GridView s smart tag click on the Edit Templates link and then select the `Picture` TemplateField s `EditItemTemplate` from the drop-down list.</span></span> <span data-ttu-id="6082b-345">在模板中，你应该看到删除此文本框。</span><span class="sxs-lookup"><span data-stu-id="6082b-345">In the template you should see a TextBox remove this.</span></span> <span data-ttu-id="6082b-346">接下来，将 FileUpload 控件从工具箱拖到该模板后，设置其`ID`到`PictureUpload`。</span><span class="sxs-lookup"><span data-stu-id="6082b-346">Next, drag a FileUpload control from the Toolbox into the template, setting its `ID` to `PictureUpload`.</span></span> <span data-ttu-id="6082b-347">此外添加文本以更改类别的图片，指定新图片。</span><span class="sxs-lookup"><span data-stu-id="6082b-347">Also add the text To change the category s picture, specify a new picture.</span></span> <span data-ttu-id="6082b-348">若要保留相同类别的图片，该字段留空到模板。</span><span class="sxs-lookup"><span data-stu-id="6082b-348">To keep the category s picture the same, leave the field empty to the template, as well.</span></span>


<span data-ttu-id="6082b-349">[![FileUpload 控件添加到 EditItemTemplate](updating-and-deleting-existing-binary-data-cs/_static/image17.gif)](updating-and-deleting-existing-binary-data-cs/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-349">[![Add a FileUpload Control to the EditItemTemplate](updating-and-deleting-existing-binary-data-cs/_static/image17.gif)](updating-and-deleting-existing-binary-data-cs/_static/image27.png)</span></span>

<span data-ttu-id="6082b-350">**图 17**: FileUpload 将控件添加到`EditItemTemplate`([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-350">**Figure 17**: Add a FileUpload Control to the `EditItemTemplate` ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image28.png))</span></span>


<span data-ttu-id="6082b-351">自定义的编辑界面之后, 在浏览器中查看进度。</span><span class="sxs-lookup"><span data-stu-id="6082b-351">After customizing the editing interface, view your progress in a browser.</span></span> <span data-ttu-id="6082b-352">在查看行在只读模式下时，类别的映像将显示为之前，但单击编辑按钮将图片列呈现为与 FileUpload 控件的文本。</span><span class="sxs-lookup"><span data-stu-id="6082b-352">When viewing a row in read-only mode, the category s image is shown as it was before, but clicking on the Edit button renders the picture column as text with a FileUpload control.</span></span>


<span data-ttu-id="6082b-353">[![编辑接口包含 FileUpload 控件](updating-and-deleting-existing-binary-data-cs/_static/image18.gif)](updating-and-deleting-existing-binary-data-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="6082b-353">[![The Editing Interface Includes a FileUpload Control](updating-and-deleting-existing-binary-data-cs/_static/image18.gif)](updating-and-deleting-existing-binary-data-cs/_static/image29.png)</span></span>

<span data-ttu-id="6082b-354">**图 18**： 编辑接口包含 FileUpload 控件 ([单击以查看实际尺寸的图像](updating-and-deleting-existing-binary-data-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="6082b-354">**Figure 18**: The Editing Interface Includes a FileUpload Control ([Click to view full-size image](updating-and-deleting-existing-binary-data-cs/_static/image30.png))</span></span>


<span data-ttu-id="6082b-355">回想一下，ObjectDataSource 配置为调用`CategoriesBLL`类 s`UpdateCategory`接受作为输入图片作为的二进制数据的方法`byte`数组。</span><span class="sxs-lookup"><span data-stu-id="6082b-355">Recall that the ObjectDataSource is configured to call the `CategoriesBLL` class s `UpdateCategory` method that accepts as input the binary data for the picture as a `byte` array.</span></span> <span data-ttu-id="6082b-356">如果此数组有`null`值，但是，备用`UpdateCategory`调用重载，哪些问题`UPDATE`不会修改的 SQL 语句`Picture`列，从而使类别 s 当前按原样图片。</span><span class="sxs-lookup"><span data-stu-id="6082b-356">If this array has a `null` value, however, the alternate `UpdateCategory` overload is called, which issues the `UPDATE` SQL statement that does not modify the `Picture` column, thereby leaving the category s current picture intact.</span></span> <span data-ttu-id="6082b-357">因此，在 GridView s`RowUpdating`我们需要以编程方式引用的事件处理程序`PictureUpload`FileUpload 控制，并确定未上载文件。</span><span class="sxs-lookup"><span data-stu-id="6082b-357">Therefore, in the GridView s `RowUpdating` event handler we need to programmatically reference the `PictureUpload` FileUpload control and determine if a file was uploaded.</span></span> <span data-ttu-id="6082b-358">如果一个未上载，那么我们要做*不*想要为指定值`picture`参数。</span><span class="sxs-lookup"><span data-stu-id="6082b-358">If one was not uploaded, then we do *not* want to specify a value for the `picture` parameter.</span></span> <span data-ttu-id="6082b-359">另一方面，如果未在上载文件`PictureUpload`FileUpload 控件，我们想要确保它是一个 JPG 文件。</span><span class="sxs-lookup"><span data-stu-id="6082b-359">On the other hand, if a file was uploaded in the `PictureUpload` FileUpload control, we want to ensure that it is a JPG file.</span></span> <span data-ttu-id="6082b-360">如果是，则我们可以将其二进制内容发送到通过 ObjectDataSource`picture`参数。</span><span class="sxs-lookup"><span data-stu-id="6082b-360">If it is, then we can send its binary contents to the ObjectDataSource through the `picture` parameter.</span></span>

<span data-ttu-id="6082b-361">像在步骤 6 中使用的代码中，大部分已此处需要的代码中存在对具有说明的`ItemInserting`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6082b-361">Like with the code used in Step 6, much of the code needed here already exists in the DetailsView s `ItemInserting` event handler.</span></span> <span data-ttu-id="6082b-362">因此，我遇到重构成新方法的常见功能`ValidPictureUpload`，并且更新`ItemInserting`事件处理程序以使用此方法。</span><span class="sxs-lookup"><span data-stu-id="6082b-362">Therefore, I ve refactored the common functionality into a new method, `ValidPictureUpload`, and updated the `ItemInserting` event handler to use this method.</span></span>

<span data-ttu-id="6082b-363">将以下代码添加到的 GridView 的开头`RowUpdating`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6082b-363">Add the following code to the start of the GridView s `RowUpdating` event handler.</span></span> <span data-ttu-id="6082b-364">它非常重要的是此代码将放在保存小册子文件，因为我们不 t 的代码之前想要将小册子中保存到 web 服务器的文件系统中，如果上载无效图片文件。</span><span class="sxs-lookup"><span data-stu-id="6082b-364">It s important that this code come before the code that saves the brochure file since we don t want to save the brochure to the web server s file system if an invalid picture file is uploaded.</span></span>


[!code-csharp[Main](updating-and-deleting-existing-binary-data-cs/samples/sample11.cs)]

<span data-ttu-id="6082b-365">`ValidPictureUpload(FileUpload)`方法接受 FileUpload 控件作为其唯一的输入参数中，并检查已上载的文件的扩展，以确保已上载的文件的 JPG; 如果上载图片文件，则仅调用。</span><span class="sxs-lookup"><span data-stu-id="6082b-365">The `ValidPictureUpload(FileUpload)` method takes in a FileUpload control as its sole input parameter and checks the uploaded file s extension to ensure that the uploaded file is a JPG; it is only called if a picture file is uploaded.</span></span> <span data-ttu-id="6082b-366">如果不上载任何文件，则将图片的参数未设置，并因此使用其默认值为`null`。</span><span class="sxs-lookup"><span data-stu-id="6082b-366">If no file is uploaded, then the picture parameter is not set, and therefore uses its default value of `null`.</span></span> <span data-ttu-id="6082b-367">如果已上载图片和`ValidPictureUpload`返回`true`、`picture`参数分配的二进制数据的已上载的图像中; 如果该方法返回`false`、 取消更新工作流和事件处理程序退出。</span><span class="sxs-lookup"><span data-stu-id="6082b-367">If a picture was uploaded and `ValidPictureUpload` returns `true`, the `picture` parameter is assigned the binary data of the uploaded image; if the method returns `false`, the update workflow is cancelled and the event handler exited.</span></span>

<span data-ttu-id="6082b-368">`ValidPictureUpload(FileUpload)`从说明 s 重构的方法代码`ItemInserting`事件处理程序遵循：</span><span class="sxs-lookup"><span data-stu-id="6082b-368">The `ValidPictureUpload(FileUpload)` method code, which was refactored from the DetailsView s `ItemInserting` event handler, follows:</span></span>


[!code-csharp[Main](updating-and-deleting-existing-binary-data-cs/samples/sample12.cs)]

## <a name="step-8-replacing-the-original-categories-pictures-with-jpgs"></a><span data-ttu-id="6082b-369">步骤 8： 替换 Jpg 原始类别图片</span><span class="sxs-lookup"><span data-stu-id="6082b-369">Step 8: Replacing the Original Categories Pictures with JPGs</span></span>

<span data-ttu-id="6082b-370">记得原始的八个类别图片的位图文件包装在一个 OLE 标头。</span><span class="sxs-lookup"><span data-stu-id="6082b-370">Recall that the original eight categories pictures are bitmap files wrapped in an OLE header.</span></span> <span data-ttu-id="6082b-371">现在，我们已添加的功能，若要编辑现有的记录的图片，花些时间将替换为 Jpg 这些位图。</span><span class="sxs-lookup"><span data-stu-id="6082b-371">Now that we have added the capability to edit an existing record s picture, take a moment to replace these bitmaps with JPGs.</span></span> <span data-ttu-id="6082b-372">如果你想要继续使用当前的类别图片，可以直接将它们转换为 Jpg，通过执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="6082b-372">If you want to continue to use the current category pictures, you can convert them to JPGs by performing the following steps:</span></span>

1. <span data-ttu-id="6082b-373">将位图图像保存到硬盘空间。</span><span class="sxs-lookup"><span data-stu-id="6082b-373">Save the bitmap images to your hard drive.</span></span> <span data-ttu-id="6082b-374">请访问`UpdatingAndDeleting.aspx`页在浏览器和每个前八个类别上，在图像上右键单击，选择将保存图。</span><span class="sxs-lookup"><span data-stu-id="6082b-374">Visit the `UpdatingAndDeleting.aspx` page in your browser and for each of the first eight categories, right-click on the image and choose to save the picture.</span></span>
2. <span data-ttu-id="6082b-375">在选择的图像编辑器中打开的图像。</span><span class="sxs-lookup"><span data-stu-id="6082b-375">Open the image in your image editor of choice.</span></span> <span data-ttu-id="6082b-376">可以使用 Microsoft 画图，例如所示。</span><span class="sxs-lookup"><span data-stu-id="6082b-376">You can use Microsoft Paint, for example.</span></span>
3. <span data-ttu-id="6082b-377">将位图另存为的 JPG 图像。</span><span class="sxs-lookup"><span data-stu-id="6082b-377">Save the bitmap as a JPG image.</span></span>
4. <span data-ttu-id="6082b-378">更新通过编辑界面、 使用 JPG 文件的类别的图片。</span><span class="sxs-lookup"><span data-stu-id="6082b-378">Update the category s picture through the editing interface, using the JPG file.</span></span>

<span data-ttu-id="6082b-379">后编辑类别并上传的 JPG 图像，图像将不会呈现在浏览器因为`DisplayCategoryPicture.aspx`页去除前 78 个字节从前八个类别的图片。</span><span class="sxs-lookup"><span data-stu-id="6082b-379">After editing a category and uploading the JPG image, the image will not render in the browser because the `DisplayCategoryPicture.aspx` page is stripping the first 78 bytes from the pictures of the first eight categories.</span></span> <span data-ttu-id="6082b-380">通过删除执行 OLE 标头去除的代码来解决此问题。</span><span class="sxs-lookup"><span data-stu-id="6082b-380">Fix this by removing the code that performs the OLE header stripping.</span></span> <span data-ttu-id="6082b-381">执行此操作，操作之后`DisplayCategoryPicture.aspx``Page_Load`事件处理程序应具有只会将以下代码：</span><span class="sxs-lookup"><span data-stu-id="6082b-381">After doing this, the `DisplayCategoryPicture.aspx``Page_Load` event handler should have just the following code:</span></span>


[!code-vb[Main](updating-and-deleting-existing-binary-data-cs/samples/sample13.vb)]

> [!NOTE]
> <span data-ttu-id="6082b-382">`UpdatingAndDeleting.aspx`页 s 插入和编辑接口无法使用多做一些工作。</span><span class="sxs-lookup"><span data-stu-id="6082b-382">The `UpdatingAndDeleting.aspx` page s inserting and editing interfaces could use a bit more work.</span></span> <span data-ttu-id="6082b-383">`CategoryName`和`Description`中的说明和 GridView BoundFields 应转换为 TemplateFields。</span><span class="sxs-lookup"><span data-stu-id="6082b-383">The `CategoryName` and `Description` BoundFields in the DetailsView and GridView should be converted into TemplateFields.</span></span> <span data-ttu-id="6082b-384">由于`CategoryName`不允许`NULL`值，应添加 RequiredFieldValidator。</span><span class="sxs-lookup"><span data-stu-id="6082b-384">Since `CategoryName` does not allow `NULL` values, a RequiredFieldValidator should be added.</span></span> <span data-ttu-id="6082b-385">与`Description`文本框中应可能转换为多行文本框。</span><span class="sxs-lookup"><span data-stu-id="6082b-385">And the `Description` TextBox should probably be converted into a multi-line TextBox.</span></span> <span data-ttu-id="6082b-386">我为你作为练习保留这些完成收尾工作。</span><span class="sxs-lookup"><span data-stu-id="6082b-386">I leave these finishing touches as an exercise for you.</span></span>


## <a name="summary"></a><span data-ttu-id="6082b-387">摘要</span><span class="sxs-lookup"><span data-stu-id="6082b-387">Summary</span></span>

<span data-ttu-id="6082b-388">本教程中完成我们看处理二进制数据。</span><span class="sxs-lookup"><span data-stu-id="6082b-388">This tutorial completes our look at working with binary data.</span></span> <span data-ttu-id="6082b-389">在本教程和以前的三个，我们已了解如何二进制数据可以存储在文件系统或直接在数据库内。</span><span class="sxs-lookup"><span data-stu-id="6082b-389">In this tutorial and the previous three, we saw how binary data can be stored on the file system or directly within the database.</span></span> <span data-ttu-id="6082b-390">用户提供的选择从其硬盘的文件并将其上载到 web 服务器，其中可以存储在文件系统或插入到数据库到系统的二进制数据。</span><span class="sxs-lookup"><span data-stu-id="6082b-390">A user provides binary data to the system by selecting a file from their hard drive and uploading it to the web server, where it can be stored on the file system or inserted into the database.</span></span> <span data-ttu-id="6082b-391">ASP.NET 2.0 包括 FileUpload 控件，可提供此类接口一样简单，如拖放。</span><span class="sxs-lookup"><span data-stu-id="6082b-391">ASP.NET 2.0 includes a FileUpload control that makes providing such an interface as easy as drag and drop.</span></span> <span data-ttu-id="6082b-392">但是，如中另有说明[上载文件](uploading-files-cs.md)教程中，FileUpload 控件是仅适合于相对较小的文件上载，理想情况下不超过一兆字节。</span><span class="sxs-lookup"><span data-stu-id="6082b-392">However, as noted in the [Uploading Files](uploading-files-cs.md) tutorial, the FileUpload control is only well-suited for relatively small file uploads, ideally not exceeding a megabyte.</span></span> <span data-ttu-id="6082b-393">我们还介绍了如何将上载的数据与基础数据模型中，关联，以及如何编辑和删除来自现有记录的二进制数据。</span><span class="sxs-lookup"><span data-stu-id="6082b-393">We also explored how to associate uploaded data with the underlying data model, as well as how to edit and delete the binary data from existing records.</span></span>

<span data-ttu-id="6082b-394">我们接下来的教程介绍了各种缓存技术。</span><span class="sxs-lookup"><span data-stu-id="6082b-394">Our next set of tutorials explores various caching techniques.</span></span> <span data-ttu-id="6082b-395">缓存提供了一种方式来提高应用程序 s 通过采用来自成本高昂的操作的结果，并将它们存储在可以更快地访问的位置的整体性能。</span><span class="sxs-lookup"><span data-stu-id="6082b-395">Caching provides a means to improve an application s overall performance by taking the results from expensive operations and storing them in a location that can be more quickly accessed.</span></span>

<span data-ttu-id="6082b-396">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="6082b-396">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="6082b-397">关于作者</span><span class="sxs-lookup"><span data-stu-id="6082b-397">About the Author</span></span>

<span data-ttu-id="6082b-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七个 ASP/ASP.NET 书籍和的创始人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年使用与 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="6082b-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="6082b-399">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="6082b-399">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="6082b-400">最新书籍是[ *Sam 教授自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="6082b-400">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="6082b-401">他可以达到在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或通过他的博客，其中可以找到在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="6082b-401">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="6082b-402">特别感谢</span><span class="sxs-lookup"><span data-stu-id="6082b-402">Special Thanks To</span></span>

<span data-ttu-id="6082b-403">本教程系列已由许多有用的审阅者评审。</span><span class="sxs-lookup"><span data-stu-id="6082b-403">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="6082b-404">本教程中的前导审阅者已 Teresa 墨。</span><span class="sxs-lookup"><span data-stu-id="6082b-404">Lead reviewer for this tutorial was Teresa Murphy.</span></span> <span data-ttu-id="6082b-405">对感兴趣查看我即将到来的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="6082b-405">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="6082b-406">如果是这样，删除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="6082b-406">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="6082b-407">[上一页](including-a-file-upload-option-when-adding-a-new-record-cs.md)
[下一页](uploading-files-vb.md)</span><span class="sxs-lookup"><span data-stu-id="6082b-407">[Previous](including-a-file-upload-option-when-adding-a-new-record-cs.md)
[Next](uploading-files-vb.md)</span></span>
