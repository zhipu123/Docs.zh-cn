---
uid: web-forms/overview/data-access/introduction/creating-a-data-access-layer-cs
title: "创建数据访问层 (C#) |Microsoft 文档"
author: rick-anderson
description: "在本教程中我们将从一开始启动，并创建数据访问层 (DAL)，使用类型化数据集，以访问数据库中的信息。"
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/05/2010
ms.topic: article
ms.assetid: cfe2a6a0-1e56-4dc8-9537-c8ec76ba96a4
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-data-access-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: c610f84cfb82f38f9c67b757aa341c7a1497369c
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="creating-a-data-access-layer-c"></a><span data-ttu-id="d21ed-103">创建数据访问层 (C#)</span><span class="sxs-lookup"><span data-stu-id="d21ed-103">Creating a Data Access Layer (C#)</span></span>
====================
<span data-ttu-id="d21ed-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d21ed-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d21ed-105">[下载示例应用程序](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_1_CS.exe)或[下载 PDF](creating-a-data-access-layer-cs/_static/datatutorial01cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="d21ed-105">[Download Sample App](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_1_CS.exe) or [Download PDF](creating-a-data-access-layer-cs/_static/datatutorial01cs1.pdf)</span></span>

> <span data-ttu-id="d21ed-106">在本教程中我们将从一开始启动，并创建数据访问层 (DAL)，使用类型化数据集，以访问数据库中的信息。</span><span class="sxs-lookup"><span data-stu-id="d21ed-106">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), using typed DataSets, to access the information in a database.</span></span>


## <a name="introduction"></a><span data-ttu-id="d21ed-107">介绍</span><span class="sxs-lookup"><span data-stu-id="d21ed-107">Introduction</span></span>

<span data-ttu-id="d21ed-108">为 web 开发人员，我们生活围绕使用数据。</span><span class="sxs-lookup"><span data-stu-id="d21ed-108">As web developers, our lives revolve around working with data.</span></span> <span data-ttu-id="d21ed-109">我们将创建数据库来存储数据，来检索和修改它，和 web 页来收集和汇总它的代码。</span><span class="sxs-lookup"><span data-stu-id="d21ed-109">We create databases to store the data, code to retrieve and modify it, and web pages to collect and summarize it.</span></span> <span data-ttu-id="d21ed-110">这是将浏览技术用于在 ASP.NET 2.0 实现这些常见的模式一冗长系列中的第一个教程。</span><span class="sxs-lookup"><span data-stu-id="d21ed-110">This is the first tutorial in a lengthy series that will explore techniques for implementing these common patterns in ASP.NET 2.0.</span></span> <span data-ttu-id="d21ed-111">我们将开始创建[软件体系结构](http://en.wikipedia.org/wiki/Software_architecture)组合使用类型化数据集，业务逻辑层 (BLL) 数据访问层 (DAL)，它强制自定义业务规则和表示层组成 ASP.NET 的页共享通用的页面布局。</span><span class="sxs-lookup"><span data-stu-id="d21ed-111">We'll start with creating a [software architecture](http://en.wikipedia.org/wiki/Software_architecture) composed of a Data Access Layer (DAL) using Typed DataSets, a Business Logic Layer (BLL) that enforces custom business rules, and a presentation layer composed of ASP.NET pages that share a common page layout.</span></span> <span data-ttu-id="d21ed-112">一旦此后端基础工作已排列，我们来看看到报告，显示如何显示，汇总、 收集，和验证从 web 应用程序的数据。</span><span class="sxs-lookup"><span data-stu-id="d21ed-112">Once this backend groundwork has been laid, we'll move into reporting, showing how to display, summarize, collect, and validate data from a web application.</span></span> <span data-ttu-id="d21ed-113">这些教程旨在是简洁并提供引导你完成此过程以可视方式并提供充足的屏幕截图的分步说明。</span><span class="sxs-lookup"><span data-stu-id="d21ed-113">These tutorials are geared to be concise and provide step-by-step instructions with plenty of screen shots to walk you through the process visually.</span></span> <span data-ttu-id="d21ed-114">每个教程是在 C# 和 Visual Basic 版本中可用，包括使用的完整代码下载。</span><span class="sxs-lookup"><span data-stu-id="d21ed-114">Each tutorial is available in C# and Visual Basic versions and includes a download of the complete code used.</span></span> <span data-ttu-id="d21ed-115">（此第一个教程是非常长，但其余部分将显示更多可以理解的小区块中。）</span><span class="sxs-lookup"><span data-stu-id="d21ed-115">(This first tutorial is quite lengthy, but the rest are presented in much more digestible chunks.)</span></span>

<span data-ttu-id="d21ed-116">我们将放置在 Northwind 数据库的 Microsoft SQL Server 2005 Express Edition 版本使用在本系列教程**应用\_数据**目录。</span><span class="sxs-lookup"><span data-stu-id="d21ed-116">For these tutorials we'll be using a Microsoft SQL Server 2005 Express Edition version of the Northwind database placed in the **App\_Data** directory.</span></span> <span data-ttu-id="d21ed-117">除了数据库文件中，**应用\_数据**文件夹还包含用于创建数据库的 SQL 脚本，以防你想要使用不同的数据库版本。</span><span class="sxs-lookup"><span data-stu-id="d21ed-117">In addition to the database file, the **App\_Data** folder also contains the SQL scripts for creating the database, in case you want to use a different database version.</span></span> <span data-ttu-id="d21ed-118">这些脚本可能也会[直接从 Microsoft 下载](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en)，如果您希望使用。</span><span class="sxs-lookup"><span data-stu-id="d21ed-118">These scripts can be also be [downloaded directly from Microsoft](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en), if you'd prefer.</span></span> <span data-ttu-id="d21ed-119">如果你使用 Northwind 数据库的不同 SQL Server 版本，你将需要更新**NORTHWNDConnectionString**中应用程序的设置**Web.config**文件。</span><span class="sxs-lookup"><span data-stu-id="d21ed-119">If you use a different SQL Server version of the Northwind database, you will need to update the **NORTHWNDConnectionString** setting in the application's **Web.config** file.</span></span> <span data-ttu-id="d21ed-120">Web 应用程序是为文件系统基于网站项目中使用 Visual Studio 2005 专业版生成的。</span><span class="sxs-lookup"><span data-stu-id="d21ed-120">The web application was built using Visual Studio 2005 Professional Edition as a file system-based Web site project.</span></span> <span data-ttu-id="d21ed-121">但是，所有这些教程将起作用同样有效的免费版本的 Visual Studio 2005 中， [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/)。</span><span class="sxs-lookup"><span data-stu-id="d21ed-121">However, all of the tutorials will work equally well with the free version of Visual Studio 2005, [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/).</span></span>  
  
<span data-ttu-id="d21ed-122">在本教程中我们将从一开始启动，并创建数据访问层 (DAL) 后, 跟在第二个教程中，创建业务逻辑层 (BLL) 和在页面布局和第三个中的导航正常工作。</span><span class="sxs-lookup"><span data-stu-id="d21ed-122">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), followed by creating the Business Logic Layer (BLL) in the second tutorial, and working on page layout and navigation in the third.</span></span> <span data-ttu-id="d21ed-123">在前三个中的布局后第三个将生成的基础之上的教程。</span><span class="sxs-lookup"><span data-stu-id="d21ed-123">The tutorials after the third one will build upon the foundation laid in the first three.</span></span> <span data-ttu-id="d21ed-124">我们提供了许多介绍在此第一个教程，因此启动 Visual Studio 并让我们开始吧 ！</span><span class="sxs-lookup"><span data-stu-id="d21ed-124">We've got a lot to cover in this first tutorial, so fire up Visual Studio and let's get started!</span></span>

## <a name="step-1-creating-a-web-project-and-connecting-to-the-database"></a><span data-ttu-id="d21ed-125">步骤 1： 创建 Web 项目，并连接到数据库</span><span class="sxs-lookup"><span data-stu-id="d21ed-125">Step 1: Creating a Web Project and Connecting to the Database</span></span>

<span data-ttu-id="d21ed-126">我们可以创建我们的数据访问层 (DAL) 之前，我们首先需要创建网站并设置我们的数据库。</span><span class="sxs-lookup"><span data-stu-id="d21ed-126">Before we can create our Data Access Layer (DAL), we first need to create a web site and setup our database.</span></span> <span data-ttu-id="d21ed-127">首先，创建新文件系统基于 ASP.NET 网站。</span><span class="sxs-lookup"><span data-stu-id="d21ed-127">Start by creating a new file system-based ASP.NET web site.</span></span> <span data-ttu-id="d21ed-128">若要完成此操作，请转到文件菜单并选择新的网站，显示新建网站对话框。</span><span class="sxs-lookup"><span data-stu-id="d21ed-128">To accomplish this, go to the File menu and choose New Web Site, displaying the New Web Site dialog box.</span></span> <span data-ttu-id="d21ed-129">选择 ASP.NET 网站模板，将位置下拉列表设置为文件系统、 选择一个文件夹，以将 web 站点，并将语言设置为 C#。</span><span class="sxs-lookup"><span data-stu-id="d21ed-129">Choose the ASP.NET Web Site template, set the Location drop-down list to File System, choose a folder to place the web site, and set the language to C#.</span></span>


<span data-ttu-id="d21ed-130">[![创建新的文件系统基于 Web 站点](creating-a-data-access-layer-cs/_static/image2.png)](creating-a-data-access-layer-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-130">[![Create a New File System-Based Web Site](creating-a-data-access-layer-cs/_static/image2.png)](creating-a-data-access-layer-cs/_static/image1.png)</span></span>

<span data-ttu-id="d21ed-131">**图 1**： 创建 New File System-Based 网站 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-131">**Figure 1**: Create a New File System-Based Web Site ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image3.png))</span></span>


<span data-ttu-id="d21ed-132">这将创建新的网站与**Default.aspx** ASP.NET 页和**应用\_数据**文件夹。</span><span class="sxs-lookup"><span data-stu-id="d21ed-132">This will create a new web site with a **Default.aspx** ASP.NET page and an **App\_Data** folder.</span></span>

<span data-ttu-id="d21ed-133">与创建网站后下, 一步是在 Visual Studio 服务器资源管理器中添加对数据库的引用。</span><span class="sxs-lookup"><span data-stu-id="d21ed-133">With the web site created, the next step is to add a reference to the database in Visual Studio's Server Explorer.</span></span> <span data-ttu-id="d21ed-134">通过将数据库添加到服务器资源管理器中，你可以添加表、 存储的过程、 视图和从 Visual Studio 中的等所有。</span><span class="sxs-lookup"><span data-stu-id="d21ed-134">By adding a database to the Server Explorer you can add tables, stored procedures, views, and so on all from within Visual Studio.</span></span> <span data-ttu-id="d21ed-135">你还可以查看表数据，或通过查询生成器手动或以图形方式创建您自己的查询。</span><span class="sxs-lookup"><span data-stu-id="d21ed-135">You can also view table data or create your own queries either by hand or graphically via the Query Builder.</span></span> <span data-ttu-id="d21ed-136">此外，我们为 DAL 生成类型化数据集时我们将需要点 Visual Studio 连接到可从其构造类型化数据集的数据库。</span><span class="sxs-lookup"><span data-stu-id="d21ed-136">Furthermore, when we build the Typed DataSets for the DAL we'll need to point Visual Studio to the database from which the Typed DataSets should be constructed.</span></span> <span data-ttu-id="d21ed-137">虽然我们可以提供此连接信息在该点的时间，Visual Studio 将自动填充已在服务器资源管理器中注册的数据库的下拉列表。</span><span class="sxs-lookup"><span data-stu-id="d21ed-137">While we can provide this connection information at that point in time, Visual Studio automatically populates a drop-down list of the databases already registered in the Server Explorer.</span></span>

<span data-ttu-id="d21ed-138">将 Northwind 数据库添加到服务器资源管理器的步骤取决于是否想要使用中的 SQL Server 2005 Express Edition 数据库**应用\_数据**文件夹或者如果您使用 Microsoft SQL Server 2000 或 2005年你想要改为使用的数据库服务器设置。</span><span class="sxs-lookup"><span data-stu-id="d21ed-138">The steps for adding the Northwind database to the Server Explorer depend on whether you want to use the SQL Server 2005 Express Edition database in the **App\_Data** folder or if you have a Microsoft SQL Server 2000 or 2005 database server setup that you want to use instead.</span></span>

## <a name="using-a-database-in-theappdatafolder"></a><span data-ttu-id="d21ed-139">使用数据库中 theApp\_DataFolder</span><span class="sxs-lookup"><span data-stu-id="d21ed-139">Using a Database in theApp\_DataFolder</span></span>

<span data-ttu-id="d21ed-140">如果你没有要连接到的 SQL Server 2000 或 2005年数据库服务器，或者你只想要避免无需将数据库添加到数据库服务器，则可以使用位于下载 websit Northwind 数据库的 SQL Server 2005 Express Edition 版本e's**应用\_数据**文件夹 (**northwnd 不。MDF**)。</span><span class="sxs-lookup"><span data-stu-id="d21ed-140">If you do not have a SQL Server 2000 or 2005 database server to connect to, or you simply want to avoid having to add the database to a database server, you can use the SQL Server 2005 Express Edition version of the Northwind database that is located in the downloaded website's **App\_Data** folder (**NORTHWND.MDF**).</span></span>

<span data-ttu-id="d21ed-141">数据库置于**应用\_数据**文件夹会自动添加到服务器资源管理器。</span><span class="sxs-lookup"><span data-stu-id="d21ed-141">A database placed in the **App\_Data** folder is automatically added to the Server Explorer.</span></span> <span data-ttu-id="d21ed-142">假设你有 SQL Server 2005 Express Edition 安装您的计算机上，你应该看到名为 northwnd 不的节点。MDF 在服务器资源管理器，你可以展开和浏览其表、 视图、 存储的过程等 （请参见图 2）。</span><span class="sxs-lookup"><span data-stu-id="d21ed-142">Assuming you have SQL Server 2005 Express Edition installed on your machine you should see a node named NORTHWND.MDF in the Server Explorer, which you can expand and explore its tables, views, stored procedure, and so on (see Figure 2).</span></span>

<span data-ttu-id="d21ed-143">**应用\_数据**文件夹还可以包含 Microsoft Access **.mdb**文件，如 SQL Server 的对应，会自动添加到服务器资源管理器。</span><span class="sxs-lookup"><span data-stu-id="d21ed-143">The **App\_Data** folder can also hold Microsoft Access **.mdb** files, which, like their SQL Server counterparts, are automatically added to the Server Explorer.</span></span> <span data-ttu-id="d21ed-144">如果你不想要使用的任何 SQL Server 选项，则可以始终[下载 Northwind 数据库文件的 Microsoft Access 版本](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN)拖放到**应用\_数据**目录。</span><span class="sxs-lookup"><span data-stu-id="d21ed-144">If you don't want to use any of the SQL Server options, you can always [download a Microsoft Access version of the Northwind database file](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN) and drop into the **App\_Data** directory.</span></span> <span data-ttu-id="d21ed-145">请记住，但是，Access 数据库不作为功能丰富作为 SQL Server，并不旨在在网站方案中使用。</span><span class="sxs-lookup"><span data-stu-id="d21ed-145">Keep in mind, however, that Access databases aren't as feature-rich as SQL Server, and aren't designed to be used in web site scenarios.</span></span> <span data-ttu-id="d21ed-146">此外，几个 35 + 教程将使用不受访问某些数据库级功能。</span><span class="sxs-lookup"><span data-stu-id="d21ed-146">Furthermore, a couple of the 35+ tutorials will utilize certain database-level features that aren't supported by Access.</span></span>

## <a name="connecting-to-the-database-in-a-microsoft-sql-server-2000-or-2005-database-server"></a><span data-ttu-id="d21ed-147">连接到 Microsoft SQL Server 2000 或 2005年数据库服务器中数据库</span><span class="sxs-lookup"><span data-stu-id="d21ed-147">Connecting to the Database in a Microsoft SQL Server 2000 or 2005 Database Server</span></span>

<span data-ttu-id="d21ed-148">或者，你可能会连接到 Northwind 数据库的数据库服务器上安装。</span><span class="sxs-lookup"><span data-stu-id="d21ed-148">Alternatively, you may connect to a Northwind database installed on a database server.</span></span> <span data-ttu-id="d21ed-149">如果数据库服务器已没有安装了 Northwind 数据库，你首先必须将其添加到数据库服务器通过运行安装脚本包含在本教程的下载或通过[下载的 SQL Server 2000 版的 Northwind安装脚本](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en)直接从 Microsoft 网站上找到。</span><span class="sxs-lookup"><span data-stu-id="d21ed-149">If the database server does not already have the Northwind database installed, you first must add it to database server by running the installation script included in this tutorial's download or by [downloading the SQL Server 2000 version of Northwind and installation script](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en) directly from Microsoft's web site.</span></span>

<span data-ttu-id="d21ed-150">一旦安装了数据库，请转到 Visual Studio 的服务器资源管理器，右键单击数据连接节点中，然后选择添加连接。</span><span class="sxs-lookup"><span data-stu-id="d21ed-150">Once you have the database installed, go to the Server Explorer in Visual Studio, right-click on the Data Connections node, and choose Add Connection.</span></span> <span data-ttu-id="d21ed-151">如果看不到服务器资源管理器转到视图 / 服务器资源管理器或命中的 Ctrl + Alt + S。</span><span class="sxs-lookup"><span data-stu-id="d21ed-151">If you don't see the Server Explorer go to the View / Server Explorer, or hit Ctrl+Alt+S.</span></span> <span data-ttu-id="d21ed-152">这将显示添加连接对话框中，你可以在其中指定要连接到的服务器，身份验证信息，且数据库名称。</span><span class="sxs-lookup"><span data-stu-id="d21ed-152">This will bring up the Add Connection dialog box, where you can specify the server to connect to, the authentication information, and the database name.</span></span> <span data-ttu-id="d21ed-153">一旦你已成功配置的数据库连接信息并单击确定按钮，数据库将添加作为节点下面的数据连接节点的节点。</span><span class="sxs-lookup"><span data-stu-id="d21ed-153">Once you have successfully configured the database connection information and clicked the OK button, the database will be added as a node underneath the Data Connections node.</span></span> <span data-ttu-id="d21ed-154">你可以展开数据库节点来浏览其表、 视图、 存储的过程和等等。</span><span class="sxs-lookup"><span data-stu-id="d21ed-154">You can expand the database node to explore its tables, views, stored procedures, and so on.</span></span>


![添加到你的数据库服务器的 Northwind 数据库的连接](creating-a-data-access-layer-cs/_static/image4.png)

<span data-ttu-id="d21ed-156">**图 2**： 添加到你的数据库服务器的 Northwind 数据库的连接</span><span class="sxs-lookup"><span data-stu-id="d21ed-156">**Figure 2**: Add a Connection to Your Database Server's Northwind Database</span></span>


## <a name="step-2-creating-the-data-access-layer"></a><span data-ttu-id="d21ed-157">步骤 2： 创建数据访问层</span><span class="sxs-lookup"><span data-stu-id="d21ed-157">Step 2: Creating the Data Access Layer</span></span>

<span data-ttu-id="d21ed-158">在使用数据的一个选项是特定于数据的逻辑将直接嵌入到表示层 （在 web 应用中，ASP.NET 页构成了表示层）。</span><span class="sxs-lookup"><span data-stu-id="d21ed-158">When working with data one option is to embed the data-specific logic directly into the presentation layer (in a web application, the ASP.NET pages make up the presentation layer).</span></span> <span data-ttu-id="d21ed-159">这可能需要编写 ASP.NET 页的代码部分中的 ADO.NET 代码或使用 SqlDataSource 控件标记部分中的形式。</span><span class="sxs-lookup"><span data-stu-id="d21ed-159">This may take the form of writing ADO.NET code in the ASP.NET page's code portion or using the SqlDataSource control from the markup portion.</span></span> <span data-ttu-id="d21ed-160">在任一情况下，此方法紧密标数据访问逻辑与表示层。</span><span class="sxs-lookup"><span data-stu-id="d21ed-160">In either case, this approach tightly couples the data access logic with the presentation layer.</span></span> <span data-ttu-id="d21ed-161">但是，建议的方法，是分开的表示层的数据访问逻辑。</span><span class="sxs-lookup"><span data-stu-id="d21ed-161">The recommended approach, however, is to separate the data access logic from the presentation layer.</span></span> <span data-ttu-id="d21ed-162">此单独的层称为数据访问层，简称，DAL 并通常实现为一个单独的类库项目。</span><span class="sxs-lookup"><span data-stu-id="d21ed-162">This separate layer is referred to as the Data Access Layer, DAL for short, and is typically implemented as a separate Class Library project.</span></span> <span data-ttu-id="d21ed-163">也记录此分层体系结构的好处 （在本教程末尾的有关这些优点的信息请参阅"进一步读数"部分） 且在本系列中，我们将采取的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-163">The benefits of this layered architecture are well documented (see the "Further Readings" section at the end of this tutorial for information on these advantages) and is the approach we will take in this series.</span></span>

<span data-ttu-id="d21ed-164">所有代码都是特定于基础数据源创建连接到数据库，如颁发**选择**，**插入**，**更新**，和**删除**命令，依次类推应位于 DAL。</span><span class="sxs-lookup"><span data-stu-id="d21ed-164">All code that is specific to the underlying data source such as creating a connection to the database, issuing **SELECT**, **INSERT**, **UPDATE**, and **DELETE** commands, and so on should be located in the DAL.</span></span> <span data-ttu-id="d21ed-165">表示层不应包含对此类数据访问代码的任何引用，但应进行的所有数据请求 DAL 调用。</span><span class="sxs-lookup"><span data-stu-id="d21ed-165">The presentation layer should not contain any references to such data access code, but should instead make calls into the DAL for any and all data requests.</span></span> <span data-ttu-id="d21ed-166">数据访问层通常包含用于访问基础数据库数据的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-166">Data Access Layers typically contain methods for accessing the underlying database data.</span></span> <span data-ttu-id="d21ed-167">Northwind 数据库中，例如，具有**产品**和**类别**记录用于销售和它们所属的类别的产品的表。</span><span class="sxs-lookup"><span data-stu-id="d21ed-167">The Northwind database, for example, has **Products** and **Categories** tables that record the products for sale and the categories to which they belong.</span></span> <span data-ttu-id="d21ed-168">在我们 DAL 我们将具有类似的方法：</span><span class="sxs-lookup"><span data-stu-id="d21ed-168">In our DAL we will have methods like:</span></span>

- <span data-ttu-id="d21ed-169">**GetCategories()，**这将返回有关所有类别信息</span><span class="sxs-lookup"><span data-stu-id="d21ed-169">**GetCategories(),** which will return information about all of the categories</span></span>
- <span data-ttu-id="d21ed-170">**GetProducts()**，这将返回有关所有产品信息</span><span class="sxs-lookup"><span data-stu-id="d21ed-170">**GetProducts()**, which will return information about all of the products</span></span>
- <span data-ttu-id="d21ed-171">**GetProductsByCategoryID (*categoryID*) * *，这样就会返回属于指定类别的所有产品</span><span class="sxs-lookup"><span data-stu-id="d21ed-171">**GetProductsByCategoryID(*categoryID*)**, which will return all products that belong to a specified category</span></span>
- <span data-ttu-id="d21ed-172">**GetProductByProductID (*productID*) * *，这样就会返回有关特定产品的信息</span><span class="sxs-lookup"><span data-stu-id="d21ed-172">**GetProductByProductID(*productID*)**, which will return information about a particular product</span></span>

<span data-ttu-id="d21ed-173">这些方法，调用时，将连接到数据库、 发出相应的查询，并返回结果。</span><span class="sxs-lookup"><span data-stu-id="d21ed-173">These methods, when invoked, will connect to the database, issue the appropriate query, and return the results.</span></span> <span data-ttu-id="d21ed-174">我们返回这些结果的方式非常重要。</span><span class="sxs-lookup"><span data-stu-id="d21ed-174">How we return these results is important.</span></span> <span data-ttu-id="d21ed-175">这些方法可能只需返回的数据集或 DataReader 填充数据库查询，但理想情况下这些结果应返回使用*强类型对象*。</span><span class="sxs-lookup"><span data-stu-id="d21ed-175">These methods could simply return a DataSet or DataReader populated by the database query, but ideally these results should be returned using *strongly-typed objects*.</span></span> <span data-ttu-id="d21ed-176">强类型的对象是一个在编译时，严格定义其架构而相反，松散类型化的对象，是一个直到运行时才知道其架构。</span><span class="sxs-lookup"><span data-stu-id="d21ed-176">A strongly-typed object is one whose schema is rigidly defined at compile time, whereas the opposite, a loosely-typed object, is one whose schema is not known until runtime.</span></span>

<span data-ttu-id="d21ed-177">例如，DataReader 和 （默认） 数据集是松散类型化对象，因为它们的架构定义的用于填充其数据库查询返回的列。</span><span class="sxs-lookup"><span data-stu-id="d21ed-177">For example, the DataReader and the DataSet (by default) are loosely-typed objects since their schema is defined by the columns returned by the database query used to populate them.</span></span> <span data-ttu-id="d21ed-178">若要从松散类型化的 DataTable 我们需要使用类似的语法访问特定的列：   ***DataTable*。行 [*索引*] ["*columnName*"]**。DataTable 的松散类型在此示例中表现出事实，我们需要访问使用字符串或序号索引的列名称。强类型的数据表，另一方面，将具有每个列实现为属性，从而导致如下所示的代码：   ***DataTable*。行 [*索引*]。*columnName** *。</span><span class="sxs-lookup"><span data-stu-id="d21ed-178">To access a particular column from a loosely-typed DataTable we need to use syntax like: ***DataTable*.Rows[*index*]["*columnName*"]**. The DataTable's loose typing in this example is exhibited by the fact that we need to access the column name using a string or ordinal index. A strongly-typed DataTable, on the other hand, will have each of its columns implemented as properties, resulting in code that looks like: ***DataTable*.Rows[*index*].*columnName***.</span></span>

<span data-ttu-id="d21ed-179">若要返回强类型对象，开发人员可以创建自己的自定义业务对象或使用类型化数据集。</span><span class="sxs-lookup"><span data-stu-id="d21ed-179">To return strongly-typed objects, developers can either create their own custom business objects or use Typed DataSets.</span></span> <span data-ttu-id="d21ed-180">其属性通常反映基础数据库表的业务对象的列的类表示，开发人员实现业务对象。</span><span class="sxs-lookup"><span data-stu-id="d21ed-180">A business object is implemented by the developer as a class whose properties typically reflect the columns of the underlying database table the business object represents.</span></span> <span data-ttu-id="d21ed-181">类型化数据集是由基于数据库架构和其成员都是根据此架构强类型的 Visual Studio 为你生成一个类。</span><span class="sxs-lookup"><span data-stu-id="d21ed-181">A Typed DataSet is a class generated for you by Visual Studio based on a database schema and whose members are strongly-typed according to this schema.</span></span> <span data-ttu-id="d21ed-182">类型化数据集本身扩展 ADO.NET 数据集、 数据表和 DataRow 类的类组成。</span><span class="sxs-lookup"><span data-stu-id="d21ed-182">The Typed DataSet itself consists of classes that extend the ADO.NET DataSet, DataTable, and DataRow classes.</span></span> <span data-ttu-id="d21ed-183">除了强类型的数据表，类型化数据集现在还包括 Tableadapter，是使用的填充数据集的数据表和传播回数据库数据表中的修改的方法的类。</span><span class="sxs-lookup"><span data-stu-id="d21ed-183">In addition to strongly-typed DataTables, Typed DataSets now also include TableAdapters, which are classes with methods for populating the DataSet's DataTables and propagating modifications within the DataTables back to the database.</span></span>

> [!NOTE]
> <span data-ttu-id="d21ed-184">有关的优点和缺点的自定义业务对象与使用类型化数据集的详细信息，请参阅[设计数据层组件和层间传递数据](https://msdn.microsoft.com/en-us/library/ms978496.aspx)。</span><span class="sxs-lookup"><span data-stu-id="d21ed-184">For more information on the advantages and disadvantages of using Typed DataSets versus custom business objects, refer to [Designing Data Tier Components and Passing Data Through Tiers](https://msdn.microsoft.com/en-us/library/ms978496.aspx).</span></span>


<span data-ttu-id="d21ed-185">我们将使用这些教程的体系结构相符的强类型化数据集。</span><span class="sxs-lookup"><span data-stu-id="d21ed-185">We'll use strongly-typed DataSets for these tutorials' architecture.</span></span> <span data-ttu-id="d21ed-186">图 3 说明了使用类型化数据集的应用程序的不同层之间的工作流。</span><span class="sxs-lookup"><span data-stu-id="d21ed-186">Figure 3 illustrates the workflow between the different layers of an application that uses Typed DataSets.</span></span>


<span data-ttu-id="d21ed-187">[![所有数据访问代码都降级到 DAL](creating-a-data-access-layer-cs/_static/image6.png)](creating-a-data-access-layer-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-187">[![All Data Access Code is Relegated to the DAL](creating-a-data-access-layer-cs/_static/image6.png)](creating-a-data-access-layer-cs/_static/image5.png)</span></span>

<span data-ttu-id="d21ed-188">**图 3**： 所有数据访问代码都降级到 DAL ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-188">**Figure 3**: All Data Access Code is Relegated to the DAL ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image7.png))</span></span>


## <a name="creating-a-typed-dataset-and-table-adapter"></a><span data-ttu-id="d21ed-189">创建类型化数据集和表适配器</span><span class="sxs-lookup"><span data-stu-id="d21ed-189">Creating a Typed DataSet and Table Adapter</span></span>

<span data-ttu-id="d21ed-190">若要开始创建我们 DAL，我们首先将类型化数据集添加到我们的项目。</span><span class="sxs-lookup"><span data-stu-id="d21ed-190">To begin creating our DAL, we start by adding a Typed DataSet to our project.</span></span> <span data-ttu-id="d21ed-191">若要完成此操作，右键单击解决方案资源管理器中的项目节点并选择添加新项。</span><span class="sxs-lookup"><span data-stu-id="d21ed-191">To accomplish this, right-click on the project node in the Solution Explorer and choose Add a New Item.</span></span> <span data-ttu-id="d21ed-192">从模板列表中选择数据集选项并将其命名**Northwind.xsd**。</span><span class="sxs-lookup"><span data-stu-id="d21ed-192">Select the DataSet option from the list of templates and name it **Northwind.xsd**.</span></span>


<span data-ttu-id="d21ed-193">[![选择将新的数据集添加到你的项目](creating-a-data-access-layer-cs/_static/image9.png)](creating-a-data-access-layer-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-193">[![Choose to Add a New DataSet to Your Project](creating-a-data-access-layer-cs/_static/image9.png)](creating-a-data-access-layer-cs/_static/image8.png)</span></span>

<span data-ttu-id="d21ed-194">**图 4**： 选择将新的数据集添加到您的项目 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-194">**Figure 4**: Choose to Add a New DataSet to Your Project ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image10.png))</span></span>


<span data-ttu-id="d21ed-195">单击添加，当系统提示添加到的数据集后**应用\_代码**文件夹中，选择是。</span><span class="sxs-lookup"><span data-stu-id="d21ed-195">After clicking Add, when prompted to add the DataSet to the **App\_Code** folder, choose Yes.</span></span> <span data-ttu-id="d21ed-196">将显示为类型化数据集设计器，并将启动 TableAdapter 配置向导，让你可以添加到类型化数据集的第一个 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="d21ed-196">The Designer for the Typed DataSet will then be displayed, and the TableAdapter Configuration Wizard will start, allowing you to add your first TableAdapter to the Typed DataSet.</span></span>

<span data-ttu-id="d21ed-197">类型化数据集用作强类型集合的数据;它由构成的强类型 DataTable 实例，其中每个反过来组成强类型 DataRow 实例。</span><span class="sxs-lookup"><span data-stu-id="d21ed-197">A Typed DataSet serves as a strongly-typed collection of data; it is composed of strongly-typed DataTable instances, each of which is in turn composed of strongly-typed DataRow instances.</span></span> <span data-ttu-id="d21ed-198">我们将为每个我们需要使用在本教程系列中的基础数据库表创建强类型的 DataTable。</span><span class="sxs-lookup"><span data-stu-id="d21ed-198">We will create a strongly-typed DataTable for each of the underlying database tables that we need to work with in this tutorials series.</span></span> <span data-ttu-id="d21ed-199">让我们开始创建用于数据表**产品**表。</span><span class="sxs-lookup"><span data-stu-id="d21ed-199">Let's start with creating a DataTable for the **Products** table.</span></span>

<span data-ttu-id="d21ed-200">请记住，强类型数据表未包括上如何访问其基础数据库表中的数据的任何信息。</span><span class="sxs-lookup"><span data-stu-id="d21ed-200">Keep in mind that strongly-typed DataTables do not include any information on how to access data from their underlying database table.</span></span> <span data-ttu-id="d21ed-201">为了检索要填充 DataTable 的数据，我们使用一个 TableAdapter 类，该类用作我们的数据访问层。</span><span class="sxs-lookup"><span data-stu-id="d21ed-201">In order to retrieve the data to populate the DataTable, we use a TableAdapter class, which functions as our Data Access Layer.</span></span> <span data-ttu-id="d21ed-202">有关我们**产品**数据表，TableAdapter 将包含方法**GetProducts()**，  **GetProductByCategoryID (*categoryID*) * *，依次类推我们将从表示层中调用。</span><span class="sxs-lookup"><span data-stu-id="d21ed-202">For our **Products** DataTable, the TableAdapter will contain the methods **GetProducts()**, **GetProductByCategoryID(*categoryID*)**, and so on that we'll invoke from the presentation layer.</span></span> <span data-ttu-id="d21ed-203">DataTable 的角色是充当用于在各层之间传递数据的强类型对象。</span><span class="sxs-lookup"><span data-stu-id="d21ed-203">The DataTable's role is to serve as the strongly-typed objects used to pass data between the layers.</span></span>

<span data-ttu-id="d21ed-204">TableAdapter 配置向导首先提示你选择要使用的数据库。</span><span class="sxs-lookup"><span data-stu-id="d21ed-204">The TableAdapter Configuration Wizard begins by prompting you to select which database to work with.</span></span> <span data-ttu-id="d21ed-205">下拉列表显示在服务器资源管理器中这些数据库。</span><span class="sxs-lookup"><span data-stu-id="d21ed-205">The drop-down list shows those databases in the Server Explorer.</span></span> <span data-ttu-id="d21ed-206">如果您不未向服务器资源管理器添加 Northwind 数据库，可以在此时若要这样做单击新建连接按钮。</span><span class="sxs-lookup"><span data-stu-id="d21ed-206">If you did not add the Northwind database to the Server Explorer, you can click the New Connection button at this time to do so.</span></span>


<span data-ttu-id="d21ed-207">[![从下拉列表中选择 Northwind 数据库](creating-a-data-access-layer-cs/_static/image12.png)](creating-a-data-access-layer-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-207">[![Choose the Northwind Database from the Drop-Down List](creating-a-data-access-layer-cs/_static/image12.png)](creating-a-data-access-layer-cs/_static/image11.png)</span></span>

<span data-ttu-id="d21ed-208">**图 5**： 从下拉列表中选择 Northwind 数据库 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-208">**Figure 5**: Choose the Northwind Database from the Drop-Down List ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image13.png))</span></span>


<span data-ttu-id="d21ed-209">选择数据库并单击下一步后, 你系统将要求你想要保存的连接字符串中**Web.config**文件。</span><span class="sxs-lookup"><span data-stu-id="d21ed-209">After selecting the database and clicking Next, you'll be asked if you want to save the connection string in the **Web.config** file.</span></span> <span data-ttu-id="d21ed-210">通过保存连接字符串中，你可以避免具有硬编码在 TableAdapter 类中，可简化操作，如果连接字符串信息在将来发生更改。</span><span class="sxs-lookup"><span data-stu-id="d21ed-210">By saving the connection string you'll avoid having it hard coded in the TableAdapter classes, which simplifies things if the connection string information changes in the future.</span></span> <span data-ttu-id="d21ed-211">如果选择将连接字符串保存在配置文件中将被放置在 **&lt;connectionStrings&gt;** 部分中，可以是[（可选） 加密](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)以改进安全或更高版本通过新的 ASP.NET 2.0 属性页内 IIS GUI 管理工具的说明进行操作，这是更适合管理员已修改。</span><span class="sxs-lookup"><span data-stu-id="d21ed-211">If you opt to save the connection string in the configuration file it's placed in the **&lt;connectionStrings&gt;** section, which can be [optionally encrypted](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx) for improved security or modified later through the new ASP.NET 2.0 Property Page within the IIS GUI Admin Tool, which is more ideal for administrators.</span></span>


<span data-ttu-id="d21ed-212">[![将连接字符串保存到 Web.config](creating-a-data-access-layer-cs/_static/image15.png)](creating-a-data-access-layer-cs/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-212">[![Save the Connection String to Web.config](creating-a-data-access-layer-cs/_static/image15.png)](creating-a-data-access-layer-cs/_static/image14.png)</span></span>

<span data-ttu-id="d21ed-213">**图 6**： 将连接字符串保存到**Web.config** ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-213">**Figure 6**: Save the Connection String to **Web.config** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image16.png))</span></span>


<span data-ttu-id="d21ed-214">接下来，我们需要第一个的强类型 datatable 中定义的架构，并提供为我们 TableAdapter 填充强类型化数据集时要使用第一种方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-214">Next, we need to define the schema for the first strongly-typed DataTable and provide the first method for our TableAdapter to use when populating the strongly-typed DataSet.</span></span> <span data-ttu-id="d21ed-215">通过创建查询返回的列从表，我们希望在我们 DataTable 中反映同时完成这两个步骤。</span><span class="sxs-lookup"><span data-stu-id="d21ed-215">These two steps are accomplished simultaneously by creating a query that returns the columns from the table that we want reflected in our DataTable.</span></span> <span data-ttu-id="d21ed-216">在向导末尾我们将对此查询提供的方法名称。</span><span class="sxs-lookup"><span data-stu-id="d21ed-216">At the end of the wizard we'll give a method name to this query.</span></span> <span data-ttu-id="d21ed-217">一旦完成的工作，则可以从我们表示层调用此方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-217">Once that's been accomplished, this method can be invoked from our presentation layer.</span></span> <span data-ttu-id="d21ed-218">该方法将执行定义的查询并填充强类型的 DataTable。</span><span class="sxs-lookup"><span data-stu-id="d21ed-218">The method will execute the defined query and populate a strongly-typed DataTable.</span></span>

<span data-ttu-id="d21ed-219">若要开始定义我们首先必须指示我们希望如何可以发出查询的 TableAdapter 的 SQL 查询。</span><span class="sxs-lookup"><span data-stu-id="d21ed-219">To get started defining the SQL query we must first indicate how we want the TableAdapter to issue the query.</span></span> <span data-ttu-id="d21ed-220">我们可以使用临时 SQL 语句，创建一个新的存储的过程，或使用现有存储的过程。</span><span class="sxs-lookup"><span data-stu-id="d21ed-220">We can use an ad-hoc SQL statement, create a new stored procedure, or use an existing stored procedure.</span></span> <span data-ttu-id="d21ed-221">对于这些教程中，我们将使用临时 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="d21ed-221">For these tutorials we'll use ad-hoc SQL statements.</span></span> <span data-ttu-id="d21ed-222">请参阅[Brian Noyes](http://briannoyes.net/)的文章，[生成数据访问层与 Visual Studio 2005 数据集设计器](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner)有关使用存储的过程的示例。</span><span class="sxs-lookup"><span data-stu-id="d21ed-222">Refer to [Brian Noyes](http://briannoyes.net/)'s article, [Build a Data Access Layer with the Visual Studio 2005 DataSet Designer](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner) for an example of using stored procedures.</span></span>


<span data-ttu-id="d21ed-223">[![查询使用的临时 SQL 语句的数据](creating-a-data-access-layer-cs/_static/image18.png)](creating-a-data-access-layer-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-223">[![Query the Data Using an Ad-Hoc SQL Statement](creating-a-data-access-layer-cs/_static/image18.png)](creating-a-data-access-layer-cs/_static/image17.png)</span></span>

<span data-ttu-id="d21ed-224">**图 7**： 查询使用临时 SQL 语句的数据 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image19.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-224">**Figure 7**: Query the Data Using an Ad-Hoc SQL Statement ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image19.png))</span></span>


<span data-ttu-id="d21ed-225">此时我们可以键入 SQL 查询中手动。</span><span class="sxs-lookup"><span data-stu-id="d21ed-225">At this point we can type in the SQL query by hand.</span></span> <span data-ttu-id="d21ed-226">当在 TableAdapter 中创建第一种方法通常想要让查询返回需要在相应的 DataTable 中表示这些列。</span><span class="sxs-lookup"><span data-stu-id="d21ed-226">When creating the first method in the TableAdapter you typically want to have the query return those columns that need to be expressed in the corresponding DataTable.</span></span> <span data-ttu-id="d21ed-227">我们可以通过创建的查询返回所有列和中的所有行来完成此**产品**表：</span><span class="sxs-lookup"><span data-stu-id="d21ed-227">We can accomplish this by creating a query that returns all columns and all rows from the **Products** table:</span></span>


<span data-ttu-id="d21ed-228">[![在文本框中输入 SQL 查询](creating-a-data-access-layer-cs/_static/image21.png)](creating-a-data-access-layer-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-228">[![Enter the SQL Query Into the Textbox](creating-a-data-access-layer-cs/_static/image21.png)](creating-a-data-access-layer-cs/_static/image20.png)</span></span>

<span data-ttu-id="d21ed-229">**图 8**： 输入 SQL 查询到文本框中 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-229">**Figure 8**: Enter the SQL Query Into the Textbox ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image22.png))</span></span>


<span data-ttu-id="d21ed-230">或者，使用查询生成器，并以图形方式构造查询，如图 9 中所示。</span><span class="sxs-lookup"><span data-stu-id="d21ed-230">Alternatively, use the Query Builder and graphically construct the query, as shown in Figure 9.</span></span>


<span data-ttu-id="d21ed-231">[![以图形方式，通过查询编辑器中创建查询](creating-a-data-access-layer-cs/_static/image24.png)](creating-a-data-access-layer-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-231">[![Create the Query Graphically, through the Query Editor](creating-a-data-access-layer-cs/_static/image24.png)](creating-a-data-access-layer-cs/_static/image23.png)</span></span>

<span data-ttu-id="d21ed-232">**图 9**: 查询以图形方式，通过查询编辑器中创建 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-232">**Figure 9**: Create the Query Graphically, through the Query Editor ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image25.png))</span></span>


<span data-ttu-id="d21ed-233">创建查询之后, 再移到下一个屏幕上，单击高级选项按钮。</span><span class="sxs-lookup"><span data-stu-id="d21ed-233">After creating the query, but before moving onto the next screen, click the Advanced Options button.</span></span> <span data-ttu-id="d21ed-234">在网站项目中，"生成 Insert、 Update 和 Delete 语句"是唯一一种高级选项选择默认设置。如果你从类库或 Windows 项目运行此向导也将选择"使用开放式并发"选项。</span><span class="sxs-lookup"><span data-stu-id="d21ed-234">In Web Site Projects, "Generate Insert, Update, and Delete statements" is the only advanced option selected by default; if you run this wizard from a Class Library or a Windows Project the "Use optimistic concurrency" option will also be selected.</span></span> <span data-ttu-id="d21ed-235">现在请保留"使用开放式并发"选项未选中状态。</span><span class="sxs-lookup"><span data-stu-id="d21ed-235">Leave the "Use optimistic concurrency" option unchecked for now.</span></span> <span data-ttu-id="d21ed-236">在将来的教程中，我们将检查开放式并发。</span><span class="sxs-lookup"><span data-stu-id="d21ed-236">We'll examine optimistic concurrency in future tutorials.</span></span>


<span data-ttu-id="d21ed-237">[![选择仅生成 Insert、 Update 和 Delete 语句选项](creating-a-data-access-layer-cs/_static/image27.png)](creating-a-data-access-layer-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-237">[![Select Only the Generate Insert, Update, and Delete statements Option](creating-a-data-access-layer-cs/_static/image27.png)](creating-a-data-access-layer-cs/_static/image26.png)</span></span>

<span data-ttu-id="d21ed-238">**图 10**： 选择仅生成 Insert、 Update 和 Delete 语句选项 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-238">**Figure 10**: Select Only the Generate Insert, Update, and Delete statements Option ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image28.png))</span></span>


<span data-ttu-id="d21ed-239">在验证之后的高级的选项，单击下一步转到最后一个屏幕。</span><span class="sxs-lookup"><span data-stu-id="d21ed-239">After verifying the advanced options, click Next to proceed to the final screen.</span></span> <span data-ttu-id="d21ed-240">此处我们将要求选择要添加到 TableAdapter 的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-240">Here we are asked to select which methods to add to the TableAdapter.</span></span> <span data-ttu-id="d21ed-241">有两种模式填充数据：</span><span class="sxs-lookup"><span data-stu-id="d21ed-241">There are two patterns for populating data:</span></span>

- <span data-ttu-id="d21ed-242">**填充 DataTable**使用此方法创建一个方法采用作为参数数据表并填充它基于查询的结果。</span><span class="sxs-lookup"><span data-stu-id="d21ed-242">**Fill a DataTable** with this approach a method is created that takes in a DataTable as a parameter and populates it based on the results of the query.</span></span> <span data-ttu-id="d21ed-243">ADO.NET DataAdapter 类，例如，实现此模式与其**Fill()**方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-243">The ADO.NET DataAdapter class, for example, implements this pattern with its **Fill()** method.</span></span>
- <span data-ttu-id="d21ed-244">**返回 DataTable**使用此方法时该方法将创建和为你填充 DataTable 并返回它作为方法返回值。</span><span class="sxs-lookup"><span data-stu-id="d21ed-244">**Return a DataTable** with this approach the method creates and fills the DataTable for you and returns it as the methods return value.</span></span>

<span data-ttu-id="d21ed-245">你可以实现一个或这两种模式的 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="d21ed-245">You can have the TableAdapter implement one or both of these patterns.</span></span> <span data-ttu-id="d21ed-246">你还可以重命名此处提供的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-246">You can also rename the methods provided here.</span></span> <span data-ttu-id="d21ed-247">即使我们将仅使用这些教程在后一种模式，让我们将检查，这两个复选框保留。</span><span class="sxs-lookup"><span data-stu-id="d21ed-247">Let's leave both checkboxes checked, even though we'll only be using the latter pattern throughout these tutorials.</span></span> <span data-ttu-id="d21ed-248">此外，让我们重命名而不是泛型**GetData**方法**GetProducts**。</span><span class="sxs-lookup"><span data-stu-id="d21ed-248">Also, let's rename the rather generic **GetData** method to **GetProducts**.</span></span>

<span data-ttu-id="d21ed-249">如果选中，则最终的复选框，"GenerateDBDirectMethods，"创建**Insert()**， **update （)**，和**delete （)** TableAdapter 的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-249">If checked, the final checkbox, "GenerateDBDirectMethods," creates **Insert()**, **Update()**, and **Delete()** methods for the TableAdapter.</span></span> <span data-ttu-id="d21ed-250">如果选中此选项，所有更新将都需要通过 TableAdapter 的唯一**update （)**方法，后者采用在类型化数据集、 数据表、 单个数据行或返回数据行的数组。</span><span class="sxs-lookup"><span data-stu-id="d21ed-250">If you leave this option unchecked, all updates will need to be done through the TableAdapter's sole **Update()** method, which takes in the Typed DataSet, a DataTable, a single DataRow, or an array of DataRows.</span></span> <span data-ttu-id="d21ed-251">(如果你已经图 9 中的高级属性中此复选框未选中的"生成 Insert、 Update 和 Delete 语句"选项设置不起作用。)让我们保留选中此复选框。</span><span class="sxs-lookup"><span data-stu-id="d21ed-251">(If you've unchecked the "Generate Insert, Update, and Delete statements" option from the advanced properties in Figure 9 this checkbox's setting will have no effect.) Let's leave this checkbox selected.</span></span>


<span data-ttu-id="d21ed-252">[![GetData 方法名称更改为 GetProducts](creating-a-data-access-layer-cs/_static/image30.png)](creating-a-data-access-layer-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-252">[![Change the Method Name from GetData to GetProducts](creating-a-data-access-layer-cs/_static/image30.png)](creating-a-data-access-layer-cs/_static/image29.png)</span></span>

<span data-ttu-id="d21ed-253">**图 11**： 将方法名称由**GetData**到**GetProducts** ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-253">**Figure 11**: Change the Method Name from **GetData** to **GetProducts** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image31.png))</span></span>


<span data-ttu-id="d21ed-254">通过单击完成完成向导。</span><span class="sxs-lookup"><span data-stu-id="d21ed-254">Complete the wizard by clicking Finish.</span></span> <span data-ttu-id="d21ed-255">在向导关闭后我们将返回到显示 DataTable 我们刚刚创建的数据集设计器。</span><span class="sxs-lookup"><span data-stu-id="d21ed-255">After the wizard closes we are returned to the DataSet Designer which shows the DataTable we just created.</span></span> <span data-ttu-id="d21ed-256">您可以看到中的列列表**产品**DataTable (**ProductID**， **ProductName**，依次类推)，以及的方法**ProductsTableAdapter** (**Fill()**和**GetProducts()**)。</span><span class="sxs-lookup"><span data-stu-id="d21ed-256">You can see the list of columns in the **Products** DataTable (**ProductID**, **ProductName**, and so on), as well as the methods of the **ProductsTableAdapter** (**Fill()** and **GetProducts()**).</span></span>


<span data-ttu-id="d21ed-257">[![已添加到类型化数据集的产品 DataTable 和 ProductsTableAdapter](creating-a-data-access-layer-cs/_static/image33.png)](creating-a-data-access-layer-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-257">[![The Products DataTable and ProductsTableAdapter have been Added to the Typed DataSet](creating-a-data-access-layer-cs/_static/image33.png)](creating-a-data-access-layer-cs/_static/image32.png)</span></span>

<span data-ttu-id="d21ed-258">**图 12**:**产品**DataTable 和**ProductsTableAdapter**已添加到类型化数据集 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-258">**Figure 12**: The **Products** DataTable and **ProductsTableAdapter** have been Added to the Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image34.png))</span></span>


<span data-ttu-id="d21ed-259">我们现在有单个数据表的数据集类型 (**Northwind.Products**) 和一个强类型 DataAdapter 类 (**NorthwindTableAdapters.ProductsTableAdapter**) 与**GetProducts()**方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-259">At this point we have a Typed DataSet with a single DataTable (**Northwind.Products**) and a strongly-typed DataAdapter class (**NorthwindTableAdapters.ProductsTableAdapter**) with a **GetProducts()** method.</span></span> <span data-ttu-id="d21ed-260">这些对象可以用于从类似的代码访问的所有产品的列表：</span><span class="sxs-lookup"><span data-stu-id="d21ed-260">These objects can be used to access a list of all products from code like:</span></span>

[!code-html[Main](creating-a-data-access-layer-cs/samples/sample1.html)]

<span data-ttu-id="d21ed-261">此代码不需要我们要写入的数据访问特定代码的一位。</span><span class="sxs-lookup"><span data-stu-id="d21ed-261">This code did not require us to write one bit of data access-specific code.</span></span> <span data-ttu-id="d21ed-262">我们不一定非要实例化任何 ADO.NET 类，我们没有来指代的任意连接字符串，SQL 查询或存储过程。</span><span class="sxs-lookup"><span data-stu-id="d21ed-262">We did not have to instantiate any ADO.NET classes, we didn't have to refer to any connection strings, SQL queries, or stored procedures.</span></span> <span data-ttu-id="d21ed-263">相反，TableAdapter 为我们提供低级别的数据访问代码。</span><span class="sxs-lookup"><span data-stu-id="d21ed-263">Instead, the TableAdapter provides the low-level data access code for us.</span></span>

<span data-ttu-id="d21ed-264">此示例中使用每个对象也是强类型，允许 Visual Studio 以提供 IntelliSense 和编译时类型检查。</span><span class="sxs-lookup"><span data-stu-id="d21ed-264">Each object used in this example is also strongly-typed, allowing Visual Studio to provide IntelliSense and compile-time type checking.</span></span> <span data-ttu-id="d21ed-265">并且返回的 TableAdapter 的所有数据表的最佳可以绑定到 ASP.NET Web 控件，如 GridView、 说明、 DropDownList、 如何，以及多个其他数据。</span><span class="sxs-lookup"><span data-stu-id="d21ed-265">And best of all the DataTables returned by the TableAdapter can be bound to ASP.NET data Web controls, such as the GridView, DetailsView, DropDownList, CheckBoxList, and several others.</span></span> <span data-ttu-id="d21ed-266">下面的示例演示绑定返回 DataTable **GetProducts()**方法只需获得的三个行中的代码中一个 GridView**页\_负载**事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="d21ed-266">The following example illustrates binding the DataTable returned by the **GetProducts()** method to a GridView in just a scant three lines of code within the **Page\_Load** event handler.</span></span>

<span data-ttu-id="d21ed-267">AllProducts.aspx</span><span class="sxs-lookup"><span data-stu-id="d21ed-267">AllProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample2.aspx)]

<span data-ttu-id="d21ed-268">AllProducts.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="d21ed-268">AllProducts.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample3.cs)]


<span data-ttu-id="d21ed-269">[![产品列表将显示在一个 GridView](creating-a-data-access-layer-cs/_static/image36.png)](creating-a-data-access-layer-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-269">[![The List of Products is Displayed in a GridView](creating-a-data-access-layer-cs/_static/image36.png)](creating-a-data-access-layer-cs/_static/image35.png)</span></span>

<span data-ttu-id="d21ed-270">**图 13**： 的产品的列表显示在一个 GridView ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image37.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-270">**Figure 13**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image37.png))</span></span>


<span data-ttu-id="d21ed-271">尽管此示例要求这样做我们在我们的 ASP.NET 页中编写的代码的三个行**页\_负载**事件处理程序中，在将来我们将查看如何使用对象数据源以声明方式检索中的数据的教程DAL。</span><span class="sxs-lookup"><span data-stu-id="d21ed-271">While this example required that we write three lines of code in our ASP.NET page's **Page\_Load** event handler, in future tutorials we'll examine how to use the ObjectDataSource to declaratively retrieve the data from the DAL.</span></span> <span data-ttu-id="d21ed-272">与 ObjectDataSource 我们将不需要编写任何代码，并将获取以及分页和排序支持 ！</span><span class="sxs-lookup"><span data-stu-id="d21ed-272">With the ObjectDataSource we'll not have to write any code and will get paging and sorting support as well!</span></span>

## <a name="step-3-adding-parameterized-methods-to-the-data-access-layer"></a><span data-ttu-id="d21ed-273">步骤 3： 添加参数化的数据访问层的方法</span><span class="sxs-lookup"><span data-stu-id="d21ed-273">Step 3: Adding Parameterized Methods to the Data Access Layer</span></span>

<span data-ttu-id="d21ed-274">此时我们**ProductsTableAdapter**类具有一个方法，但**GetProducts()**，它返回数据库中的所有产品。</span><span class="sxs-lookup"><span data-stu-id="d21ed-274">At this point our **ProductsTableAdapter** class has but one method, **GetProducts()**, which returns all of the products in the database.</span></span> <span data-ttu-id="d21ed-275">在能够使用的所有产品是肯定有用，可以在我们将需要检索有关特定产品或属于特定类别的所有产品的信息的时间。</span><span class="sxs-lookup"><span data-stu-id="d21ed-275">While being able to work with all products is definitely useful, there are times when we'll want to retrieve information about a specific product, or all products that belong to a particular category.</span></span> <span data-ttu-id="d21ed-276">若要将此类功能添加到我们的数据访问层我们可以向 TableAdapter 添加参数化的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-276">To add such functionality to our Data Access Layer we can add parameterized methods to the TableAdapter.</span></span>

<span data-ttu-id="d21ed-277">让我们添加 **GetProductsByCategoryID (*categoryID*) * * 方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-277">Let's add the **GetProductsByCategoryID(*categoryID*)** method.</span></span> <span data-ttu-id="d21ed-278">要将新方法添加到 DAL，返回到数据集设计器中，右键单击**ProductsTableAdapter**部分，然后选择添加查询。</span><span class="sxs-lookup"><span data-stu-id="d21ed-278">To add a new method to the DAL, return to the DataSet Designer, right-click in the **ProductsTableAdapter** section, and choose Add Query.</span></span>


![右键单击 TableAdapter，然后选择添加查询](creating-a-data-access-layer-cs/_static/image38.png)

<span data-ttu-id="d21ed-280">**图 14**： 的 TableAdapter 上右键单击，然后选择添加查询</span><span class="sxs-lookup"><span data-stu-id="d21ed-280">**Figure 14**: Right-Click on the TableAdapter and Choose Add Query</span></span>


<span data-ttu-id="d21ed-281">我们首先提示您有关是否我们想要使用的临时 SQL 语句或新的或现有的存储的过程访问数据库。</span><span class="sxs-lookup"><span data-stu-id="d21ed-281">We are first prompted about whether we want to access the database using an ad-hoc SQL statement or a new or existing stored procedure.</span></span> <span data-ttu-id="d21ed-282">让我们选择使用临时 SQL 语句试。</span><span class="sxs-lookup"><span data-stu-id="d21ed-282">Let's choose to use an ad-hoc SQL statement again.</span></span> <span data-ttu-id="d21ed-283">接下来，我们会要求我们要使用哪种类型的 SQL 查询。</span><span class="sxs-lookup"><span data-stu-id="d21ed-283">Next, we are asked what type of SQL query we'd like to use.</span></span> <span data-ttu-id="d21ed-284">由于我们想要返回属于指定类别的所有产品，我们希望编写**选择**语句语句可返回行。</span><span class="sxs-lookup"><span data-stu-id="d21ed-284">Since we want to return all products that belong to a specified category, we want to write a **SELECT** statement which returns rows.</span></span>


<span data-ttu-id="d21ed-285">[![选择创建可返回行的 SELECT 语句](creating-a-data-access-layer-cs/_static/image40.png)](creating-a-data-access-layer-cs/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-285">[![Choose to Create a SELECT Statement Which Returns Rows](creating-a-data-access-layer-cs/_static/image40.png)](creating-a-data-access-layer-cs/_static/image39.png)</span></span>

<span data-ttu-id="d21ed-286">**图 15**： 选择创建**选择**语句其返回行 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image41.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-286">**Figure 15**: Choose to Create a **SELECT** Statement Which Returns Rows ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image41.png))</span></span>


<span data-ttu-id="d21ed-287">下一步是定义用于访问数据的 SQL 查询。</span><span class="sxs-lookup"><span data-stu-id="d21ed-287">The next step is to define the SQL query used to access the data.</span></span> <span data-ttu-id="d21ed-288">由于我们想要返回属于特定类别的产品，我将使用相同**选择**语句从**GetProducts()**，但将添加以下**其中**子句：**其中 CategoryID = @CategoryID** 。</span><span class="sxs-lookup"><span data-stu-id="d21ed-288">Since we want to return only those products that belong to a particular category, I use the same **SELECT** statement from **GetProducts()**, but add the following **WHERE** clause: **WHERE CategoryID = @CategoryID**.</span></span> <span data-ttu-id="d21ed-289"> **@CategoryID** 参数到 TableAdapter 向导指示我们正在创建的方法，将需要输入的参数的相应类型 （也就是说，可以为 null 的整数）。</span><span class="sxs-lookup"><span data-stu-id="d21ed-289">The **@CategoryID** parameter indicates to the TableAdapter wizard that the method we're creating will require an input parameter of the corresponding type (namely, a nullable integer).</span></span>


<span data-ttu-id="d21ed-290">[![输入查询以仅返回在指定类别中的产品](creating-a-data-access-layer-cs/_static/image43.png)](creating-a-data-access-layer-cs/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-290">[![Enter a Query to Only Return Products in a Specified Category](creating-a-data-access-layer-cs/_static/image43.png)](creating-a-data-access-layer-cs/_static/image42.png)</span></span>

<span data-ttu-id="d21ed-291">**图 16**： 输入以仅返回产品指定类别中的查询 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image44.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-291">**Figure 16**: Enter a Query to Only Return Products in a Specified Category ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image44.png))</span></span>


<span data-ttu-id="d21ed-292">最后一步中我们可以选择数据访问模式，来使用，以及自定义所生成的方法的名称。</span><span class="sxs-lookup"><span data-stu-id="d21ed-292">In the final step we can choose which data access patterns to use, as well as customize the names of the methods generated.</span></span> <span data-ttu-id="d21ed-293">填充模式中，让我们将名称更改为**FillByCategoryID**并返回数据表返回模式 ( **获取*X** * 方法)，让我们使用**GetProductsByCategoryID**。</span><span class="sxs-lookup"><span data-stu-id="d21ed-293">For the Fill pattern, let's change the name to **FillByCategoryID** and for the return a DataTable return pattern (the **Get*X*** methods), let's use **GetProductsByCategoryID**.</span></span>


<span data-ttu-id="d21ed-294">[![选择的 TableAdapter 方法的名称](creating-a-data-access-layer-cs/_static/image46.png)](creating-a-data-access-layer-cs/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-294">[![Choose the Names for the TableAdapter Methods](creating-a-data-access-layer-cs/_static/image46.png)](creating-a-data-access-layer-cs/_static/image45.png)</span></span>

<span data-ttu-id="d21ed-295">**图 17**： 选择 TableAdapter 方法的名称 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image47.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-295">**Figure 17**: Choose the Names for the TableAdapter Methods ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image47.png))</span></span>


<span data-ttu-id="d21ed-296">完成向导后，数据集设计器包含新的 TableAdapter 方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-296">After completing the wizard, the DataSet Designer includes the new TableAdapter methods.</span></span>


![产品可以现在查询按类别](creating-a-data-access-layer-cs/_static/image48.png)

<span data-ttu-id="d21ed-298">**图 18**: 产品可以现在查询按类别</span><span class="sxs-lookup"><span data-stu-id="d21ed-298">**Figure 18**: The Products Can Now be Queried by Category</span></span>


<span data-ttu-id="d21ed-299">花些时间添加 **GetProductByProductID (*productID*) * * 使用相同的技术的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-299">Take a moment to add a **GetProductByProductID(*productID*)** method using the same technique.</span></span>

<span data-ttu-id="d21ed-300">这些参数化的查询可以直接从数据集设计器进行测试。</span><span class="sxs-lookup"><span data-stu-id="d21ed-300">These parameterized queries can be tested directly from the DataSet Designer.</span></span> <span data-ttu-id="d21ed-301">右键单击 TableAdapter 中的方法，然后选择预览数据。</span><span class="sxs-lookup"><span data-stu-id="d21ed-301">Right-click on the method in the TableAdapter and choose Preview Data.</span></span> <span data-ttu-id="d21ed-302">接下来，输入要使用的参数并单击预览的值。</span><span class="sxs-lookup"><span data-stu-id="d21ed-302">Next, enter the values to use for the parameters and click Preview.</span></span>


<span data-ttu-id="d21ed-303">[![显示这些产品隶属于饮料类别](creating-a-data-access-layer-cs/_static/image50.png)](creating-a-data-access-layer-cs/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-303">[![Those Products Belonging to the Beverages Category are Shown](creating-a-data-access-layer-cs/_static/image50.png)](creating-a-data-access-layer-cs/_static/image49.png)</span></span>

<span data-ttu-id="d21ed-304">**图 19**： 显示那些产品属于饮料类别 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-304">**Figure 19**: Those Products Belonging to the Beverages Category are Shown ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image51.png))</span></span>


<span data-ttu-id="d21ed-305">与 **GetProductsByCategoryID (*categoryID*) * * 我们 DAL 中的方法，我们现在可以创建仅显示那些产品指定类别中的 ASP.NET 页。</span><span class="sxs-lookup"><span data-stu-id="d21ed-305">With the **GetProductsByCategoryID(*categoryID*)** method in our DAL, we can now create an ASP.NET page that displays only those products in a specified category.</span></span> <span data-ttu-id="d21ed-306">下面的示例显示的所有产品中饮料类别中，其具有**CategoryID**为 1。</span><span class="sxs-lookup"><span data-stu-id="d21ed-306">The following example shows all products that are in the Beverages category, which have a **CategoryID** of 1.</span></span>

<span data-ttu-id="d21ed-307">Beverages.asp</span><span class="sxs-lookup"><span data-stu-id="d21ed-307">Beverages.asp</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample4.aspx)]

<span data-ttu-id="d21ed-308">Beverages.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="d21ed-308">Beverages.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample5.cs)]


<span data-ttu-id="d21ed-309">[![显示饮料类别中的这些产品](creating-a-data-access-layer-cs/_static/image53.png)](creating-a-data-access-layer-cs/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-309">[![Those Products in the Beverages Category are Displayed](creating-a-data-access-layer-cs/_static/image53.png)](creating-a-data-access-layer-cs/_static/image52.png)</span></span>

<span data-ttu-id="d21ed-310">**图 20**： 显示饮料类别中的那些产品 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image54.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-310">**Figure 20**: Those Products in the Beverages Category are Displayed ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image54.png))</span></span>


## <a name="step-4-inserting-updating-and-deleting-data"></a><span data-ttu-id="d21ed-311">步骤 4： 插入、 更新和删除数据</span><span class="sxs-lookup"><span data-stu-id="d21ed-311">Step 4: Inserting, Updating, and Deleting Data</span></span>

<span data-ttu-id="d21ed-312">有两种模式通常用于插入、 更新和删除数据。</span><span class="sxs-lookup"><span data-stu-id="d21ed-312">There are two patterns commonly used for inserting, updating, and deleting data.</span></span> <span data-ttu-id="d21ed-313">第一个模式，我将调用数据库直接模式，涉及到创建方法，调用时，问题**插入**，**更新**，或**删除**命令对一条数据库记录的数据库。</span><span class="sxs-lookup"><span data-stu-id="d21ed-313">The first pattern, which I'll call the database direct pattern, involves creating methods that, when invoked, issue an **INSERT**, **UPDATE**, or **DELETE** command to the database that operates on a single database record.</span></span> <span data-ttu-id="d21ed-314">若要插入、 更新或删除的值中，此类方法中的一系列对应的标量值 （整数、 字符串、 布尔值、 Datetime，等） 通常传递。</span><span class="sxs-lookup"><span data-stu-id="d21ed-314">Such methods are typically passed in a series of scalar values (integers, strings, Booleans, DateTimes, and so on) that correspond to the values to insert, update, or delete.</span></span> <span data-ttu-id="d21ed-315">例如，对于此模式**产品**delete 方法将采用一个整数参数的表，该值指示**ProductID** insert 方法将需要时删除的记录字符串**ProductName**即为十进制**UnitPrice**，整数**UnitsOnStock**，依次类推。</span><span class="sxs-lookup"><span data-stu-id="d21ed-315">For example, with this pattern for the **Products** table the delete method would take in an integer parameter, indicating the **ProductID** of the record to delete, while the insert method would take in a string for the **ProductName**, a decimal for the **UnitPrice**, an integer for the **UnitsOnStock**, and so on.</span></span>


<span data-ttu-id="d21ed-316">[![每个插入、 更新和删除请求发送到数据库立即](creating-a-data-access-layer-cs/_static/image56.png)](creating-a-data-access-layer-cs/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-316">[![Each Insert, Update, and Delete Request is Sent to the Database Immediately](creating-a-data-access-layer-cs/_static/image56.png)](creating-a-data-access-layer-cs/_static/image55.png)</span></span>

<span data-ttu-id="d21ed-317">**图 21**： 每个插入、 更新和删除请求发送到数据库立即 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image57.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-317">**Figure 21**: Each Insert, Update, and Delete Request is Sent to the Database Immediately ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image57.png))</span></span>


<span data-ttu-id="d21ed-318">其他模式，我将引用以作为批处理更新模式，是更新整个数据集、 数据表或在一个方法调用中返回数据行的集合。</span><span class="sxs-lookup"><span data-stu-id="d21ed-318">The other pattern, which I'll refer to as the batch update pattern, is to update an entire DataSet, DataTable, or collection of DataRows in one method call.</span></span> <span data-ttu-id="d21ed-319">此模式与开发人员删除、 插入和修改数据表中的 Datarow，然后将这些数据行或 DataTable 传递给的更新方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-319">With this pattern a developer deletes, inserts, and modifies the DataRows in a DataTable and then passes those DataRows or DataTable into an update method.</span></span> <span data-ttu-id="d21ed-320">此方法然后枚举传入 Datarow，确定是否它们已被修改、 添加或删除 (通过 DataRow 的[RowState 属性](https://msdn.microsoft.com/en-us/library/system.data.datarow.rowstate.aspx)值)，因此会发出每个记录的相应数据库请求。</span><span class="sxs-lookup"><span data-stu-id="d21ed-320">This method then enumerates the DataRows passed in, determines whether or not they've been modified, added, or deleted (via the DataRow's [RowState property](https://msdn.microsoft.com/en-us/library/system.data.datarow.rowstate.aspx) value), and issues the appropriate database request for each record.</span></span>


<span data-ttu-id="d21ed-321">[![调用更新方法时，所有更改将与数据库都同步](creating-a-data-access-layer-cs/_static/image59.png)](creating-a-data-access-layer-cs/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-321">[![All Changes are Synchronized with the Database When the Update Method is Invoked](creating-a-data-access-layer-cs/_static/image59.png)](creating-a-data-access-layer-cs/_static/image58.png)</span></span>

<span data-ttu-id="d21ed-322">**图 22**： 调用更新方法时，所有更改将与数据库都同步 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image60.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-322">**Figure 22**: All Changes are Synchronized with the Database When the Update Method is Invoked ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image60.png))</span></span>


<span data-ttu-id="d21ed-323">TableAdapter 默认情况下，使用批处理更新模式，但也支持 DB 直接模式。</span><span class="sxs-lookup"><span data-stu-id="d21ed-323">The TableAdapter uses the batch update pattern by default, but also supports the DB direct pattern.</span></span> <span data-ttu-id="d21ed-324">由于我们从高级属性选择"生成 Insert、 Update 和 Delete 语句"选项，创建我们 TableAdapter 时**ProductsTableAdapter**包含**update （)**方法，它实现批处理更新模式。</span><span class="sxs-lookup"><span data-stu-id="d21ed-324">Since we selected the "Generate Insert, Update, and Delete statements" option from the Advanced Properties when creating our TableAdapter, the **ProductsTableAdapter** contains an **Update()** method, which implements the batch update pattern.</span></span> <span data-ttu-id="d21ed-325">具体而言，TableAdapter 包含**update （)**类型化数据集、 强类型的数据表或一个或多个数据行可传递的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-325">Specifically, the TableAdapter contains an **Update()** method that can be passed the Typed DataSet, a strongly-typed DataTable, or one or more DataRows.</span></span> <span data-ttu-id="d21ed-326">如果保留"GenerateDBDirectMethods"复选框选中时首次创建 TableAdapter 的 DB 直接模式将还可通过实现**Insert()**， **update （)**，和**delete （)**方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-326">If you left the "GenerateDBDirectMethods" checkbox checked when first creating the TableAdapter the DB direct pattern will also be implemented via **Insert()**, **Update()**, and **Delete()** methods.</span></span>

<span data-ttu-id="d21ed-327">这两种数据修改模式使用 TableAdapter 的**InsertCommand**， **UpdateCommand**，和**DeleteCommand**属性来颁发其**插入**，**更新**，和**删除**到数据库的命令。</span><span class="sxs-lookup"><span data-stu-id="d21ed-327">Both data modification patterns use the TableAdapter's **InsertCommand**, **UpdateCommand**, and **DeleteCommand** properties to issue their **INSERT**, **UPDATE**, and **DELETE** commands to the database.</span></span> <span data-ttu-id="d21ed-328">你可以检查和修改**InsertCommand**， **UpdateCommand**，和**DeleteCommand**由数据集设计器中的 TableAdapter 上单击，然后将属性到属性窗口中。</span><span class="sxs-lookup"><span data-stu-id="d21ed-328">You can inspect and modify the **InsertCommand**, **UpdateCommand**, and **DeleteCommand** properties by clicking on the TableAdapter in the DataSet Designer and then going to the Properties window.</span></span> <span data-ttu-id="d21ed-329">(请确保选择了 TableAdapter，且**ProductsTableAdapter**对象是在属性窗口中的下拉列表中选择。)</span><span class="sxs-lookup"><span data-stu-id="d21ed-329">(Make sure you have selected the TableAdapter, and that the **ProductsTableAdapter** object is the one selected in the drop-down list in the Properties window.)</span></span>


<span data-ttu-id="d21ed-330">[![TableAdapter 具有 InsertCommand、 限于 UpdateCommand 和 DeleteCommand 属性](creating-a-data-access-layer-cs/_static/image62.png)](creating-a-data-access-layer-cs/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-330">[![The TableAdapter has InsertCommand, UpdateCommand, and DeleteCommand Properties](creating-a-data-access-layer-cs/_static/image62.png)](creating-a-data-access-layer-cs/_static/image61.png)</span></span>

<span data-ttu-id="d21ed-331">**图 23**: TableAdapter 具有**InsertCommand**， **UpdateCommand**，和**DeleteCommand**属性 ([单击以查看完全尺寸的图像](creating-a-data-access-layer-cs/_static/image63.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-331">**Figure 23**: The TableAdapter has **InsertCommand**, **UpdateCommand**, and **DeleteCommand** Properties ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image63.png))</span></span>


<span data-ttu-id="d21ed-332">若要检查或修改任何这些数据库命令属性，请单击**CommandText**子属性，将显示查询生成器。</span><span class="sxs-lookup"><span data-stu-id="d21ed-332">To examine or modify any of these database command properties, click on the **CommandText** subproperty, which will bring up the Query Builder.</span></span>


<span data-ttu-id="d21ed-333">[![配置查询生成器中的 INSERT、 UPDATE 和 DELETE 语句](creating-a-data-access-layer-cs/_static/image65.png)](creating-a-data-access-layer-cs/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-333">[![Configure the INSERT, UPDATE, and DELETE Statements in the Query Builder](creating-a-data-access-layer-cs/_static/image65.png)](creating-a-data-access-layer-cs/_static/image64.png)</span></span>

<span data-ttu-id="d21ed-334">**图 24**： 配置**插入**，**更新**，和**删除**查询生成器中的语句 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image66.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-334">**Figure 24**: Configure the **INSERT**, **UPDATE**, and **DELETE** Statements in the Query Builder ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image66.png))</span></span>


<span data-ttu-id="d21ed-335">下面的代码示例演示如何使用批处理更新模式为双精度，所有产品的数量和具有 25 个单元库存量或更低的价格：</span><span class="sxs-lookup"><span data-stu-id="d21ed-335">The following code example shows how to use the batch update pattern to double the price of all products that are not discontinued and that have 25 units in stock or less:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample6.cs)]

<span data-ttu-id="d21ed-336">下面的代码演示如何使用 DB 直接模式以编程方式删除特定的产品，然后更新一个，并将一个新：</span><span class="sxs-lookup"><span data-stu-id="d21ed-336">The code below illustrates how to use the DB direct pattern to programmatically delete a particular product, then update one, and then add a new one:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample7.cs)]

## <a name="creating-custom-insert-update-and-delete-methods"></a><span data-ttu-id="d21ed-337">创建自定义插入、 更新和删除方法</span><span class="sxs-lookup"><span data-stu-id="d21ed-337">Creating Custom Insert, Update, and Delete Methods</span></span>

<span data-ttu-id="d21ed-338">**Insert()**， **update （)**，和**delete （)**由数据库直接方法创建的方法可能会有点麻烦，尤其是对于包含许多列的表。</span><span class="sxs-lookup"><span data-stu-id="d21ed-338">The **Insert()**, **Update()**, and **Delete()** methods created by the DB direct method can be a bit cumbersome, especially for tables with many columns.</span></span> <span data-ttu-id="d21ed-339">查看前面的代码示例中，没有 IntelliSense 的帮助不特别清楚什么**产品**表列将映射到每个输入参数为**update （)**和**Insert()**方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-339">Looking at the previous code example, without IntelliSense's help it's not particularly clear what **Products** table column maps to each input parameter to the **Update()** and **Insert()** methods.</span></span> <span data-ttu-id="d21ed-340">可能有些时候当我们只想要更新的单个列或两个，或者想自定义**Insert()**将可能的方法返回的值的新插入的记录**标识**（自动递增）字段。</span><span class="sxs-lookup"><span data-stu-id="d21ed-340">There may be times when we only want to update a single column or two, or want a customized **Insert()** method that will, perhaps, return the value of the newly inserted record's **IDENTITY** (auto-increment) field.</span></span>

<span data-ttu-id="d21ed-341">若要创建这样的自定义方法，请返回到数据集设计器。</span><span class="sxs-lookup"><span data-stu-id="d21ed-341">To create such a custom method, return to the DataSet Designer.</span></span> <span data-ttu-id="d21ed-342">右键单击 TableAdapter，然后选择添加的查询，返回到 TableAdapter 向导。</span><span class="sxs-lookup"><span data-stu-id="d21ed-342">Right-click on the TableAdapter and choose Add Query, returning to the TableAdapter wizard.</span></span> <span data-ttu-id="d21ed-343">在第二个屏幕上我们可以指示查询创建的类型。</span><span class="sxs-lookup"><span data-stu-id="d21ed-343">On the second screen we can indicate the type of query to create.</span></span> <span data-ttu-id="d21ed-344">让我们创建一个方法来添加新的产品，然后返回新添加记录的值**ProductID**。</span><span class="sxs-lookup"><span data-stu-id="d21ed-344">Let's create a method that adds a new product and then returns the value of the newly added record's **ProductID**.</span></span> <span data-ttu-id="d21ed-345">因此，选择创建**插入**查询。</span><span class="sxs-lookup"><span data-stu-id="d21ed-345">Therefore, opt to create an **INSERT** query.</span></span>


<span data-ttu-id="d21ed-346">[![创建一个方法来将新行添加到产品表](creating-a-data-access-layer-cs/_static/image68.png)](creating-a-data-access-layer-cs/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-346">[![Create a Method to Add a New Row to the Products Table](creating-a-data-access-layer-cs/_static/image68.png)](creating-a-data-access-layer-cs/_static/image67.png)</span></span>

<span data-ttu-id="d21ed-347">**图 25**： 创建一个要向其中添加新建行方法**产品**表 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image69.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-347">**Figure 25**: Create a Method to Add a New Row to the **Products** Table ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image69.png))</span></span>


<span data-ttu-id="d21ed-348">在下一个屏幕**InsertCommand**的**CommandText**显示。</span><span class="sxs-lookup"><span data-stu-id="d21ed-348">On the next screen the **InsertCommand**'s **CommandText** appears.</span></span> <span data-ttu-id="d21ed-349">通过添加增强此查询**选择作用域\_IDENTITY()**在查询结束时，这将返回插入到的最后一个标识值**标识**同一范围内的列。</span><span class="sxs-lookup"><span data-stu-id="d21ed-349">Augment this query by adding **SELECT SCOPE\_IDENTITY()** at the end of the query, which will return the last identity value inserted into an **IDENTITY** column in the same scope.</span></span> <span data-ttu-id="d21ed-350">(请参阅[技术文档](https://msdn.microsoft.com/en-us/library/ms190315.aspx)有关详细信息**作用域\_IDENTITY()**以及为何可能愿意[使用范围\_IDENTITY() 替代的 @@IDENTITY](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx).)请确保你最终**插入**用分号的语句才能添加**选择**语句。</span><span class="sxs-lookup"><span data-stu-id="d21ed-350">(See the [technical documentation](https://msdn.microsoft.com/en-us/library/ms190315.aspx) for more information about **SCOPE\_IDENTITY()** and why you probably want to [use SCOPE\_IDENTITY() in lieu of @@IDENTITY](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx).) Make sure that you end the **INSERT** statement with a semi-colon before adding the **SELECT** statement.</span></span>


<span data-ttu-id="d21ed-351">[![增加查询返回 scope_identity （） 值](creating-a-data-access-layer-cs/_static/image71.png)](creating-a-data-access-layer-cs/_static/image70.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-351">[![Augment the Query to Return the SCOPE_IDENTITY() Value](creating-a-data-access-layer-cs/_static/image71.png)](creating-a-data-access-layer-cs/_static/image70.png)</span></span>

<span data-ttu-id="d21ed-352">**图 26**： 增加到返回查询**作用域\_IDENTITY()**值 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image72.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-352">**Figure 26**: Augment the Query to Return the **SCOPE\_IDENTITY()** Value ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image72.png))</span></span>


<span data-ttu-id="d21ed-353">最后，将该新方法**InsertProduct**。</span><span class="sxs-lookup"><span data-stu-id="d21ed-353">Finally, name the new method **InsertProduct**.</span></span>


<span data-ttu-id="d21ed-354">[![将新的方法名称设置为 InsertProduct](creating-a-data-access-layer-cs/_static/image74.png)](creating-a-data-access-layer-cs/_static/image73.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-354">[![Set the New Method Name to InsertProduct](creating-a-data-access-layer-cs/_static/image74.png)](creating-a-data-access-layer-cs/_static/image73.png)</span></span>

<span data-ttu-id="d21ed-355">**图 27**： 将新的方法名称设置为**InsertProduct** ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image75.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-355">**Figure 27**: Set the New Method Name to **InsertProduct** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image75.png))</span></span>


<span data-ttu-id="d21ed-356">当您返回到数据集设计器你会看到**ProductsTableAdapter**包含一个新方法， **InsertProduct**。</span><span class="sxs-lookup"><span data-stu-id="d21ed-356">When you return to the DataSet Designer you'll see that the **ProductsTableAdapter** contains a new method, **InsertProduct**.</span></span> <span data-ttu-id="d21ed-357">如果此新方法不具有每个列中的参数**产品**表，很有可能你忘记终止**插入**用分号的语句。</span><span class="sxs-lookup"><span data-stu-id="d21ed-357">If this new method doesn't have a parameter for each column in the **Products** table, chances are you forgot to terminate the **INSERT** statement with a semi-colon.</span></span> <span data-ttu-id="d21ed-358">配置**InsertProduct**方法，并确保你有以分号分隔**插入**和**选择**语句。</span><span class="sxs-lookup"><span data-stu-id="d21ed-358">Configure the **InsertProduct** method and ensure you have a semi-colon delimiting the **INSERT** and **SELECT** statements.</span></span>

<span data-ttu-id="d21ed-359">默认情况下，会插入方法问题非查询方法，这意味着它们返回受影响的行数。</span><span class="sxs-lookup"><span data-stu-id="d21ed-359">By default, insert methods issue non-query methods, meaning that they return the number of affected rows.</span></span> <span data-ttu-id="d21ed-360">但是，我们希望**InsertProduct**方法以返回由查询返回，不受影响的行数的值。</span><span class="sxs-lookup"><span data-stu-id="d21ed-360">However, we want the **InsertProduct** method to return the value returned by the query, not the number of rows affected.</span></span> <span data-ttu-id="d21ed-361">若要完成此操作，调整**InsertProduct**方法的**ExecuteMode**属性**标量**。</span><span class="sxs-lookup"><span data-stu-id="d21ed-361">To accomplish this, adjust the **InsertProduct** method's **ExecuteMode** property to **Scalar**.</span></span>


<span data-ttu-id="d21ed-362">[![将 ExecuteMode 属性更改为标量](creating-a-data-access-layer-cs/_static/image77.png)](creating-a-data-access-layer-cs/_static/image76.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-362">[![Change the ExecuteMode Property to Scalar](creating-a-data-access-layer-cs/_static/image77.png)](creating-a-data-access-layer-cs/_static/image76.png)</span></span>

<span data-ttu-id="d21ed-363">**图 28**： 更改**ExecuteMode**属性**标量**([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image78.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-363">**Figure 28**: Change the **ExecuteMode** Property to **Scalar** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image78.png))</span></span>


<span data-ttu-id="d21ed-364">下面的代码演示此新**InsertProduct**中操作的方法：</span><span class="sxs-lookup"><span data-stu-id="d21ed-364">The following code shows this new **InsertProduct** method in action:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample8.cs)]

## <a name="step-5-completing-the-data-access-layer"></a><span data-ttu-id="d21ed-365">步骤 5： 完成数据访问层</span><span class="sxs-lookup"><span data-stu-id="d21ed-365">Step 5: Completing the Data Access Layer</span></span>

<span data-ttu-id="d21ed-366">请注意， **ProductsTableAdapters**类返回**CategoryID**和**供应商 Id**值从**产品**表，但不包括**CategoryName**列从**类别**表或**CompanyName**列从**供应商**表，尽管这些可能是我们想要在其中显示了产品信息时显示的列。</span><span class="sxs-lookup"><span data-stu-id="d21ed-366">Note that the **ProductsTableAdapters** class returns the **CategoryID** and **SupplierID** values from the **Products** table, but doesn't include the **CategoryName** column from the **Categories** table or the **CompanyName** column from the **Suppliers** table, although these are likely the columns we want to display when showing product information.</span></span> <span data-ttu-id="d21ed-367">我们可以增加 TableAdapter 的初始方法**GetProducts()**、 同时包含这两者**CategoryName**和**CompanyName**列的值，这将更新若要包括这些新的列的强类型的 DataTable。</span><span class="sxs-lookup"><span data-stu-id="d21ed-367">We can augment the TableAdapter's initial method, **GetProducts()**, to include both the **CategoryName** and **CompanyName** column values, which will update the strongly-typed DataTable to include these new columns as well.</span></span>

<span data-ttu-id="d21ed-368">这可以显示问题，但是，为 TableAdapter 的方法插入、 更新和删除数据基于此初始的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-368">This can present a problem, however, as the TableAdapter's methods for inserting, updating, and deleting data are based off of this initial method.</span></span> <span data-ttu-id="d21ed-369">幸运的是，自动生成的方法插入、 更新和删除将不可受中的子查询**选择**子句。</span><span class="sxs-lookup"><span data-stu-id="d21ed-369">Fortunately, the auto-generated methods for inserting, updating, and deleting are not affected by subqueries in the **SELECT** clause.</span></span> <span data-ttu-id="d21ed-370">注意，要添加到我们查询通过**类别**和**供应商**为子查询，而不是**加入**s，我们将避免不得不返工这些修改数据的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-370">By taking care to add our queries to **Categories** and **Suppliers** as subqueries, rather than **JOIN** s, we'll avoid having to rework those methods for modifying data.</span></span> <span data-ttu-id="d21ed-371">右键单击**GetProducts()**中的方法**ProductsTableAdapter**并选择配置。</span><span class="sxs-lookup"><span data-stu-id="d21ed-371">Right-click on the **GetProducts()** method in the **ProductsTableAdapter** and choose Configure.</span></span> <span data-ttu-id="d21ed-372">然后，调整**选择**子句，以便其所示类似：</span><span class="sxs-lookup"><span data-stu-id="d21ed-372">Then, adjust the **SELECT** clause so that it looks like:</span></span>

[!code-sql[Main](creating-a-data-access-layer-cs/samples/sample9.sql)]


<span data-ttu-id="d21ed-373">[![更新的 SELECT 语句 GetProducts() 方法](creating-a-data-access-layer-cs/_static/image80.png)](creating-a-data-access-layer-cs/_static/image79.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-373">[![Update the SELECT Statement for the GetProducts() Method](creating-a-data-access-layer-cs/_static/image80.png)](creating-a-data-access-layer-cs/_static/image79.png)</span></span>

<span data-ttu-id="d21ed-374">**图 29**： 更新**选择**语句**GetProducts()**方法 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image81.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-374">**Figure 29**: Update the **SELECT** Statement for the **GetProducts()** Method ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image81.png))</span></span>


<span data-ttu-id="d21ed-375">在更新后**GetProducts()**要使用此 DataTable 将包括两个新列的新查询方法： **CategoryName**和**供应商名称**。</span><span class="sxs-lookup"><span data-stu-id="d21ed-375">After updating the **GetProducts()** method to use this new query the DataTable will include two new columns: **CategoryName** and **SupplierName**.</span></span>


![产品 DataTable 具有两个新列](creating-a-data-access-layer-cs/_static/image82.png)

<span data-ttu-id="d21ed-377">**图 30**:**产品**DataTable 具有两个新列</span><span class="sxs-lookup"><span data-stu-id="d21ed-377">**Figure 30**: The **Products** DataTable has Two New Columns</span></span>


<span data-ttu-id="d21ed-378">花一些时间来更新**选择**中的子句 **GetProductsByCategoryID (*categoryID*) * * 以及方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-378">Take a moment to update the **SELECT** clause in the **GetProductsByCategoryID(*categoryID*)** method as well.</span></span>

<span data-ttu-id="d21ed-379">如果你更新**GetProducts()** **选择**使用**加入**语法数据集设计器将无法自动生成用于插入、 更新和删除方法使用数据库直接模式的数据库数据。</span><span class="sxs-lookup"><span data-stu-id="d21ed-379">If you update the **GetProducts()** **SELECT** using **JOIN** syntax the DataSet Designer won't be able to auto-generate the methods for inserting, updating, and deleting database data using the DB direct pattern.</span></span> <span data-ttu-id="d21ed-380">相反，你将需要手动创建它们更像与我们**InsertProduct**本教程中前面的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-380">Instead, you'll have to manually create them much like we did with the **InsertProduct** method earlier in this tutorial.</span></span> <span data-ttu-id="d21ed-381">此外，手动将需要提供**InsertCommand**， **UpdateCommand**，和**DeleteCommand**属性值，则如果你想要使用批更新模式。</span><span class="sxs-lookup"><span data-stu-id="d21ed-381">Furthermore, you'll manually have to provide the **InsertCommand**, **UpdateCommand**, and **DeleteCommand** property values if you want to use the batch updating pattern.</span></span>

## <a name="adding-the-remaining-tableadapters"></a><span data-ttu-id="d21ed-382">添加剩余的 Tableadapter</span><span class="sxs-lookup"><span data-stu-id="d21ed-382">Adding the Remaining TableAdapters</span></span>

<span data-ttu-id="d21ed-383">直到现在，我们只介绍了使用单个 TableAdapter 的单个数据库表。</span><span class="sxs-lookup"><span data-stu-id="d21ed-383">Up until now, we've only looked at working with a single TableAdapter for a single database table.</span></span> <span data-ttu-id="d21ed-384">但是，Northwind 数据库包含我们将需要使用我们的 web 应用程序中的多个相关的表。</span><span class="sxs-lookup"><span data-stu-id="d21ed-384">However, the Northwind database contains several related tables that we'll need to work with in our web application.</span></span> <span data-ttu-id="d21ed-385">类型化数据集可以包含多个相关数据表。</span><span class="sxs-lookup"><span data-stu-id="d21ed-385">A Typed DataSet can contain multiple, related DataTables.</span></span> <span data-ttu-id="d21ed-386">因此，若要完成我们 DAL，我们需要将数据表添加我们将在这些教程中使用的其他表。</span><span class="sxs-lookup"><span data-stu-id="d21ed-386">Therefore, to complete our DAL we need to add DataTables for the other tables we'll be using in these tutorials.</span></span> <span data-ttu-id="d21ed-387">若要将新的 TableAdapter 添加到类型化数据集，打开数据集设计器，在设计器中，右键单击并选择添加 / TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="d21ed-387">To add a new TableAdapter to a Typed DataSet, open the DataSet Designer, right-click in the Designer, and choose Add / TableAdapter.</span></span> <span data-ttu-id="d21ed-388">这将创建新的 DataTable 和 TableAdapter，并引导你完成本教程中前面部分中，我们探讨向导。</span><span class="sxs-lookup"><span data-stu-id="d21ed-388">This will create a new DataTable and TableAdapter and walk you through the wizard we examined earlier in this tutorial.</span></span>

<span data-ttu-id="d21ed-389">需要几分钟才能创建以下 Tableadapter 和使用下面的查询的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-389">Take a few minutes to create the following TableAdapters and methods using the following queries.</span></span> <span data-ttu-id="d21ed-390">请注意，中的查询**ProductsTableAdapter**包括子查询中获取每个产品类别和供应商名称。</span><span class="sxs-lookup"><span data-stu-id="d21ed-390">Note that the queries in the **ProductsTableAdapter** include the subqueries to grab each product's category and supplier names.</span></span> <span data-ttu-id="d21ed-391">此外，如果你已已之后，你已添加**ProductsTableAdapter**类的**GetProducts()**和 **GetProductsByCategoryID (*categoryID*) * * 方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-391">Additionally, if you've been following along, you've already added the **ProductsTableAdapter** class's **GetProducts()** and **GetProductsByCategoryID(*categoryID*)** methods.</span></span>

- <span data-ttu-id="d21ed-392">**ProductsTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="d21ed-392">**ProductsTableAdapter**</span></span>

    - <span data-ttu-id="d21ed-393">**GetProducts**:</span><span class="sxs-lookup"><span data-stu-id="d21ed-393">**GetProducts**:</span></span> 

        [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample10.sql)]
    - <span data-ttu-id="d21ed-394">**GetProductsByCategoryID**:</span><span class="sxs-lookup"><span data-stu-id="d21ed-394">**GetProductsByCategoryID**:</span></span> 

        [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample11.sql)]
    - <span data-ttu-id="d21ed-395">**GetProductsBySupplierID**:</span><span class="sxs-lookup"><span data-stu-id="d21ed-395">**GetProductsBySupplierID**:</span></span> 

        [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample12.sql)]
    - <span data-ttu-id="d21ed-396">**GetProductByProductID**:</span><span class="sxs-lookup"><span data-stu-id="d21ed-396">**GetProductByProductID**:</span></span> 

        [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample13.sql)]
- <span data-ttu-id="d21ed-397">**CategoriesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="d21ed-397">**CategoriesTableAdapter**</span></span>

    - <span data-ttu-id="d21ed-398">**GetCategories**:</span><span class="sxs-lookup"><span data-stu-id="d21ed-398">**GetCategories**:</span></span> 

        [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample14.sql)]
    - <span data-ttu-id="d21ed-399">**GetCategoryByCategoryID**:</span><span class="sxs-lookup"><span data-stu-id="d21ed-399">**GetCategoryByCategoryID**:</span></span> 

        [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample15.sql)]
- <span data-ttu-id="d21ed-400">**SuppliersTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="d21ed-400">**SuppliersTableAdapter**</span></span>

    - <span data-ttu-id="d21ed-401">**GetSuppliers**:</span><span class="sxs-lookup"><span data-stu-id="d21ed-401">**GetSuppliers**:</span></span> 

        [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample16.sql)]
    - <span data-ttu-id="d21ed-402">**GetSuppliersByCountry**:</span><span class="sxs-lookup"><span data-stu-id="d21ed-402">**GetSuppliersByCountry**:</span></span> 

        [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample17.sql)]
    - <span data-ttu-id="d21ed-403">**GetSupplierBySupplierID**:</span><span class="sxs-lookup"><span data-stu-id="d21ed-403">**GetSupplierBySupplierID**:</span></span> 

        [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample18.sql)]
- <span data-ttu-id="d21ed-404">**EmployeesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="d21ed-404">**EmployeesTableAdapter**</span></span>

    - <span data-ttu-id="d21ed-405">**GetEmployees**:</span><span class="sxs-lookup"><span data-stu-id="d21ed-405">**GetEmployees**:</span></span> 

        [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample19.sql)]
    - <span data-ttu-id="d21ed-406">**GetEmployeesByManager**:</span><span class="sxs-lookup"><span data-stu-id="d21ed-406">**GetEmployeesByManager**:</span></span> 

        [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample20.sql)]
    - <span data-ttu-id="d21ed-407">**GetEmployeeByEmployeeID**:</span><span class="sxs-lookup"><span data-stu-id="d21ed-407">**GetEmployeeByEmployeeID**:</span></span> 

        [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample21.sql)]


<span data-ttu-id="d21ed-408">[![数据集设计器后已添加四个 Tableadapter](creating-a-data-access-layer-cs/_static/image84.png)](creating-a-data-access-layer-cs/_static/image83.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-408">[![The DataSet Designer After the Four TableAdapters Have Been Added](creating-a-data-access-layer-cs/_static/image84.png)](creating-a-data-access-layer-cs/_static/image83.png)</span></span>

<span data-ttu-id="d21ed-409">**图 31**: 数据集设计器后四个 Tableadapter 已添加 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image85.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-409">**Figure 31**: The DataSet Designer After the Four TableAdapters Have Been Added ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image85.png))</span></span>


## <a name="adding-custom-code-to-the-dal"></a><span data-ttu-id="d21ed-410">将自定义代码添加到 DAL</span><span class="sxs-lookup"><span data-stu-id="d21ed-410">Adding Custom Code to the DAL</span></span>

<span data-ttu-id="d21ed-411">将 Tableadapter 和数据表添加到类型化数据集表示为 XML 架构定义文件 (**Northwind.xsd**)。</span><span class="sxs-lookup"><span data-stu-id="d21ed-411">The TableAdapters and DataTables added to the Typed DataSet are expressed as an XML Schema Definition file (**Northwind.xsd**).</span></span> <span data-ttu-id="d21ed-412">你可以通过右键单击查看此架构信息**Northwind.xsd**文件位于解决方案资源管理器，并选择查看代码。</span><span class="sxs-lookup"><span data-stu-id="d21ed-412">You can view this schema information by right-clicking on the **Northwind.xsd** file in the Solution Explorer and choosing View Code.</span></span>


<span data-ttu-id="d21ed-413">[![罗斯文的 XML 架构定义 (XSD) 文件类型化数据集](creating-a-data-access-layer-cs/_static/image87.png)](creating-a-data-access-layer-cs/_static/image86.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-413">[![The XML Schema Definition (XSD) File for the Northwinds Typed DataSet](creating-a-data-access-layer-cs/_static/image87.png)](creating-a-data-access-layer-cs/_static/image86.png)</span></span>

<span data-ttu-id="d21ed-414">**图 32**： 罗斯文类型化数据集的 XML 架构定义 (XSD) 文件 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image88.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-414">**Figure 32**: The XML Schema Definition (XSD) File for the Northwinds Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image88.png))</span></span>


<span data-ttu-id="d21ed-415">此架构信息将转换为 C# 或 Visual Basic 代码在设计时编译时或在运行时 （如果需要），此时你可以单步执行它使用调试程序。</span><span class="sxs-lookup"><span data-stu-id="d21ed-415">This schema information is translated into C# or Visual Basic code at design time when compiled or at runtime (if needed), at which point you can step through it with the debugger.</span></span> <span data-ttu-id="d21ed-416">若要查看此自动生成的代码转到的类视图和钻取到 TableAdapter 或类型化数据集类。</span><span class="sxs-lookup"><span data-stu-id="d21ed-416">To view this auto-generated code go to the Class View and drill down to the TableAdapter or Typed DataSet classes.</span></span> <span data-ttu-id="d21ed-417">如果看不到类视图屏幕上，转到视图菜单，选择在这里，或按 Ctrl + Shift + C。</span><span class="sxs-lookup"><span data-stu-id="d21ed-417">If you don't see the Class View on your screen, go to the View menu and select it from there, or hit Ctrl+Shift+C.</span></span> <span data-ttu-id="d21ed-418">从类视图中，你可以看到属性、 方法和事件的类型化数据集和 TableAdapter 类。</span><span class="sxs-lookup"><span data-stu-id="d21ed-418">From the Class View you can see the properties, methods, and events of the Typed DataSet and TableAdapter classes.</span></span> <span data-ttu-id="d21ed-419">若要查看特定方法的代码，双击类视图中的方法名称或右键单击它并选择转到定义。</span><span class="sxs-lookup"><span data-stu-id="d21ed-419">To view the code for a particular method, double-click the method name in the Class View or right-click on it and choose Go To Definition.</span></span>


![通过选择转到定义从类视图中检查自动生成的代码](creating-a-data-access-layer-cs/_static/image89.png)

<span data-ttu-id="d21ed-421">**图 33**： 通过选择转到定义从类视图中检查自动生成的代码</span><span class="sxs-lookup"><span data-stu-id="d21ed-421">**Figure 33**: Inspect the Auto-Generated Code by Selecting Go To Definition from the Class View</span></span>


<span data-ttu-id="d21ed-422">虽然自动生成的代码可节省了很好的时间，该代码通常是非常泛型，并需要进行自定义以满足应用程序的独特需求。</span><span class="sxs-lookup"><span data-stu-id="d21ed-422">While auto-generated code can be a great time saver, the code is often very generic and needs to be customized to meet the unique needs of an application.</span></span> <span data-ttu-id="d21ed-423">扩展自动生成的代码的风险，是生成代码的工具可能会决定是时候"重新生成"，并覆盖你的自定义。</span><span class="sxs-lookup"><span data-stu-id="d21ed-423">The risk of extending auto-generated code, though, is that the tool that generated the code might decide it's time to "regenerate" and overwrite your customizations.</span></span> <span data-ttu-id="d21ed-424">使用.NET 2.0 的新的分部类概念，很容易将类拆分到多个文件。</span><span class="sxs-lookup"><span data-stu-id="d21ed-424">With .NET 2.0's new partial class concept, it's easy to split a class across multiple files.</span></span> <span data-ttu-id="d21ed-425">这使我们能够向自动生成的类中添加我们自己的方法、 属性和事件，而无需担心覆盖我们自定义项的 Visual Studio。</span><span class="sxs-lookup"><span data-stu-id="d21ed-425">This enables us to add our own methods, properties, and events to the auto-generated classes without having to worry about Visual Studio overwriting our customizations.</span></span>

<span data-ttu-id="d21ed-426">为了演示如何自定义 DAL，让我们添加**GetProducts()**方法**SuppliersRow**类。</span><span class="sxs-lookup"><span data-stu-id="d21ed-426">To demonstrate how to customize the DAL, let's add a **GetProducts()** method to the **SuppliersRow** class.</span></span> <span data-ttu-id="d21ed-427">**SuppliersRow**类表示中的单个记录**供应商**表; 每个供应商可以提供程序零到许多产品，因此**GetProducts()**将返回那些指定的供应商的产品。</span><span class="sxs-lookup"><span data-stu-id="d21ed-427">The **SuppliersRow** class represents a single record in the **Suppliers** table; each supplier can provider zero to many products, so **GetProducts()** will return those products of the specified supplier.</span></span> <span data-ttu-id="d21ed-428">若要完成此创建中的新类文件**应用\_代码**文件夹名为**SuppliersRow.cs**并添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="d21ed-428">To accomplish this create a new class file in the **App\_Code** folder named **SuppliersRow.cs** and add the following code:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample22.cs)]

<span data-ttu-id="d21ed-429">此分部类指示编译器，当生成**Northwind.SuppliersRow**类，以包含**GetProducts()**我们刚才定义的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-429">This partial class instructs the compiler that when building the **Northwind.SuppliersRow** class to include the **GetProducts()** method we just defined.</span></span> <span data-ttu-id="d21ed-430">如果你生成你的项目，然后返回到类视图你将看到**GetProducts()**现在作为一种列出**Northwind.SuppliersRow**。</span><span class="sxs-lookup"><span data-stu-id="d21ed-430">If you build your project and then return to the Class View you'll see **GetProducts()** now listed as a method of **Northwind.SuppliersRow**.</span></span>


![GetProducts() 方法属于现在 Northwind.SuppliersRow 类](creating-a-data-access-layer-cs/_static/image90.png)

<span data-ttu-id="d21ed-432">**图 34**: **GetProducts()**方法是现在的一部分**Northwind.SuppliersRow**类</span><span class="sxs-lookup"><span data-stu-id="d21ed-432">**Figure 34**: The **GetProducts()** Method is Now Part of the **Northwind.SuppliersRow** Class</span></span>


<span data-ttu-id="d21ed-433">**GetProducts()**方法现在可以用于枚举的一套产品特定供应商，如以下代码所示：</span><span class="sxs-lookup"><span data-stu-id="d21ed-433">The **GetProducts()** method can now be used to enumerate the set of products for a particular supplier, as the following code shows:</span></span>

[!code-html[Main](creating-a-data-access-layer-cs/samples/sample23.html)]

<span data-ttu-id="d21ed-434">此数据也可以显示在任何 ASP。NET 的数据 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="d21ed-434">This data can also be displayed in any of ASP.NET's data Web controls.</span></span> <span data-ttu-id="d21ed-435">以下页面 GridView 控件使用两个字段：</span><span class="sxs-lookup"><span data-stu-id="d21ed-435">The following page uses a GridView control with two fields:</span></span>

- <span data-ttu-id="d21ed-436">显示每个供应商的名称 BoundField 和</span><span class="sxs-lookup"><span data-stu-id="d21ed-436">A BoundField that displays the name of each supplier, and</span></span>
- <span data-ttu-id="d21ed-437">包含如何控件绑定到返回的结果为 TemplateField **GetProducts()**每个供应商的方法。</span><span class="sxs-lookup"><span data-stu-id="d21ed-437">A TemplateField that contains a BulletedList control that is bound to the results returned by the **GetProducts()** method for each supplier.</span></span>

<span data-ttu-id="d21ed-438">我们将查看如何在将来的教程中显示此类主-详细信息报表。</span><span class="sxs-lookup"><span data-stu-id="d21ed-438">We'll examine how to display such master-detail reports in future tutorials.</span></span> <span data-ttu-id="d21ed-439">现在，此示例旨在演示如何使用自定义的方法添加到**Northwind.SuppliersRow**类。</span><span class="sxs-lookup"><span data-stu-id="d21ed-439">For now, this example is designed to illustrate using the custom method added to the **Northwind.SuppliersRow** class.</span></span>

<span data-ttu-id="d21ed-440">SuppliersAndProducts.aspx</span><span class="sxs-lookup"><span data-stu-id="d21ed-440">SuppliersAndProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample24.aspx)]

<span data-ttu-id="d21ed-441">SuppliersAndProducts.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="d21ed-441">SuppliersAndProducts.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample25.cs)]


<span data-ttu-id="d21ed-442">[![在左侧列中，他们的产品的右侧列出供应商的公司名称](creating-a-data-access-layer-cs/_static/image92.png)](creating-a-data-access-layer-cs/_static/image91.png)</span><span class="sxs-lookup"><span data-stu-id="d21ed-442">[![The Supplier's Company Name is Listed in the Left Column, Their Products in the Right](creating-a-data-access-layer-cs/_static/image92.png)](creating-a-data-access-layer-cs/_static/image91.png)</span></span>

<span data-ttu-id="d21ed-443">**图 35**: 供应商的公司名称列出在左侧列中，他们的产品的右侧 ([单击以查看实际尺寸的图像](creating-a-data-access-layer-cs/_static/image93.png))</span><span class="sxs-lookup"><span data-stu-id="d21ed-443">**Figure 35**: The Supplier's Company Name is Listed in the Left Column, Their Products in the Right ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image93.png))</span></span>


## <a name="summary"></a><span data-ttu-id="d21ed-444">摘要</span><span class="sxs-lookup"><span data-stu-id="d21ed-444">Summary</span></span>

<span data-ttu-id="d21ed-445">当生成 web 应用程序创建 DAL 应该是一个你的第一个步骤，发生之前你开始创建表示层。</span><span class="sxs-lookup"><span data-stu-id="d21ed-445">When building a web application creating the DAL should be one of your first steps, occurring before you start creating your presentation layer.</span></span> <span data-ttu-id="d21ed-446">使用 Visual Studio，创建类型化数据集所基于的 DAL 是完成的任务，可以在 10-15 分钟内无需编写一行代码。</span><span class="sxs-lookup"><span data-stu-id="d21ed-446">With Visual Studio, creating a DAL based on Typed DataSets is a task that can be accomplished in 10-15 minutes without writing a line of code.</span></span> <span data-ttu-id="d21ed-447">下一步的教程将相互依赖此 DAL。</span><span class="sxs-lookup"><span data-stu-id="d21ed-447">The tutorials moving forward will build upon this DAL.</span></span> <span data-ttu-id="d21ed-448">在[下一教程](creating-a-business-logic-layer-cs.md)我们定义大量的业务规则，请参阅如何在单独的业务逻辑层中实现它们。</span><span class="sxs-lookup"><span data-stu-id="d21ed-448">In the [next tutorial](creating-a-business-logic-layer-cs.md) we'll define a number of business rules and see how to implement them in a separate Business Logic Layer.</span></span>

<span data-ttu-id="d21ed-449">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="d21ed-449">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="d21ed-450">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="d21ed-450">Further Reading</span></span>

<span data-ttu-id="d21ed-451">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="d21ed-451">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="d21ed-452">生成使用强类型化的 Tableadapter 和 VS 2005 和 ASP.NET 2.0 中的数据表 DAL</span><span class="sxs-lookup"><span data-stu-id="d21ed-452">Building a DAL using Strongly Typed TableAdapters and DataTables in VS 2005 and ASP.NET 2.0</span></span>](https://weblogs.asp.net/scottgu/435498)
- [<span data-ttu-id="d21ed-453">设计数据层组件和层间传递数据</span><span class="sxs-lookup"><span data-stu-id="d21ed-453">Designing Data Tier Components and Passing Data Through Tiers</span></span>](https://msdn.microsoft.com/en-us/library/ms978496.aspx)
- [<span data-ttu-id="d21ed-454">生成与 Visual Studio 2005 数据集设计器的数据访问层</span><span class="sxs-lookup"><span data-stu-id="d21ed-454">Build a Data Access Layer with the Visual Studio 2005 DataSet Designer</span></span>](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner)
- [<span data-ttu-id="d21ed-455">加密 ASP.NET 2.0 中的配置信息的应用程序</span><span class="sxs-lookup"><span data-stu-id="d21ed-455">Encrypting Configuration Information in ASP.NET 2.0 Applications</span></span>](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)
- [<span data-ttu-id="d21ed-456">TableAdapter 概述</span><span class="sxs-lookup"><span data-stu-id="d21ed-456">TableAdapter Overview</span></span>](https://msdn.microsoft.com/en-us/library/bz9tthwx.aspx)
- [<span data-ttu-id="d21ed-457">使用类型化数据集</span><span class="sxs-lookup"><span data-stu-id="d21ed-457">Working with a Typed DataSet</span></span>](https://msdn.microsoft.com/en-us/library/esbykkzb.aspx)
- [<span data-ttu-id="d21ed-458">使用 Visual Studio 2005 和 ASP.NET 2.0 中的强类型数据访问</span><span class="sxs-lookup"><span data-stu-id="d21ed-458">Using Strongly-Typed Data Access in Visual Studio 2005 and ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/020806-1.aspx)
- [<span data-ttu-id="d21ed-459">如何扩展 TableAdapter 方法</span><span class="sxs-lookup"><span data-stu-id="d21ed-459">How to Extend TableAdapter Methods</span></span>](https://blogs.msdn.com/vbteam/archive/2005/05/04/ExtendingTableAdapters.aspx)
- [<span data-ttu-id="d21ed-460">从存储过程中检索标量数据</span><span class="sxs-lookup"><span data-stu-id="d21ed-460">Retrieving Scalar Data from a Stored Procedure</span></span>](http://aspnet.4guysfromrolla.com/articles/062905-1.aspx)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="d21ed-461">在本教程中包含的主题的视频培训</span><span class="sxs-lookup"><span data-stu-id="d21ed-461">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="d21ed-462">ASP.NET 应用程序中的数据访问层</span><span class="sxs-lookup"><span data-stu-id="d21ed-462">Data Access Layers in ASP.NET Applications</span></span>](../../../videos/data-access/adonet-data-services/data-access-layers-in-aspnet-applications.md)
- [<span data-ttu-id="d21ed-463">如何手动将数据集绑定到数据网格</span><span class="sxs-lookup"><span data-stu-id="d21ed-463">How to Manually Bind a Dataset to a Datagrid</span></span>](../../../videos/data-access/adonet-data-services/how-to-manually-bind-a-dataset-to-a-datagrid.md)
- [<span data-ttu-id="d21ed-464">如何使用数据集和筛选器从 ASP 应用程序</span><span class="sxs-lookup"><span data-stu-id="d21ed-464">How to Work with Datasets and Filters from an ASP Application</span></span>](../../../videos/data-access/adonet-data-services/how-to-work-with-datasets-and-filters-from-an-asp-application.md)

## <a name="about-the-author"></a><span data-ttu-id="d21ed-465">关于作者</span><span class="sxs-lookup"><span data-stu-id="d21ed-465">About the Author</span></span>

<span data-ttu-id="d21ed-466">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七个 ASP/ASP.NET 书籍和的创始人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年使用与 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="d21ed-466">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="d21ed-467">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="d21ed-467">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="d21ed-468">最新书籍是[ *Sam 教授自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="d21ed-468">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="d21ed-469">他可以达到在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或通过他的博客，其中可以找到在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="d21ed-469">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="d21ed-470">特别感谢</span><span class="sxs-lookup"><span data-stu-id="d21ed-470">Special Thanks To</span></span>

<span data-ttu-id="d21ed-471">本教程系列已由许多有用的审阅者评审。</span><span class="sxs-lookup"><span data-stu-id="d21ed-471">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="d21ed-472">本教程中的前导审阅者已 Ron 绿色、 希尔顿 Giesenow、 Dennis Patterson、 沈 Shulok、 Abel Gomez 和 Carlos Santos。</span><span class="sxs-lookup"><span data-stu-id="d21ed-472">Lead reviewers for this tutorial were Ron Green, Hilton Giesenow, Dennis Patterson, Liz Shulok, Abel Gomez, and Carlos Santos.</span></span> <span data-ttu-id="d21ed-473">对感兴趣查看我即将到来的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="d21ed-473">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="d21ed-474">如果是这样，删除我一行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="d21ed-474">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
[<span data-ttu-id="d21ed-475">下一篇</span><span class="sxs-lookup"><span data-stu-id="d21ed-475">Next</span></span>](creating-a-business-logic-layer-cs.md)
