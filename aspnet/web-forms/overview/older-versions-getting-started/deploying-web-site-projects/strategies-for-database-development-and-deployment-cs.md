---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-cs
title: "进行数据库开发和部署 (C#) 的策略 |Microsoft 文档"
author: rick-anderson
description: "部署第一次数据驱动应用程序时可以盲目地将数据库复制到生产环境的开发环境中。 B..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/23/2009
ms.topic: article
ms.assetid: 3e8b0627-3eb7-488e-807e-067cba7cec05
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-cs
msc.type: authoredcontent
ms.openlocfilehash: 21d63b175eb52838ac9a12e33efc59fded4ed87d
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="strategies-for-database-development-and-deployment-c"></a><span data-ttu-id="64e9f-104">策略进行数据库开发和部署 (C#)</span><span class="sxs-lookup"><span data-stu-id="64e9f-104">Strategies for Database Development and Deployment (C#)</span></span>
====================
<span data-ttu-id="64e9f-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="64e9f-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

[<span data-ttu-id="64e9f-106">下载 PDF</span><span class="sxs-lookup"><span data-stu-id="64e9f-106">Download PDF</span></span>](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial10_DBDevel_cs.pdf)

> <span data-ttu-id="64e9f-107">部署第一次数据驱动应用程序时可以盲目地将数据库复制到生产环境的开发环境中。</span><span class="sxs-lookup"><span data-stu-id="64e9f-107">When deploying a data-driven application for the first time you can blindly copy the database in the development environment to the production environment.</span></span> <span data-ttu-id="64e9f-108">但执行直接在后续部署中的副本将覆盖进入生产数据库的任何数据。</span><span class="sxs-lookup"><span data-stu-id="64e9f-108">But performing a blind copy in subsequent deployments will overwrite any data entered into the production database.</span></span> <span data-ttu-id="64e9f-109">相反，将数据库部署涉及将应用到生产数据库上次部署以来对开发数据库所做的更改。</span><span class="sxs-lookup"><span data-stu-id="64e9f-109">Instead, deploying a database involves applying the changes made to the development database since the last deployment onto the production database.</span></span> <span data-ttu-id="64e9f-110">本教程中检查这些挑战，并提供不同的策略，用于帮助 chronicling 和应用自上次部署以来对数据库进行更改。</span><span class="sxs-lookup"><span data-stu-id="64e9f-110">This tutorial examines these challenges and offers various strategies to assist with chronicling and applying the changes made to the database since the last deployment.</span></span>


## <a name="introduction"></a><span data-ttu-id="64e9f-111">介绍</span><span class="sxs-lookup"><span data-stu-id="64e9f-111">Introduction</span></span>

<span data-ttu-id="64e9f-112">如前面的教程中所述，部署 ASP.NET 应用程序需要从开发环境的相关的内容复制到生产环境。</span><span class="sxs-lookup"><span data-stu-id="64e9f-112">As discussed in previous tutorials, deploying an ASP.NET application entails copying the pertinent content from the development environment to the production environment.</span></span> <span data-ttu-id="64e9f-113">部署不是一次性事件，但而是指每次发布新版本的软件或时，会发生情况的 bug 或确定并解决安全问题。</span><span class="sxs-lookup"><span data-stu-id="64e9f-113">Deployment is not a one-time event, but rather something that happens every time a new version of the software is released or when bugs or security concerns have been identified and addressed.</span></span> <span data-ttu-id="64e9f-114">在复制 ASP.NET 页时，图像、 JavaScript 文件和其他此类文件到生产环境不需要关注与这些文件已更改自上次部署以来中。</span><span class="sxs-lookup"><span data-stu-id="64e9f-114">When copying ASP.NET pages, images, JavaScript files, and other such files to the production environment you do not need to concern yourself with how these file have been changed since the last deployment.</span></span> <span data-ttu-id="64e9f-115">你可以隐式的文件复制到生产环境，覆盖现有的内容。</span><span class="sxs-lookup"><span data-stu-id="64e9f-115">You can blindly copy the file to production, overwriting the existing content.</span></span> <span data-ttu-id="64e9f-116">遗憾的是，这种简单性未扩展到部署数据库。</span><span class="sxs-lookup"><span data-stu-id="64e9f-116">Unfortunately, this simplicity does not extend to deploying the database.</span></span>

<span data-ttu-id="64e9f-117">部署第一次数据驱动应用程序时可以盲目地将数据库复制到生产环境的开发环境中。</span><span class="sxs-lookup"><span data-stu-id="64e9f-117">When deploying a data-driven application for the first time you can blindly copy the database in the development environment to the production environment.</span></span> <span data-ttu-id="64e9f-118">但执行直接在后续部署中的副本将覆盖进入生产数据库的任何数据。</span><span class="sxs-lookup"><span data-stu-id="64e9f-118">But performing a blind copy in subsequent deployments will overwrite any data entered into the production database.</span></span> <span data-ttu-id="64e9f-119">相反，部署数据库涉及应用*更改*对开发数据库进行自上次部署到生产数据库。</span><span class="sxs-lookup"><span data-stu-id="64e9f-119">Instead, deploying a database involves applying the *changes* made to the development database since the last deployment onto the production database.</span></span> <span data-ttu-id="64e9f-120">本教程中检查这些挑战，并提供不同的策略，用于帮助 chronicling 和应用自上次部署以来对数据库进行更改。</span><span class="sxs-lookup"><span data-stu-id="64e9f-120">This tutorial examines these challenges and offers various strategies to assist with chronicling and applying the changes made to the database since the last deployment.</span></span>

## <a name="the-challenges-of-deploying-a-database"></a><span data-ttu-id="64e9f-121">部署数据库中的难题</span><span class="sxs-lookup"><span data-stu-id="64e9f-121">The Challenges of Deploying a Database</span></span>

<span data-ttu-id="64e9f-122">数据驱动的应用程序已部署第一次之前，只有一个数据库，即在开发环境中，这正是你可以部署第一次数据驱动应用程序时盲目地数据库复制中的数据库到生产环境的开发环境。</span><span class="sxs-lookup"><span data-stu-id="64e9f-122">Before a data-driven application has been deployed for the first time, there is only one database, namely the database in the development environment, which is why when deploying a data-driven application for the first time you can blindly copy the database in the development environment to the production environment.</span></span> <span data-ttu-id="64e9f-123">但在部署应用程序后有两个数据库的副本： 一个在开发而在生产环境中的另一个。</span><span class="sxs-lookup"><span data-stu-id="64e9f-123">But once the application has been deployed there are two copies of the database: one in development and one in production.</span></span>

<span data-ttu-id="64e9f-124">部署之间的开发和生产数据库可能会变得不同步。虽然生产数据库的架构保持不变，添加新功能时可能会变化开发数据库的架构。</span><span class="sxs-lookup"><span data-stu-id="64e9f-124">Between deployments the development and production databases can become out of sync. While the production database s schema remains unchanged, the development database s schema may change as new features are added.</span></span> <span data-ttu-id="64e9f-125">您可能添加或删除列、 表、 视图或存储的过程。</span><span class="sxs-lookup"><span data-stu-id="64e9f-125">You might add or remove columns, tables, views, or stored procedures.</span></span> <span data-ttu-id="64e9f-126">也可能是获取添加到开发数据库的重要数据。</span><span class="sxs-lookup"><span data-stu-id="64e9f-126">There may also be important data that gets added to the development database.</span></span> <span data-ttu-id="64e9f-127">许多数据驱动应用程序包括使用硬编码，特定于应用程序不是用户可编辑的数据进行填充的查找表。</span><span class="sxs-lookup"><span data-stu-id="64e9f-127">Many data-driven applications include lookup tables populated with hard-coded, application-specific data that are not user-editable.</span></span> <span data-ttu-id="64e9f-128">例如，拍卖网站可能有一个带有描述正在 auctioned 的项的条件的选项的下拉列表： 新建、 新类似、 良好，和公平。</span><span class="sxs-lookup"><span data-stu-id="64e9f-128">For example, an auction website might have a drop-down list with choices that describe the condition of the item being auctioned: New, Like New, Good, and Fair.</span></span> <span data-ttu-id="64e9f-129">而不是直接在下拉列表中的这些选项进行硬编码，则通常最好将它们放在数据库表。</span><span class="sxs-lookup"><span data-stu-id="64e9f-129">Rather than hard-coding these options directly in the drop-down list it is usually better to place them in a database table.</span></span> <span data-ttu-id="64e9f-130">如果在开发期间，新的名为差条件添加到表然后部署应用程序时此相同记录将需要添加到生产数据库中的查找表。</span><span class="sxs-lookup"><span data-stu-id="64e9f-130">If, during development, a new condition named Poor is added to the table then when deploying the application this same record needs to be added to the lookup table in the production database.</span></span>

<span data-ttu-id="64e9f-131">理想情况下，将数据库部署会涉及复制数据库从开发到生产环境。</span><span class="sxs-lookup"><span data-stu-id="64e9f-131">Ideally, deploying the database would involve copying the database from development to production.</span></span> <span data-ttu-id="64e9f-132">但请记住，你已部署应用程序并恢复开发后，生产数据库正在使用来自真实的用户的真实数据填充。</span><span class="sxs-lookup"><span data-stu-id="64e9f-132">But keep in mind that after you have deployed the application and resumed development, the production database is being populated with real data from real users.</span></span> <span data-ttu-id="64e9f-133">因此，如果你打算只需将数据库复制从开发到生产在下一步的部署将覆盖生产数据库，并且会丢失其现有的数据。</span><span class="sxs-lookup"><span data-stu-id="64e9f-133">Therefore, if you were to simply copy the database from development to production at the next deployment you would overwrite the production database and lose its existing data.</span></span> <span data-ttu-id="64e9f-134">最终结果是，将数据库部署归结为应用自上次部署以来到开发数据库所做的更改。</span><span class="sxs-lookup"><span data-stu-id="64e9f-134">The net result is that deploying the database boils down to applying the changes made to the development database since the last deployment.</span></span>

<span data-ttu-id="64e9f-135">由于将数据库部署涉及自上次部署以来应用中的架构和数据，如果可能，请更改，更改的历史记录必须维护 （或在部署时确定），以便可以在生产应用这些更改。</span><span class="sxs-lookup"><span data-stu-id="64e9f-135">Because deploying a database involves applying the changes in the schema and, possibly, the data since the last deployment, a history of changes must be maintained (or determined at deploy-time) so that those changes can be applied on production.</span></span> <span data-ttu-id="64e9f-136">有多种技术来管理和将更改应用到数据模型。</span><span class="sxs-lookup"><span data-stu-id="64e9f-136">There are a variety of techniques for managing and applying changes to the data model.</span></span>

### <a name="defining-the-baseline"></a><span data-ttu-id="64e9f-137">定义基线</span><span class="sxs-lookup"><span data-stu-id="64e9f-137">Defining the Baseline</span></span>

<span data-ttu-id="64e9f-138">若要维护对你应用程序的 s 数据库的更改需要具有一些起始状态，向其所做的更改应用到的基线。</span><span class="sxs-lookup"><span data-stu-id="64e9f-138">To maintain the changes to your application s database you need to have some starting state, a baseline to which the changes are applied to.</span></span> <span data-ttu-id="64e9f-139">在极端情况起始状态，可能是没有表、 视图或存储的过程的空数据库。</span><span class="sxs-lookup"><span data-stu-id="64e9f-139">At one extreme the starting state could be an empty database with no tables, views, or stored procedures.</span></span> <span data-ttu-id="64e9f-140">此类基线产生显著更改日志中，因为它必须包括所有数据库的表、 视图和存储的过程以及在初始部署之后所做的任何更改的创建。</span><span class="sxs-lookup"><span data-stu-id="64e9f-140">Such a baseline results in a large change log because it must include the creation of all of the database s tables, views, and stored procedures along with any changes made after the initial deployment.</span></span> <span data-ttu-id="64e9f-141">频谱图的另一端，你可以将基线设置为最初部署到生产环境的数据库的版本。</span><span class="sxs-lookup"><span data-stu-id="64e9f-141">At the other end of the spectrum you could set the baseline as the version of the database that is initially deployed to the production environment.</span></span> <span data-ttu-id="64e9f-142">选择此选项时将产生多较小的更改日志，因为它只包括到以下第一次部署数据库所做的更改。</span><span class="sxs-lookup"><span data-stu-id="64e9f-142">This choice results in a much smaller change log because it only includes the changes made to the database following the first deployment.</span></span> <span data-ttu-id="64e9f-143">这是我更喜欢的方法。</span><span class="sxs-lookup"><span data-stu-id="64e9f-143">This is the approach I prefer.</span></span> <span data-ttu-id="64e9f-144">当然你可以选择的道路方法中，多个中间定义基线初始创建数据库和数据库第一次部署时之间的某些点。</span><span class="sxs-lookup"><span data-stu-id="64e9f-144">And of course you can choose a more middle of the road approach, defining the baseline as some point between the initial creation of the database and when the database is first deployed.</span></span>

<span data-ttu-id="64e9f-145">一旦选择基线考虑生成可以执行以重新创建的基线版本的 SQL 脚本。</span><span class="sxs-lookup"><span data-stu-id="64e9f-145">Once you have chosen a baseline consider generating a SQL script that can be executed to recreate the baseline version.</span></span> <span data-ttu-id="64e9f-146">此类脚本，使可以快速重新创建数据库的基线版本。</span><span class="sxs-lookup"><span data-stu-id="64e9f-146">Such a script makes it possible to quickly recreate the baseline version of the database.</span></span> <span data-ttu-id="64e9f-147">此功能是更大型的项目中尤其有用，其中可能有多个开发人员处理的项目或其他环境，例如测试或过渡，每个需要其自己的数据库的副本。</span><span class="sxs-lookup"><span data-stu-id="64e9f-147">This functionality is especially useful in larger projects, where there may be multiple developers working on the project or additional environments, such as testing or staging, that each need their own copy of the database.</span></span>

<span data-ttu-id="64e9f-148">有多种工具可自由应用生成的基准版本的 SQL 脚本。</span><span class="sxs-lookup"><span data-stu-id="64e9f-148">There are a variety of tools at your disposal to generate a SQL script of the baseline version.</span></span> <span data-ttu-id="64e9f-149">从 SQL Server Management Studio (SSMS) 你可以右键单击数据库，请转到任务子菜单，并选择生成脚本选项。</span><span class="sxs-lookup"><span data-stu-id="64e9f-149">From SQL Server Management Studio (SSMS) you can right-click on the database, go to the Tasks submenu, and choose the Generate Scripts option.</span></span> <span data-ttu-id="64e9f-150">这将启动脚本向导中，你可以指示生成包含创建 s 对象的数据库的 SQL 命令的文件。</span><span class="sxs-lookup"><span data-stu-id="64e9f-150">This launches the Script Wizard, which you can instruct to generate a file that contains the SQL commands to create your database s objects.</span></span> <span data-ttu-id="64e9f-151">另一个选项是使用数据库发布向导，可以生成不仅在数据库表中创建数据库架构，但还数据的 SQL 命令。</span><span class="sxs-lookup"><span data-stu-id="64e9f-151">Another option is the Database Publishing Wizard, which can generate the SQL commands to not only create the database schema, but also the data in the database tables.</span></span> <span data-ttu-id="64e9f-152">数据库发布向导已检查详细信息中返回*部署数据库*教程。</span><span class="sxs-lookup"><span data-stu-id="64e9f-152">The Database Publishing Wizard was examined in detail back in the *Deploying a Database* tutorial.</span></span> <span data-ttu-id="64e9f-153">无论你使用什么工具，你应具有最终可用于重新创建你的数据库的基线版本的脚本文件应需要出现。</span><span class="sxs-lookup"><span data-stu-id="64e9f-153">Regardless of what tool you use, in the end you should have a script file that you can use to recreate the baseline version of your database, should the need arise.</span></span>

## <a name="documenting-the-database-changes-in-prose"></a><span data-ttu-id="64e9f-154">记录 Prose 中的数据库更改</span><span class="sxs-lookup"><span data-stu-id="64e9f-154">Documenting the Database Changes in Prose</span></span>

<span data-ttu-id="64e9f-155">在开发阶段维护对数据模型的更改的日志的最简单方法是在文本中记录的更改。</span><span class="sxs-lookup"><span data-stu-id="64e9f-155">The simplest way to maintain a log of changes to the data model during the development phase is to record the changes in prose.</span></span> <span data-ttu-id="64e9f-156">例如，如果在已部署应用程序的开发过程中添加的新列`Employees`表，删除的列从`Orders`表，并添加新表 (`ProductCategories`)，你将维护的文本文件或 Microsoft Word 文档与以下历史记录：</span><span class="sxs-lookup"><span data-stu-id="64e9f-156">For example, if during development of an already-deployed application you add a new column to the `Employees` table, remove a column from the `Orders` table, and add a new table (`ProductCategories`), you would maintain a text file or Microsoft Word document with the following history:</span></span>

<a id="0.4_table01"></a>


| <span data-ttu-id="64e9f-157">**更改日期**</span><span class="sxs-lookup"><span data-stu-id="64e9f-157">**Change Date**</span></span> | <span data-ttu-id="64e9f-158">**更改的详细信息**</span><span class="sxs-lookup"><span data-stu-id="64e9f-158">**Change Details**</span></span> |
| --- | --- |
| <span data-ttu-id="64e9f-159">2009-02-03:</span><span class="sxs-lookup"><span data-stu-id="64e9f-159">2009-02-03:</span></span> | <span data-ttu-id="64e9f-160">添加的列`DepartmentID`(`int`，NOT NULL) 到`Employees`表。</span><span class="sxs-lookup"><span data-stu-id="64e9f-160">Added column `DepartmentID` (`int`, NOT NULL) to the `Employees` table.</span></span> <span data-ttu-id="64e9f-161">添加从外的键约束`Departments.DepartmentID`到`Employees.DepartmentID`。</span><span class="sxs-lookup"><span data-stu-id="64e9f-161">Added a foreign key constraint from `Departments.DepartmentID` to `Employees.DepartmentID`.</span></span> |
| <span data-ttu-id="64e9f-162">2009-02-05:</span><span class="sxs-lookup"><span data-stu-id="64e9f-162">2009-02-05:</span></span> | <span data-ttu-id="64e9f-163">删除的列`TotalWeight`从`Orders`表。</span><span class="sxs-lookup"><span data-stu-id="64e9f-163">Removed column `TotalWeight` from the `Orders` table.</span></span> <span data-ttu-id="64e9f-164">中已捕获的数据关联`OrderDetails`记录。</span><span class="sxs-lookup"><span data-stu-id="64e9f-164">Data already captured in associated `OrderDetails` records.</span></span> |
| <span data-ttu-id="64e9f-165">2009-02-12:</span><span class="sxs-lookup"><span data-stu-id="64e9f-165">2009-02-12:</span></span> | <span data-ttu-id="64e9f-166">创建`ProductCategories`表。</span><span class="sxs-lookup"><span data-stu-id="64e9f-166">Created the `ProductCategories` table.</span></span> <span data-ttu-id="64e9f-167">有三列： `ProductCategoryID` (`int`， `IDENTITY`， `NOT NULL`)， `CategoryName` (`nvarchar(50)`， `NOT NULL`)，和`Active`(`bit`， `NOT NULL`)。</span><span class="sxs-lookup"><span data-stu-id="64e9f-167">There are three columns: `ProductCategoryID` (`int`, `IDENTITY`, `NOT NULL`), `CategoryName` (`nvarchar(50)`, `NOT NULL`), and `Active` (`bit`, `NOT NULL`).</span></span> <span data-ttu-id="64e9f-168">添加主键约束到`ProductCategoryID`，和默认值为 1 到`Active`。</span><span class="sxs-lookup"><span data-stu-id="64e9f-168">Added a primary key constraint to `ProductCategoryID`, and a default value of 1 to `Active`.</span></span> |


<span data-ttu-id="64e9f-169">有大量的这种方法的缺点。</span><span class="sxs-lookup"><span data-stu-id="64e9f-169">There are a number of drawbacks to this approach.</span></span> <span data-ttu-id="64e9f-170">对于初学者，自动化没有希望。</span><span class="sxs-lookup"><span data-stu-id="64e9f-170">For starters, there is no hope for automation.</span></span> <span data-ttu-id="64e9f-171">随时这些更改需要应用到数据库-例如，当部署该应用程序开发人员必须手动实现时每次更改，一次一个地。</span><span class="sxs-lookup"><span data-stu-id="64e9f-171">Anytime these changes need to be applied to a database - such as when the application is deployed - a developer must manually implement each change, one at a time.</span></span> <span data-ttu-id="64e9f-172">此外，如果你需要重新构造使用更改日志的基线中的数据库的特定版本，这样做因此将需要越来越多时间随着日志的大小的增长。</span><span class="sxs-lookup"><span data-stu-id="64e9f-172">Moreover, if you need to reconstruct a particular version of the database from the baseline using the change log, doing so will take more and more time as the size of the log grows.</span></span> <span data-ttu-id="64e9f-173">对此方法的另一个缺点是，实现明晰度和的详细信息的每个更改日志条目的级别从左到记录更改的人员。</span><span class="sxs-lookup"><span data-stu-id="64e9f-173">Another drawback to this method is that the clarity and level of detail of each change log entry is left to the person recording the change.</span></span> <span data-ttu-id="64e9f-174">在多个开发人员与团队中一些可能会使比其他更多详细、 更具可读性，或更精确的条目。</span><span class="sxs-lookup"><span data-stu-id="64e9f-174">In a team with multiple developers some may make more detailed, more readable, or more precise entries than others.</span></span> <span data-ttu-id="64e9f-175">此外，错误报告中也可能包含拼写错误和其他与用户相关的数据输入错误。</span><span class="sxs-lookup"><span data-stu-id="64e9f-175">Also, typos and other human-related data entry errors are possible.</span></span>

<span data-ttu-id="64e9f-176">记录 prose 中的数据库更改的主要好处是简单。</span><span class="sxs-lookup"><span data-stu-id="64e9f-176">The primary benefit of documenting the database changes in prose is simplicity.</span></span> <span data-ttu-id="64e9f-177">您不 t 需要知道如何创建和更改数据库对象的 SQL 语法。</span><span class="sxs-lookup"><span data-stu-id="64e9f-177">You don t need familiarity with the SQL syntax for creating and altering database objects.</span></span> <span data-ttu-id="64e9f-178">相反，你可以在文本中记录的更改，并实现它们通过 SQL Server Management Studio s 图形用户界面。</span><span class="sxs-lookup"><span data-stu-id="64e9f-178">Instead, you can record the changes in prose and implement them through SQL Server Management Studio s graphical user interface.</span></span>

<span data-ttu-id="64e9f-179">维护你更改日志中 prose，不可否认，不很好地与某些项目，例如在范围内，较大的非常复杂且获胜 t 工作具有对数据模型中，频繁的更改或涉及多个开发人员。</span><span class="sxs-lookup"><span data-stu-id="64e9f-179">Maintaining your change log in prose is, admittedly, not very sophisticated and won t work well with certain projects, such as ones that are large in scope, have frequent changes to the data model, or involve multiple developers.</span></span> <span data-ttu-id="64e9f-180">但是，我已经看到这种方法小、 one-man 项目具有对数据模型仅偶尔做出更改和其中单核的开发人员具有坚实的背景中没有用于创建和更改数据库对象的 SQL 语法中非常出色的工作。</span><span class="sxs-lookup"><span data-stu-id="64e9f-180">But I have seen this approach work quite well in small, one-man projects that have only occasional changes to the data model and where the solo developer does not have a strong background in the SQL syntax for creating and altering database objects.</span></span>

> [!NOTE]
> <span data-ttu-id="64e9f-181">时更改日志中的信息，从技术上讲，直到部署时，才需要我建议你保留的更改历史记录。</span><span class="sxs-lookup"><span data-stu-id="64e9f-181">While the information in the change log is, technically, only needed until deploy-time, I recommend keeping a history of changes.</span></span> <span data-ttu-id="64e9f-182">但是，而不是维护单个，不断更改日志文件，请考虑让每个数据库版本不同的更改日志文件。</span><span class="sxs-lookup"><span data-stu-id="64e9f-182">But rather than maintaining a single, ever growing change log file, consider having a different change log file for each database version.</span></span> <span data-ttu-id="64e9f-183">通常你需要把版本数据库每个部署的时间。</span><span class="sxs-lookup"><span data-stu-id="64e9f-183">Typically you will want to version the database each time it is deployed.</span></span> <span data-ttu-id="64e9f-184">通过维护的更改日志的日志可以从该基线，开始重新创建任何数据库版本通过执行从版本 1 开始的更改日志脚本，你需要重新创建继续，直到你访问的版本。</span><span class="sxs-lookup"><span data-stu-id="64e9f-184">By maintaining a log of change logs you can, starting from the baseline, recreate any database version by executing the change log scripts starting from version 1 and continuing until you reach the version you need to recreate.</span></span>


## <a name="recording-the-sql-change-statements"></a><span data-ttu-id="64e9f-185">记录 SQL 更改语句</span><span class="sxs-lookup"><span data-stu-id="64e9f-185">Recording the SQL Change Statements</span></span>

<span data-ttu-id="64e9f-186">维护 prose 中的更改日志的主要缺点是自动化缺乏。</span><span class="sxs-lookup"><span data-stu-id="64e9f-186">The primary drawback of maintaining the change log in prose is the lack of automation.</span></span> <span data-ttu-id="64e9f-187">理想情况下，实现对生产数据库在部署时的数据库更改将简单地单击按钮以执行脚本，而不是无需手动执行一系列说明。</span><span class="sxs-lookup"><span data-stu-id="64e9f-187">Ideally, implementing the database changes to the production database at deploy-time would be as easy as clicking a button to execute a script rather than having to manually perform a list of instructions.</span></span> <span data-ttu-id="64e9f-188">此类自动化是可能通过维护包含用于更改数据模型那些 SQL 命令的更改日志。</span><span class="sxs-lookup"><span data-stu-id="64e9f-188">Such automation is possible by maintaining a change log that contains those SQL commands used to alter the data model.</span></span>

<span data-ttu-id="64e9f-189">SQL 语法包括创建和修改各种数据库对象的语句数。</span><span class="sxs-lookup"><span data-stu-id="64e9f-189">The SQL syntax includes a number of statements for creating and modifying various database objects.</span></span> <span data-ttu-id="64e9f-190">例如， [ *CREATE TABLE 语句*](https://msdn.microsoft.com/en-us/library/ms174979.aspx)、 执行时，使用指定的列和约束创建的新表。</span><span class="sxs-lookup"><span data-stu-id="64e9f-190">For example, the [*CREATE TABLE statement*](https://msdn.microsoft.com/en-us/library/ms174979.aspx), when executed, creates a new table with the specified columns and constraints.</span></span> <span data-ttu-id="64e9f-191">[ *ALTER TABLE 语句*](https://msdn.microsoft.com/en-us/library/ms190273.aspx)修改现有表中，添加、 移除或修改其列或约束。</span><span class="sxs-lookup"><span data-stu-id="64e9f-191">The [*ALTER TABLE statement*](https://msdn.microsoft.com/en-us/library/ms190273.aspx) modifies an existing table, adding, removing, or modifying its columns or constraints.</span></span> <span data-ttu-id="64e9f-192">此外，还存在语句来创建、 修改和删除索引、 视图、 用户定义函数、 存储的过程、 触发器和其他数据库对象。</span><span class="sxs-lookup"><span data-stu-id="64e9f-192">There are also statements to create, modify, and drop indexes, views, user-defined functions, stored procedures, triggers, and other database objects.</span></span>

<span data-ttu-id="64e9f-193">返回到我们前面的示例，在你添加的新列的已部署的应用程序开发期间映像`Employees`表，删除的列从`Orders`表，并添加新表 (`ProductCategories`)。</span><span class="sxs-lookup"><span data-stu-id="64e9f-193">Returning to our earlier example, image that during development of an already-deployed application you add a new column to the `Employees` table, remove a column from the `Orders` table, and add a new table (`ProductCategories`).</span></span> <span data-ttu-id="64e9f-194">此类操作会导致具有以下 SQL 命令的更改日志文件：</span><span class="sxs-lookup"><span data-stu-id="64e9f-194">Such actions would result in a change log file with the following SQL commands:</span></span>

[!code-sql[Main](strategies-for-database-development-and-deployment-cs/samples/sample1.sql)]

<span data-ttu-id="64e9f-195">将这些更改推送到生产数据库在部署时是一次单击操作： 打开 SQL Server Management Studio、 连接到你的生产数据库、 打开新查询窗口、 粘贴的内容更改日志中，和单击执行以运行该脚本。</span><span class="sxs-lookup"><span data-stu-id="64e9f-195">Pushing these changes to the production database at deploy-time is a one-click operation: open SQL Server Management Studio, connect to your production database, open a New Query window, paste the contents of the change log, and click Execute to run the script.</span></span>

## <a name="using-a-comparison-tool-to-synchronize-the-data-models"></a><span data-ttu-id="64e9f-196">使用比较工具同步的数据模型</span><span class="sxs-lookup"><span data-stu-id="64e9f-196">Using a Comparison Tool to Synchronize the Data Models</span></span>

<span data-ttu-id="64e9f-197">记录中 prose 数据库更改很简单，但实现所做的更改需要开发人员可以一次; 在一个生产数据库上进行每个更改记录更改 SQL 命令使在作为轻松、 快速与单击一个按钮，生产数据库上实现这些更改，但需要学习和控制的 SQL 语句和语法用于创建和更改数据库对象。</span><span class="sxs-lookup"><span data-stu-id="64e9f-197">Documenting database changes in prose is easy, but implementing the changes requires a developer to make each change on the production database one at a time; documenting the change SQL commands makes implementing those changes on the production database as easy and quick as clicking a button, but requires learning and mastering the SQL statements and syntax for creating and altering database objects.</span></span> <span data-ttu-id="64e9f-198">数据库比较工具需要从这两种方法的最佳和放弃所做的最差。</span><span class="sxs-lookup"><span data-stu-id="64e9f-198">Database comparison tools take the best from both approaches and discard the worst.</span></span>

<span data-ttu-id="64e9f-199">数据库比较工具比较架构或两个数据库的数据，并显示摘要报告显示了数据库之间的差异。</span><span class="sxs-lookup"><span data-stu-id="64e9f-199">A database comparison tool compares the schema or data of two databases and displays a summary report showing you how the databases differ.</span></span> <span data-ttu-id="64e9f-200">然后，只需单击一个按钮，可以生成有关同步一个或多个数据库对象的 SQL 命令。</span><span class="sxs-lookup"><span data-stu-id="64e9f-200">Then, with the click of a button, you can generate the SQL commands for synchronizing one or more database objects.</span></span> <span data-ttu-id="64e9f-201">简而言之，你可以使用数据库比较工具比较开发和生产数据库，在部署时，生成的文件，包含 SQL 命令，在执行时，会将更改应用于生产数据库的架构因此它镜像开发数据库的架构。</span><span class="sxs-lookup"><span data-stu-id="64e9f-201">In a nutshell, you can use a database comparison tool to compare the development and production databases at deploy-time, generating a file that contains the SQL commands that, when executed, will apply the changes to the production database s schema so that it mirrors the development database s schema.</span></span>

<span data-ttu-id="64e9f-202">有多种第三方数据库比较工具提供的许多不同的供应商。</span><span class="sxs-lookup"><span data-stu-id="64e9f-202">There are a variety of third-party database comparison tools offered by many different vendors.</span></span> <span data-ttu-id="64e9f-203">一个例子就是[ *SQL 比较*](http://www.red-gate.com/products/SQL_Compare/)，也可由[ *Red Gate Software*](http://www.red-gate.com/)。</span><span class="sxs-lookup"><span data-stu-id="64e9f-203">One such example is [*SQL Compare*](http://www.red-gate.com/products/SQL_Compare/), by [*Red Gate Software*](http://www.red-gate.com/).</span></span> <span data-ttu-id="64e9f-204">允许 s 演练使用 SQL 比较比较和同步开发和生产数据库架构的过程。</span><span class="sxs-lookup"><span data-stu-id="64e9f-204">Let s walk through the process of using SQL Compare to compare and synchronize the development and production databases schemas.</span></span>

> [!NOTE]
> <span data-ttu-id="64e9f-205">在撰写本文时 SQL 比较的当前版本是版本 7.1、 使用标准版 $395 的成本计算。</span><span class="sxs-lookup"><span data-stu-id="64e9f-205">At the time of this writing the current version of SQL Compare was version 7.1, with the Standard Edition costing $395.</span></span> <span data-ttu-id="64e9f-206">你可以遵循通过下载 14 天免费试用版。</span><span class="sxs-lookup"><span data-stu-id="64e9f-206">You can follow along by downloading a free 14-day trial.</span></span>


<span data-ttu-id="64e9f-207">SQL 比较启动时将打开比较项目对话框中，显示的已保存的 SQL 比较项目。</span><span class="sxs-lookup"><span data-stu-id="64e9f-207">When SQL Compare starts the Comparison Projects dialog box opens, showing the saved SQL Compare projects.</span></span> <span data-ttu-id="64e9f-208">创建新项目。</span><span class="sxs-lookup"><span data-stu-id="64e9f-208">Create a new project.</span></span> <span data-ttu-id="64e9f-209">这将启动项目配置向导中，提示输入的数据库的相关信息进行比较 （请参见图 1）。</span><span class="sxs-lookup"><span data-stu-id="64e9f-209">This launches the Project Configuration wizard, which prompts for information about the databases to compare (see Figure 1).</span></span> <span data-ttu-id="64e9f-210">输入开发和生产环境数据库的信息。</span><span class="sxs-lookup"><span data-stu-id="64e9f-210">Enter the information for the development and production environment databases.</span></span>


<span data-ttu-id="64e9f-211">[![开发和生产数据库进行比较](strategies-for-database-development-and-deployment-cs/_static/image2.jpg)](strategies-for-database-development-and-deployment-cs/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="64e9f-211">[![Compare the Development and Production Databases](strategies-for-database-development-and-deployment-cs/_static/image2.jpg)](strategies-for-database-development-and-deployment-cs/_static/image1.jpg)</span></span>

<span data-ttu-id="64e9f-212">**图 1**： 开发和生产数据库进行比较 ([单击以查看实际尺寸的图像](strategies-for-database-development-and-deployment-cs/_static/image3.jpg))</span><span class="sxs-lookup"><span data-stu-id="64e9f-212">**Figure 1**: Compare the Development and Production Databases ([Click to view full-size image](strategies-for-database-development-and-deployment-cs/_static/image3.jpg))</span></span>


> [!NOTE]
> <span data-ttu-id="64e9f-213">如果你的开发环境数据库是中的 SQL Express Edition 数据库文件`App_Data`将需要在 SQL Server Express 数据库服务器中注册数据库，以便从图 1 所示的对话框中选择该网站的文件夹。</span><span class="sxs-lookup"><span data-stu-id="64e9f-213">If your development environment database is a SQL Express Edition database file in the `App_Data` folder of your website you will need to register the database in the SQL Server Express database server in order to select it from the dialog box shown in Figure 1.</span></span> <span data-ttu-id="64e9f-214">实现此目的的最简单方法是打开 SQL Server Management Studio (SSMS)，连接到 SQL Server Express 数据库服务器上，然后附加数据库。</span><span class="sxs-lookup"><span data-stu-id="64e9f-214">The easiest way to accomplish this is to open SQL Server Management Studio (SSMS), connect to the SQL Server Express database server, and attach the database.</span></span> <span data-ttu-id="64e9f-215">如果你没有在计算机上安装的 SSMS 可以下载并安装免费[ *SQL Server 2008 Management Studio Basic 版本*](https://www.microsoft.com/downloads/details.aspx?FamilyId=7522A683-4CB2-454E-B908-E805E9BD4E28&amp;displaylang=en)。</span><span class="sxs-lookup"><span data-stu-id="64e9f-215">If you do not have SSMS installed on your computer you can download and install the free [*SQL Server 2008 Management Studio Basic version*](https://www.microsoft.com/downloads/details.aspx?FamilyId=7522A683-4CB2-454E-B908-E805E9BD4E28&amp;displaylang=en).</span></span>


<span data-ttu-id="64e9f-216">除了选择数据库来进行比较，还可以指定各种比较设置从选项选项卡。你可能想要开启的一个选项是"忽略约束和索引名。</span><span class="sxs-lookup"><span data-stu-id="64e9f-216">In addition to selecting the databases to compare, you can also specify a variety of comparison settings from the Options tab. One option you may want to turn on is the "Ignore constraint and index names."</span></span> <span data-ttu-id="64e9f-217">回想一下，在前面的教程，我们添加应用程序服务到开发和生产数据库的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="64e9f-217">Recall that in the preceding tutorial we added the application services database objects to the development and production databases.</span></span> <span data-ttu-id="64e9f-218">如果你使用`aspnet_regsql.exe`工具在生产数据库上创建这些对象，那么你将找到 primary key 和 unique 约束名称，在开发和生产数据库之间有所不同。</span><span class="sxs-lookup"><span data-stu-id="64e9f-218">If you used the `aspnet_regsql.exe` tool to create these objects on the production database then you will find that the primary key and unique constraint names differ between the development and production databases.</span></span> <span data-ttu-id="64e9f-219">因此，SQL 比较将标记的所有应用程序服务表作为不同。</span><span class="sxs-lookup"><span data-stu-id="64e9f-219">Consequently, SQL Compare will flag all of the application services tables as differing.</span></span> <span data-ttu-id="64e9f-220">你也可以将"忽略约束和索引名称"未选中状态和同步约束名称，或指示 SQL 比较忽略这些差异。</span><span class="sxs-lookup"><span data-stu-id="64e9f-220">You can either leave the "Ignore constraint and index names" unchecked and synchronize the constraint names, or instruct SQL Compare to ignore these differences.</span></span>

<span data-ttu-id="64e9f-221">选择到数据库后比较 （和查看比较选项），单击立即比较按钮开始比较。</span><span class="sxs-lookup"><span data-stu-id="64e9f-221">After selecting the databases to compare (and reviewing the comparison options), click the Compare Now button to begin the comparison.</span></span> <span data-ttu-id="64e9f-222">接下来的几秒内，通过 SQL 比较检查两个数据库的架构并生成一份有何不同。</span><span class="sxs-lookup"><span data-stu-id="64e9f-222">Over the next several seconds, SQL Compare examines the schemas of the two databases and generates a report of how they differ.</span></span> <span data-ttu-id="64e9f-223">我已特意进行了到开发数据库，以显示在 SQL 比较界面中注明此类差异了一些修改。</span><span class="sxs-lookup"><span data-stu-id="64e9f-223">I ve purposefully made some modifications to the development database to show how such discrepancies are noted in the SQL Compare interface.</span></span> <span data-ttu-id="64e9f-224">如图 2 所示，我遇到添加`BirthDate`列`Authors`表，删除`ISBN`列从`Books`表，并添加一个新表， `Ratings`，这为了让用户访问站点速率审阅的丛书。</span><span class="sxs-lookup"><span data-stu-id="64e9f-224">As Figure 2 shows, I ve added a `BirthDate` column to the `Authors` table, removed the `ISBN` column from the `Books` table, and added a new table, `Ratings`, which is meant to let users visiting the site rate the reviewed books.</span></span>

> [!NOTE]
> <span data-ttu-id="64e9f-225">在本教程中所做的数据模型更改是为了演示如何使用数据库比较工具。</span><span class="sxs-lookup"><span data-stu-id="64e9f-225">The data model changes made in this tutorial were done to illustrate using a database comparison tool.</span></span> <span data-ttu-id="64e9f-226">您不将在将来的教程在数据库中找到这些更改。</span><span class="sxs-lookup"><span data-stu-id="64e9f-226">You will not find these changes in the database in future tutorials.</span></span>


<span data-ttu-id="64e9f-227">[![SQL 比较列出的开发和生产数据库之间的差异](strategies-for-database-development-and-deployment-cs/_static/image5.jpg)](strategies-for-database-development-and-deployment-cs/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="64e9f-227">[![SQL Compare Lists the Differences Between the Development and Production Databases](strategies-for-database-development-and-deployment-cs/_static/image5.jpg)](strategies-for-database-development-and-deployment-cs/_static/image4.jpg)</span></span>

<span data-ttu-id="64e9f-228">**图 2**: SQL 比较列出开发之间的差异和生产数据库 ([单击以查看实际尺寸的图像](strategies-for-database-development-and-deployment-cs/_static/image6.jpg))</span><span class="sxs-lookup"><span data-stu-id="64e9f-228">**Figure 2**: SQL Compare Lists the Differences Between the Development and Production Databases ([Click to view full-size image](strategies-for-database-development-and-deployment-cs/_static/image6.jpg))</span></span>


<span data-ttu-id="64e9f-229">SQL 比较将分解成组的数据库对象、 快速显示哪些对象在这两个数据库中存在但不同，该对象存在于一个数据库，但不是另一个，和的对象相等。</span><span class="sxs-lookup"><span data-stu-id="64e9f-229">SQL Compare breaks down the database objects into groups, quickly showing you what objects exist in both databases but are different, which objects exist in one database but not the other, and which objects are identical.</span></span> <span data-ttu-id="64e9f-230">如你所见，有两个数据库中存在但为不同的两个对象：`Authors`表，必须添加某列，与`Books`表，它具有一个删除。</span><span class="sxs-lookup"><span data-stu-id="64e9f-230">As you can see, there are two objects that exist in both databases but are different: the `Authors` table, which had a column added, and the `Books` table, which had one removed.</span></span> <span data-ttu-id="64e9f-231">存在仅在开发数据库中，即新创建的一个对象`Ratings`表。</span><span class="sxs-lookup"><span data-stu-id="64e9f-231">There is one object that exists only in the development database, namely the newly created `Ratings` table.</span></span> <span data-ttu-id="64e9f-232">并且有两个数据库中相同的 117 对象。</span><span class="sxs-lookup"><span data-stu-id="64e9f-232">And there are 117 objects that are identical in both databases.</span></span>

<span data-ttu-id="64e9f-233">选择数据库对象将显示 SQL 差异窗口，其中显示了这些对象之间的差异。</span><span class="sxs-lookup"><span data-stu-id="64e9f-233">Selecting a database object displays the SQL Differences window, which shows how these objects differ.</span></span> <span data-ttu-id="64e9f-234">SQL 差异窗口中，在图 2 中，底部显示突出显示，`Authors`开发数据库中的表具有`BirthDate`列，该列中找不到`Authors`生产数据库上的表。</span><span class="sxs-lookup"><span data-stu-id="64e9f-234">The SQL Differences window, displayed at the bottom in Figure 2, highlights that the `Authors` table in the development database has the `BirthDate` column, which is not found in the `Authors` table on the production database.</span></span>

<span data-ttu-id="64e9f-235">后查看差异，并选择你想要同步的对象下, 一步是生成更新生产数据库的架构所需的 SQL 命令以匹配开发数据库。</span><span class="sxs-lookup"><span data-stu-id="64e9f-235">After reviewing the differences and selecting which objects you want to synchronize, the next step is to generate the SQL commands needed to update the production database s schema to match the development database.</span></span> <span data-ttu-id="64e9f-236">这是通过同步向导来完成。</span><span class="sxs-lookup"><span data-stu-id="64e9f-236">This is accomplished through the Synchronization Wizard.</span></span> <span data-ttu-id="64e9f-237">同步向导确认什么对象进行同步，并总结了操作计划 （请参见图 3）。</span><span class="sxs-lookup"><span data-stu-id="64e9f-237">The Synchronization Wizard confirms what objects to synchronize and summarizes the action plan (see Figure 3).</span></span> <span data-ttu-id="64e9f-238">您可以立即同步数据库，或生成具有可以在方便的时候运行的 SQL 命令的脚本。</span><span class="sxs-lookup"><span data-stu-id="64e9f-238">You can synchronize the databases immediately or generate a script with the SQL commands that can be run at your leisure.</span></span>


<span data-ttu-id="64e9f-239">[![使用同步向导同步你的数据库架构](strategies-for-database-development-and-deployment-cs/_static/image8.jpg)](strategies-for-database-development-and-deployment-cs/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="64e9f-239">[![Use the Synchronization Wizard to Synchronize Your Databases Schemas](strategies-for-database-development-and-deployment-cs/_static/image8.jpg)](strategies-for-database-development-and-deployment-cs/_static/image7.jpg)</span></span>

<span data-ttu-id="64e9f-240">**图 3**： 使用同步数据库架构同步向导 ([单击以查看实际尺寸的图像](strategies-for-database-development-and-deployment-cs/_static/image9.jpg))</span><span class="sxs-lookup"><span data-stu-id="64e9f-240">**Figure 3**: Use the Synchronization Wizard to Synchronize Your Databases Schemas ([Click to view full-size image](strategies-for-database-development-and-deployment-cs/_static/image9.jpg))</span></span>


<span data-ttu-id="64e9f-241">数据库比较工具，如 Red Gate Software 的 SQL 比较请将所做的更改应用于对生产数据库一样简单，如点，然后单击开发数据库架构。</span><span class="sxs-lookup"><span data-stu-id="64e9f-241">Database comparison tools like Red Gate Software s SQL Compare make applying the changes to the development database schema to the production database as easy as point and click.</span></span>

> [!NOTE]
> <span data-ttu-id="64e9f-242">SQL 比较比较和同步两个数据库*架构*。</span><span class="sxs-lookup"><span data-stu-id="64e9f-242">SQL Compare compares and synchronizes two databases *schemas*.</span></span> <span data-ttu-id="64e9f-243">遗憾的是，它不比较和同步两个数据库表内的数据。</span><span class="sxs-lookup"><span data-stu-id="64e9f-243">Unfortunately, it does not compare and synchronize the data within two databases tables.</span></span> <span data-ttu-id="64e9f-244">Red Gate Software 确实提供了名为产品[ *SQL 数据比较*](http://www.red-gate.com/products/SQL_Data_Compare/) ，将比较，并将两个数据库间数据同步，但它是从 SQL 比较的单独产品，另一个 $395 的成本。</span><span class="sxs-lookup"><span data-stu-id="64e9f-244">Red Gate Software does offer a product named [*SQL Data Compare*](http://www.red-gate.com/products/SQL_Data_Compare/) that compares and synchronizes the data between two databases, but it is a separate product from SQL Compare and costs another $395.</span></span>


## <a name="taking-the-application-offline-during-deployment"></a><span data-ttu-id="64e9f-245">采用应用程序脱机在部署过程</span><span class="sxs-lookup"><span data-stu-id="64e9f-245">Taking the Application Offline During Deployment</span></span>

<span data-ttu-id="64e9f-246">正如我们看到在这些教程中，整个的已部署是一个包括多个步骤的过程： 将 ASP.NET 页、 母版页、 CSS 文件、 JavaScript 文件、 图像和其他所需的内容从开发环境复制到生产环境中;如果需要;，复制生产环境特定的配置信息，然后，自上次部署以来将所做的更改应用于数据模型。</span><span class="sxs-lookup"><span data-stu-id="64e9f-246">As we ve seen throughout these tutorials, deployment is a process that involves multiple steps: copying the ASP.NET pages, master pages, CSS files, JavaScript files, images, and other necessary content from the development environment to the production environment; copying up the production environment-specific configuration information, if needed; and applying the changes to the data model since the last deployment.</span></span> <span data-ttu-id="64e9f-247">根据文件的数目和数据库更改的复杂性，这些步骤需要任何位置从几秒到几分钟时间才能完成。</span><span class="sxs-lookup"><span data-stu-id="64e9f-247">Depending on the number of files and the complexity of your database changes, these steps can take anywhere from a few seconds to several minutes to complete.</span></span> <span data-ttu-id="64e9f-248">在此时段内的 web 应用程序变化不定，并且访问网站的用户可能会遇到错误或意外的行为。</span><span class="sxs-lookup"><span data-stu-id="64e9f-248">During this window the web application is in flux and users visiting the site may experience errors or unexpected behavior.</span></span>

<span data-ttu-id="64e9f-249">部署网站时，最好使 web 应用程序"脱机"，直到完成部署。</span><span class="sxs-lookup"><span data-stu-id="64e9f-249">When deploying a website it is best to take the web application "offline" until deployment has completed.</span></span> <span data-ttu-id="64e9f-250">脱机应用程序 （并完成部署过程后，则会将该备份） 化简为上载文件，然后将其删除。</span><span class="sxs-lookup"><span data-stu-id="64e9f-250">Taking the application offline (and bringing it back up once the deployment process has finished) is as easy as uploading a file and then deleting it.</span></span> <span data-ttu-id="64e9f-251">从 ASP.NET 2.0，名为的文件的存在开始`app_offline.htm`在应用程序根目录使整个网站"脱机"。</span><span class="sxs-lookup"><span data-stu-id="64e9f-251">Starting with ASP.NET 2.0, the mere presence of a file named `app_offline.htm` in the application s root directory takes the entire website "offline."</span></span> <span data-ttu-id="64e9f-252">向该站点上的 ASP.NET 页面的任何请求自动响应的内容`app_offline.htm`文件。</span><span class="sxs-lookup"><span data-stu-id="64e9f-252">Any request to an ASP.NET page on that site is automatically responded with the contents of the `app_offline.htm` file.</span></span> <span data-ttu-id="64e9f-253">该文件在删除之后，应用程序重新联机。</span><span class="sxs-lookup"><span data-stu-id="64e9f-253">Once that file is removed, the application comes back online.</span></span>

<span data-ttu-id="64e9f-254">采用应用程序脱机在部署期间，然后，非常简单，只上载`app_offline.htm`文件复制到生产环境 s 根目录开始部署过程，然后将其删除 （或将其更名为其他内容） 之前一次部署已完成。</span><span class="sxs-lookup"><span data-stu-id="64e9f-254">Taking an application offline during deployment, then, is as simple as uploading an `app_offline.htm` file to the production environment s root directory prior to beginning the deployment process and then deleting it (or renaming it to something else) once deployment is complete.</span></span> <span data-ttu-id="64e9f-255">有关此技术的详细信息请参阅 John Peterson 的文章，采用[*脱机 ASP.NET 应用程序*](http://www.15seconds.com/issue/061207.htm)。</span><span class="sxs-lookup"><span data-stu-id="64e9f-255">For more information on this technique refer to John Peterson s article, Taking an [*ASP.NET Application Offline*](http://www.15seconds.com/issue/061207.htm).</span></span>

## <a name="summary"></a><span data-ttu-id="64e9f-256">摘要</span><span class="sxs-lookup"><span data-stu-id="64e9f-256">Summary</span></span>

<span data-ttu-id="64e9f-257">部署数据驱动应用程序的主要难题是围绕将数据库部署。</span><span class="sxs-lookup"><span data-stu-id="64e9f-257">The main challenge in deploying a data-driven application centers around deploying the database.</span></span> <span data-ttu-id="64e9f-258">因为有两个版本的数据库在开发环境中一-以及一个在生产环境中的这些两个数据库架构可以成为同步的如在开发过程中添加新功能。</span><span class="sxs-lookup"><span data-stu-id="64e9f-258">Because there are two versions of the database - one in the development environment and one in the production environment - these two databases schemas can become out of sync as new features are added in development.</span></span> <span data-ttu-id="64e9f-259">新增功能更多，因为作为正在用来自真实的用户的真实数据填充的生产数据库，你无法覆盖生产数据库具有修改的开发数据库一样部署构成应用程序 （ASP.NET 页的文件时图像文件，和等等）。</span><span class="sxs-lookup"><span data-stu-id="64e9f-259">What s more, because the production database as being populated with real data from real users, you cannot overwrite the production database with the modified development database like you can when deploying the files that make up the application (the ASP.NET pages, image files, and so forth).</span></span> <span data-ttu-id="64e9f-260">相反，将数据库部署需要实现的精确的一套自上次部署以来对生产数据库上的开发数据库所做更改。</span><span class="sxs-lookup"><span data-stu-id="64e9f-260">Instead, deploying a database entails implementing the precise set of changes made to the development database on the production database since the last deployment.</span></span>

<span data-ttu-id="64e9f-261">本教程介绍了有关维护和将数据库更改的日志应用的这三种技术。</span><span class="sxs-lookup"><span data-stu-id="64e9f-261">This tutorial looked at three techniques for maintaining and applying a log of database changes.</span></span> <span data-ttu-id="64e9f-262">最简单方法是在文本中记录的更改。</span><span class="sxs-lookup"><span data-stu-id="64e9f-262">The simplest approach is to record the changes in prose.</span></span> <span data-ttu-id="64e9f-263">当这种做法在生产数据库手动过程上实现这些更改时，它不用于创建和更改数据库对象需要的 SQL 命令的知识。</span><span class="sxs-lookup"><span data-stu-id="64e9f-263">While this tactic makes implementing these changes on the production database a manual process, it does not require knowledge of the SQL commands for creating and altering database objects.</span></span> <span data-ttu-id="64e9f-264">一个更复杂的方法，以及一个知识更有意思在更大的项目或项目中使用多个开发人员而言，是为 SQL 命令的一系列记录的更改。</span><span class="sxs-lookup"><span data-stu-id="64e9f-264">A more sophisticated approach, and one that is much more palatable in larger projects or projects with multiple developers, is to record the changes as a series of SQL commands.</span></span> <span data-ttu-id="64e9f-265">这极大地 hastens 推出到目标数据库的这些更改。</span><span class="sxs-lookup"><span data-stu-id="64e9f-265">This greatly hastens rolling out these changes to the target database.</span></span> <span data-ttu-id="64e9f-266">可以通过使用数据库比较工具，如 Red Gate Software 的 SQL 比较实现这两种方法的最佳。</span><span class="sxs-lookup"><span data-stu-id="64e9f-266">The best of both approaches can be achieved by using a database comparison tool, such as Red Gate Software s SQL Compare.</span></span>

<span data-ttu-id="64e9f-267">本教程到结束我们专注于将数据驱动的应用程序部署。</span><span class="sxs-lookup"><span data-stu-id="64e9f-267">This tutorial concludes our focus on deploying a data-driven application.</span></span> <span data-ttu-id="64e9f-268">下一步系列教程讲述如何响应在生产环境中的错误。</span><span class="sxs-lookup"><span data-stu-id="64e9f-268">The next set of tutorials looks at how to respond to errors in the production environment.</span></span> <span data-ttu-id="64e9f-269">我们将查看如何显示友好错误页，而是而不是黄色死亡屏幕。</span><span class="sxs-lookup"><span data-stu-id="64e9f-269">We'll look at how to display a friendly error page rather instead of the Yellow Screen of Death.</span></span> <span data-ttu-id="64e9f-270">并且，我们将了解如何将登录错误 s 详细信息以及如何在此类错误发生时向你发出警报。</span><span class="sxs-lookup"><span data-stu-id="64e9f-270">And we'll see how to log the error s details and how to alert you when such errors occur.</span></span>

<span data-ttu-id="64e9f-271">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="64e9f-271">Happy Programming!</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="64e9f-272">[上一页](configuring-a-website-that-uses-application-services-cs.md)
[下一页](displaying-a-custom-error-page-cs.md)</span><span class="sxs-lookup"><span data-stu-id="64e9f-272">[Previous](configuring-a-website-that-uses-application-services-cs.md)
[Next](displaying-a-custom-error-page-cs.md)</span></span>
