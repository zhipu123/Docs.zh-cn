---
uid: web-forms/overview/older-versions-security/roles/creating-and-managing-roles-vb
title: "创建和管理角色 (VB) |Microsoft 文档"
author: rick-anderson
description: "本教程可检查为配置角色框架所必需的步骤。 接下来，我们将生成的 web 页面以创建和删除角色。"
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/24/2008
ms.topic: article
ms.assetid: 83af9f5f-9a00-4f83-8afc-e98bdd49014e
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/roles/creating-and-managing-roles-vb
msc.type: authoredcontent
ms.openlocfilehash: a67065a33bb38388ab941c785b7dcc268645ceca
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="creating-and-managing-roles-vb"></a><span data-ttu-id="c39d8-104">创建和管理角色 (VB)</span><span class="sxs-lookup"><span data-stu-id="c39d8-104">Creating and Managing Roles (VB)</span></span>
====================
<span data-ttu-id="c39d8-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c39d8-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c39d8-106">[下载代码](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.09.zip)或[下载 PDF](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="c39d8-106">[Download Code](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.09.zip) or [Download PDF](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_vb.pdf)</span></span>

> <span data-ttu-id="c39d8-107">本教程可检查为配置角色框架所必需的步骤。</span><span class="sxs-lookup"><span data-stu-id="c39d8-107">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="c39d8-108">接下来，我们将生成的 web 页面以创建和删除角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-108">Following that, we will build web pages to create and delete roles.</span></span>


## <a name="introduction"></a><span data-ttu-id="c39d8-109">介绍</span><span class="sxs-lookup"><span data-stu-id="c39d8-109">Introduction</span></span>

<span data-ttu-id="c39d8-110">在<a id="_msoanchor_1"> </a> [*基于用户的授权*](../membership/user-based-authorization-vb.md)教程，我们了解了使用 URL 授权以限制某些用户从一组页面，并介绍了声明性和有关如何调整基于正在访问的用户的 ASP.NET 页的功能的编程技术。</span><span class="sxs-lookup"><span data-stu-id="c39d8-110">In the <a id="_msoanchor_1"></a>[*User-Based Authorization*](../membership/user-based-authorization-vb.md) tutorial we looked at using URL authorization to restrict certain users from a set of pages and explored declarative and programmatic techniques for adjusting an ASP.NET page's functionality based on the visiting user.</span></span> <span data-ttu-id="c39d8-111">授予访问页或基于用户的用户的功能的权限，但是，可以更大量方案中的维护任务在有多个用户帐户，或当用户的权限通常更改。</span><span class="sxs-lookup"><span data-stu-id="c39d8-111">Granting permission for page access or functionality on a user-by-user basis, however, can become a maintenance nightmare in scenarios where there are many user accounts or when users' privileges change often.</span></span> <span data-ttu-id="c39d8-112">任何时候用户获得或失去授权，以执行特定任务，管理员需要更新的相应 URL 授权规则，声明性标记和代码。</span><span class="sxs-lookup"><span data-stu-id="c39d8-112">Any time a user gains or loses authorization to perform a particular task, the administrator needs to update the appropriate URL authorization rules, declarative markup, and code.</span></span>

<span data-ttu-id="c39d8-113">它通常有助于将归入组的用户或*角色*，然后将权限应用基于角色的角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-113">It usually helps to classify users into groups or *roles* and then to apply permissions on a role-by-role basis.</span></span> <span data-ttu-id="c39d8-114">例如，大多数 web 应用程序具有某组页面或仅为管理用户保留的任务。</span><span class="sxs-lookup"><span data-stu-id="c39d8-114">For example, most web applications have a certain set of pages or tasks that are reserved only for administrative users.</span></span> <span data-ttu-id="c39d8-115">在中使用的技术学习到*基于用户的授权*教程中，我们将添加相应的 URL 授权规则、 声明性标记和代码，以允许指定的用户帐户来执行管理任务。</span><span class="sxs-lookup"><span data-stu-id="c39d8-115">Using the techniques learned in the *User-Based Authorization* tutorial, we would add the appropriate URL authorization rules, declarative markup, and code to allow the specified user accounts to perform administrative tasks.</span></span> <span data-ttu-id="c39d8-116">但如果添加到新的管理员或现有的管理员需要能够吊销其管理权限，我们必须返回并更新配置文件和 web 页。</span><span class="sxs-lookup"><span data-stu-id="c39d8-116">But if a new administrator was added or if an existing administrator needed to have her administration rights revoked, we would have to return and update the configuration files and web pages.</span></span> <span data-ttu-id="c39d8-117">与角色，但是，我们可以创建名为管理员角色并将这些受信任的用户分配到管理员角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-117">With roles, however, we could create a role called Administrators and assign those trusted users to the Administrators role.</span></span> <span data-ttu-id="c39d8-118">接下来，我们将添加相应的 URL 授权规则、 声明性标记和代码，以允许管理员角色来执行各种管理任务。</span><span class="sxs-lookup"><span data-stu-id="c39d8-118">Next, we would add the appropriate URL authorization rules, declarative markup, and code to allow the Administrators role to perform the various administrative tasks.</span></span> <span data-ttu-id="c39d8-119">与此基础结构，向站点添加新的管理员或删除现有类型是简单，只包括或从管理员角色中删除用户。</span><span class="sxs-lookup"><span data-stu-id="c39d8-119">With this infrastructure in place, adding new administrators to the site or removing existing ones is as simple as including or removing the user from the Administrators role.</span></span> <span data-ttu-id="c39d8-120">没有配置、 声明性标记或代码更改是必需的。</span><span class="sxs-lookup"><span data-stu-id="c39d8-120">No configuration, declarative markup, or code changes are necessary.</span></span>

<span data-ttu-id="c39d8-121">ASP.NET 提供一个用于定义角色和将其与用户帐户关联的角色框架。</span><span class="sxs-lookup"><span data-stu-id="c39d8-121">ASP.NET offers a Roles framework for defining roles and associating them with user accounts.</span></span> <span data-ttu-id="c39d8-122">使用角色 framework 我们可以创建和删除角色，将用户添加或从角色中删除用户、 确定属于特定角色，并告知用户是否属于特定角色的用户组。</span><span class="sxs-lookup"><span data-stu-id="c39d8-122">With the Roles framework we can create and delete roles, add users to or remove users from a role, determine the set of users that belong to a particular role, and tell whether a user belongs to a particular role.</span></span> <span data-ttu-id="c39d8-123">一旦配置了角色框架，我们可以限制对页 URL 授权规则通过基于角色的角色的访问以及显示或隐藏的其他信息或基于当前登录的用户的角色页面上的功能。</span><span class="sxs-lookup"><span data-stu-id="c39d8-123">Once the Roles framework has been configured, we can limit access to pages on a role-by-role basis through URL authorization rules and show or hide additional information or functionality on a page based on the currently logged on user's roles.</span></span>

<span data-ttu-id="c39d8-124">本教程可检查为配置角色框架所必需的步骤。</span><span class="sxs-lookup"><span data-stu-id="c39d8-124">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="c39d8-125">接下来，我们将生成的 web 页面以创建和删除角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-125">Following that, we will build web pages to create and delete roles.</span></span> <span data-ttu-id="c39d8-126">在<a id="_msoanchor_2"> </a> [*向用户分配角色*](assigning-roles-to-users-vb.md)教程我们将了解如何添加和从角色中删除用户。</span><span class="sxs-lookup"><span data-stu-id="c39d8-126">In the <a id="_msoanchor_2"></a>[*Assigning Roles to Users*](assigning-roles-to-users-vb.md) tutorial we will look at how to add and remove users from roles.</span></span> <span data-ttu-id="c39d8-127">然后在<a id="_msoanchor_3"> </a> [*基于角色的授权*](role-based-authorization-vb.md)教程，我们将了解如何限制对页以及如何调整页功能具体取决于基于角色的角色的访问正在访问用户的角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-127">And in the <a id="_msoanchor_3"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial we will see how to limit access to pages on a role-by-role basis along with how to adjust page functionality depending on the visiting user's role.</span></span> <span data-ttu-id="c39d8-128">让我们进入正题！</span><span class="sxs-lookup"><span data-stu-id="c39d8-128">Let's get started!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="c39d8-129">步骤 1： 添加新的 ASP.NET 页</span><span class="sxs-lookup"><span data-stu-id="c39d8-129">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="c39d8-130">我们将在本教程和后面的两个检查各种与角色相关的函数和功能。</span><span class="sxs-lookup"><span data-stu-id="c39d8-130">In this tutorial and the next two we will be examining various roles-related functions and capabilities.</span></span> <span data-ttu-id="c39d8-131">我们将需要一系列的 ASP.NET 网页来实现检查整个这些教程的主题。</span><span class="sxs-lookup"><span data-stu-id="c39d8-131">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="c39d8-132">让我们创建这些页面和更新站点映射。</span><span class="sxs-lookup"><span data-stu-id="c39d8-132">Let's create these pages and update the site map.</span></span>

<span data-ttu-id="c39d8-133">首先创建一个新文件夹中名为的项目`Roles`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-133">Start by creating a new folder in the project named `Roles`.</span></span> <span data-ttu-id="c39d8-134">接下来，添加到四个新的 ASP.NET 页面`Roles`文件夹中，链接与每个页面`Site.master`母版页。</span><span class="sxs-lookup"><span data-stu-id="c39d8-134">Next, add four new ASP.NET pages to the `Roles` folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="c39d8-135">命名页：</span><span class="sxs-lookup"><span data-stu-id="c39d8-135">Name the pages:</span></span>

- `ManageRoles.aspx`
- `UsersAndRoles.aspx`
- `CreateUserWizardWithRoles.aspx`
- `RoleBasedAuthorization.aspx`

<span data-ttu-id="c39d8-136">此时你的项目的解决方案资源管理器应类似于的屏幕快照中图 1 所示。</span><span class="sxs-lookup"><span data-stu-id="c39d8-136">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>


<span data-ttu-id="c39d8-137">[![四个新页面已添加到角色文件夹](creating-and-managing-roles-vb/_static/image2.png)](creating-and-managing-roles-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c39d8-137">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-vb/_static/image2.png)](creating-and-managing-roles-vb/_static/image1.png)</span></span>

<span data-ttu-id="c39d8-138">**图 1**： 四个新页已添加到`Roles`文件夹 ([单击以查看实际尺寸的图像](creating-and-managing-roles-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="c39d8-138">**Figure 1**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image3.png))</span></span>


<span data-ttu-id="c39d8-139">每一页后，应该在此情况下，有两个内容控件，每个母版页的 ContentPlaceHolders:`MainContent`和`LoginContent`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-139">Each page should, at this point, have the two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample1.aspx)]

<span data-ttu-id="c39d8-140">回想一下， `LoginContent` ContentPlaceHolder 的默认标记显示在登录或注销的站点，具体取决于是否对用户进行身份验证的链接。</span><span class="sxs-lookup"><span data-stu-id="c39d8-140">Recall that the `LoginContent` ContentPlaceHolder's default markup displays a link to log on or log off the site, depending on whether the user is authenticated.</span></span> <span data-ttu-id="c39d8-141">是否存在`Content2`内容控件在 ASP.NET 页中，但是，重写主页面的默认标记。</span><span class="sxs-lookup"><span data-stu-id="c39d8-141">The presence of the `Content2` Content control in the ASP.NET page, however, overrides the master page's default markup.</span></span> <span data-ttu-id="c39d8-142">如我们所述<a id="_msoanchor_4"> </a> [*概述窗体身份验证的*](../introduction/an-overview-of-forms-authentication-vb.md)教程中，重写的默认标记是有用我们不希望在何处显示登录相关的页面中左侧列中的选项。</span><span class="sxs-lookup"><span data-stu-id="c39d8-142">As we discussed in <a id="_msoanchor_4"></a>[*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, overriding the default markup is useful in pages where we do not want to display login-related options in the left column.</span></span>

<span data-ttu-id="c39d8-143">对于这些四个页，但是，我们希望能够显示主控页的默认标记`LoginContent`ContentPlaceHolder。</span><span class="sxs-lookup"><span data-stu-id="c39d8-143">For these four pages, however, we want to show the master page's default markup for the `LoginContent` ContentPlaceHolder.</span></span> <span data-ttu-id="c39d8-144">因此，删除的声明性标记`Content2`内容控件。</span><span class="sxs-lookup"><span data-stu-id="c39d8-144">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="c39d8-145">这么做，四个页面的标记的每个应包含几个内容控件。</span><span class="sxs-lookup"><span data-stu-id="c39d8-145">After doing so, each of the four page's markup should contain just one Content control.</span></span>

<span data-ttu-id="c39d8-146">最后，让我们更新站点图 (`Web.sitemap`) 以包括这些新的 web 页面。</span><span class="sxs-lookup"><span data-stu-id="c39d8-146">Finally, let's update the site map (`Web.sitemap`) to include these new web pages.</span></span> <span data-ttu-id="c39d8-147">添加以下 XML 后的`<siteMapNode>`我们添加有关成员身份教程。</span><span class="sxs-lookup"><span data-stu-id="c39d8-147">Add the following XML after the `<siteMapNode>` we added for the Membership tutorials.</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample2.xml)]

<span data-ttu-id="c39d8-148">使用站点映射更新，请访问通过浏览器的站点。</span><span class="sxs-lookup"><span data-stu-id="c39d8-148">With the site map updated, visit the site through a browser.</span></span> <span data-ttu-id="c39d8-149">如图 2 所示，在左侧的导航现在将包括以为角色教程的项。</span><span class="sxs-lookup"><span data-stu-id="c39d8-149">As Figure 2 shows, the navigation on the left now includes items for the Roles tutorials.</span></span>


<span data-ttu-id="c39d8-150">[![四个新页面已添加到角色文件夹](creating-and-managing-roles-vb/_static/image5.png)](creating-and-managing-roles-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c39d8-150">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-vb/_static/image5.png)](creating-and-managing-roles-vb/_static/image4.png)</span></span>

<span data-ttu-id="c39d8-151">**图 2**： 四个新页已添加到`Roles`文件夹 ([单击以查看实际尺寸的图像](creating-and-managing-roles-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c39d8-151">**Figure 2**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image6.png))</span></span>


## <a name="step-2-specifying-and-configuring-the-roles-framework-provider"></a><span data-ttu-id="c39d8-152">步骤 2： 指定和配置的角色 Framework 提供程序</span><span class="sxs-lookup"><span data-stu-id="c39d8-152">Step 2: Specifying and Configuring the Roles Framework Provider</span></span>

<span data-ttu-id="c39d8-153">成员资格 framework 中，如角色 framework 是在提供程序模型之上构建的。</span><span class="sxs-lookup"><span data-stu-id="c39d8-153">Like the Membership framework, the Roles framework is built atop the provider model.</span></span> <span data-ttu-id="c39d8-154">中所述<a id="_msoanchor_5"> </a> [*安全性基础知识和 ASP.NET 支持*](../introduction/security-basics-and-asp-net-support-vb.md)教程中，.NET Framework 附带有三个内置角色提供程序： [ `AuthorizationStoreRoleProvider` ](https://msdn.microsoft.com/en-us/library/system.web.security.authorizationstoreroleprovider.aspx)[ `WindowsTokenRoleProvider` ](https://msdn.microsoft.com/en-us/library/system.web.security.windowstokenroleprovider.aspx)，和[ `SqlRoleProvider` ](https://msdn.microsoft.com/en-us/library/system.web.security.sqlroleprovider.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c39d8-154">As discussed in the <a id="_msoanchor_5"></a>[*Security Basics and ASP.NET Support*](../introduction/security-basics-and-asp-net-support-vb.md) tutorial, the .NET Framework ships with three built-in Roles providers: [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/en-us/library/system.web.security.authorizationstoreroleprovider.aspx), [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/en-us/library/system.web.security.windowstokenroleprovider.aspx), and [`SqlRoleProvider`](https://msdn.microsoft.com/en-us/library/system.web.security.sqlroleprovider.aspx).</span></span> <span data-ttu-id="c39d8-155">本系列教程侧重于`SqlRoleProvider`，它使用 Microsoft SQL Server 数据库作为角色存储。</span><span class="sxs-lookup"><span data-stu-id="c39d8-155">This tutorial series focuses on the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span>

<span data-ttu-id="c39d8-156">实际上角色 framework 和`SqlRoleProvider`工作一样成员资格 framework 和`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-156">Underneath the covers the Roles framework and `SqlRoleProvider` work just like the Membership framework and `SqlMembershipProvider`.</span></span> <span data-ttu-id="c39d8-157">.NET Framework 包含`Roles`用作角色 framework API 的类。</span><span class="sxs-lookup"><span data-stu-id="c39d8-157">The .NET Framework contains a `Roles` class that serves as the API to the Roles framework.</span></span> <span data-ttu-id="c39d8-158">`Roles`类已共享等方法`CreateRole`， `DeleteRole`， `GetAllRoles`， `AddUserToRole`， `IsUserInRole`，依次类推。</span><span class="sxs-lookup"><span data-stu-id="c39d8-158">The `Roles` class has shared methods like `CreateRole`, `DeleteRole`, `GetAllRoles`, `AddUserToRole`, `IsUserInRole`, and so forth.</span></span> <span data-ttu-id="c39d8-159">当调用这些方法之一时，`Roles`类将调用委托给配置的提供程序。</span><span class="sxs-lookup"><span data-stu-id="c39d8-159">When one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="c39d8-160">`SqlRoleProvider`适用于特定于角色的表 (`aspnet_Roles`和`aspnet_UsersInRoles`) 在响应中。</span><span class="sxs-lookup"><span data-stu-id="c39d8-160">The `SqlRoleProvider` works with the role-specific tables (`aspnet_Roles` and `aspnet_UsersInRoles`) in response.</span></span>

<span data-ttu-id="c39d8-161">若要使用`SqlRoleProvider`我们的应用程序中的提供程序，我们需要指定什么数据库以用作存储区。</span><span class="sxs-lookup"><span data-stu-id="c39d8-161">In order to use the `SqlRoleProvider` provider in our application, we need to specify what database to use as the store.</span></span> <span data-ttu-id="c39d8-162">`SqlRoleProvider`需要指定的角色存储具有某些数据库表、 视图和存储的过程。</span><span class="sxs-lookup"><span data-stu-id="c39d8-162">The `SqlRoleProvider` expects the specified role store to have certain database tables, views, and stored procedures.</span></span> <span data-ttu-id="c39d8-163">可以使用添加这些必备项的数据库对象[`aspnet_regsql.exe`工具](https://msdn.microsoft.com/en-us/library/ms229862.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c39d8-163">These requisite database objects can be added using the [`aspnet_regsql.exe` tool](https://msdn.microsoft.com/en-us/library/ms229862.aspx).</span></span> <span data-ttu-id="c39d8-164">现在我们已有具有所需的架构的数据库`SqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-164">At this point we already have a database with the schema necessary for the `SqlRoleProvider`.</span></span> <span data-ttu-id="c39d8-165">返回<a id="_msoanchor_6"> </a> [*在 SQL Server 中创建成员身份架构*](../membership/creating-the-membership-schema-in-sql-server-vb.md)我们创建一个名为数据库的教程`SecurityTutorials.mdf`和使用`aspnet_regsql.exe`以添加该应用程序服务，它包括所需的数据库对象`SqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-165">Back in the <a id="_msoanchor_6"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial we created a database named `SecurityTutorials.mdf` and used `aspnet_regsql.exe` to add the application services, which included the database objects required by the `SqlRoleProvider`.</span></span> <span data-ttu-id="c39d8-166">因此我们只需通知角色框架以支持角色并使用`SqlRoleProvider`与`SecurityTutorials.mdf`作为角色存储的数据库。</span><span class="sxs-lookup"><span data-stu-id="c39d8-166">Therefore we just need to tell the Roles framework to enable role support and to use the `SqlRoleProvider` with the `SecurityTutorials.mdf` database as the role store.</span></span>

<span data-ttu-id="c39d8-167">通过配置角色 framework`<roleManager>`中应用程序的元素`Web.config`文件。</span><span class="sxs-lookup"><span data-stu-id="c39d8-167">The Roles framework is configured via the `<roleManager>` element in the application's `Web.config` file.</span></span> <span data-ttu-id="c39d8-168">默认情况下，角色支持处于禁用状态。</span><span class="sxs-lookup"><span data-stu-id="c39d8-168">By default, role support is disabled.</span></span> <span data-ttu-id="c39d8-169">若要启用它，必须设置[ `<roleManager>` ](https://msdn.microsoft.com/en-us/library/ms164660.aspx)元素的`enabled`属性设为`true`如下所示：</span><span class="sxs-lookup"><span data-stu-id="c39d8-169">To enable it, you must set the [`<roleManager>`](https://msdn.microsoft.com/en-us/library/ms164660.aspx) element's `enabled` attribute to `true` like so:</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample3.xml)]

<span data-ttu-id="c39d8-170">默认情况下，所有 web 应用程序都具有名为角色提供程序`AspNetSqlRoleProvider`类型的`SqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-170">By default, all web applications have a Roles provider named `AspNetSqlRoleProvider` of type `SqlRoleProvider`.</span></span> <span data-ttu-id="c39d8-171">此默认的提供程序注册中`machine.config`(位于`%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span><span class="sxs-lookup"><span data-stu-id="c39d8-171">This default provider is registered in `machine.config` (located at `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample4.xml)]

<span data-ttu-id="c39d8-172">提供程序的`connectionStringName`属性指定使用角色存储。</span><span class="sxs-lookup"><span data-stu-id="c39d8-172">The provider's `connectionStringName` attribute specifies the role store that is used.</span></span> <span data-ttu-id="c39d8-173">`AspNetSqlRoleProvider`提供程序将此属性设置为`LocalSqlServer`，也会在定义`machine.config`和点，默认情况下，到中的 SQL Server 2005 Express Edition 数据库`App_Data`文件夹名为`aspnet.mdf`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-173">The `AspNetSqlRoleProvider` provider sets this attribute to `LocalSqlServer`, which is also defined in `machine.config` and points, by default, to a SQL Server 2005 Express Edition database in the `App_Data` folder named `aspnet.mdf`.</span></span>

<span data-ttu-id="c39d8-174">因此，如果我们只需为不在我们的应用程序中指定任何提供程序信息的情况下启用角色 framework`Web.config`文件，应用程序使用注册的默认角色提供程序， `AspNetSqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-174">Consequently, if we simply enable the Roles framework without specifying any provider information in our application's `Web.config` file, the application uses the default registered Roles provider, `AspNetSqlRoleProvider`.</span></span> <span data-ttu-id="c39d8-175">如果`~/App_Data/aspnet.mdf`数据库不存在，ASP.NET 运行时将自动创建它并添加应用程序服务架构。</span><span class="sxs-lookup"><span data-stu-id="c39d8-175">If the `~/App_Data/aspnet.mdf` database does not exist, the ASP.NET runtime will automatically create it and add the application services schema.</span></span> <span data-ttu-id="c39d8-176">但是，我们不想使用`aspnet.mdf`数据库; 相反，我们想要使用`SecurityTutorials.mdf`我们已经创建并添加到应用程序服务架构的数据库。</span><span class="sxs-lookup"><span data-stu-id="c39d8-176">However, we don't want to use the `aspnet.mdf` database; rather, we want to use the `SecurityTutorials.mdf` database that we have already created and added the application services schema to.</span></span> <span data-ttu-id="c39d8-177">此修改，可以处于两种方式之一实现：</span><span class="sxs-lookup"><span data-stu-id="c39d8-177">This modification can be accomplished in one of two ways:</span></span>

- <span data-ttu-id="c39d8-178">**指定的值 * * *`LocalSqlServer`* * * 中的连接字符串名称 * * *`Web.config`* * *。**</span><span class="sxs-lookup"><span data-stu-id="c39d8-178">**Specify a value for the****`LocalSqlServer`****connection string name in****`Web.config`****.**</span></span> <span data-ttu-id="c39d8-179">通过覆盖`LocalSqlServer`连接字符串名称值中的`Web.config`，我们可以使用注册的默认角色提供程序 (`AspNetSqlRoleProvider`)，并将其正确使用`SecurityTutorials.mdf`数据库。</span><span class="sxs-lookup"><span data-stu-id="c39d8-179">By overwriting the `LocalSqlServer` connection string name value in `Web.config`, we can use the default registered Roles provider (`AspNetSqlRoleProvider`) and have it correctly work with the `SecurityTutorials.mdf` database.</span></span> <span data-ttu-id="c39d8-180">有关此技术的详细信息，请参阅[Scott Guthrie](https://weblogs.asp.net/scottgu/)的博客文章[配置 ASP.NET 2.0 应用程序服务添加到使用 SQL Server 2000 或 SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c39d8-180">For more information on this technique, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog post, [Configuring ASP.NET 2.0 Application Services to Use SQL Server 2000 or SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span></span>
- <span data-ttu-id="c39d8-181">**添加新的已注册提供程序的类型 * * *`SqlRoleProvider`* * * 并配置其 * * *`connectionStringName`* * * 设置为指向 * * *`SecurityTutorials.mdf`* * * 数据库。**</span><span class="sxs-lookup"><span data-stu-id="c39d8-181">**Add a new registered provider of type****`SqlRoleProvider`****and configure its****`connectionStringName`****setting to point to the****`SecurityTutorials.mdf`****database.**</span></span> <span data-ttu-id="c39d8-182">这是我建议并在中使用的方法<a id="_msoanchor_7"> </a> [*在 SQL Server 中创建成员身份架构*](../membership/creating-the-membership-schema-in-sql-server-vb.md)教程中，也是如此 I will use 以及本教程中使用的方法。</span><span class="sxs-lookup"><span data-stu-id="c39d8-182">This is the approach I recommended and used in the <a id="_msoanchor_7"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial, and it is the approach I will use in this tutorial as well.</span></span>

<span data-ttu-id="c39d8-183">添加到以下的角色配置标记`Web.config`文件。</span><span class="sxs-lookup"><span data-stu-id="c39d8-183">Add the following Roles configuration markup to the `Web.config` file.</span></span> <span data-ttu-id="c39d8-184">此标记注册新的提供程序名为`SecurityTutorialsSqlRoleProvider.`</span><span class="sxs-lookup"><span data-stu-id="c39d8-184">This markup registers a new provider named `SecurityTutorialsSqlRoleProvider.`</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample5.xml)]

<span data-ttu-id="c39d8-185">上面的标记定义`SecurityTutorialsSqlRoleProvider`作为默认提供程序 (通过`defaultProvider`属性中`<roleManager>`元素)。</span><span class="sxs-lookup"><span data-stu-id="c39d8-185">The above markup defines the `SecurityTutorialsSqlRoleProvider` as the default provider (via the `defaultProvider` attribute in the `<roleManager>` element).</span></span> <span data-ttu-id="c39d8-186">它还将设置`SecurityTutorialsSqlRoleProvider`的`applicationName`将设置为`SecurityTutorials`，即相同`applicationName`使用成员资格提供程序的设置 (`SecurityTutorialsSqlMembershipProvider`)。</span><span class="sxs-lookup"><span data-stu-id="c39d8-186">It also sets the `SecurityTutorialsSqlRoleProvider`'s `applicationName` setting to `SecurityTutorials`, which is the same `applicationName` setting used by the Membership provider (`SecurityTutorialsSqlMembershipProvider`).</span></span> <span data-ttu-id="c39d8-187">而不显示在这里， [ `<add>`元素](https://msdn.microsoft.com/en-us/library/ms164662.aspx)为`SqlRoleProvider`还可能包含`commandTimeout`特性来指定数据库超时持续时间，以秒为单位。</span><span class="sxs-lookup"><span data-stu-id="c39d8-187">While not shown here, the [`<add>` element](https://msdn.microsoft.com/en-us/library/ms164662.aspx) for the `SqlRoleProvider` may also contain a `commandTimeout` attribute to specify the database timeout duration, in seconds.</span></span> <span data-ttu-id="c39d8-188">默认值为 30。</span><span class="sxs-lookup"><span data-stu-id="c39d8-188">The default value is 30.</span></span>

<span data-ttu-id="c39d8-189">此就地配置标记中，我们现在可以开始使用我们的应用程序中的角色功能。</span><span class="sxs-lookup"><span data-stu-id="c39d8-189">With this configuration markup in place, we are ready to start using role functionality within our application.</span></span>

> [!NOTE]
> <span data-ttu-id="c39d8-190">上面的配置代码演示如何使用`<roleManager>`元素的`enabled`和`defaultProvider`属性。</span><span class="sxs-lookup"><span data-stu-id="c39d8-190">The above configuration markup illustrates using the `<roleManager>` element's `enabled` and `defaultProvider` attributes.</span></span> <span data-ttu-id="c39d8-191">有多个其他影响角色 framework 如何将基于用户的用户的角色信息相关联的特性。</span><span class="sxs-lookup"><span data-stu-id="c39d8-191">There are a number of other attributes that affect how the Roles framework associates role information on a user-by-user basis.</span></span> <span data-ttu-id="c39d8-192">我们将检查这些设置位于<a id="_msoanchor_8"> </a> [*基于角色的授权*](role-based-authorization-vb.md)教程。</span><span class="sxs-lookup"><span data-stu-id="c39d8-192">We will examine these settings in the <a id="_msoanchor_8"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial.</span></span>


## <a name="step-3-examining-the-roles-api"></a><span data-ttu-id="c39d8-193">第 3 步： 检查角色 API</span><span class="sxs-lookup"><span data-stu-id="c39d8-193">Step 3: Examining the Roles API</span></span>

<span data-ttu-id="c39d8-194">角色框架的功能公开通过[`Roles`类](https://msdn.microsoft.com/en-us/library/system.web.security.roles.aspx)，其中包含十三个共享的方法，用于执行基于角色的操作。</span><span class="sxs-lookup"><span data-stu-id="c39d8-194">The Roles framework's functionality is exposed via the [`Roles` class](https://msdn.microsoft.com/en-us/library/system.web.security.roles.aspx), which contains thirteen shared methods for performing role-based operations.</span></span> <span data-ttu-id="c39d8-195">当我们看一下创建和删除在步骤 4 中的角色和 6 我们将使用[ `CreateRole` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.createrole.aspx)和[ `DeleteRole` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.deleterole.aspx)方法，它们将添加或从系统中删除角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-195">When we look at creating and deleting roles in Steps 4 and 6 we will use the [`CreateRole`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.createrole.aspx) and [`DeleteRole`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.deleterole.aspx) methods, which add or remove a role from the system.</span></span>

<span data-ttu-id="c39d8-196">若要获取系统中的所有角色的列表，请使用[`GetAllRoles`方法](https://msdn.microsoft.com/en-us/library/system.web.security.roles.getallroles.aspx)（请参阅步骤 5）。</span><span class="sxs-lookup"><span data-stu-id="c39d8-196">To get a list of all of the roles in the system, use the [`GetAllRoles` method](https://msdn.microsoft.com/en-us/library/system.web.security.roles.getallroles.aspx) (see Step 5).</span></span> <span data-ttu-id="c39d8-197">[ `RoleExists`方法](https://msdn.microsoft.com/en-us/library/system.web.security.roles.roleexists.aspx)返回一个布尔值，该值指示是否存在指定的角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-197">The [`RoleExists` method](https://msdn.microsoft.com/en-us/library/system.web.security.roles.roleexists.aspx) returns a Boolean value indicating whether a specified role exists.</span></span>

<span data-ttu-id="c39d8-198">在下一教程中，我们将检查如何将用户与角色关联。</span><span class="sxs-lookup"><span data-stu-id="c39d8-198">In the next tutorial we will examine how to associate users with roles.</span></span> <span data-ttu-id="c39d8-199">`Roles`类的[ `AddUserToRole` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.addusertorole.aspx)， [ `AddUserToRoles` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.addusertoroles.aspx)， [ `AddUsersToRole` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.adduserstorole.aspx)，和[ `AddUsersToRoles` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.adduserstoroles.aspx)方法将一个或多个用户添加到一个或多个角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-199">The `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.addusertorole.aspx), [`AddUserToRoles`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.addusertoroles.aspx), [`AddUsersToRole`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.adduserstorole.aspx), and [`AddUsersToRoles`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.adduserstoroles.aspx) methods add one or more users to one or more roles.</span></span> <span data-ttu-id="c39d8-200">若要从角色中删除用户，使用[ `RemoveUserFromRole` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.removeuserfromrole.aspx)， [ `RemoveUserFromRoles` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.removeuserfromroles.aspx)， [ `RemoveUsersFromRole` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.removeusersfromrole.aspx)，或[ `RemoveUsersFromRoles` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.removeusersfromroles.aspx)方法。</span><span class="sxs-lookup"><span data-stu-id="c39d8-200">To remove users from roles, use the [`RemoveUserFromRole`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.removeuserfromrole.aspx), [`RemoveUserFromRoles`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.removeuserfromroles.aspx), [`RemoveUsersFromRole`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.removeusersfromrole.aspx), or [`RemoveUsersFromRoles`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.removeusersfromroles.aspx) methods.</span></span>

<span data-ttu-id="c39d8-201">在<a id="_msoanchor_9"> </a> [*基于角色的授权*](role-based-authorization-vb.md)我们将了解如何以编程方式显示或隐藏基于当前登录的用户的角色的功能的教程。</span><span class="sxs-lookup"><span data-stu-id="c39d8-201">In the <a id="_msoanchor_9"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial we will look at ways to programmatically show or hide functionality based on the currently logged in user's role.</span></span> <span data-ttu-id="c39d8-202">若要实现此目的，我们可以使用角色类的[ `FindUsersInRole` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.findusersinrole.aspx)， [ `GetRolesForUser` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.getrolesforuser.aspx)， [ `GetUsersInRole` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.getusersinrole.aspx)，或[ `IsUserInRole` ](https://msdn.microsoft.com/en-us/library/system.web.security.roles.isuserinrole.aspx)方法。</span><span class="sxs-lookup"><span data-stu-id="c39d8-202">To accomplish this, we can use the Role class's [`FindUsersInRole`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.findusersinrole.aspx), [`GetRolesForUser`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.getrolesforuser.aspx), [`GetUsersInRole`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.getusersinrole.aspx), or [`IsUserInRole`](https://msdn.microsoft.com/en-us/library/system.web.security.roles.isuserinrole.aspx) methods.</span></span>

> [!NOTE]
> <span data-ttu-id="c39d8-203">请记住，则调用的任何时间下列方法之一，`Roles`类将调用委托给配置的提供程序。</span><span class="sxs-lookup"><span data-stu-id="c39d8-203">Keep in mind that any time one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="c39d8-204">在本例中，这意味着发送到调用`SqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-204">In our case, this means that the call is being sent to the `SqlRoleProvider`.</span></span> <span data-ttu-id="c39d8-205">`SqlRoleProvider`然后执行相应的数据库操作基于调用的方法。</span><span class="sxs-lookup"><span data-stu-id="c39d8-205">The `SqlRoleProvider` then performs the appropriate database operation based on the invoked method.</span></span> <span data-ttu-id="c39d8-206">例如，代码`Roles.CreateRole("Administrators")`导致`SqlRoleProvider`执行`aspnet_Roles_CreateRole`存储过程，它插入一条新记录到`aspnet_Roles`表名为管理员。</span><span class="sxs-lookup"><span data-stu-id="c39d8-206">For example, the code `Roles.CreateRole("Administrators")` results in the `SqlRoleProvider` executing the `aspnet_Roles_CreateRole` stored procedure, which inserts a new record into the `aspnet_Roles` table named Administrators .</span></span>


<span data-ttu-id="c39d8-207">本教程的其余部分考察使用`Roles`类的`CreateRole`， `GetAllRoles`，和`DeleteRole`方法来管理系统中的角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-207">The remainder of this tutorial looks at using the `Roles` class's `CreateRole`, `GetAllRoles`, and `DeleteRole` methods to manage the roles in the system.</span></span>

## <a name="step-4-creating-new-roles"></a><span data-ttu-id="c39d8-208">步骤 4： 创建新的角色</span><span class="sxs-lookup"><span data-stu-id="c39d8-208">Step 4: Creating New Roles</span></span>

<span data-ttu-id="c39d8-209">角色提供了一个方法向任意组用户，并且通常情况下此分组适用于更加方便地将授权规则。</span><span class="sxs-lookup"><span data-stu-id="c39d8-209">Roles offer a way to arbitrarily group users, and most commonly this grouping is used for a more convenient way to apply authorization rules.</span></span> <span data-ttu-id="c39d8-210">但若要使用角色作为一种授权机制我们首先需要定义应用程序中有哪些角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-210">But in order to use roles as an authorization mechanism we first need to define what roles exist in the application.</span></span> <span data-ttu-id="c39d8-211">遗憾的是，ASP.NET 不包括 CreateRoleWizard 控件。</span><span class="sxs-lookup"><span data-stu-id="c39d8-211">Unfortunately, ASP.NET does not include a CreateRoleWizard control.</span></span> <span data-ttu-id="c39d8-212">为了添加新角色，我们需要创建一个合适的用户界面和自行调用角色 API。</span><span class="sxs-lookup"><span data-stu-id="c39d8-212">In order to add new roles we need to create a suitable user interface and invoke the Roles API ourselves.</span></span> <span data-ttu-id="c39d8-213">好消息是，这是非常轻松地完成。</span><span class="sxs-lookup"><span data-stu-id="c39d8-213">The good news is that this is very easy to accomplish.</span></span>

> [!NOTE]
> <span data-ttu-id="c39d8-214">尽管没有 CreateRoleWizard Web 控件，但还有[ASP.NET 网站管理工具](https://msdn.microsoft.com/en-us/library/ms228053.aspx)，这是本地 ASP.NET 应用程序，旨在帮助查看和管理 web 应用程序的配置。</span><span class="sxs-lookup"><span data-stu-id="c39d8-214">While there is no CreateRoleWizard Web control, there is the [ASP.NET Web Site Administration Tool](https://msdn.microsoft.com/en-us/library/ms228053.aspx), which is a local ASP.NET application designed to assist with viewing and managing your web application's configuration.</span></span> <span data-ttu-id="c39d8-215">但是，我不是以下两个原因非常热衷于 ASP.NET 网站管理工具。</span><span class="sxs-lookup"><span data-stu-id="c39d8-215">However, I am not a big fan of the ASP.NET Web Site Administration Tool for two reasons.</span></span> <span data-ttu-id="c39d8-216">首先，有点错误并且用户体验离开大量需要改进。</span><span class="sxs-lookup"><span data-stu-id="c39d8-216">First, it is a bit buggy and the user experience leaves a lot to be desired.</span></span> <span data-ttu-id="c39d8-217">其次，ASP.NET 网站管理工具旨在仅在本地运行，这意味着，您将需要生成你自己的角色管理网页，如果你需要远程管理实时网站上的角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-217">Second, the ASP.NET Web Site Administration Tool is designed to only work locally, meaning that you will have to build your own role management web pages if you need to manage roles on a live site remotely.</span></span> <span data-ttu-id="c39d8-218">有关这两个原因，本教程和下一步将专注于构建在网页中的管理工具的必要角色，而不是依赖于 ASP.NET 网站管理工具。</span><span class="sxs-lookup"><span data-stu-id="c39d8-218">For these two reasons, this tutorial and the next will focus on building the necessary role management tools in a web page rather than relying on the ASP.NET Web Site Administration Tool.</span></span>


<span data-ttu-id="c39d8-219">打开`ManageRoles.aspx`页面`Roles`文件夹并向页面添加一个文本框和按钮 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="c39d8-219">Open the `ManageRoles.aspx` page in the `Roles` folder and add a TextBox and a Button Web control to the page.</span></span> <span data-ttu-id="c39d8-220">设置文本框中控件的`ID`属性`RoleName`和按钮的`ID`和`Text`属性设置为`CreateRoleButton`和创建角色，分别。</span><span class="sxs-lookup"><span data-stu-id="c39d8-220">Set the TextBox control's `ID` property to `RoleName` and the Button's `ID` and `Text` properties to `CreateRoleButton` and Create Role, respectively.</span></span> <span data-ttu-id="c39d8-221">此时，页面的声明性标记应类似以下：</span><span class="sxs-lookup"><span data-stu-id="c39d8-221">At this point, your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample6.aspx)]

<span data-ttu-id="c39d8-222">接下来，双击`CreateRoleButton`按钮在设计器中创建的控件`Click`事件处理程序，然后添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="c39d8-222">Next, double-click the `CreateRoleButton` Button control in the Designer to create a `Click` event handler and then add the following code:</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample7.vb)]

<span data-ttu-id="c39d8-223">通过分配中输入的裁剪后的角色名称来启动上面的代码`RoleName`到文本框中`newRoleName`变量。</span><span class="sxs-lookup"><span data-stu-id="c39d8-223">The above code starts by assigning the trimmed role name entered in the `RoleName` TextBox to the `newRoleName` variable.</span></span> <span data-ttu-id="c39d8-224">接下来，`Roles`类的`RoleExists`调用方法来确定如果角色`newRoleName`系统中已存在。</span><span class="sxs-lookup"><span data-stu-id="c39d8-224">Next, the `Roles` class's `RoleExists` method is called to determine if the role `newRoleName` already exists in the system.</span></span> <span data-ttu-id="c39d8-225">如果该角色不存在，则创建它通过调用`CreateRole`方法。</span><span class="sxs-lookup"><span data-stu-id="c39d8-225">If the role does not exist, it is created via a call to the `CreateRole` method.</span></span> <span data-ttu-id="c39d8-226">如果`CreateRole`方法传递在系统中，已存在的角色名称`ProviderException`引发异常。</span><span class="sxs-lookup"><span data-stu-id="c39d8-226">If the `CreateRole` method is passed a role name that already exists in the system, a `ProviderException` exception is thrown.</span></span> <span data-ttu-id="c39d8-227">这就是为什么代码将首先检查，以确保该角色已中不存在的系统，然后调用`CreateRole`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-227">This is why the code first checks to ensure that the role does not already exist in the system before calling `CreateRole`.</span></span> <span data-ttu-id="c39d8-228">`Click`事件处理程序结束清除`RoleName`文本框的`Text`属性。</span><span class="sxs-lookup"><span data-stu-id="c39d8-228">The `Click` event handler concludes by clearing out the `RoleName` TextBox's `Text` property.</span></span>

> [!NOTE]
> <span data-ttu-id="c39d8-229">你可能想知道将发生如果用户不输入任何值转换为`RoleName`文本框。</span><span class="sxs-lookup"><span data-stu-id="c39d8-229">You may be wondering what will happen if the user doesn't enter any value into the `RoleName` TextBox.</span></span> <span data-ttu-id="c39d8-230">如果值传递给`CreateRole`方法是`Nothing`或空字符串，异常引发。</span><span class="sxs-lookup"><span data-stu-id="c39d8-230">If the value passed into the `CreateRole` method is `Nothing` or an empty string, an exception is raised.</span></span> <span data-ttu-id="c39d8-231">同样，如果角色名称包含逗号被引发异常。</span><span class="sxs-lookup"><span data-stu-id="c39d8-231">Likewise, if the role name contains a comma an exception is raised.</span></span> <span data-ttu-id="c39d8-232">因此，页面应包含验证控件，以确保用户输入角色，并且它不包含任何逗号。</span><span class="sxs-lookup"><span data-stu-id="c39d8-232">Consequently, the page should contain validation controls to ensure that the user enters a role and that it does not contain any commas.</span></span> <span data-ttu-id="c39d8-233">我将保留为练习为读取器。</span><span class="sxs-lookup"><span data-stu-id="c39d8-233">I leave as an exercise for the reader.</span></span>


<span data-ttu-id="c39d8-234">让我们创建一个名为管理员角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-234">Let's create a role named Administrators.</span></span> <span data-ttu-id="c39d8-235">请访问`ManageRoles.aspx`通过浏览器页上，在文本框中键入管理员中 （请参见图 3），然后单击创建角色按钮。</span><span class="sxs-lookup"><span data-stu-id="c39d8-235">Visit the `ManageRoles.aspx` page through a browser, type in Administrators into the textbox (see Figure 3), and then click the Create Role button.</span></span>


<span data-ttu-id="c39d8-236">[![创建管理员角色](creating-and-managing-roles-vb/_static/image8.png)](creating-and-managing-roles-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c39d8-236">[![Create an Administrators Role](creating-and-managing-roles-vb/_static/image8.png)](creating-and-managing-roles-vb/_static/image7.png)</span></span>

<span data-ttu-id="c39d8-237">**图 3**： 创建管理员角色 ([单击以查看实际尺寸的图像](creating-and-managing-roles-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="c39d8-237">**Figure 3**: Create an Administrators Role  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image9.png))</span></span>


<span data-ttu-id="c39d8-238">发生什么情况？</span><span class="sxs-lookup"><span data-stu-id="c39d8-238">What happens?</span></span> <span data-ttu-id="c39d8-239">产生的回发，但没有任何视觉提示，角色实际上已被添加到系统。</span><span class="sxs-lookup"><span data-stu-id="c39d8-239">A postback occurs, but there's no visual cue that the role has actually been added to the system.</span></span> <span data-ttu-id="c39d8-240">我们将更新此页面，在步骤 5 中包括的视觉反馈。</span><span class="sxs-lookup"><span data-stu-id="c39d8-240">We will update this page in Step 5 to include visual feedback.</span></span> <span data-ttu-id="c39d8-241">现在，但是，您可以验证该角色的创建通过转到`SecurityTutorials.mdf`数据库和显示从数据`aspnet_Roles`表。</span><span class="sxs-lookup"><span data-stu-id="c39d8-241">For now, however, you can verify that the role was created by going to the `SecurityTutorials.mdf` database and displaying the data from the `aspnet_Roles` table.</span></span> <span data-ttu-id="c39d8-242">如图 4 所示，`aspnet_Roles`表包含刚添加管理员角色的记录。</span><span class="sxs-lookup"><span data-stu-id="c39d8-242">As Figure 4 shows, the `aspnet_Roles` table contains a record for the just-added Administrators roles.</span></span>


<span data-ttu-id="c39d8-243">[![Aspnet_Roles 表对于管理员，有一个行](creating-and-managing-roles-vb/_static/image11.png)](creating-and-managing-roles-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c39d8-243">[![The aspnet_Roles Table has a Row for the Administrators](creating-and-managing-roles-vb/_static/image11.png)](creating-and-managing-roles-vb/_static/image10.png)</span></span>

<span data-ttu-id="c39d8-244">**图 4**:`aspnet_Roles`表具有一个行的管理员 ([单击以查看实际尺寸的图像](creating-and-managing-roles-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="c39d8-244">**Figure 4**: The `aspnet_Roles` Table has a Row for the Administrators  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image12.png))</span></span>


## <a name="step-5-displaying-the-roles-in-the-system"></a><span data-ttu-id="c39d8-245">步骤 5： 在系统中显示的角色</span><span class="sxs-lookup"><span data-stu-id="c39d8-245">Step 5: Displaying the Roles in the System</span></span>

<span data-ttu-id="c39d8-246">让我们增加`ManageRoles.aspx`页以包含在系统中的当前角色的列表。</span><span class="sxs-lookup"><span data-stu-id="c39d8-246">Let's augment the `ManageRoles.aspx` page to include a list of the current roles in the system.</span></span> <span data-ttu-id="c39d8-247">若要完成此操作，将 GridView 控件添加到页并设置其`ID`属性`RoleList`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-247">To accomplish this, add a GridView control to the page and set its `ID` property to `RoleList`.</span></span> <span data-ttu-id="c39d8-248">接下来，将方法添加到页面的代码隐藏类名为`DisplayRolesInGrid`使用下面的代码：</span><span class="sxs-lookup"><span data-stu-id="c39d8-248">Next, add a method to the page's code-behind class named `DisplayRolesInGrid` using the following code:</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample8.vb)]

<span data-ttu-id="c39d8-249">`Roles`类的`GetAllRoles`方法的所有角色系统中作为返回的字符串数组。</span><span class="sxs-lookup"><span data-stu-id="c39d8-249">The `Roles` class's `GetAllRoles` method returns all of the roles in the system as an array of strings.</span></span> <span data-ttu-id="c39d8-250">此字符串数组，然后绑定到 GridView。</span><span class="sxs-lookup"><span data-stu-id="c39d8-250">This string array is then bound to the GridView.</span></span> <span data-ttu-id="c39d8-251">若要将角色列表绑定到 GridView，首次加载页时，我们需要调用`DisplayRolesInGrid`方法从该页面的`Page_Load`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="c39d8-251">In order to bind the list of roles to the GridView when the page is first loaded, we need to call the `DisplayRolesInGrid` method from the page's `Page_Load` event handler.</span></span> <span data-ttu-id="c39d8-252">下面的代码调用此方法时首次访问页，但不是能在后续回发。</span><span class="sxs-lookup"><span data-stu-id="c39d8-252">The following code calls this method when the page is first visited, but not on subsequent postbacks.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample9.vb)]

<span data-ttu-id="c39d8-253">使用此代码中的位置，请访问通过浏览器页面。</span><span class="sxs-lookup"><span data-stu-id="c39d8-253">With this code in place, visit the page through a browser.</span></span> <span data-ttu-id="c39d8-254">如图 5 所示，你应看到与标记为项的单个列的网格。</span><span class="sxs-lookup"><span data-stu-id="c39d8-254">As Figure 5 shows, you should see a grid with a single column labeled Item.</span></span> <span data-ttu-id="c39d8-255">网格包括我们在步骤 4 中添加的管理员角色的行。</span><span class="sxs-lookup"><span data-stu-id="c39d8-255">The grid includes a row for the Administrators role we added in Step 4.</span></span>


<span data-ttu-id="c39d8-256">[![GridView 单个列中显示的角色](creating-and-managing-roles-vb/_static/image14.png)](creating-and-managing-roles-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c39d8-256">[![The GridView Displays the Roles in a Single Column](creating-and-managing-roles-vb/_static/image14.png)](creating-and-managing-roles-vb/_static/image13.png)</span></span>

<span data-ttu-id="c39d8-257">**图 5**: GridView 单个列中显示的角色 ([单击以查看实际尺寸的图像](creating-and-managing-roles-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="c39d8-257">**Figure 5**: The GridView Displays the Roles in a Single Column  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image15.png))</span></span>


<span data-ttu-id="c39d8-258">GridView 显示一个标记为项，因为的唯一列的 GridView`AutoGenerateColumns`属性设置为 True （默认值），这会导致 GridView 自动创建列中每个属性及其`DataSource`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-258">The GridView displays a lone column labeled Item because the GridView's `AutoGenerateColumns` property is set to True (the default), which causes the GridView to automatically create a column for each property in its `DataSource`.</span></span> <span data-ttu-id="c39d8-259">数组具有一个属性，表示在 GridView 的单个列的数组，因此中的元素。</span><span class="sxs-lookup"><span data-stu-id="c39d8-259">An array has a single property that represents the elements in the array, hence the single column in the GridView.</span></span>

<span data-ttu-id="c39d8-260">显示与一个 GridView 的数据时，我愿意显式定义列，而不能将其隐式生成的 GridView。</span><span class="sxs-lookup"><span data-stu-id="c39d8-260">When displaying data with a GridView, I prefer to explicitly define my columns rather than have them implicitly generated by the GridView.</span></span> <span data-ttu-id="c39d8-261">通过显式定义列就可以更轻松地设置数据格式、 重新排列列，以及执行其他常见任务。</span><span class="sxs-lookup"><span data-stu-id="c39d8-261">By explicitly defining the columns it is much easier to format the data, rearrange the columns, and perform other common tasks.</span></span> <span data-ttu-id="c39d8-262">因此，让我们更新 GridView 的声明性标记，以便其列显式定义如此。</span><span class="sxs-lookup"><span data-stu-id="c39d8-262">Therefore, let's update the GridView's declarative markup so that its columns are explicitly defined.</span></span>

<span data-ttu-id="c39d8-263">通过设置 GridView 的启动`AutoGenerateColumns`属性设置为 False。</span><span class="sxs-lookup"><span data-stu-id="c39d8-263">Start by setting the GridView's `AutoGenerateColumns` property to False.</span></span> <span data-ttu-id="c39d8-264">接下来，将为 TemplateField 添加到网格中，设置其`HeaderText`属性角色，并配置其`ItemTemplate`，使其显示数组的内容。</span><span class="sxs-lookup"><span data-stu-id="c39d8-264">Next, add a TemplateField to the grid, set its `HeaderText` property to Roles, and configure its `ItemTemplate` so that it displays the contents of the array.</span></span> <span data-ttu-id="c39d8-265">若要完成此操作，将添加一个名为的标签 Web 控件`RoleNameLabel`到`ItemTemplate`并将绑定其`Text`属性`Container.DataItem.`</span><span class="sxs-lookup"><span data-stu-id="c39d8-265">To accomplish this, add a Label Web control named `RoleNameLabel` to the `ItemTemplate` and bind its `Text` property to `Container.DataItem.`</span></span>

<span data-ttu-id="c39d8-266">这些属性和`ItemTemplate`的内容可以设置以声明方式或通过 GridView 的字段对话框和编辑模板接口。</span><span class="sxs-lookup"><span data-stu-id="c39d8-266">These properties and the `ItemTemplate`'s contents can be set declaratively or through the GridView's Fields dialog box and Edit Templates interface.</span></span> <span data-ttu-id="c39d8-267">若要访问字段对话框中，单击 GridView 的智能标记中的编辑列链接。</span><span class="sxs-lookup"><span data-stu-id="c39d8-267">To reach the Fields dialog box, click the Edit Columns link in the GridView's Smart Tag.</span></span> <span data-ttu-id="c39d8-268">接下来，取消选中自动生成字段复选框以设置`AutoGenerateColumns`属性设置为 False，并将为 TemplateField 添加到 GridView，设置其`HeaderText`到角色的属性。</span><span class="sxs-lookup"><span data-stu-id="c39d8-268">Next, uncheck the Auto-generate fields checkbox to set the `AutoGenerateColumns` property to False, and add a TemplateField to the GridView, setting its `HeaderText` property to Role.</span></span> <span data-ttu-id="c39d8-269">若要定义`ItemTemplate`的内容，选择编辑模板选项从 GridView 的智能标记。</span><span class="sxs-lookup"><span data-stu-id="c39d8-269">To define the `ItemTemplate`'s contents, choose the Edit Templates option from the GridView's Smart Tag.</span></span> <span data-ttu-id="c39d8-270">将标签 Web 控件拖到`ItemTemplate`，将其`ID`属性`RoleNameLabel`，并配置其数据绑定设置，以便其`Text`属性绑定到`Container.DataItem`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-270">Drag a Label Web control onto the `ItemTemplate`, set its `ID` property to `RoleNameLabel`, and configure its databinding settings so that its `Text` property is bound to `Container.DataItem`.</span></span>

<span data-ttu-id="c39d8-271">无论你使用何种方法，GridView 的生成的声明性标记应类似于以下完成后。</span><span class="sxs-lookup"><span data-stu-id="c39d8-271">Regardless of what approach you use, the GridView's resulting declarative markup should look similar to the following when you are done.</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample10.aspx)]

> [!NOTE]
> <span data-ttu-id="c39d8-272">数组的内容显示使用的数据绑定语法`<%# Container.DataItem %>`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-272">The array's contents are displayed using the databinding syntax `<%# Container.DataItem %>`.</span></span> <span data-ttu-id="c39d8-273">当数组的内容显示绑定到 GridView 为什么使用此语法的全面说明是超出了本教程的范围。</span><span class="sxs-lookup"><span data-stu-id="c39d8-273">A thorough description of why this syntax is used when displaying the contents of an array bound to the GridView is beyond the scope of this tutorial.</span></span> <span data-ttu-id="c39d8-274">有关此问题的详细信息，请参阅[标量数组绑定到数据 Web 控件](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c39d8-274">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>


<span data-ttu-id="c39d8-275">目前， `RoleList` GridView 只能绑定到的角色列表，在首次访问页时。</span><span class="sxs-lookup"><span data-stu-id="c39d8-275">Currently, the `RoleList` GridView is only bound to the list of roles when the page is first visited.</span></span> <span data-ttu-id="c39d8-276">我们需要刷新该网格，无论何时添加新的角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-276">We need to refresh the grid whenever a new role is added.</span></span> <span data-ttu-id="c39d8-277">若要实现此目的，更新`CreateRoleButton`按钮的`Click`事件处理程序，使它调用`DisplayRolesInGrid`方法如果创建新的角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-277">To accomplish this, update the `CreateRoleButton` Button's `Click` event handler so that it calls the `DisplayRolesInGrid` method if a new role is created.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample11.vb)]

<span data-ttu-id="c39d8-278">现在当用户添加新角色`RoleList`GridView 回发时，显示刚才添加的角色提供角色已成功创建的视觉反馈。</span><span class="sxs-lookup"><span data-stu-id="c39d8-278">Now when the user adds a new role the `RoleList` GridView shows the just-added role on postback, providing visual feedback that the role was successfully created.</span></span> <span data-ttu-id="c39d8-279">若要说明这一点，请访问`ManageRoles.aspx`通过浏览器页上，添加一个名为主管角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-279">To illustrate this, visit the `ManageRoles.aspx` page through a browser and add a role named Supervisors.</span></span> <span data-ttu-id="c39d8-280">如果单击创建角色按钮，回发将随之发生和网格将会更新以包含管理员，以及新角色，主管。</span><span class="sxs-lookup"><span data-stu-id="c39d8-280">Upon clicking the Create Role button, a postback will ensue and the grid will update to include Administrators as well as the new role, Supervisors.</span></span>


<span data-ttu-id="c39d8-281">[![主管角色具有已添加](creating-and-managing-roles-vb/_static/image17.png)](creating-and-managing-roles-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="c39d8-281">[![The Supervisors Role has Been Added](creating-and-managing-roles-vb/_static/image17.png)](creating-and-managing-roles-vb/_static/image16.png)</span></span>

<span data-ttu-id="c39d8-282">**图 6**: 主管角色具有已添加 ([单击以查看实际尺寸的图像](creating-and-managing-roles-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="c39d8-282">**Figure 6**: The Supervisors Role has Been Added  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image18.png))</span></span>


## <a name="step-6-deleting-roles"></a><span data-ttu-id="c39d8-283">步骤 6： 删除角色</span><span class="sxs-lookup"><span data-stu-id="c39d8-283">Step 6: Deleting Roles</span></span>

<span data-ttu-id="c39d8-284">用户可以创建新的角色并查看中的所有现有角色此时`ManageRoles.aspx`页。</span><span class="sxs-lookup"><span data-stu-id="c39d8-284">At this point a user can create a new role and view all existing roles from the `ManageRoles.aspx` page.</span></span> <span data-ttu-id="c39d8-285">让我们允许用户还删除角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-285">Let's allow users to also delete roles.</span></span> <span data-ttu-id="c39d8-286">`Roles.DeleteRole`方法有两个重载：</span><span class="sxs-lookup"><span data-stu-id="c39d8-286">The `Roles.DeleteRole` method has two overloads:</span></span>

- <span data-ttu-id="c39d8-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/en-us/library/ek4sywc0.aspx)-删除角色*roleName*。</span><span class="sxs-lookup"><span data-stu-id="c39d8-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/en-us/library/ek4sywc0.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="c39d8-288">如果该角色包含一个或多个成员，将引发异常。</span><span class="sxs-lookup"><span data-stu-id="c39d8-288">An exception is thrown if the role contains one or more members.</span></span>
- <span data-ttu-id="c39d8-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/en-us/library/38h6wf59.aspx)-删除角色*roleName*。</span><span class="sxs-lookup"><span data-stu-id="c39d8-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/en-us/library/38h6wf59.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="c39d8-290">如果*throwOnPopulateRole*是`True`，则如果角色包含一个或多个成员引发异常。</span><span class="sxs-lookup"><span data-stu-id="c39d8-290">If *throwOnPopulateRole* is `True`, then an exception is thrown if the role contains one or more members.</span></span> <span data-ttu-id="c39d8-291">如果*throwOnPopulateRole*是`False`，然后是否它包含任何成员，或不删除此角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-291">If *throwOnPopulateRole* is `False`, then the role is deleted whether it contains any members or not.</span></span> <span data-ttu-id="c39d8-292">在内部，`DeleteRole(roleName)`方法调用`DeleteRole(roleName, True)`。</span><span class="sxs-lookup"><span data-stu-id="c39d8-292">Internally, the `DeleteRole(roleName)` method calls `DeleteRole(roleName, True)`.</span></span>

<span data-ttu-id="c39d8-293">`DeleteRole`方法将还会引发异常，如果*roleName*是`Nothing`或空字符串或如果*roleName*包含逗号。</span><span class="sxs-lookup"><span data-stu-id="c39d8-293">The `DeleteRole` method will also throw an exception if *roleName* is `Nothing` or an empty string or if *roleName* contains a comma.</span></span> <span data-ttu-id="c39d8-294">如果*roleName*不在系统中，存在`DeleteRole`以无提示方式，失败，且不引发异常。</span><span class="sxs-lookup"><span data-stu-id="c39d8-294">If *roleName* does not exist in the system, `DeleteRole` fails silently, without raising an exception.</span></span>

<span data-ttu-id="c39d8-295">让我们增加在 GridView`ManageRoles.aspx`以包括删除按钮，单击时，删除所选的角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-295">Let's augment the GridView in `ManageRoles.aspx` to include a Delete button that, when clicked, deletes the selected role.</span></span> <span data-ttu-id="c39d8-296">通过将删除按钮添加到 GridView，通过转到字段对话框中，并添加位于 CommandField 选项下的删除按钮开始。</span><span class="sxs-lookup"><span data-stu-id="c39d8-296">Start by adding a Delete button to the GridView by going to the Fields dialog box and adding a Delete button, which is located under the CommandField option.</span></span> <span data-ttu-id="c39d8-297">请删除按钮最左侧的列并设置其`DeleteText`到删除的角色的属性。</span><span class="sxs-lookup"><span data-stu-id="c39d8-297">Make the Delete button the far left column and set its `DeleteText` property to Delete Role .</span></span>


<span data-ttu-id="c39d8-298">[![将删除按钮添加到 RoleList GridView](creating-and-managing-roles-vb/_static/image20.png)](creating-and-managing-roles-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c39d8-298">[![Add a Delete Button to the RoleList GridView](creating-and-managing-roles-vb/_static/image20.png)](creating-and-managing-roles-vb/_static/image19.png)</span></span>

<span data-ttu-id="c39d8-299">**图 7**： 添加到一个删除按钮`RoleList`GridView ([单击以查看实际尺寸的图像](creating-and-managing-roles-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="c39d8-299">**Figure 7**: Add a Delete Button to the `RoleList` GridView  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image21.png))</span></span>


<span data-ttu-id="c39d8-300">添加删除按钮后, GridView 的声明性标记应看起来类似于以下：</span><span class="sxs-lookup"><span data-stu-id="c39d8-300">After adding the Delete button, your GridView's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample12.aspx)]

<span data-ttu-id="c39d8-301">接下来，为 GridView 创建事件处理程序`RowDeleting`事件。</span><span class="sxs-lookup"><span data-stu-id="c39d8-301">Next, create an event handler for the GridView's `RowDeleting` event.</span></span> <span data-ttu-id="c39d8-302">这是单击删除角色按钮时，在回发时引发的事件。</span><span class="sxs-lookup"><span data-stu-id="c39d8-302">This is the event that is raised on postback when the Delete Role button is clicked.</span></span> <span data-ttu-id="c39d8-303">将以下代码添加到该事件处理程序中。</span><span class="sxs-lookup"><span data-stu-id="c39d8-303">Add the following code to the event handler.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample13.vb)]

<span data-ttu-id="c39d8-304">通过以编程方式引用的代码启动`RoleNameLabel`Web 控件在其删除角色按钮被单击的行。</span><span class="sxs-lookup"><span data-stu-id="c39d8-304">The code starts by programmatically referencing the `RoleNameLabel` Web control in the row whose Delete Role button was clicked.</span></span> <span data-ttu-id="c39d8-305">`Roles.DeleteRole`然后调用方法，传入`Text`的`RoleNameLabel`和`False`，从而删除的角色，而不管是否有任何用户与角色关联。</span><span class="sxs-lookup"><span data-stu-id="c39d8-305">The `Roles.DeleteRole` method is then invoked, passing in the `Text` of the `RoleNameLabel` and `False`, thereby deleting the role regardless of whether there are any users associated with the role.</span></span> <span data-ttu-id="c39d8-306">最后， `RoleList` GridView 刷新，以便只删除角色不会再出现在网格中。</span><span class="sxs-lookup"><span data-stu-id="c39d8-306">Finally, the `RoleList` GridView is refreshed so that the just-deleted role no longer appears in the grid.</span></span>

> [!NOTE]
> <span data-ttu-id="c39d8-307">删除角色按钮不需要任何种类的用户从在删除角色之前的确认。</span><span class="sxs-lookup"><span data-stu-id="c39d8-307">The Delete Role button does not require any sort of confirmation from the user before deleting the role.</span></span> <span data-ttu-id="c39d8-308">确认某项操作的最简单方法之一是通过客户端确认对话框。</span><span class="sxs-lookup"><span data-stu-id="c39d8-308">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="c39d8-309">有关此技术的详细信息，请参阅[删除时添加客户端确认](https://asp.net/learn/data-access/tutorial-42-vb.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c39d8-309">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-vb.aspx).</span></span>


## <a name="summary"></a><span data-ttu-id="c39d8-310">摘要</span><span class="sxs-lookup"><span data-stu-id="c39d8-310">Summary</span></span>

<span data-ttu-id="c39d8-311">许多 web 应用程序具有特定的授权规则或仅适用于特定类别的用户正在的页级功能。</span><span class="sxs-lookup"><span data-stu-id="c39d8-311">Many web applications have certain authorization rules or page-level functionality that is only available to certain classes of users.</span></span> <span data-ttu-id="c39d8-312">例如，可能有一套只有管理员才能访问的网页。</span><span class="sxs-lookup"><span data-stu-id="c39d8-312">For example, there may be a set of web pages that only administrators can access.</span></span> <span data-ttu-id="c39d8-313">而不是基于用户的用户定义这些授权规则，通常很多有用定义基于角色的规则。</span><span class="sxs-lookup"><span data-stu-id="c39d8-313">Rather than defining these authorization rules on a user-by-user basis, oftentimes it is more useful to define the rules based on a role.</span></span> <span data-ttu-id="c39d8-314">即，而不是显式允许用户访问管理的网页，Scott 并 Jisun，更易于维护的方法是允许的管理员角色的成员才能访问这些页面中，然后为用户属于表示 Scott 和 Jisun管理员角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-314">That is, rather than explicitly allowing users Scott and Jisun to access the administrative web pages, a more maintainable approach is to permit members of the Administrators role to access these pages, and then to denote Scott and Jisun as users belonging to the Administrators role.</span></span>

<span data-ttu-id="c39d8-315">角色框架，可以轻松地创建和管理角色。</span><span class="sxs-lookup"><span data-stu-id="c39d8-315">The Roles framework makes it easy to create and manage roles.</span></span> <span data-ttu-id="c39d8-316">在本教程中，我们将探讨如何配置要使用的角色 framework `SqlRoleProvider`，它使用 Microsoft SQL Server 数据库作为角色存储。</span><span class="sxs-lookup"><span data-stu-id="c39d8-316">In this tutorial we examined how to configure the Roles framework to use the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span> <span data-ttu-id="c39d8-317">我们还创建一个网页，列出系统中的现有角色，并允许新角色，以创建和现有的要删除。</span><span class="sxs-lookup"><span data-stu-id="c39d8-317">We also created a web page that lists the existing roles in the system and allows for new roles to be created and existing ones to be deleted.</span></span> <span data-ttu-id="c39d8-318">在后续教程中，我们将看到如何将用户分配到角色以及如何将应用基于角色的授权。</span><span class="sxs-lookup"><span data-stu-id="c39d8-318">In subsequent tutorials we will see how to assign users to roles and how to apply role-based authorization.</span></span>

<span data-ttu-id="c39d8-319">尽情享受编程 ！</span><span class="sxs-lookup"><span data-stu-id="c39d8-319">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="c39d8-320">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="c39d8-320">Further Reading</span></span>

<span data-ttu-id="c39d8-321">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="c39d8-321">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="c39d8-322">检查 ASP.NET 2.0 的成员资格、 角色和配置文件</span><span class="sxs-lookup"><span data-stu-id="c39d8-322">Examining ASP.NET 2.0's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="c39d8-323">如何： 在 ASP.NET 2.0 中使用角色管理器</span><span class="sxs-lookup"><span data-stu-id="c39d8-323">How To: Use Role Manager in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/en-us/library/ms998314.aspx)
- [<span data-ttu-id="c39d8-324">角色提供程序</span><span class="sxs-lookup"><span data-stu-id="c39d8-324">Role Providers</span></span>](https://msdn.microsoft.com/en-us/library/aa478950.aspx)
- [<span data-ttu-id="c39d8-325">滚动你自己的网站管理工具</span><span class="sxs-lookup"><span data-stu-id="c39d8-325">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="c39d8-326">技术文档`<roleManager>`元素</span><span class="sxs-lookup"><span data-stu-id="c39d8-326">Technical documentation for the `<roleManager>` Element</span></span>](https://msdn.microsoft.com/en-us/library/ms164660.aspx)
- [<span data-ttu-id="c39d8-327">使用成员资格和角色管理器 Api</span><span class="sxs-lookup"><span data-stu-id="c39d8-327">Using the Membership and Role Manager APIs</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/security/membership.aspx)

### <a name="about-the-author"></a><span data-ttu-id="c39d8-328">关于作者</span><span class="sxs-lookup"><span data-stu-id="c39d8-328">About the Author</span></span>

<span data-ttu-id="c39d8-329">Scott Mitchell，多个 ASP/ASP.NET 丛书的作者和创始人 4GuysFromRolla.com，具有已使用自 1998 年 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="c39d8-329">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c39d8-330">Scott 的作用是作为独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="c39d8-330">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c39d8-331">最新书籍是 *[Sam 教授自己 ASP.NET 2.0 24 小时内](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*。</span><span class="sxs-lookup"><span data-stu-id="c39d8-331">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="c39d8-332">可以在达到 Scott [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)或通过在其博客地址[http://ScottOnWriting.NET](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="c39d8-332">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="c39d8-333">特别感谢</span><span class="sxs-lookup"><span data-stu-id="c39d8-333">Special Thanks To</span></span>

<span data-ttu-id="c39d8-334">本教程系列已由许多有用的审阅者评审。</span><span class="sxs-lookup"><span data-stu-id="c39d8-334">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c39d8-335">本教程中的前导审阅者包括 Alicja Maziarz、 Suchi Banerjee 和 Teresa 墨。</span><span class="sxs-lookup"><span data-stu-id="c39d8-335">Lead reviewers for this tutorial include Alicja Maziarz, Suchi Banerjee, and Teresa Murphy.</span></span> <span data-ttu-id="c39d8-336">对感兴趣查看我即将到来的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="c39d8-336">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c39d8-337">如果是这样，删除我一行[mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c39d8-337">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="c39d8-338">[上一页](role-based-authorization-cs.md)
[下一页](assigning-roles-to-users-vb.md)</span><span class="sxs-lookup"><span data-stu-id="c39d8-338">[Previous](role-based-authorization-cs.md)
[Next](assigning-roles-to-users-vb.md)</span></span>
