---
uid: single-page-application/overview/introduction/knockoutjs-template
title: "单页面应用程序： KnockoutJS 模板 |Microsoft 文档"
author: MikeWasson
description: "Knockout 模板"
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/30/2013
ms.topic: article
ms.assetid: f9c07af0-4b20-4b08-af8f-47fc3df169a2
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /single-page-application/overview/introduction/knockoutjs-template
msc.type: authoredcontent
ms.openlocfilehash: 6e84dcc16345e33fcd3a3f83c4b35bc993c03ca6
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/10/2017
---
<a name="single-page-application-knockoutjs-template"></a><span data-ttu-id="5b040-103">单页面应用程序： KnockoutJS 模板</span><span class="sxs-lookup"><span data-stu-id="5b040-103">Single Page Application: KnockoutJS template</span></span>
====================
<span data-ttu-id="5b040-104">通过[Mike Wasson](https://github.com/MikeWasson)</span><span class="sxs-lookup"><span data-stu-id="5b040-104">by [Mike Wasson](https://github.com/MikeWasson)</span></span>

> <span data-ttu-id="5b040-105">Knockout MVC 模板是 ASP.NET 和 Web Tools 2012.2 的一部分</span><span class="sxs-lookup"><span data-stu-id="5b040-105">The Knockout MVC Template is part of ASP.NET and Web Tools 2012.2</span></span>
> 
> [<span data-ttu-id="5b040-106">下载 ASP.NET 和 Web Tools 2012.2</span><span class="sxs-lookup"><span data-stu-id="5b040-106">Download ASP.NET and Web Tools 2012.2</span></span>](https://go.microsoft.com/fwlink/?LinkId=282650)


<span data-ttu-id="5b040-107">ASP.NET 和 Web Tools 2012.2 更新包含 ASP.NET MVC 4 的单页面应用程序 (SPA) 模板。</span><span class="sxs-lookup"><span data-stu-id="5b040-107">The ASP.NET and Web Tools 2012.2 update includes a Single-Page Application (SPA) template for ASP.NET MVC 4.</span></span> <span data-ttu-id="5b040-108">此模板用于帮助你入门快速生成客户端的交互式 web 应用。</span><span class="sxs-lookup"><span data-stu-id="5b040-108">This template is designed to get you started quickly building interactive client-side web apps.</span></span>

<span data-ttu-id="5b040-109">"单页面应用程序"(SPA) 是常规的 web 应用程序加载单个 HTML 页，然后而不是加载新页面，动态地更新页术语。</span><span class="sxs-lookup"><span data-stu-id="5b040-109">"Single-page application" (SPA) is the general term for a web application that loads a single HTML page and then updates the page dynamically, instead of loading new pages.</span></span> <span data-ttu-id="5b040-110">初始页加载后, SPA 介绍与通过 AJAX 请求服务器。</span><span class="sxs-lookup"><span data-stu-id="5b040-110">After the initial page load, the SPA talks with the server through AJAX requests.</span></span>

![](knockoutjs-template/_static/image1.png)

<span data-ttu-id="5b040-111">AJAX 已是老生常谈，但目前有更加轻松地生成和维护一个大型的复杂的 SPA 应用程序的 JavaScript 框架。</span><span class="sxs-lookup"><span data-stu-id="5b040-111">AJAX is nothing new, but today there are JavaScript frameworks that make it easier to build and maintain a large sophisticated SPA application.</span></span> <span data-ttu-id="5b040-112">此外，html5 和 CSS3 使其更方便地创建丰富的用户界面。</span><span class="sxs-lookup"><span data-stu-id="5b040-112">Also, HTML 5 and CSS3 are making it easier to create rich UIs.</span></span>

<span data-ttu-id="5b040-113">为了帮助你入门，SPA 模板，请创建一个示例"待办事项列表"应用程序。</span><span class="sxs-lookup"><span data-stu-id="5b040-113">To get you started, the SPA template creates a sample "To-do list" application.</span></span> <span data-ttu-id="5b040-114">在本教程中，我们将该模板的指导的教程。</span><span class="sxs-lookup"><span data-stu-id="5b040-114">In this tutorial, we'll take a guided tour of the template.</span></span> <span data-ttu-id="5b040-115">首先我们将查看待办事项列表应用程序本身，然后检查使其适用的技术部分。</span><span class="sxs-lookup"><span data-stu-id="5b040-115">First we'll look at the To-do list application itself, then examine the technology pieces that make it work.</span></span>

## <a name="create-a-new-spa-template-project"></a><span data-ttu-id="5b040-116">创建一个新的 SPA 模板项目</span><span class="sxs-lookup"><span data-stu-id="5b040-116">Create a New SPA Template Project</span></span>

<span data-ttu-id="5b040-117">要求：</span><span class="sxs-lookup"><span data-stu-id="5b040-117">Requirements:</span></span>

- <span data-ttu-id="5b040-118">Visual Studio 2012 或 Visual Studio Express 2012 for Web</span><span class="sxs-lookup"><span data-stu-id="5b040-118">Visual Studio 2012 or Visual Studio Express 2012 for Web</span></span>
- <span data-ttu-id="5b040-119">ASP.NET Web Tools 2012.2 更新。</span><span class="sxs-lookup"><span data-stu-id="5b040-119">ASP.NET Web Tools 2012.2 update.</span></span> <span data-ttu-id="5b040-120">你可以在安装更新[此处](https://www.microsoft.com/web/handlers/webpi.ashx?command=getinstallerredirect&appid=ASPDOTNETandWebTools2012_2)。</span><span class="sxs-lookup"><span data-stu-id="5b040-120">You can install the update [here](https://www.microsoft.com/web/handlers/webpi.ashx?command=getinstallerredirect&appid=ASPDOTNETandWebTools2012_2).</span></span>

<span data-ttu-id="5b040-121">启动 Visual Studio 并选择**新项目**从开始页。</span><span class="sxs-lookup"><span data-stu-id="5b040-121">Start Visual Studio and select **New Project** from the Start page.</span></span> <span data-ttu-id="5b040-122">或从**文件**菜单上，选择**新建**然后**项目**。</span><span class="sxs-lookup"><span data-stu-id="5b040-122">Or, from the **File** menu, select **New** and then **Project**.</span></span>

<span data-ttu-id="5b040-123">在**模板**窗格中，选择**已安装的模板**展开**Visual C#**节点。</span><span class="sxs-lookup"><span data-stu-id="5b040-123">In the **Templates** pane, select **Installed Templates** and expand the **Visual C#** node.</span></span> <span data-ttu-id="5b040-124">下**Visual C#**，选择**Web**。</span><span class="sxs-lookup"><span data-stu-id="5b040-124">Under **Visual C#**, select **Web**.</span></span> <span data-ttu-id="5b040-125">在项目模板列表中，选择**ASP.NET MVC 4 Web 应用程序**。</span><span class="sxs-lookup"><span data-stu-id="5b040-125">In the list of project templates, select **ASP.NET MVC 4 Web Application**.</span></span> <span data-ttu-id="5b040-126">命名该项目并单击**确定**。</span><span class="sxs-lookup"><span data-stu-id="5b040-126">Name the project and click **OK**.</span></span>

![](knockoutjs-template/_static/image2.png)

<span data-ttu-id="5b040-127">在**新项目**向导中，选择**单页面应用程序**。</span><span class="sxs-lookup"><span data-stu-id="5b040-127">In the **New Project** wizard, select **Single Page Application**.</span></span>

![](knockoutjs-template/_static/image3.png)

<span data-ttu-id="5b040-128">按 F5 生成并运行该应用程序。</span><span class="sxs-lookup"><span data-stu-id="5b040-128">Press F5 to build and run the application.</span></span> <span data-ttu-id="5b040-129">第一次运行应用程序，它会显示登录屏幕。</span><span class="sxs-lookup"><span data-stu-id="5b040-129">When the application first runs, it displays a login screen.</span></span>

![](knockoutjs-template/_static/image4.png)

<span data-ttu-id="5b040-130">单击&quot;注册&quot;链接并创建新用户。</span><span class="sxs-lookup"><span data-stu-id="5b040-130">Click the &quot;Sign up&quot; link and create a new user.</span></span>

![](knockoutjs-template/_static/image5.png)

<span data-ttu-id="5b040-131">你在登录后，应用程序将创建具有以下两项默认 Todo 列表。</span><span class="sxs-lookup"><span data-stu-id="5b040-131">After you log in, the application creates a default Todo list with two items.</span></span> <span data-ttu-id="5b040-132">你可以单击"添加 Todo 列表"以添加新列表。</span><span class="sxs-lookup"><span data-stu-id="5b040-132">You can click "Add Todo list" to add a new list.</span></span>

![](knockoutjs-template/_static/image6.png)

<span data-ttu-id="5b040-133">重命名列表，将项添加到列表中，并取消选中它们。</span><span class="sxs-lookup"><span data-stu-id="5b040-133">Rename the list, add items to the list, and check them off.</span></span> <span data-ttu-id="5b040-134">你还可以删除项或删除整个列表。</span><span class="sxs-lookup"><span data-stu-id="5b040-134">You can also delete items or delete an entire list.</span></span> <span data-ttu-id="5b040-135">自动将所做的更改保存到服务器上的数据库 (实际 LocalDB 此时，因为正在本地运行应用程序)。</span><span class="sxs-lookup"><span data-stu-id="5b040-135">The changes are automatically persisted to a database on the server (actually LocalDB at this point, because you are running the application locally).</span></span>

![](knockoutjs-template/_static/image7.png)

## <a name="architecture-of-the-spa-template"></a><span data-ttu-id="5b040-136">SPA 模板的体系结构</span><span class="sxs-lookup"><span data-stu-id="5b040-136">Architecture of the SPA Template</span></span>

<span data-ttu-id="5b040-137">下图显示应用程序主要构建基块。</span><span class="sxs-lookup"><span data-stu-id="5b040-137">This diagram shows the main building blocks for the application.</span></span>

![](knockoutjs-template/_static/image8.png)

<span data-ttu-id="5b040-138">在服务器端中，ASP.NET MVC 提供服务的 HTML，还可以处理基于窗体的身份验证。</span><span class="sxs-lookup"><span data-stu-id="5b040-138">On the server side, ASP.NET MVC serves the HTML and also handles forms-based authentication.</span></span>

<span data-ttu-id="5b040-139">ASP.NET Web API 处理与 ToDoLists 和 ToDoItems，包括获取、 创建、 更新和删除相关的所有请求。</span><span class="sxs-lookup"><span data-stu-id="5b040-139">ASP.NET Web API handles all requests that relate to the ToDoLists and ToDoItems, including getting, creating, updating and deleting.</span></span> <span data-ttu-id="5b040-140">客户端交换使用 Web API 以 JSON 格式的数据。</span><span class="sxs-lookup"><span data-stu-id="5b040-140">The client exchanges data with Web API in JSON format.</span></span>

<span data-ttu-id="5b040-141">Entity Framework (EF) 是 O/RM 层。</span><span class="sxs-lookup"><span data-stu-id="5b040-141">Entity Framework (EF) is the O/RM layer.</span></span> <span data-ttu-id="5b040-142">它面向对象的世界上的 ASP.NET 和基础数据库之间担当中介。</span><span class="sxs-lookup"><span data-stu-id="5b040-142">It mediates between the object-oriented world of ASP.NET and the underlying database.</span></span> <span data-ttu-id="5b040-143">数据库使用 LocalDB，但您可以在 Web.config 文件中更改此。</span><span class="sxs-lookup"><span data-stu-id="5b040-143">The database uses LocalDB but you can change this in the Web.config file.</span></span> <span data-ttu-id="5b040-144">通常，你将以进行本地开发使用 LocalDB，并随后部署到 SQL 数据库在服务器上，使用 EF 代码优先迁移。</span><span class="sxs-lookup"><span data-stu-id="5b040-144">Typically you would use LocalDB for local development and then deploy to a SQL database on the server, using EF code-first migration.</span></span>

<span data-ttu-id="5b040-145">在客户端一侧，Knockout.js 库可处理从 AJAX 请求的页更新。</span><span class="sxs-lookup"><span data-stu-id="5b040-145">On the client side, the Knockout.js library handles page updates from AJAX requests.</span></span> <span data-ttu-id="5b040-146">Knockout 使用数据绑定来使用最新的数据同步页。</span><span class="sxs-lookup"><span data-stu-id="5b040-146">Knockout uses data binding to synchronize the page with the latest data.</span></span> <span data-ttu-id="5b040-147">这样一来，你无需编写任何代码，它将指导完成的 JSON 数据并更新 DOM</span><span class="sxs-lookup"><span data-stu-id="5b040-147">That way, you don't have to write any of the code that walks through the JSON data and updates the DOM.</span></span> <span data-ttu-id="5b040-148">相反，你可以声明性属性置于告诉 Knockout 如何将数据呈现的 HTML。</span><span class="sxs-lookup"><span data-stu-id="5b040-148">Instead, you put declarative attributes in the HTML that tell Knockout how to present the data.</span></span>

<span data-ttu-id="5b040-149">此体系结构的大优点是它将表示层与应用程序逻辑分离。</span><span class="sxs-lookup"><span data-stu-id="5b040-149">A big advantage of this architecture is that it separates the presentation layer from the application logic.</span></span> <span data-ttu-id="5b040-150">你可以创建的 Web API 部分而不必知道有关 web 页面将看起来的任何信息。</span><span class="sxs-lookup"><span data-stu-id="5b040-150">You can create the Web API portion without knowing anything about how your web page will look.</span></span> <span data-ttu-id="5b040-151">在客户端上创建"视图模型"到表示该数据和视图模型使用 Knockout 将绑定到 HTML。</span><span class="sxs-lookup"><span data-stu-id="5b040-151">On the client side, you create a "view model" to represent that data, and the view model uses Knockout to bind to the HTML.</span></span> <span data-ttu-id="5b040-152">它允许你轻松地将 HTML 更改而无需更改视图模型。</span><span class="sxs-lookup"><span data-stu-id="5b040-152">That lets you easily change the HTML without changing the view model.</span></span> <span data-ttu-id="5b040-153">（我们来看看 Knockout 有点更高版本。）</span><span class="sxs-lookup"><span data-stu-id="5b040-153">(We'll look at Knockout a bit later.)</span></span>

## <a name="models"></a><span data-ttu-id="5b040-154">模型</span><span class="sxs-lookup"><span data-stu-id="5b040-154">Models</span></span>

<span data-ttu-id="5b040-155">在 Visual Studio 项目中，模型文件夹包含在服务器端使用的模型。</span><span class="sxs-lookup"><span data-stu-id="5b040-155">In the Visual Studio project, the Models folder contains the models that are used on the server side.</span></span> <span data-ttu-id="5b040-156">（客户端上还有模型; 我们将获取到那些。）</span><span class="sxs-lookup"><span data-stu-id="5b040-156">(There are also models on the client side; we'll get to those.)</span></span>

![](knockoutjs-template/_static/image9.png)

<span data-ttu-id="5b040-157">**TodoItem TodoList**</span><span class="sxs-lookup"><span data-stu-id="5b040-157">**TodoItem, TodoList**</span></span>

<span data-ttu-id="5b040-158">这些是用于 Entity Framework Code First 的数据库模型。</span><span class="sxs-lookup"><span data-stu-id="5b040-158">These are the database models for Entity Framework Code First.</span></span> <span data-ttu-id="5b040-159">请注意这些模型具有指向对方的属性。</span><span class="sxs-lookup"><span data-stu-id="5b040-159">Notice that these models have properties that point to each other.</span></span> <span data-ttu-id="5b040-160">`ToDoList`包含的 Todoitem，并且每个集合`ToDoItem`已返回到其父 ToDoList 的引用。</span><span class="sxs-lookup"><span data-stu-id="5b040-160">`ToDoList` contains a collection of ToDoItems, and each `ToDoItem` has a reference back to its parent ToDoList.</span></span> <span data-ttu-id="5b040-161">这些属性被称为导航属性，以及它们所表示的一对多关系待办事项列表和其待办事项。</span><span class="sxs-lookup"><span data-stu-id="5b040-161">These properties are called navigation properties, and they represent the one-to-many relation a to-do list and its to-do items.</span></span>

<span data-ttu-id="5b040-162">`ToDoItem`类还使用**[ForeignKey]**特性来指定`ToDoListId`是到的外键`ToDoList`表。</span><span class="sxs-lookup"><span data-stu-id="5b040-162">The `ToDoItem` class also uses the **[ForeignKey]** attribute to specify that `ToDoListId` is a foreign key into the `ToDoList` table.</span></span> <span data-ttu-id="5b040-163">这将告知 EF 将 foreign key 约束添加到数据库。</span><span class="sxs-lookup"><span data-stu-id="5b040-163">This tells EF to add a foreign-key constraint to the database.</span></span>

[!code-csharp[Main](knockoutjs-template/samples/sample1.cs)]

<span data-ttu-id="5b040-164">**TodoItemDto TodoListDto**</span><span class="sxs-lookup"><span data-stu-id="5b040-164">**TodoItemDto, TodoListDto**</span></span>

<span data-ttu-id="5b040-165">这些类定义将发送到客户端的数据。</span><span class="sxs-lookup"><span data-stu-id="5b040-165">These classes define the data that will be sent to the client.</span></span> <span data-ttu-id="5b040-166">"DTO"代表"数据传输对象"。</span><span class="sxs-lookup"><span data-stu-id="5b040-166">"DTO" stands for "data transfer object."</span></span> <span data-ttu-id="5b040-167">DTO 定义如何将实体序列化为 JSON。</span><span class="sxs-lookup"><span data-stu-id="5b040-167">The DTO defines how the entities will be serialized into JSON.</span></span> <span data-ttu-id="5b040-168">一般情况下，有几个使用 Dto 的原因：</span><span class="sxs-lookup"><span data-stu-id="5b040-168">In general, there are several reasons to use DTOs:</span></span>

- <span data-ttu-id="5b040-169">若要控制序列化的属性。</span><span class="sxs-lookup"><span data-stu-id="5b040-169">To control which properties are serialized.</span></span> <span data-ttu-id="5b040-170">DTO 可以包含从域模型属性的子集。</span><span class="sxs-lookup"><span data-stu-id="5b040-170">The DTO can contain a subset of the properties from the domain model.</span></span> <span data-ttu-id="5b040-171">你可能会出于安全原因 （以隐藏敏感数据） 或只需执行此来减少你发送的数据量。</span><span class="sxs-lookup"><span data-stu-id="5b040-171">You might do this for security reasons (to hide sensitive data) or simply to reduce the amount of data that you send.</span></span>
- <span data-ttu-id="5b040-172">若要更改形状的数据，例如以平展更复杂的数据结构。</span><span class="sxs-lookup"><span data-stu-id="5b040-172">To change the shape of the data – e.g. to flatten a more complex data structure.</span></span>
- <span data-ttu-id="5b040-173">若要保留 DTO （关注点分离） 之外的任何业务逻辑。</span><span class="sxs-lookup"><span data-stu-id="5b040-173">To keep any business logic out of the DTO (separation of concerns).</span></span>
- <span data-ttu-id="5b040-174">如果出于某种原因，域模型无法序列化。</span><span class="sxs-lookup"><span data-stu-id="5b040-174">If your domain models cannot be serialized for some reason.</span></span> <span data-ttu-id="5b040-175">例如，循环引用可能会导致问题在序列化有一个对象时如何处理此问题，Web API 中的 (请参阅[处理循环对象引用](../../../web-api/overview/formats-and-model-binding/json-and-xml-serialization.md#handling_circular_object_references)); 但是使用 DTO 只是完全避免问题。</span><span class="sxs-lookup"><span data-stu-id="5b040-175">For example, circular references can cause problems when you serialize an object There are ways to handle this problem in Web API (see [Handling Circular Object References](../../../web-api/overview/formats-and-model-binding/json-and-xml-serialization.md#handling_circular_object_references)); but using a DTO simply avoids the problem altogether.</span></span>

<span data-ttu-id="5b040-176">在 SPA 模板中，Dto 包含域模型相同的数据。</span><span class="sxs-lookup"><span data-stu-id="5b040-176">In the SPA template, the DTOs contains the same data as the domain models.</span></span> <span data-ttu-id="5b040-177">但是，它们是仍可因为它们避免循环引用导航属性，并且它们演示了一个常规模式，DTO。</span><span class="sxs-lookup"><span data-stu-id="5b040-177">However, they are still useful because they avoid circular references from the navigation properties, and they demonstrate the general DTO pattern.</span></span>

<span data-ttu-id="5b040-178">**AccountModels.cs**</span><span class="sxs-lookup"><span data-stu-id="5b040-178">**AccountModels.cs**</span></span>

<span data-ttu-id="5b040-179">此文件包含站点成员身份的模型。</span><span class="sxs-lookup"><span data-stu-id="5b040-179">This file contains models for site membership.</span></span> <span data-ttu-id="5b040-180">`UserProfile`类定义成员资格数据库中的用户配置文件的架构。</span><span class="sxs-lookup"><span data-stu-id="5b040-180">The `UserProfile` class defines the schema for user profiles in the membership DB.</span></span> <span data-ttu-id="5b040-181">（在这种情况下，唯一信息是用户 ID 和用户名。）此文件中的其他模型类用于创建用户注册和登录窗体。</span><span class="sxs-lookup"><span data-stu-id="5b040-181">(In this case, the only information is the user ID and the user name.) The other model classes in this file are used to create the user registration and login forms.</span></span>

## <a name="entity-framework"></a><span data-ttu-id="5b040-182">Entity Framework</span><span class="sxs-lookup"><span data-stu-id="5b040-182">Entity Framework</span></span>

<span data-ttu-id="5b040-183">SPA 模板使用 EF Code First。</span><span class="sxs-lookup"><span data-stu-id="5b040-183">The SPA template uses EF Code First.</span></span> <span data-ttu-id="5b040-184">在 Code First 开发中，你定义模型首先在代码中，而 EF 然后使用模型来创建数据库。</span><span class="sxs-lookup"><span data-stu-id="5b040-184">In Code First development, you define the models first in code, and then EF uses the model to create the database.</span></span> <span data-ttu-id="5b040-185">此外可以使用现有的数据库使用 EF ([Database First](https://msdn.microsoft.com/en-us/data/jj206878.aspx))。</span><span class="sxs-lookup"><span data-stu-id="5b040-185">You can also use EF with an existing database ([Database First](https://msdn.microsoft.com/en-us/data/jj206878.aspx)).</span></span>

<span data-ttu-id="5b040-186">`TodoItemContext`在 Models 文件夹中的类派生自**DbContext**。</span><span class="sxs-lookup"><span data-stu-id="5b040-186">The `TodoItemContext` class in the Models folder derives from **DbContext**.</span></span> <span data-ttu-id="5b040-187">此类提供"粘附"模型和 EF 之间。</span><span class="sxs-lookup"><span data-stu-id="5b040-187">This class provides the "glue" between the models and EF.</span></span> <span data-ttu-id="5b040-188">`TodoItemContext`保存`ToDoItem`集合和一个`TodoList`集合。</span><span class="sxs-lookup"><span data-stu-id="5b040-188">The `TodoItemContext` holds a `ToDoItem` collection and a `TodoList` collection.</span></span> <span data-ttu-id="5b040-189">若要查询数据库时，你只需编写针对这些集合的 LINQ 查询。</span><span class="sxs-lookup"><span data-stu-id="5b040-189">To query the database, you simply write a LINQ query against these collections.</span></span> <span data-ttu-id="5b040-190">例如，下面是如何选择所有用户"Alice"待办事项列表：</span><span class="sxs-lookup"><span data-stu-id="5b040-190">For example, here is how you can select all of the to-do lists for user "Alice":</span></span>

[!code-csharp[Main](knockoutjs-template/samples/sample2.cs)]

<span data-ttu-id="5b040-191">你也可以向集合添加新项，更新项，或从集合中删除项和保留对数据库的更改。</span><span class="sxs-lookup"><span data-stu-id="5b040-191">You can also add new items to the collection, update items, or delete items from the collection, and persist the changes to the database.</span></span>

## <a name="aspnet-web-api-controllers"></a><span data-ttu-id="5b040-192">ASP.NET Web API 控制器</span><span class="sxs-lookup"><span data-stu-id="5b040-192">ASP.NET Web API Controllers</span></span>

<span data-ttu-id="5b040-193">在 ASP.NET Web API 中，控制器在处理 HTTP 请求的对象。</span><span class="sxs-lookup"><span data-stu-id="5b040-193">In ASP.NET Web API, controllers are objects that handle HTTP requests.</span></span> <span data-ttu-id="5b040-194">如前文所述，SPA 模板使用 Web API 上启用 CRUD 操作`ToDoList`和`ToDoItem`实例。</span><span class="sxs-lookup"><span data-stu-id="5b040-194">As mentioned, the SPA template uses Web API to enable CRUD operations on `ToDoList` and `ToDoItem` instances.</span></span> <span data-ttu-id="5b040-195">控制器位于该解决方案的 Controllers 文件夹中。</span><span class="sxs-lookup"><span data-stu-id="5b040-195">The controllers are located in the Controllers folder of the solution.</span></span>

![](knockoutjs-template/_static/image10.png)

- <span data-ttu-id="5b040-196">`TodoController`： 处理待办事项的 HTTP 请求</span><span class="sxs-lookup"><span data-stu-id="5b040-196">`TodoController`: Handles HTTP requests for to-do items</span></span>
- <span data-ttu-id="5b040-197">`TodoListController`： 处理待办事项列表的 HTTP 请求。</span><span class="sxs-lookup"><span data-stu-id="5b040-197">`TodoListController`: Handles HTTP requests for to-do lists.</span></span>

<span data-ttu-id="5b040-198">因为 Web API 与控制器名称的 URI 路径相匹配，都有意义，这些名称。</span><span class="sxs-lookup"><span data-stu-id="5b040-198">These names are significant, because Web API matches the URI path to the controller name.</span></span> <span data-ttu-id="5b040-199">(若要了解 Web API 将 HTTP 请求路由到控制器的方式，请参阅[路由在 ASP.NET Web API 中](../../../web-api/overview/web-api-routing-and-actions/routing-in-aspnet-web-api.md)。)</span><span class="sxs-lookup"><span data-stu-id="5b040-199">(To learn how Web API routes HTTP requests to controllers, see [Routing in ASP.NET Web API](../../../web-api/overview/web-api-routing-and-actions/routing-in-aspnet-web-api.md).)</span></span>

<span data-ttu-id="5b040-200">让我们看一下`ToDoListController`类。</span><span class="sxs-lookup"><span data-stu-id="5b040-200">Let's look at the `ToDoListController` class.</span></span> <span data-ttu-id="5b040-201">它包含单个数据成员：</span><span class="sxs-lookup"><span data-stu-id="5b040-201">It contains a single data member:</span></span>

[!code-csharp[Main](knockoutjs-template/samples/sample3.cs)]

<span data-ttu-id="5b040-202">`TodoItemContext`用于通信和 EF，如前面所述。</span><span class="sxs-lookup"><span data-stu-id="5b040-202">The `TodoItemContext` is used to communicate with EF, as described earlier.</span></span> <span data-ttu-id="5b040-203">在控制器上的方法实现的 CRUD 操作。</span><span class="sxs-lookup"><span data-stu-id="5b040-203">The methods on the controller implement the CRUD operations.</span></span> <span data-ttu-id="5b040-204">Web API，如下所示映射到控制器的方法，从客户端的 HTTP 请求：</span><span class="sxs-lookup"><span data-stu-id="5b040-204">Web API maps HTTP requests from the client to controller methods, as follows:</span></span>

| <span data-ttu-id="5b040-205">HTTP 请求</span><span class="sxs-lookup"><span data-stu-id="5b040-205">HTTP Request</span></span> | <span data-ttu-id="5b040-206">控制器方法</span><span class="sxs-lookup"><span data-stu-id="5b040-206">Controller Method</span></span> | <span data-ttu-id="5b040-207">描述</span><span class="sxs-lookup"><span data-stu-id="5b040-207">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="5b040-208">GET /api/todo</span><span class="sxs-lookup"><span data-stu-id="5b040-208">GET /api/todo</span></span> | `GetTodoLists` | <span data-ttu-id="5b040-209">获取待办事项列表的集合。</span><span class="sxs-lookup"><span data-stu-id="5b040-209">Gets a collection of to-do lists.</span></span> |
| <span data-ttu-id="5b040-210">GET/api/todo/*id*</span><span class="sxs-lookup"><span data-stu-id="5b040-210">GET /api/todo/*id*</span></span> | `GetTodoList` | <span data-ttu-id="5b040-211">获取按 ID 待办事项列表</span><span class="sxs-lookup"><span data-stu-id="5b040-211">Gets a to-do list by ID</span></span> |
| <span data-ttu-id="5b040-212">PUT/api/todo/*id*</span><span class="sxs-lookup"><span data-stu-id="5b040-212">PUT /api/todo/*id*</span></span> | `PutTodoList` | <span data-ttu-id="5b040-213">更新一个待办事项列表。</span><span class="sxs-lookup"><span data-stu-id="5b040-213">Updates a to-do list.</span></span> |
| <span data-ttu-id="5b040-214">POST /api/todo</span><span class="sxs-lookup"><span data-stu-id="5b040-214">POST /api/todo</span></span> | `PostTodoList` | <span data-ttu-id="5b040-215">创建一个新的待办事项列表。</span><span class="sxs-lookup"><span data-stu-id="5b040-215">Creates a new to-do list.</span></span> |
| <span data-ttu-id="5b040-216">删除/api/todo/*id*</span><span class="sxs-lookup"><span data-stu-id="5b040-216">DELETE /api/todo/*id*</span></span> | `DeleteTodoList` | <span data-ttu-id="5b040-217">删除 TODO 列表。</span><span class="sxs-lookup"><span data-stu-id="5b040-217">Deletes a TODO list.</span></span> |

<span data-ttu-id="5b040-218">请注意，对于某些操作的 Uri 包含的 ID 值的占位符。</span><span class="sxs-lookup"><span data-stu-id="5b040-218">Notice that the URIs for some operations contain placeholders for the ID value.</span></span> <span data-ttu-id="5b040-219">例如，若要删除到-列表 id 为 42，URI 是`/api/todo/42`。</span><span class="sxs-lookup"><span data-stu-id="5b040-219">For example, to delete a to-list with an ID of 42, the URI is `/api/todo/42`.</span></span>

<span data-ttu-id="5b040-220">若要了解有关使用 Web API 的 CRUD 操作的详细信息，请参阅[创建该支持 CRUD 操作的 Web API](../../../web-api/overview/older-versions/creating-a-web-api-that-supports-crud-operations.md)。</span><span class="sxs-lookup"><span data-stu-id="5b040-220">To learn more about using Web API for CRUD operations, see [Creating a Web API that Supports CRUD Operations](../../../web-api/overview/older-versions/creating-a-web-api-that-supports-crud-operations.md).</span></span> <span data-ttu-id="5b040-221">此控制器的代码将非常简单。</span><span class="sxs-lookup"><span data-stu-id="5b040-221">The code for this controller is fairly straightforward.</span></span> <span data-ttu-id="5b040-222">以下是一些有趣的要点：</span><span class="sxs-lookup"><span data-stu-id="5b040-222">Here are some interesting points:</span></span>

- <span data-ttu-id="5b040-223">`GetTodoLists`方法使用 LINQ 查询来筛选的登录的用户 ID 通过结果。</span><span class="sxs-lookup"><span data-stu-id="5b040-223">The `GetTodoLists` method uses a LINQ query to filter the results by the ID of the logged-in user.</span></span> <span data-ttu-id="5b040-224">这样一来，用户仅看到他 / 她所属的数据。</span><span class="sxs-lookup"><span data-stu-id="5b040-224">That way, a user only sees the data that belongs to him or her.</span></span> <span data-ttu-id="5b040-225">此外，请注意 Select 语句用于将转换`ToDoList`实例到`TodoListDto`实例。</span><span class="sxs-lookup"><span data-stu-id="5b040-225">Also, notice that a Select statement is used to convert the `ToDoList` instances into `TodoListDto` instances.</span></span>
- <span data-ttu-id="5b040-226">PUT 和 POST 方法修改数据库之前检查模型状态。</span><span class="sxs-lookup"><span data-stu-id="5b040-226">The PUT and POST methods check the model state before modifying the database.</span></span> <span data-ttu-id="5b040-227">如果**ModelState.IsValid**为 false，这些方法将返回 HTTP 400 错误的请求。</span><span class="sxs-lookup"><span data-stu-id="5b040-227">If **ModelState.IsValid** is false, these methods return HTTP 400, Bad Request.</span></span> <span data-ttu-id="5b040-228">阅读有关在 Web API 中的模型验证的详细信息[模型验证](../../../web-api/overview/formats-and-model-binding/model-validation-in-aspnet-web-api.md)。</span><span class="sxs-lookup"><span data-stu-id="5b040-228">Read more about model validation in Web API at [Model Validation](../../../web-api/overview/formats-and-model-binding/model-validation-in-aspnet-web-api.md).</span></span>
- <span data-ttu-id="5b040-229">控制器类也用修饰**[Authorize]**属性。</span><span class="sxs-lookup"><span data-stu-id="5b040-229">The controller class is also decorated with the **[Authorize]** attribute.</span></span> <span data-ttu-id="5b040-230">此属性检查 HTTP 请求进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="5b040-230">This attribute checks whether the HTTP request is authenticated.</span></span> <span data-ttu-id="5b040-231">如果请求未通过身份验证，客户端收到 HTTP 401 未授权。</span><span class="sxs-lookup"><span data-stu-id="5b040-231">If the request is not authenticated, the client receives HTTP 401, Unauthorized.</span></span> <span data-ttu-id="5b040-232">阅读有关在身份验证的详细信息[身份验证和 ASP.NET Web API 中的授权](../../../web-api/overview/security/authentication-and-authorization-in-aspnet-web-api.md)。</span><span class="sxs-lookup"><span data-stu-id="5b040-232">Read more about authentication at [Authentication and Authorization in ASP.NET Web API](../../../web-api/overview/security/authentication-and-authorization-in-aspnet-web-api.md).</span></span>

<span data-ttu-id="5b040-233">`TodoController`类是非常类似于`TodoListController`。</span><span class="sxs-lookup"><span data-stu-id="5b040-233">The `TodoController` class is very similar to `TodoListController`.</span></span> <span data-ttu-id="5b040-234">最大的区别是它不定义任何 GET 方法中，因为客户端将会获得待办事项项目，以及每个待办事项列表。</span><span class="sxs-lookup"><span data-stu-id="5b040-234">The biggest difference is that it does not define any GET methods, because the client will get the to-do items along with each to-do list.</span></span>

## <a name="mvc-controllers-and-views"></a><span data-ttu-id="5b040-235">MVC 控制器和视图</span><span class="sxs-lookup"><span data-stu-id="5b040-235">MVC Controllers and Views</span></span>

<span data-ttu-id="5b040-236">MVC 控制器也位于该解决方案的 Controllers 文件夹中。</span><span class="sxs-lookup"><span data-stu-id="5b040-236">The MVC controllers are also located in the Controllers folder of the solution.</span></span> <span data-ttu-id="5b040-237">`HomeController`应用程序的主要 HTML 呈现。</span><span class="sxs-lookup"><span data-stu-id="5b040-237">`HomeController` renders the main HTML for the application.</span></span> <span data-ttu-id="5b040-238">Views/Home/Index.cshtml 中定义了主控制器的视图。</span><span class="sxs-lookup"><span data-stu-id="5b040-238">The view for the Home controller is defined in Views/Home/Index.cshtml.</span></span> <span data-ttu-id="5b040-239">主页视图呈现具体取决于是否将用户记录的不同内容：</span><span class="sxs-lookup"><span data-stu-id="5b040-239">The Home view renders different content depending on whether the user is logged in:</span></span>

[!code-cshtml[Main](knockoutjs-template/samples/sample4.cshtml)]

<span data-ttu-id="5b040-240">当用户登录时，他们将看到的主 UI。</span><span class="sxs-lookup"><span data-stu-id="5b040-240">When users are logged in, they see the main UI.</span></span> <span data-ttu-id="5b040-241">否则，它们将看到登录面板。</span><span class="sxs-lookup"><span data-stu-id="5b040-241">Otherwise, they see the login panel.</span></span> <span data-ttu-id="5b040-242">请注意在服务器端时发生此条件的呈现。</span><span class="sxs-lookup"><span data-stu-id="5b040-242">Note that this conditional rendering happens on the server side.</span></span> <span data-ttu-id="5b040-243">决不会尝试隐藏客户端上的敏感内容 （&) 在 HTTP 响应中发送的 #8212anything 是对观察原始 HTTP 消息的任何人员可见。</span><span class="sxs-lookup"><span data-stu-id="5b040-243">Never try to hide sensitive content on the client side&#8212anything that you send in an HTTP response is visible to someone who is watching the raw HTTP messages.</span></span>

## <a name="client-side-javascript-and-knockoutjs"></a><span data-ttu-id="5b040-244">客户端 JavaScript 和 Knockout.js</span><span class="sxs-lookup"><span data-stu-id="5b040-244">Client-Side JavaScript and Knockout.js</span></span>

<span data-ttu-id="5b040-245">现在我们将从服务器端到客户端应用程序。</span><span class="sxs-lookup"><span data-stu-id="5b040-245">Now let's turn from the server side of the application to the client.</span></span> <span data-ttu-id="5b040-246">SPA 模板使用 jQuery 和 Knockout.js 的组合来创建平滑的交互式 UI。</span><span class="sxs-lookup"><span data-stu-id="5b040-246">The SPA template uses a combination of jQuery and Knockout.js to create a smooth, interactive UI.</span></span> <span data-ttu-id="5b040-247">Knockout.js 是一个 JavaScript 库，可以轻松地将 HTML 绑定到数据。</span><span class="sxs-lookup"><span data-stu-id="5b040-247">Knockout.js is a JavaScript library that makes it easy to bind HTML to data.</span></span> <span data-ttu-id="5b040-248">Knockout.js 使用一种模式称为"模型-视图-视图模型。"</span><span class="sxs-lookup"><span data-stu-id="5b040-248">Knockout.js uses a pattern called "Model-View-ViewModel."</span></span>

- <span data-ttu-id="5b040-249">该模型是域数据 （ToDo 列表和 ToDo 项）。</span><span class="sxs-lookup"><span data-stu-id="5b040-249">The model is the domain data (ToDo lists and ToDo items).</span></span>
- <span data-ttu-id="5b040-250">该视图是 HTML 文档。</span><span class="sxs-lookup"><span data-stu-id="5b040-250">The view is the HTML document.</span></span>
- <span data-ttu-id="5b040-251">视图模型是包含模型数据的 JavaScript 对象。</span><span class="sxs-lookup"><span data-stu-id="5b040-251">The view-model is a JavaScript object that holds the model data.</span></span> <span data-ttu-id="5b040-252">视图模型是 UI 的代码抽象。</span><span class="sxs-lookup"><span data-stu-id="5b040-252">The view-model is a code abstraction of the UI.</span></span> <span data-ttu-id="5b040-253">它具有的 HTML 表示不知道。</span><span class="sxs-lookup"><span data-stu-id="5b040-253">It has no knowledge of the HTML representation.</span></span> <span data-ttu-id="5b040-254">相反，它表示抽象视图，例如"ToDo 项的列表"的功能。</span><span class="sxs-lookup"><span data-stu-id="5b040-254">Instead, it represents abstract features of the view, such as "a list of ToDo items".</span></span>

<span data-ttu-id="5b040-255">该视图被数据绑定到视图模型。</span><span class="sxs-lookup"><span data-stu-id="5b040-255">The view is data-bound to the view-model.</span></span> <span data-ttu-id="5b040-256">对视图模型更新会自动反映在视图中。</span><span class="sxs-lookup"><span data-stu-id="5b040-256">Updates to the view-model are automatically reflected in the view.</span></span> <span data-ttu-id="5b040-257">绑定都可以其他的方向。</span><span class="sxs-lookup"><span data-stu-id="5b040-257">Bindings work the other direction as well.</span></span> <span data-ttu-id="5b040-258">DOM （如，单击） 中的事件是数据绑定到函数在视图模型上触发 AJAX 调用的。</span><span class="sxs-lookup"><span data-stu-id="5b040-258">Events in the DOM (such as clicks) are data-bound to functions on the view model, which trigger AJAX calls.</span></span>

<span data-ttu-id="5b040-259">SPA 模板将客户端 JavaScript 组织成三层：</span><span class="sxs-lookup"><span data-stu-id="5b040-259">The SPA template organizes the client-side JavaScript into three layers:</span></span>

- <span data-ttu-id="5b040-260">todo.datacontext.js： 发送 AJAX 请求。</span><span class="sxs-lookup"><span data-stu-id="5b040-260">todo.datacontext.js: Sends AJAX requests.</span></span>
- <span data-ttu-id="5b040-261">todo.model.js： 定义模型。</span><span class="sxs-lookup"><span data-stu-id="5b040-261">todo.model.js: Defines the models.</span></span>
- <span data-ttu-id="5b040-262">todo.viewmodel.js： 定义视图模型。</span><span class="sxs-lookup"><span data-stu-id="5b040-262">todo.viewmodel.js: Defines the view model.</span></span>

![](knockoutjs-template/_static/image11.png)

<span data-ttu-id="5b040-263">这些脚本文件位于解决方案的脚本/应用程序文件夹中。</span><span class="sxs-lookup"><span data-stu-id="5b040-263">These script files are located in the Scripts/app folder of the solution.</span></span>

![](knockoutjs-template/_static/image12.png)

<span data-ttu-id="5b040-264">**todo.datacontext**处理所有 AJAX 调用到 Web API 控制器。</span><span class="sxs-lookup"><span data-stu-id="5b040-264">**todo.datacontext** handles all AJAX calls to the Web API controllers.</span></span> <span data-ttu-id="5b040-265">（用于登录的 AJAX 调用在其他位置中, 定义 ajaxlogin.js。）</span><span class="sxs-lookup"><span data-stu-id="5b040-265">(The AJAX calls for logging in are defined elsewhere, in ajaxlogin.js.)</span></span>

<span data-ttu-id="5b040-266">**todo.model.js**定义待办事项列表客户端 （浏览器） 模型。</span><span class="sxs-lookup"><span data-stu-id="5b040-266">**todo.model.js** defines the client-side (browser) models for the to-do lists.</span></span> <span data-ttu-id="5b040-267">有两个模型类： todoItem 和 todoList。</span><span class="sxs-lookup"><span data-stu-id="5b040-267">There are two model classes: todoItem and todoList.</span></span>

<span data-ttu-id="5b040-268">许多模型类中的属性属于类型"ko.observable"。</span><span class="sxs-lookup"><span data-stu-id="5b040-268">Many of the properties in the model classes are of type "ko.observable".</span></span> <span data-ttu-id="5b040-269">可观察对象是 Knockout 原理其幻数。</span><span class="sxs-lookup"><span data-stu-id="5b040-269">Observables are how Knockout does its magic.</span></span> <span data-ttu-id="5b040-270">从[Knockout 文档](http://knockoutjs.com/documentation/introduction.html): 可观测对象是一个"JavaScript 对象，可以通知有关更改的订阅服务器。"</span><span class="sxs-lookup"><span data-stu-id="5b040-270">From the [Knockout documentation](http://knockoutjs.com/documentation/introduction.html): An observable is a "JavaScript object that can notify subscribers about changes."</span></span> <span data-ttu-id="5b040-271">当可观测对象的值发生更改时，Knockout 更新绑定到这些可观察对象的任何 HTML 元素。</span><span class="sxs-lookup"><span data-stu-id="5b040-271">When the value of an observable changes, Knockout updates any HTML elements that are bound to those observables.</span></span> <span data-ttu-id="5b040-272">例如，todoItem 具有标题和 isDone 属性的可观察对象：</span><span class="sxs-lookup"><span data-stu-id="5b040-272">For example, todoItem has observables for the title and isDone properties:</span></span>

[!code-javascript[Main](knockoutjs-template/samples/sample5.js)]

<span data-ttu-id="5b040-273">你还可以订阅在代码中的可观测对象。</span><span class="sxs-lookup"><span data-stu-id="5b040-273">You can also subscribe to an observable in code.</span></span> <span data-ttu-id="5b040-274">例如，"isDone"和"title"属性中的更改订阅的 todoItem 类：</span><span class="sxs-lookup"><span data-stu-id="5b040-274">For example, the todoItem class subscribes to changes in the "isDone" and "title" properties:</span></span>

[!code-javascript[Main](knockoutjs-template/samples/sample6.js)]

<span data-ttu-id="5b040-275">**视图模型**</span><span class="sxs-lookup"><span data-stu-id="5b040-275">**View Model**</span></span>

<span data-ttu-id="5b040-276">视图模型是在 todo.viewmodel.js 中定义的。</span><span class="sxs-lookup"><span data-stu-id="5b040-276">The view model is defined in todo.viewmodel.js.</span></span> <span data-ttu-id="5b040-277">视图模型是其中应用程序将 HTML 页元素绑定到域数据的中心点。</span><span class="sxs-lookup"><span data-stu-id="5b040-277">The view model is the central point where the application binds the HTML page elements to the domain data.</span></span> <span data-ttu-id="5b040-278">在 SPA 模板中，视图模型包含 todoLists 可观察到的数组。</span><span class="sxs-lookup"><span data-stu-id="5b040-278">In the SPA template, the view model contains an observable array of todoLists.</span></span> <span data-ttu-id="5b040-279">视图模型中的以下代码将指示 Knockout 要应用绑定：</span><span class="sxs-lookup"><span data-stu-id="5b040-279">The following code in the view model tells Knockout to apply the bindings:</span></span>

[!code-javascript[Main](knockoutjs-template/samples/sample7.js)]

## <a name="html-and-data-binding"></a><span data-ttu-id="5b040-280">HTML 和数据绑定</span><span class="sxs-lookup"><span data-stu-id="5b040-280">HTML and Data Binding</span></span>

<span data-ttu-id="5b040-281">Views/Home/Index.cshtml 中定义了主要 HTML 页。</span><span class="sxs-lookup"><span data-stu-id="5b040-281">The main HTML for the page is defined in Views/Home/Index.cshtml.</span></span> <span data-ttu-id="5b040-282">因为我们正在使用数据绑定，HTML 只是一个模板实际获取呈现效果。</span><span class="sxs-lookup"><span data-stu-id="5b040-282">Because we are using data-binding, the HTML is only a template for what actually gets rendered.</span></span> <span data-ttu-id="5b040-283">使用 knockout*声明性*绑定。</span><span class="sxs-lookup"><span data-stu-id="5b040-283">Knockout uses *declarative* bindings.</span></span> <span data-ttu-id="5b040-284">通过将"数据绑定"属性添加到该元素将页元素绑定到数据。</span><span class="sxs-lookup"><span data-stu-id="5b040-284">You bind page elements to data by adding a "data-bind" attribute to the element.</span></span> <span data-ttu-id="5b040-285">下面是一个非常简单的示例，摘自 Knockout 文档：</span><span class="sxs-lookup"><span data-stu-id="5b040-285">Here is a very simple example, taken from the Knockout documentation:</span></span>

[!code-html[Main](knockoutjs-template/samples/sample8.html)]

<span data-ttu-id="5b040-286">在此示例中，Knockout 更新的内容**&lt;跨越&gt;**具有的值的元素`myItems.count()`。</span><span class="sxs-lookup"><span data-stu-id="5b040-286">In this example, Knockout updates the contents of the **&lt;span&gt;** element with the value of `myItems.count()`.</span></span> <span data-ttu-id="5b040-287">当此值发生更改时，Knockout 更新文档。</span><span class="sxs-lookup"><span data-stu-id="5b040-287">Whenever this value changes, Knockout updates the document.</span></span>

<span data-ttu-id="5b040-288">Knockout 提供大量的不同绑定类型。</span><span class="sxs-lookup"><span data-stu-id="5b040-288">Knockout provides a number of different binding types.</span></span> <span data-ttu-id="5b040-289">下面是一些在 SPA 模板中使用的绑定：</span><span class="sxs-lookup"><span data-stu-id="5b040-289">Here are some of the bindings used in the SPA template:</span></span>

- <span data-ttu-id="5b040-290">**foreach**： 可以循环访问一个循环并应用于列表中的每个项目的相同标记。</span><span class="sxs-lookup"><span data-stu-id="5b040-290">**foreach**: Lets you iterate through a loop and apply the same markup to each item in the list.</span></span> <span data-ttu-id="5b040-291">这用于呈现的待办事项列表和待办事项。</span><span class="sxs-lookup"><span data-stu-id="5b040-291">This is used to render the to-do lists and to-do items.</span></span> <span data-ttu-id="5b040-292">在**foreach**，绑定应用于列表中的元素。</span><span class="sxs-lookup"><span data-stu-id="5b040-292">Within the **foreach**, the bindings are applied to the elements of the list.</span></span>
- <span data-ttu-id="5b040-293">**可见**： 用于切换可见性。</span><span class="sxs-lookup"><span data-stu-id="5b040-293">**visible**: Used to toggle visibility.</span></span> <span data-ttu-id="5b040-294">隐藏标记，当集合为空，或使错误消息可见。</span><span class="sxs-lookup"><span data-stu-id="5b040-294">Hide markup when a collection is empty, or make the error message visible.</span></span>
- <span data-ttu-id="5b040-295">**值**： 用于填充窗体值。</span><span class="sxs-lookup"><span data-stu-id="5b040-295">**value**: Used to populate form values.</span></span>
- <span data-ttu-id="5b040-296">**单击**： 将一个 click 事件绑定到视图模型上的函数。</span><span class="sxs-lookup"><span data-stu-id="5b040-296">**click**: Binds a click event to a function on the view model.</span></span>

## <a name="anti-csrf-protection"></a><span data-ttu-id="5b040-297">反 CSRF 保护</span><span class="sxs-lookup"><span data-stu-id="5b040-297">Anti-CSRF Protection</span></span>

<span data-ttu-id="5b040-298">跨站点请求伪造 (CSRF) 是一种攻击，恶意站点向在当前登录用户的易受攻击站点发送请求的位置。</span><span class="sxs-lookup"><span data-stu-id="5b040-298">Cross-Site Request Forgery (CSRF) is an attack where a malicious site sends a request to a vulnerable site where the user is currently logged in.</span></span> <span data-ttu-id="5b040-299">为了帮助防止 CSRF 攻击，ASP.NET MVC 使用*防伪令牌*，也称为请求验证令牌。</span><span class="sxs-lookup"><span data-stu-id="5b040-299">To help prevent CSRF attacks, ASP.NET MVC uses *anti-forgery tokens*, also called request verification tokens.</span></span> <span data-ttu-id="5b040-300">思路是服务器将随机生成的令牌放到网页。</span><span class="sxs-lookup"><span data-stu-id="5b040-300">The idea is that the server puts a randomly generated token into a web page.</span></span> <span data-ttu-id="5b040-301">当客户端提交到服务器的数据时，它必须在请求消息中包括此值。</span><span class="sxs-lookup"><span data-stu-id="5b040-301">When the client submits data to the server, it must include this value in the request message.</span></span>

<span data-ttu-id="5b040-302">防伪令牌，因为恶意页无法读取用户的令牌，由于同源策略工作。</span><span class="sxs-lookup"><span data-stu-id="5b040-302">Anti-forgery tokens work because the malicious page cannot read the user's tokens, due to same-origin policies.</span></span> <span data-ttu-id="5b040-303">（同源策略将阻止访问彼此的内容的两个不同站点上托管的文档）。</span><span class="sxs-lookup"><span data-stu-id="5b040-303">(Same-origin policies prevent documents hosted on two different sites from accessing each other's content.)</span></span>

<span data-ttu-id="5b040-304">ASP.NET MVC 防伪令牌，通过提供内置支持[AntiForgery](https://msdn.microsoft.com/en-us/library/system.web.helpers.antiforgery.aspx)类和[[ValidateAntiForgeryToken]](https://msdn.microsoft.com/en-us/library/system.web.mvc.validateantiforgerytokenattribute.aspx)属性。</span><span class="sxs-lookup"><span data-stu-id="5b040-304">ASP.NET MVC provides built-in support for anti-forgery tokens, through the [AntiForgery](https://msdn.microsoft.com/en-us/library/system.web.helpers.antiforgery.aspx) class and the [[ValidateAntiForgeryToken]](https://msdn.microsoft.com/en-us/library/system.web.mvc.validateantiforgerytokenattribute.aspx) attribute.</span></span> <span data-ttu-id="5b040-305">目前，此功能的非内置 Web API。</span><span class="sxs-lookup"><span data-stu-id="5b040-305">Currently, this functionality is not built into Web API.</span></span> <span data-ttu-id="5b040-306">但是，SPA 模板包含自定义实现 Web api。</span><span class="sxs-lookup"><span data-stu-id="5b040-306">However, the SPA template includes a custom implementation for Web API.</span></span> <span data-ttu-id="5b040-307">此代码中定义`ValidateHttpAntiForgeryTokenAttribute`类，该类位于该解决方案的筛选器文件夹中。</span><span class="sxs-lookup"><span data-stu-id="5b040-307">This code is defined in the `ValidateHttpAntiForgeryTokenAttribute` class, which is located in the Filters folder of the solution.</span></span> <span data-ttu-id="5b040-308">若要了解有关 Web API 中的反 CSRF 的详细信息，请参阅[防止跨站点请求伪造 (CSRF) 攻击](../../../web-api/overview/security/preventing-cross-site-request-forgery-csrf-attacks.md)。</span><span class="sxs-lookup"><span data-stu-id="5b040-308">To learn more about anti-CSRF in Web API, see [Preventing Cross-Site Request Forgery (CSRF) Attacks](../../../web-api/overview/security/preventing-cross-site-request-forgery-csrf-attacks.md).</span></span>

## <a name="conclusion"></a><span data-ttu-id="5b040-309">结束语</span><span class="sxs-lookup"><span data-stu-id="5b040-309">Conclusion</span></span>

<span data-ttu-id="5b040-310">SPA 模板旨在帮助你入门快速编写现代的交互式 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="5b040-310">The SPA template is designed to get you started quickly writing modern, interactive web applications.</span></span> <span data-ttu-id="5b040-311">它使用 Knockout.js 库来分离数据和应用程序逻辑的演示文稿 （HTML 标记）。</span><span class="sxs-lookup"><span data-stu-id="5b040-311">It uses the Knockout.js library to separate presentation (HTML markup) from the data and application logic.</span></span> <span data-ttu-id="5b040-312">但 Knockout 不是唯一可用于创建 SPA 的 JavaScript 库。</span><span class="sxs-lookup"><span data-stu-id="5b040-312">But Knockout is not the only JavaScript library you can use to create a SPA.</span></span> <span data-ttu-id="5b040-313">如果你想要浏览其他一些选项，看一看[社区创建的 SPA 模板](../templates/index.md)。</span><span class="sxs-lookup"><span data-stu-id="5b040-313">If you want to explore some other options, take a look at the [community-created SPA templates](../templates/index.md).</span></span>
